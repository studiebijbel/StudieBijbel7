/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"e2cadd41-59a4-4017-b6fe-153b221bd577"}
 */
var sb_gVersion = '7.1.25-test';

/**
 * @properties={typeid:35,uuid:"6EEF1846-05C4-43A1-8583-07ABC0CE6BB6",variableType:-4}
 */
var is_mobile_device = false;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"BD62FE18-354E-4E05-98AB-7DABD8B84AE6"}
 */
var sb_gLogoutName = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"D8EA763B-2447-4742-A8B2-6F31DF50318C"}
 */
var synopsis_text = null;

/**
 * @properties={typeid:35,uuid:"F216420C-F493-45C9-A231-99113054B65F",variableType:-4}
 * @type {*}
 */
var SETTINGS = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2A4EC626-383B-42D3-91AB-652D89635A12",variableType:4}
 */
var FirstResize = null;

/**
 * @properties={typeid:35,uuid:"174618A6-689C-4823-A961-E8A9C5CAA545",variableType:-4}
 */
var iets = null;

/**
 * @type {*}
 *
 * @properties={typeid:35,uuid:"E989E05F-09C2-4A42-9CFD-C71963B50DE9",variableType:-4}
 */
var far_indexes = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"BC7505EB-028C-4C04-8D38-2DEF4BA64B75"}
 */
var far_text = "";

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A5E63189-9E5E-4D19-B0F2-92C0C4468DC4",variableType:4}
 */
var sb_gSearchType = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"BA321578-3BC4-4470-A967-61DEF60014AB"}
 */
var web_read = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4DF855D2-1EF7-45D8-9513-26C1E1EFD2DC",variableType:4}
 */
var sb_gSelectedVersion = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"063F251F-0D3E-4FB7-B1E5-57CD0A824DDE"}
 */
var sb_gCurrentUserName = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"507F3A75-4AF0-4F47-A770-DD48E53294E8"}
 */
var HEADHACK = '<head><meta http-equiv="X-UA-Compatible" content="chrome=1"></head>';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"534B5938-3C3F-41C5-8479-B05506B79147"}
 */
var character_space = '&nbsp;';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"F14652E2-DF9E-412C-BF5C-E4538CE0FB5A",variableType:8}
 */
var sb_mode_search = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"6D964249-19BC-4B72-A878-0F9E76D939A8"}
 */
var far_replaceText = null;

/**
 * @type {*}
 *
 * @properties={typeid:35,uuid:"6FA0FE3F-C414-4D2E-AEEA-72BA92ECBDA6",variableType:-4}
 */
var far_searchText = null;

/**
 * @properties={typeid:35,uuid:"6E9ECFE9-22C3-4CA4-B602-7F5FB10774C9",variableType:-4}
 * @type {*}
 */
var far_arguments = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"24C0E88F-4D78-4BFB-90C2-06D7EB542120"}
 */
var formCountCommentInstance = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3529FA3C-8E8B-4F53-BBAE-36EE29B62AF9",variableType:8}
 */
var form_wordstudy_height = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"82FC05D1-3D43-4FF4-AC17-8B5BD21BBF45",variableType:8}
 */
var form_wordstudy_width = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"AF810B6F-32DD-4BB6-A795-6F77547A218B"}
 */
var formCountVerseTranslation = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"D854723E-08DF-48C2-B602-F7175412828F",variableType:8}
 */
var formCountStudyWords = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9BFCCDED-AC4F-4D7D-ADED-97E5DEFC238B",variableType:8}
 */
var form_comment_height = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"620DF106-4FE6-4D47-A1F6-C5CE2193DA79",variableType:8}
 */
var form_comment_width = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"91D1F3D5-DC2C-4A9C-A820-C9F7BB7344A5",variableType:8}
 */
var form_study_height = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"A9968531-911A-41F9-A6DC-5BE7706A417A",variableType:8}
 */
var form_study_width = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"B6EA1F8E-45EF-427B-B4FE-31919FBEDD28",variableType:8}
 */
var form_height = null;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5D537DF0-6259-45EF-B10E-CDEB397C88E9",variableType:8}
 */
var form_width = null;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"06f2d5fe-73e5-4f37-885e-7606babdc4a8"}
 */
var books_NT = 'New';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"20cb2340-69f4-4e40-a0dd-a187f5262f37"}
 */
var books_OT = 'Old';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9ddb5231-b66b-4358-a2f8-983b0320162b",variableType:4}
 */
var sb_print_notes = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"34e7a4e5-8b84-4bb9-a320-05773fc3a828",variableType:4}
 */
var sb_search_allbooks = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7d6ff42f-64f8-4692-b5ab-e9e63ce48e89"}
 */
var sb_search_bible_books = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"6ac9b6fc-3512-4549-b791-43b40df5cd93"}
 */
var sb_search_bible_books_nt = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8ba3b635-ddab-4e50-aec3-20226d50b412"}
 */
//var sb_search_book_translations = 'SV\nNBG\nNBV';
/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"EC0AD004-B7BF-4A58-A7B8-ED83250CE78E"}
 */
var sb_search_book_translations = 'NBG';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"a6f5f6b7-9098-4fac-843a-e976c0849b58",variableType:4}
 */
var sb_search_books_all_nt = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6e2ec5b2-4e21-44d4-99b6-38e13d7e59a8",variableType:4}
 */
var sb_search_books_all_ot = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"c4deab2b-d8dd-4e51-a4e3-109707fe1c20",variableType:4}
 */
var sb_search_commentaryNotes = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"509c1ff9-56fc-44e6-83b8-5d1724ca1189"}
 */
var sb_search_criteria = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"49433a11-2c80-4f35-814d-79c01448585a",variableType:4}
 */
var sb_search_in_biblebooks = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"657c42cf-8ea2-4a7a-ba39-3ed3e97c8096",variableType:4}
 */
var sb_search_in_studywords = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"ce34847e-6608-44c6-b8fa-0ae233b733a5",variableType:4}
 */
var sb_search_search_articles = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"784d8f3f-d6fc-4280-bb84-4ca465f46f8a",variableType:4}
 */
var sb_search_search_commentary = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"40b7e0d7-9d97-4593-86e4-5b815f159e8c",variableType:4}
 */
var sb_search_search_footnotes = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"e70aade3-bf88-4b36-978e-de6da9924f78",variableType:4}
 */
var sb_search_search_searchresults = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"98eb56b0-542d-403a-84dc-8a3243dda256",variableType:4}
 */
var sb_search_search_spacing = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"b2dc4600-54b8-442c-9862-5058b775ee5f",variableType:4}
 */
var sb_search_search_translations = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8fc843d9-79a1-4198-af10-8ca0de33d90e",variableType:4}
 */
var ALWAYSCHECKED = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"a0c080cd-8ae7-4d5d-b160-0e3049fccecb",variableType:4}
 */
var sb_print_bibleTranslations = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"364418c8-1d82-40c6-81b3-10a311e0cd5f"}
 */
var sb_print_words = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0c6be806-3254-4224-9486-d02ab9cf838f",variableType:4}
 */
var sb_print_wordStudy_concordance = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"f4699ee1-8f55-4f5a-8f1f-f39fe4168764"}
 */
var about = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"21a3897f-397b-4386-8c14-4757452e5be8"}
 */
var acceptLicense = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"1ba3e184-6e04-4c9e-a429-40c0bf51a760"}
 */
var allConcordantie = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3c43cc00-59dd-417d-a023-9970945b8d93"}
 */
var article = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0d2fe401-9be2-4fbb-8b3a-78210b6f8ee4"}
 */
var article_names = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"1389f2fe-9803-4c6e-a991-4f19e68d976b"}
 */
var article_title = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"e9dcb3cf-ef73-4a6b-8b51-c32d33740797"}
 */
var bank = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"c86171d4-16a8-41f4-8883-b1b143d5ea02"}
 */
var book = 'Matte√ºs';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"5dce0bf8-2b3b-41f8-9cca-e32f7478f0ca",variableType:8}
 */
var book_id;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6dda3b49-a9c6-467f-a0df-39e1e3d08a46",variableType:4}
 */
var chapter = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0689099f-9151-46e4-9890-d6f8aabb416b",variableType:8}
 */
var chapter_id;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7481a7ec-fc11-4481-a23b-a98ae2fbf9de",variableType:4}
 */
var chapter_pk = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2c53d5d6-67f9-48dd-b9f4-18a106430be6",variableType:8}
 */
var chkDevFix;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"b1209f12-08d7-45e9-b361-57798c13d551",variableType:8}
 */
var chkYouInThisVerse;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"db2e5305-f714-4105-9d3d-5d395fae8b34",variableType:8}
 */
var choise;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"779458ed-c43e-4617-a1bf-62fe32baf8bf"}
 */
var code = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4b5d24e1-a9a0-45ed-8616-5cbdf16923da",variableType:8}
 */
var colored;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"c2196439-10f6-4612-8c3e-9ae0901854da"}
 */
var commentary = '';

/**
 * @properties={typeid:35,uuid:"75eb1d94-208a-417d-8cc7-cdb4e4a2864d",variableType:-4}
 */
var commentary_print;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"827639c2-82ac-4c48-a7f0-28de4f3a7d2a"}
 */
var concordantie = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"17c89b07-7ee4-4fe0-9b33-c529b8bf2db1",variableType:4}
 */
var countUpdateWordStudy = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4a2dce93-2208-4d9f-bb39-a18355d102c2",variableType:4}
 */
var countUpdateWordStudy2 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"a9b2641d-243a-431a-9668-0d97511ceb19",variableType:4}
 */
var customMenuDone = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9abe3c24-593b-4dd3-abfa-e375b5cf43e4"}
 */
var d_article_names = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"82e7ff66-72e7-445e-94cf-1b9a6e2fcd12"}
 */
var d_commentary = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"abe58c3e-f131-4393-959d-4a53c4727340"}
 */
var d_notes = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"6eecdd63-8109-4eb0-b448-e0ba70a9e167"}
 */
var d_search_results = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9aa7e548-37b7-42dc-8c8d-4ad3a1192b9d"}
 */
var d_study_analyze = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"5cb0c9ab-b8ed-4f37-a847-55460090a1d8"}
 */
var d_verse_translation = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"076f4b36-15c2-4aa5-893a-b08337735cb7"}
 */
var d_words = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8b97e2fe-6efc-4d86-a92c-40dbe5923f13"}
 */
var dataset = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"b4fe1810-251d-430a-b80f-6ee310a64d00",variableType:4}
 */
var didTreeViewInit = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"054d9102-2136-4bfa-8a92-acd59b02b8d9",variableType:4}
 */
var didTreeViewInitOriginal = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"0a5cd813-9b99-475f-86fa-737be49687d2",variableType:8}
 */
var doNotPopup;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"630e32ab-4889-429c-862b-0c08f253f07b"}
 */
var doRollback = 'true';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"16139030-99b5-4790-bedd-b0894291c42c"}
 */
var downloadURL = '<html><a href="www.google.com">google</a></html>';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8dc978bc-85c6-4e8a-a332-f4ee04e56f52"}
 */
var event_instance_form = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"d53914a4-403b-49c9-8d26-5d41f0da9e1e",variableType:8}
 */
var event_instance_getX;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"c9f1cee7-44c7-4ab0-a0f8-72fd168e5425",variableType:8}
 */
var event_instance_getY;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"cd94af67-4921-41e6-a832-6fd4008bfc55"}
 */
var flag = 'false';

/**
 * @properties={typeid:35,uuid:"a609d306-9daf-48ce-8acc-8492ff6f6282",variableType:-4}
 */
var formCount;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"ff7a9a6e-3f32-4323-99a1-0ee52d2edcab"}
 */
var gElName = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"f8ec6df1-53a9-4e8f-941c-892471aaea14"}
 */
var gFName = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"12969e3a-b00c-4537-8710-20fabac45cff",variableType:8}
 */
var griek;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"ea349e46-a375-4357-8484-1074dc33ba8f"}
 */
var griek_version = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8741f5e5-1641-429e-8db2-a93333c7b319"}
 */
var heb_version = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"e2ae2e87-030c-4ada-974f-7befa55a8698"}
 */
var hml_note = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9b5cdfd9-a983-456a-8f7e-f0dd1cb5f824",variableType:8}
 */
var iConcordance;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"a830f784-e17d-48c6-bfad-a496427631c2",variableType:4}
 */
var index = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"a52303c8-ff3d-466e-a969-f63469be2da2"}
 */
var initWS = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"d14a7159-f8d5-4153-860d-df6bbc0441a2"}
 */
var isLeaf = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"b89f56f8-6bee-4c52-80b9-72be8fbcd6c0"}
 */
var licentieCode = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7cf0449a-41fe-429e-bee1-ada3db34c233"}
 */
var log = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"04d4e38c-0abb-43c1-a973-90134651b23d",variableType:4}
 */
var maxOTBook = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"591eb67f-e3ad-4122-bf12-654a78431443",variableType:4}
 */
var maxOTChapter = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"c433d796-0530-403c-b6c1-69ec6e46322d",variableType:8}
 */
var myWordStudyAnalyzePK;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"b4bef08f-40de-4b00-9136-38a722cc4ab8"}
 */
var myWordStudyID = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"5c5f94a6-6f6d-48ee-aa50-1a4f0ae2e963"}
 */
var newNote = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7a98fabf-80f4-47cd-bbfd-e33560232cae",variableType:8}
 */
var nodes_id;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8aa86182-eca2-41ac-a19f-90533997f0e4"}
 */
var notes = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"76bbbc89-2787-4792-aeda-170f8bf60371",variableType:4}
 */
var one = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"db4278c2-84ed-4371-8c8f-b4de68a48535",variableType:4}
 */
var ot = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"12e5a2ef-0d5a-4a45-98f1-6e16e7d82fdb"}
 */
var otallcomment = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"bd67c196-a703-40ee-ac18-70d43380816b",variableType:8}
 */
var parent_id;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"ddde9932-e4f8-4df5-a438-8aabb5503449",variableType:4}
 */
var parent_id1 = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"af07cd1a-7187-4fa0-83d0-3e274ea9c81c",variableType:4}
 */
var parent_id2 = -1;

/**
 * @properties={typeid:35,uuid:"6010ce6e-e638-4610-8c52-93f8219aaf76",variableType:-4}
 */
var pinkenelis;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"fb22f66f-1f92-43a5-a8c2-bbf0736b1913"}
 */
var postcode = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0981d024-78aa-4f76-96ab-a181e1e607b2"}
 */
var print1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"fa700d53-cc82-4634-96e0-5c545a76ca12"}
 */
var print2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7e86afac-d751-4d40-ac63-fa5efde5963b"}
 */
var print3 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"bf61873d-dd94-42ef-abba-2af883b13136"}
 */
var print4 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8b380e0f-fca0-49f3-97ea-d5ebea8ff93a"}
 */
var print5 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"068d576e-9c02-417d-a855-a575b015a98a"}
 */
var print6 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3f6f024d-75ad-48b7-86fe-6e4625ca7deb"}
 */
var print7 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"c3512f1f-1b72-4fd4-a219-9f61c6c1ca8b"}
 */
var print8 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"806764fe-00c9-4a11-bc07-0a06c618818f"}
 */
var print_abrev = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"dc8e1771-2d97-48d8-8cea-204bb997ab64"}
 */
var print_AlleenGrieks = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"d25b17b9-6f54-4dae-b7d2-e9800cbd400a"}
 */
var print_option = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"c4cf8f13-6def-4828-b98c-332f5cf46da0"}
 */
var print_preview = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"ae30f1c8-8f4d-4547-8759-db9104edf112"}
 */
var print_versions = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"ba31cc04-af00-470e-b5ce-044b546fec67"}
 */
var print_WordStudy = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"833dc6d4-deed-4022-ad19-7c0069698361"}
 */
var relationType = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6efee254-4fa7-429d-b2f5-eeb4450dda21",variableType:8}
 */
var rowCount;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"b366ded2-dbd7-4c00-a6ff-5ec655391977"}
 */
var sb_blockFootnoteLinkSearchForm = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"2efdaaf6-6645-4fb0-8572-9650bdba7053",variableType:4}
 */
var sb_frmOnHideCHK = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"aaff6a52-dc83-48cf-a5b6-14e805ccefdb",variableType:4}
 */
var sb_gBookID = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"f3b04412-2193-47d8-b664-53cc193e9f25",variableType:4}
 */
var sb_gBookIntegral = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7b222d1c-f91c-4a2f-a37e-9a4547c17c20",variableType:4}
 */
var sb_gBookPartial = 2;

/**
 * @properties={typeid:35,uuid:"8380d754-e987-4a20-a09f-95144c0a6c3d",variableType:-4}
 * @type {*} 
 */
var sb_gHistory;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"e96994d7-eb35-4265-935f-6691310d41d6",variableType:8}
 */
var sb_gHistoryPoint;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6a55bb91-695c-4a93-8d8b-5d7f923d2082",variableType:8}
 */
var sb_gHistoryStart;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"251ac6b8-988c-4d12-b28b-a9a50e5bdb1e",variableType:4}
 */
var sb_gSelectedFootNoteNo = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"75187b0c-0be6-4179-ab20-ae3ef670342d",variableType:4}
 */
var sb_gShowOnline = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"da2f10bb-4031-4bfc-ab17-d172ac979cc1"}
 */
var sb_gTestament = 'New';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"38ec611b-6c8c-4717-95e3-40c5967cc00e"}
 */
var sb_gTestamentReal = 'OT';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"3ea7eed8-9e5a-4dde-8cda-217a879bffa9"}
 */
var sb_gTranslationPartial = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"02965699-405b-466d-a59c-5dc987f87206"}
 */
var sb_gTranslationPartial2 = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"96028cdc-508b-4744-bdb4-d90ff7dfad8b",variableType:4}
 */
var sb_importCommentarie = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"32f934f6-0418-41d8-b6b4-673dc3f0207c"}
 */
var sb_searchTransl_tabText = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"b57561fb-2024-4268-80e3-e18af6d9c094"}
 */
var search_book = 'Alle boeken...';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"a84f99f7-b281-4353-84e3-5f04c9a7c081"}
 */
var search_in = 'Bijbelvertalingen';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"e4521c08-7725-4df6-997e-fed6cd536424"}
 */
var search_in1 = 'Bijbelvertalingen';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"d8c922b6-c988-4047-b46b-642f487bff28"}
 */
var search_in2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"76b2b1f6-0d53-42fa-b288-c33516a1432e"}
 */
var search_in3 = '';

/**
 * @properties={typeid:35,uuid:"be8e2b38-4367-4250-a20d-a6f3210d7911",variableType:-4}
 * @type {*}
 */
var search_PRINT_sql;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"dc626864-06b6-4a7f-973a-d3028ffe876b"}
 */
var search_results = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"56bb13d8-0082-4f9d-ad76-1b5c284a9289"}
 */
var search_term1 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9d1a789d-c39b-40ee-aa7d-1ccae95b1b59"}
 */
var search_term2 = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"86edd02b-98d6-47d0-bd49-dc7eca66b3a3"}
 */
var search_translation = 'SV';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"863ac726-9b07-427d-924f-317b76ff591b"}
 */
var search_type1 = 'Woord(en)';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"1af3caea-a347-41c5-96a2-c069710a9a43"}
 */
var search_type2 = 'Woord(en)';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"4ed0fb93-8abd-4dbe-a81f-d02b2e349ea2"}
 */
var select = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"99bf2a16-40e3-42dd-bf83-83da74f97799",variableType:4}
 */
var selected_node_id = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7482f80a-e300-4bde-813f-6b4717d49481",variableType:8}
 */
var selected_verse_id;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"76aee26b-1fa3-4a21-8445-fa77f37d6910"}
 */
var selectedWordStudy = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"ee0d6e53-e8bb-4e33-89b6-4a6d46503c76"}
 */
var selectOT = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"84b2bc61-a081-4ee2-b90d-5dfdc84df0c4",variableType:4}
 */
var show_books = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9277afcd-fef6-41b2-9b19-4d0576bd667d"}
 */
var showOverlapDLGHTML = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"444e6610-8df6-43ea-bc02-b4778f317c08"}
 */
var sql_input = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"cc5e3a0d-c0b0-4f7b-8aff-c2503658e522"}
 */
var sql_output = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"c0040ea2-ba55-4e19-b226-e2c9625d6d07",variableType:4}
 */
var step_size = 20;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"f538713f-56d9-4e85-b59e-e463103427d8"}
 */
var straat = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"c8fbbc2d-6037-44d5-8217-db64d283d03a"}
 */
var study_analyze = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"6672cc69-67b1-441e-b3e6-1d48976754f4"}
 */
var synopsis = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"a7d6355e-7a3a-49ea-9c5f-d9a7b9751841"}
 */
var temp = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"86683b7b-c9ee-4977-babf-59229bb7a0ed",variableType:8}
 */
var tempbookid;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"eedb92d9-2f91-4b65-ba9f-5d6b34739167"}
 */
var test_html = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"85cbe2b7-e62c-45d4-9fed-f74ce3eaf6e9"}
 */
var test_variable = 'x';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"9760d058-bbc0-4abb-904f-6a5b9416f0ce"}
 */
var testamentFirstTime = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8f500696-ccd3-47b8-b625-71b0e0e26c94"}
 */
var text = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"0d72845e-2b3c-403c-8b50-8bc6b076dbdb"}
 */
var text_version = 'TR';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"13f22a83-73e3-43e3-82c8-5a68f5b4313d"}
 */
var tot_search_results = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8ebcae35-6e2d-416d-95f0-4faab0048595"}
 */
var translation = 'SV';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"7874b68d-14a2-4b2c-9dbf-8a73ca61f544"}
 */
var translation2 = '';

/**
 * @properties={typeid:35,uuid:"b3f2d082-dba2-4698-b0e5-00932fa7bdf8",variableType:-4}
 */
var TreeArray;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"f0118e76-ec3e-43c7-9807-af0ccbc6d3a0"}
 */
var Treedemo_showclicked = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"99daa704-1898-4739-8053-53216f21bae0"}
 */
var TreeHTML = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"e09721c3-7b9a-4a76-b123-35f4fae90e2e",variableType:4}
 */
var TreeLAF = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"2c4ad411-fbe4-47da-a8b1-90af2b65f91b"}
 */
var TreeNodeAction = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"e0420f94-a479-4e61-948e-81d3fa681da1"}
 */
var TreeNodeSelected = '';

/**
 * @properties={typeid:35,uuid:"80d77948-b567-4bad-8429-3691e984fb99",variableType:-4}
 */
var uniqueComments;

/**
 * @properties={typeid:35,uuid:"f7c19a7c-e73d-4a92-a43f-71a21014f06e",variableType:-4}
 */
var uniqueVerses;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"15da750d-7dd1-4013-9f16-74ebd8506f72"}
 */
var url = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"51ce9aba-8acc-4b54-90db-36edc76e10d1",variableType:4}
 */
var UsedHistory = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"a06c193b-d1c3-464c-9155-f8403c94f3bb"}
 */
var userClientNo = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"22faa951-8e2b-4538-ae50-71897f31a437"}
 */
var userEmail = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"d6832fd7-910b-43be-9645-0c7bfb84ae87"}
 */
var userInstallationCode = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"bf415d07-b72e-472d-a996-c7e4affb095a"}
 */
var userName = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"a766c1ad-5f38-437b-b606-87c78234a8b8"}
 */
var userPhone = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"a1aa46db-bc7d-4c4f-85d1-bd31ab19bdd5",variableType:4}
 */
var var_init = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"9b8a5dd1-a98b-44c1-b0c3-1308a4e529ee",variableType:4}
 */
var verse = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6c45e6f2-5836-4453-9171-b0dbe8dafb64",variableType:8}
 */
var verse_id;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1434e7b4-4d68-4551-9b3f-c90226c64512",variableType:8}
 */
var verse_id_calc_last = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"04fd5cbe-48a1-4f02-837f-fa4780f63678"}
 */
var verse_path = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"a7f88307-bdff-4950-85e6-f0821f5dd3d9"}
 */
var verse_translation = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8c246caf-2522-482f-8758-9a95a69a03ca"}
 */
var version = '6.1.2';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8d2e00d3-b00f-43ca-aad4-23059de83a7b"}
 */
var woordstudie = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"f48c026e-cbce-4cf3-a0dc-2c91796d96c9"}
 */
var woordvormen = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"89e83684-7820-49d7-b1ed-0a51bc6e225b",variableType:8}
 */
var word_number;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"d0eb99c1-98aa-4220-92cd-5b028bf10547"}
 */
var words = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"8c4616f5-12b9-4237-a85d-e436d64a4eba"}
 */
var words_study = 'Woordstudie\r\nWoordvormen\r\nConcordantie';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"45434bc4-3c1e-4e8e-9040-83044921a1ef"}
 */
var x = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"d8dcce52-6b57-42ac-b5f3-83241684e587",variableType:4}
 */
var sb_export_exportAllBooks = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"c42e5cbe-7078-49ba-9859-83a108086d1e"}
 */
var sb_export_gFromVerse = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"42dbd5e0-1d06-4fe2-b6d5-0e0aa345bee7"}
 */
var sb_export_gSelectedBookTrans = 'SV';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"160e79f7-056f-4ca9-8b40-1697210182de"}
 */
var sb_export_gVerse = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"30788577-9cb5-48a0-8e38-81f696c0a72f",variableType:8}
 */
var sb_export_toChapter;

/**
 * @properties={typeid:24,uuid:"4c40a051-250b-4c38-ae61-6787d4b9702c"}
 */
function amb_checkEsp() {
	if (globals.sb_APP_getServerLang() == "ESP") {
		return true;
	} else {
		return false;
	}
}

/**
 * @properties={typeid:24,uuid:"2fd66dd0-c4c7-4ec2-bf4f-12aa17a4a32f"}
 */
function amb_removeWijzigMenu() {
	var item
	plugins.window.getMenuBar().removeMenu([1])

	var vNewMenu = plugins.window.getMenuBar().addMenu(1);
	vNewMenu.text = "i18n:servoy.menuitem.edit";

	var menu = plugins.window.getMenuBar().getMenu(1);

	// when you don't define an index the item will be added at the last position
	// this is what you usually do to build a new menu
	item = menu.addMenuItem();

	// create the settings for the specified menu item
	// minimum settings are the text and method properties
	// the method can be a global or form method
	// be sure to enter the method WITHOUT '()' at the end
	item.text = "i18n:cvb.menu.howtocopy";

	item = menu.addMenuItem();

	// create the settings for the specified menu item
	// minimum settings are the text and method properties
	// the method can be a global or form method
	// be sure to enter the method WITHOUT '()' at the end
	item.text = "i18n:cvb.menu.howtoselect";
}

/**
 * @properties={typeid:24,uuid:"c73a4c08-02dc-4dce-a020-5ed8ad5c8c0e"}
 * @AllowToRunInFind
 */
function completeConcordances() {
	/** @type JSRecord<db:/sb/verses> */
	var record
	var textData = plugins.file.readTXTFile('c:\\missing.txt');
	if (textData.length > 0) {
		var i = 0
		while (i < textData.length) {
			var index1 = textData.indexOf('\t', i)
			var index2 = textData.indexOf('\n', index1)
			var pkNr = textData.substring(i, index1)
			var subscrId = textData.substring(index1 + 1, index2)
			i = index2 + 1
			forms.verses_fill_in.controller.find()
			forms.verses_fill_in.subscr_id = subscrId
			forms.verses_fill_in.controller.search()
			if (forms.verses_fill_in.foundset.getSize() > 0) {
				record = forms.verses_fill_in.foundset.getRecord(1)
				var verseId = record.pk
				forms.word_concordance.controller.find()
				forms.word_concordance.pk = pkNr
				forms.word_concordance.controller.search()
				if (forms.word_concordance.foundset.getSize() > 0) {
					forms.word_concordance.foundset.setSelectedIndex(1);
					forms.word_concordance.verse_id = verseId
				} else {
					plugins.dialogs.showInfoDialog('', 'pk ' + pkNr + ' not found', 'OK')
				}
			} else {
				plugins.dialogs.showInfoDialog('', 'subscr_id' + subscrId + ' not found', 'OK')
			}
		}
	}

}

/**
 * @properties={typeid:24,uuid:"322e21a8-67c2-4446-aebb-b3ca9b4805ed"}
 * @AllowToRunInFind
 */
function convertArticleHebrTransToUnicode() {
	/** @type JSFoundset<db:/sb/articles> */
	var vFoundset = databaseManager.getFoundSet('sb', 'articles');
	vFoundset.loadAllRecords();

	if (vFoundset.find()) {
		vFoundset.article_text = '%<font face="SIL Heb Trans">%';
		vFoundset.search();
	}

	/** @type JSRecord<db:/sb/articles> */
	var vRecord
	var splitWord
	// Loop trough the foundset s
	for (var i = 1; i <= vFoundset.getSize(); i++) {
		vRecord = vFoundset.getRecord(i);
		var vHTML = vRecord.article_html;

		var vWordSplit = vRecord.article_html.split('<font face="SIL Heb Trans">');
		// Loop trough stringlengt
		for (var k = 1; k < vWordSplit.length; k++) {
			if (vWordSplit[k]) {
				splitWord = vWordSplit[k].split('</font>');
				vHTML = utils.stringReplace(vHTML, splitWord[0], globals.stringToCharNo(splitWord[0]))
			}
		}
		vRecord.article_html = vHTML;
	}

	databaseManager.saveData();
	plugins.dialogs.showErrorDialog('', 'done')

}

/**
 * @properties={typeid:24,uuid:"f2c23984-3f80-4fac-9c71-b31a00e978a2"}
 * @AllowToRunInFind
 */
function ConvertCommentaryFromPlainToHTML() {
	// Create foundset (fictive)
	/** @type JSFoundset<db:/sb/commentary_blocks> */
	var vFoundset = databaseManager.getFoundSet('sb', 'commentary_blocks')
	vFoundset.loadAllRecords();
	/** @type JSRecord<db:/sb/commentary_blocks> */
	var vRecord;

	var totalRecords = databaseManager.getFoundSetCount(vFoundset)

	// Loop trough the foundset
	for (var i = 1; i <= vFoundset.getSize(); i++)
	//for(var i = 1; i <= 10; i++)
	{
		if (i % 10 == 0) {
			application.setStatusText("Commentary " + i + " of " + totalRecords);
			application.updateUI();
		}

		if (i % 200 == 0) {
			databaseManager.saveData();
		}

		vRecord = vFoundset.getRecord(i);

		/*forms.commentary_blocks.controller.find()
		forms.commentary_blocks.pk = vRecord.pk
		forms.commentary_blocks.controller.search()
*/
		// Book
		globals.book_id = vRecord.book_id;
		var vSQL = "SELECT book_name FROM books WHERE pk = " + vRecord.book_id;
		var vQuery = databaseManager.getDataSetByQuery('sb', vSQL, [], -1)
		globals.book = vQuery.getValue(1, 1);

		//text =
		// Change the chapter:verse to links
		// If the plaintext does not exist
		if (!vRecord.plaintext) {
			vRecord.plaintext = globals.ConvertHtmlToText(vRecord.htmltext);
		}
		vRecord.htmltext = globals.ConvertTextToHtml(vRecord.plaintext);
	}
	databaseManager.saveData();
}

/**
 * @properties={typeid:24,uuid:"7509dc7a-9754-4c93-9a38-30d958ddef23"}
 * @AllowToRunInFind
 */
function ConvertFootnotesHtmlToPlainText() {
	// Create foundset (fictive)
	/** @type JSFoundset<db:/sb/footnotes> */
	var vFoundset = databaseManager.getFoundSet('sb', 'footnotes')
	vFoundset.loadAllRecords();
	/** @type JSRecord<db:/sb/footnotes> */
	var vRecord;

	var totalRecords = databaseManager.getFoundSetCount(vFoundset)

	// Loop trough the foundset
	for (var i = 1; i <= vFoundset.getSize(); i++)
	//for(var i = 1; i <= 10; i++)
	{
		if (i % 10 == 0) {
			application.setStatusText("Footnote " + i + " of " + totalRecords);
			application.updateUI();
		}

		if (i % 200 == 0) {
			databaseManager.saveData();
		}

		vRecord = vFoundset.getRecord(i);

		/*
		 forms.commentary_blocks.controller.find()
		 forms.commentary_blocks.pk = vRecord.pk
		 forms.commentary_blocks.controller.search()
		 */
		/*
		 // Book
		 globals.book_id = vRecord.book_id;
		 var vSQL = "SELECT book_name FROM books WHERE pk = " + vRecord.book_id;
		 var vQuery = databaseManager.getDataSetByQuery('sb', vSQL, [], -1)
		 globals.book = vQuery.getValue(1,1);

		 //text =
		 // Change the chapter:verse to links
		 // If the plaintext does not exist
		 if(!vRecord.plaintext){	vRecord.plaintext = globals.ConvertHtmlToText(vRecord.htmltext); }
		 vRecord.htmltext = globals.ConvertTextToHtml(vRecord.plaintext);
		 */
		vRecord.plaintext = globals.ConvertHtmlToText(vRecord.htmltext)
	}
	databaseManager.saveData();
}

/**
 * @properties={typeid:24,uuid:"332db37d-5907-4721-8397-f2f8f62db5a0"}
 */
function copy() {
	application.setClipboardContent(forms[globals.gFName].elements[globals.gElName].getSelectedText());
}

/**
 * @properties={typeid:24,uuid:"e895fe5a-1bc2-4349-9263-573e2edddefb"}
 */
function cvb_setGreek() {
	if (globals.griek_version) {
		globals.griek_version = '';
	} else {
		globals.griek_version = i18n.getI18NMessage('onlyGreek')
	}

	forms.study_words.viewWordsForSelectedVerse();
	
	// RB 01-11-2011
	// Add pointer to History
	globals.sb_history()
}

/**
 * @properties={typeid:24,uuid:"84df43db-796e-42cf-8800-34352ac8b56b"}
 */
function cvb_setHebrew() {
	if (globals.heb_version) {
		globals.heb_version = '';
	} else {
		globals.heb_version = i18n.getI18NMessage('msg_onlyHebrew')
	}

	forms.study_words.viewWordsForSelectedVerse();
	
	// RB 01-11-2011
	// Add pointer to History
	if (globals.UsedHistory != 1) {
		globals.sb_history();
	}
//	globals.sb_history()
}

/**
 * @properties={typeid:24,uuid:"22a02639-fcee-4656-81d1-c59fe4d3bbad"}
 * @param {*} arg1
 * @param {*} arg2
 * @param {*} arg3
 * @param {*} arg4
 * @param {*} arg5
 * @param {*} _version
 */
function cvb_setVersion(arg1, arg2, arg3, arg4, arg5, _version) {
	//SMM -19-05-2011 plugins.window
	globals.text_version = arguments[5][0]
	//globals.text_version = arguments[0]
	forms.study_words.viewWordsForSelectedVerse();
	
	// RB 07-11-2011 -> Save the text version into the user settings table
	if(globals.sb_gTestament == "New")
	{
		globals.setUserSetting('text_version', _version[0]);
//		globals.setUserSetting('text_version', _version[0]);
	} else {
		globals.setUserSetting('text_version', 'TR');
	}
	
	
	// RB 01-11-2011
	// Add pointer to History
//	globals.sb_history()
	if (globals.UsedHistory != 1) {
		globals.sb_history();
	}
}

/**
 * @properties={typeid:24,uuid:"83d2d14c-53e4-48b5-a878-b6447d71a02d"}
 */
function elementNameFocus() {
//	globals.gElName = application.getMethodTriggerElementName()
//	globals.gFName = application.getMethodTriggerFormName()
}

/**
 * @properties={typeid:24,uuid:"ec9cd707-f646-47a8-afa6-f19d114b57b4"}
 */
function flink(event) {
	scopes.tools.output('running flink');
	//if(globals.sb_edit_EditCommentaryBlocksVisible==1)
	//{
	//	forms.footnotes.foundset.setSelectedIndex(utils.stringToNumber(arguments[0]))
	//	return
	//}
	if (globals.sb_blockFootnoteLinkSearchForm == 1) {
		
		//plugins.dialogs.showWarningDialog("Warning", )
		globals.DIALOGS.showWarningDialog('Warning',i18n.getI18NMessage('cvb.lbl.errorlinkfootnote'),"OK")
		return false
	}
	if (globals.flag == "false") {
		globals.flag = "true";
		globals.flink(arguments[0]);
	}

	var arg = ''
	arg += arguments[0]

	var vtext = globals.otallcomment

	globals.sb_gSelectedFootNoteNo = arguments[0]
	//	forms.book_notes.elements.notec.visible = true;
	//	forms.book_notes.elements.note.visible = false;

	//databaseManager.saveData()

	var index1 = vtext.indexOf('<b>' + arg, 0)
	var index2 = vtext.indexOf('<f>', index1)
	if (index2 < 0)
		index2 = vtext.length - 1

	globals.notes = '<html><body><table><tr><td>' + vtext.substring(index1, index2) + '<br>' + globals.hml_note + globals.otallcomment + '</td></tr></table></body></html>';
	//var dl = forms.sb_form.elements.bean_321.dividerLocation
	//forms.sb_form.elements.bean_321.dividerLocation = dl
	//forms.sb_form.elements.bean_321.bottomComponent = forms.sb_form.elements.tabs_book_notes

	if(application.getApplicationType() != APPLICATION_TYPES.WEB_CLIENT) {
		forms.sb_form.resizeSplitTab(event, 'book_notes');	
	}
	
	forms.book_comment.EVENT_onRecordSelection(true);
	
	// Addition 27-05-2016
	// Detect if reading pane is open.
	if(forms.web_sb_form.elements.tab_notes.visible === true) {
		forms.web_sb_form.elements.tab_notes.visible = false;
	}
	
	return true

}

/**
 * @properties={typeid:24,uuid:"38effe83-45dc-4544-b729-e7f67a9a1acb"}
 */
function getCommentaryAndFootnotesForSelectedVerse() {
	// change this code, it contains a Sybase "list" function
	// this cannot be used in PostgreSQL

	var query = "SELECT cb.title || cb.htmltext_short as commentary, list('<f><b>' || f.footnote_number || '</b></f>&nbsp;' || f.htmltext, '<br>'  ORDER BY f.footnote_number) as footnote, cb.pk FROM commentary_blocks cb LEFT OUTER JOIN footnotes f" + " ON cb.pk=f.commentary_block_id WHERE cb.htmltext IS NOT NULL AND length(cb.htmltext)>15" + " AND cb.book_id=" + globals.book_id + " AND (cb.chapter_from<" + globals.chapter + " or (cb.chapter_from=" + globals.chapter + "  and cb.verses_from<=" + globals.verse + "))" + " AND (cb.chapter_to>" + globals.chapter + " or (cb.chapter_to=" + globals.chapter + " and cb.verses_to>=" + globals.verse + "))" + " AND cb.active_now = 1" + " GROUP BY cb.title, cb.htmltext_short, cb.pk	ORDER BY cb.pk"

	var res = databaseManager.getDataSetByQuery('sb', query, null, 100)
	return res.getRowAsArray(1)
}

/**
 * @properties={typeid:24,uuid:"6156066b-6a91-42ef-9f03-ccff0e583189"}
 * @param {Number} vVerse_id
 * @param {*} [showOnlySV]
 */
function getTranslationsForVerse(vVerse_id, showOnlySV) {
	var aSelection;
	aSelection = globals.translation.split('\n');
	// Add some semolicons!
	for (i in aSelection) {
		aSelection[i] = "'" + aSelection[i] + "'";
	}

	if (globals.sb_gTranslationPartial) {
		var bSelection = globals.sb_gTranslationPartial.split('\n')
		// Add some semolicons!
		for (i in bSelection) {
			bSelection[i] = "'" + bSelection[i] + "'";
		}
	}
	var vSelString = aSelection.join(', ');
	if (globals.sb_gTranslationPartial && bSelection.length > 0) {
		vSelString += ", " + bSelection.join(', ');
	}

	var vSQL = "SELECT transl_text, translation_book_id FROM verse_translations" + " INNER JOIN translation_books ON verse_translations.translation_book_id = translation_books.pk WHERE " + "translation_book_id IN ( SELECT pk FROM translation_books WHERE code IN (" + vSelString + ") ORDER BY nt_order ASC) " + "AND transl_text IS NOT NULL AND transl_text!='' AND verse_id = " + vVerse_id + " GROUP BY translation_books.nt_order, translation_book_id, transl_text" + " ORDER BY translation_books.nt_order, translation_book_id"

	var res = databaseManager.getDataSetByQuery('sb', vSQL, null, -1)

	var html = '<table>'
	if (res != null) {
		for (var i = 1; i <= res.getMaxRowIndex(); i++) {
			res.rowIndex = i
			var resTR = databaseManager.getDataSetByQuery('sb', 'select code from translation_books where pk=' + res.getValue(parseInt(i.toString()), 2), null, 10000)
			resTR.rowIndex = 1
			html = html.concat('<TR><TD><B>')
			if (!arguments[1])
				html = html.concat(resTR.getValue(1, 1))
			html = html.concat('</B>  ')
			html = html.concat(res.getValue(parseInt(i.toString()), 1)) + "<br>";
			html = html.concat('</TD></TR>')
		}
	}

	html += '</table>'

	return html;

}

/**
 * @properties={typeid:24,uuid:"d3e121f9-875d-43d2-ad8a-1438ab6c7b60"}
 */
function getTranslationsForVerse_old() {
	var vVerse_id = arguments[0]

	var res
	if (!arguments[1])
		res = databaseManager.getDataSetByQuery('sb', 'select transl_text,translation_book_id from verse_translations where verse_id = ' + vVerse_id + ' group by translation_book_id, transl_text', null, 10000)
	else
		res = databaseManager.getDataSetByQuery('sb', 'select transl_text,translation_book_id from verse_translations where translation_book_id=1000001 and verse_id = ' + vVerse_id, null, 1)

	var html = '<table>'
	if (res != null) {
		for (var i = 1; i <= res.getMaxRowIndex(); i++) {
			res.rowIndex = i
			var resTR = databaseManager.getDataSetByQuery('sb', 'select code from translation_books where pk=' + res.getValue(i, 2), null, 10000)
			resTR.rowIndex = 1
			html = html.concat('<TR><TD><B>')
			if (!arguments[1])
				html = html.concat(resTR.getValue(1, 1))
			html = html.concat('</B>  ')
			html = html.concat(res.getValue(i, 1));
			html = html.concat('</TD></TR>')
		}
	}

	html += '</table>'

	return html;

}

/**
 * @properties={typeid:24,uuid:"33408f4a-394e-4735-8247-1f295ec245aa"}
 * @param {String} link
 */
function getVerseIdFromTlink(link) {
	var match = link.match(/(\d?\s?[A-Z][^\d]+)(?:(\d+)(?::(\d+))?(v+)?(?:[\-‚Äì](\d+)(?::(\d+))?)?)?/);

	if (match != null) {
		var abbr = match[1]
		var chap = match[2]
		var chapTo = chap
		if (match[5])
			chapTo = match[5]
		var vers = ""
		if (match[3])
			vers = match[3]
		var versend = vers
		if (match[6])
			versend = match[6]

		//Treat the case of v and vv
		if (match[4])
			versend = '' + (utils.stringToNumber(versend) + match[4].length)

	} else {
		// Match attempt failed
		return new Array()
	}

	/* Old code
	 var index1 = link.indexOf('.', 0)

	 var abbr = link.substring(0, index1+1)
	 var abbrshort = link.substring(0, index1)
	 var abbrshortdot = link.substring(0, index1-1) + '.'

	 var index2 = link.indexOf(':', index1)
	 var index3 = link.indexOf('-', index2)
	 var index4 = link.indexOf(':', index3)

	 var chap = link.substring(index1+1, index2)
	 var vers = link.substring(index2+1)

	 //1 chapter book
	 if(index2<0)
	 {
	 chap = 1
	 vers = link.substring(index1+1)
	 }

	 var versend = vers
	 if(index3>0)
	 {
	 if(index2>=0)
	 {
	 vers = link.substring(index2+1, index3)
	 versend = link.substring(index4+1)
	 }
	 else
	 {
	 vers = link.substring(index1+1, index3)
	 versend = link.substring(index3+1)
	 }
	 }
	 */

	// TOOD: wanneer een verwijzing niet werkt.... HIER KIJKEN!
	switch (abbr) {
	case '1 Cor.':
	case '1Cor.':
		abbr = '1Kor.'
		break;
	case '2 Cor.':
	case '2Cor.':
		abbr = '2Kor.'
		break;
	case 'Col.':
		if(globals.sb_APP_getServerLang() == "NL") {
			abbr = 'Kol.'
		}
		break;
	case '1 Thess.':
	case '1Thess.':
		abbr = '1Tes.'
		break;
	case '2 Thess.':
	case '2Thess.':
		abbr = '2Tes.'
		break;
	case 'Jac.':
		abbr = 'Jak.'
		break;
	case '1 Petr.':
	case '1Petr.':
		abbr = '1Pet.'
		break;
	case '2 Petr.':
	case '2Petr.':
		abbr = '2Pet.'
		break;
	case '1 Sam.':
		abbr = '1Sam.'
		break;
	case '2 Sam.':
		abbr = '2Sam.'
		break;
	case '1 Kon.':
		abbr = '1Kon.'
		break;
	case '2 Kon.':
		abbr = '2Kon.'
		break;
	case '1 Kron.':
	case '1Kron.':
		abbr = '1Kr.'
		break;
	case '2 Kron.':
	case '2Kron.':
		abbr = '2Kr.'
		break;
	case 'Esther':
		abbr = 'Est.'
		break;
	case 'Pred.':
		abbr = 'Pr.'
		break;
	case 'Ezech.':
	case 'Ez.':
		abbr = 'Eze.'
		break;
	case 'Obadja':
		abbr = 'Ob.'
		break;
	case 'Micha':
		abbr = 'Mi.'
		break;
	case 'Zef.':
		abbr = 'Sef.'
		break;
	case 'Matt.':
		abbr = 'Mat.'
		break;
	}

	var query = 'select v.pk from verses v, books b, chapters c where v.chapter_id=c.pk and c.book_id=b.pk and b.abbreviation='
	query += '\'' + abbr + '\'' + ' and c.chapter_no>=' + chap + ' and c.chapter_no<=' + chapTo
	if (vers) {
		query += ' and ((v.verse_number>=' + vers + ' and c.chapter_no=' + chap + ') or c.chapter_no>' + chap + ')'

		query += ' and ((v.verse_number<=' + versend + ' and c.chapter_no=' + chapTo + ') or c.chapter_no<' + chapTo + ')'
	}

	if (globals.sb_demo_chk == 1) {
		query += " AND v.demo_chk = 1";
	}

	query += ' order by v.pk'

	var res = databaseManager.getDataSetByQuery('sb', query, null, 50)

	if (res.getMaxRowIndex() > 0) {
		return res.getColumnAsArray(1)
	}

	return new Array()
}

/**
 * @properties={typeid:24,uuid:"f31ed911-50c5-4d6f-b0c4-4890178e4b6b"}
 */
function goThroughVerseTranslations() {
	var res = databaseManager.getTableCount(forms.verses_fill_in.foundset)

	for (var i = 1; i <= res; i++) {
		if (i % 100 == 0) {
			application.setStatusText('Updating ' + i + ' of ' + res)
			application.updateUI(0)
		}
		forms.verses_fill_in.controller.setSelectedIndex(i)
	}
}

/**
 * @properties={typeid:24,uuid:"e762489c-2c78-404e-8812-769f0abfbfb2"}
 */
function init() {
	/**************************************************************************************
	 Method: 	globals.init();

	 Created:	Unknown
	 Modifier:	Karel Broer 02.03.2009 //remove all toolbars when application is not developer

	 Purpose:	Startup method

	 Arguments:	-

	 **************************************************************************************/

	//plugins.SB_NT.setWindowIcon('SB.png')
	//globals.sb_MENU_setMenubar();

	/*

	 //globals.maxOTChapter = 0;
	 //globals.maxOTChapter = 403;
	 //globals.maxOTBook = 14;

	 //globals.version = globals.maxOTChapter > 0 ?
	 //"2.0" : "2.0 NT"

	 //globals.testLPWeb()

	 //Get the application type
	 var vClientType = application.getApplicationType()

	 //remove all toolbars when application is not developer

	 if(vClientType != 3){

	 if(globals.customMenuDone == 0)
	 {
	 globals.modifyMenu();
	 globals.customMenuDone = 1
	 }

	 //remove import and export functions
	 plugins.excelxport.exportEnabled = false
	 plugins.excelxport.importEnabled = false
	 plugins.textxport.exportEnabled = false
	 plugins.textxport.importEnabled = false

	 //remove toolbars
	 application.setToolbarVisible('edit', false)
	 application.setToolbarVisible('align', false)
	 application.setToolbarVisible('design', false)
	 application.setToolbarVisible('draw', false)
	 application.setToolbarVisible('text', false)
	 application.setToolbarVisible('distribute', false)

	 }

	 //application.setStatusText('gereed')
	 application.updateUI()

	 */

}

/**
 * @properties={typeid:24,uuid:"8e51230f-a0c1-4022-bc1a-e74e52b65cc6"}
 */
function isOT() {
	return (globals.chapter_pk < 930)
}

/**
 * @properties={typeid:24,uuid:"a79e336c-9874-4f77-b9cf-0c431a28f207"}
 * @AllowToRunInFind
 */
function newWinSearch() {

	globals.d_search_results = globals.search_results
	//application.showFormInDialog(forms.d_search_results, 50, 50, 500, 500)
	//SMM 20-05-2011
	var vForm = application.createWindow('SearchResultsForm', JSWindow.MODAL_DIALOG, null);
	//vForm.title = '';
	vForm.setInitialBounds(50, 50, 500, 500)
	vForm.show(forms.d_search_results);

}

/**
 * @properties={typeid:24,uuid:"b77ecb92-f211-4d70-81f6-5b6bb5899a78"}
 */
function node_selected() {
	//forms.sb_form.node_selected(arguments[0], arguments[1])
}

/**
 * @properties={typeid:24,uuid:"b4a160f2-04f0-47cb-af9d-8a4de4f4a8c3"}
 */
function onClose() {
	//plugins.Kydome_Menus.resetMenuBar();

	var file = plugins.file.convertToJSFile(globals.temp)
	if (file.exists()) {
		plugins.file.deleteFile(file)
	}

}

/**
 * @properties={typeid:24,uuid:"44b27330-168d-4421-be33-472430c051c9"}
 */
function openAbout() {
	var vDate = new Date()
	if (i18n.getCurrentLanguage() == 'es') {
		globals.about = '<html><body><p align="center"><img src="media:///newui/BibliaDeEstudio_logo_648x72.png"/><br /><br />';
		
		var SB = new scopes.StudyBible.StudieBijbel();
		globals.about += SB.SendMail('app_about', 56, {AppVersion:globals.sb_gVersion}, null, true);
		
	//	globals.about += '<table><tr><td>¬© Comentario B√≠blico del CVB: la fundaci√≥n Centro de Investigaci√≥n B√≠blica http:\/\/www.comentariobiblilcocvb.com, Stichting Centrum voor Bijbelonderzoek, http:\/\/www.studiebijbel.nl Todos los derechos reservados</td></tr><tr><td>En el Comentario B√≠blico del CvB se utiliza una serie de traducciones de la Biblia, entre otras las mencionadas a continuaci√≥n. Para √©stas se aplican los siguientes derechos:<br/><br/></td></tr></table><table><tr><td>La Palabra 2010</td><td>Versi√≥n Texto b√≠blico: La Palabra 2010 ¬Æ <br />¬© Sociedad B√≠blica, http:\/\/sociedadbiblica.org <br />Todos los derechos reservados</td></tr><tr><td>Reina Valera 1995</td><td>Versi√≥n Texto b√≠blico: Reina-Valera 95 ¬Æ <br />¬© United Bible Societies Association, Inc., 1995. <br />Todos los derechos reservados http:\/\/www.biblesociety.org</td></tr><tr><td>Reina Valera 1960</td><td>El texto B√≠blico ha sido tomado de la versi√≥n Reina-Valera ¬© 1960 Sociedades B√≠blicas en Am√©rica Latina; ¬© renovado 1988 Sociedades B√≠blicas Unidas. Utilizado con permiso. http:\/\/www.americanbible.org y http:\/\/www.bibles.com <br/>Reina-Valera 1960‚Ñ¢ es una marca registrada de la American Bible Society, y puede ser usada solamente bajo licencia.</td></tr><tr><td>Nueva Biblia Latinoamericana de Hoy</td><td>Nueva Biblia Latinoamericana de Hoy Copyright ¬© 2005 by The Lockman Foundation, La Habra, Calif.  All rights reserved.<br/>For Permission to Quote Information visit http:\/\/www.lockman.org </td></tr><tr><td>Biblia Hebraica Stuttgartensia</td><td>Biblia Hebraica Stuttgartensia, edited by Karl Elliger and Wilhelm Rudolph, Fifth Revised Edition, edited by Adrian Schenker, ¬© 1977 and 1997 Deutsche Bibelgesellschaft, Stuttgart. Used by permission.</td></tr></table>'
	} else {
		globals.about = '<html><body><p align="center"><img src="media:///newui/StudieBijbel_nl-white-320x70.png"/><br /><br /><b><br>Studiebijbel - Internetversie ' + globals.sb_gVersion
		globals.about += '<br> Copyright &#169;' + vDate.getFullYear() + ' Centrum voor Bijbelonderzoek<br>Postbus 139, 3940 AC<br>Doorn.<br>Email: info@studiebijbel.nl</b><br> <br> Nieuwe Vertaling NBG 1951, herziene druk <br>Copyright Nederlands Bijbelgenootschap, 1951/2000 <br><br>Statenvertaling, editie 1977, herziene uitgave<br>Copyright Nederlands Bijbelgenootschap, Haarlem 1997<br><br>Groot Nieuws Bijbel, herziene editie<br>Copyright Nederlands Bijbelgenootschap / Katholieke Bijbelstichting, 1982/1996<br><br>De Nieuwe Bijbelvertaling<br>Copyright Nederlands Bijbelgenootschap, 2004/2007<br><br>De Naardense Bijbel<br>Copyright uitgeverij Skandalon, 2004 </p></body></html>';
	}
	//application.showFormInDialog(forms.about, -1, -1, -1, -1, 'i18n:servoy.menuitem.about', false, false, 'about', true)
	//SMM 20-05-2011

	if(application.getApplicationType() == APPLICATION_TYPES.SMART_CLIENT) {
		var vForm = application.createWindow('about', JSWindow.MODAL_DIALOG, null);
		vForm.setSize(675,500);
		vForm.title = 'i18n:servoy.menuitem.about';
		vForm.show(forms.about);	
	} else {
		forms.web_sb_read.fv_title = i18n.getI18NMessage('servoy.menuitem.about');
		forms.web_sb_read.fv_html = globals.about;
		forms.web_sb_read.fv_print = null;
		
		forms.web_sb_form.elements.tab_notes.tabIndex = 4;
		forms.web_sb_form.elements.tab_notes.visible = true;
	}

}

/**
 * @properties={typeid:24,uuid:"4f1b4509-c065-43e2-98bf-86b9e13f8489"}
 */
function openPdf() {
	/**************************************************************************************
	 Method:         globals.openPdf();

	 Creator         : Adrian Doroiman
	 Modifier        : Karel Broer,  13-10-2008 //set path dynamicly using .servoy/CVB folder

	 Purpose         : Open Grammatica_totaal.pdf

	 Arguments:      -

	 **************************************************************************************/

//	 openSynopsis(arguments[0])
	
	//	return false;
		
	var vFile;
	 if(application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT){
		
		 //var vPDF = plugins.http.getPageData(application.getServerURL()+'/Grammatica_totaal.pdf')
		 //a
		 //plugins.file.openFile(vPDF., "_SELF");
		 
//		 scopes.tools.output('Open PDF my Friend');
//		 scopes.tools.output(application.getServerURL()+'/Grammatica_totaal.pdf');
//		 application.showURL(application.getServerURL()+'/Grammatica_totaal.pdf',  "_self");
//		 application.showU

		 var vPDF = solutionModel.getMedia("files/Grammatica_totaal.pdf");
	//	 vPDF.bytes

		 var vFile = plugins.file.createTempFile("Grammatica_totaal", "pdf");
		 vFile.setBytes(vPDF.bytes);
		 
//		 plugins.UserManager.downloadFile("Grammatica_totaal.pdf", vFile.getAbsoluteFile());
		 //plugins.UserManager.getServerFile(vFile.getAbsolutePath());
		 //plugins.file.writeFile("Grammatica_totaal.pdf", vPDF.bytes);
		 
			//for the web you have to give a callback function that has a JSFile array as its first argument (also works in smart), only multi select and the title are used in the webclient, others are ignored
		//	plugins.file.showFileOpenDialog(null, null, false, new Array("JPG and GIF", "jpg", "gif"), SERVE_PDF, 'Select some nice files')
		 
		 //plugins.file.showFileSaveDialog();
		 
		 if (!plugins.file.openFile("Grammatica_totaal.pdf", vPDF.bytes, "application/pdf", "_blank", null))
				scopes.tools.output('Failed to open the file.');
		 
		 
		/* var vURL= application.getServerURL()+'/Grammatica_totaal.pdf';
			if(application.getApplicationType() == APPLICATION_TYPES.SMART_CLIENT) {
				application.showURL(vURL, "_BLANK");
			} else {
				forms.web_sb_webbrowser.fv_title = "Grammatica";
				forms.web_sb_webbrowser.browse(vURL);
				forms.web_sb_form.elements.tab_notes.tabIndex = 7;
				forms.web_sb_form.elements.tab_notes.visible = true;
			}
		*/
	 }else{
	
		vFile = 'Grammatica_totaal.pdf'
		var vServoyFolder = '.servoy'
		var vSeparator = plugins.it2be_tools.client().fileSeparator
		var vLocalClientPath = plugins.it2be_tools.client().userHome
		var vServoyFolderPath = vLocalClientPath + vSeparator + vServoyFolder
		var vCVBFolder = vServoyFolderPath + vSeparator + 'CVB'
		var vFilePath = vCVBFolder + vSeparator + vFile
	
		if (utils.stringMiddle(application.getOSName(), 1, 7) == "Windows") {
			application.executeProgram('rundll32', ['url.dll,FileProtocolHandler', vFilePath]);
		} else {
			application.executeProgram('open', ['-a', 'preview', vFilePath]);
		}
	 }
}

/**
 * @properties={typeid:24,uuid:"6160723D-206D-4FCA-A26C-B2843C516558"}
 */
function SERVE_PDF() {
	application.output("Test");
}

/**
 * @properties={typeid:24,uuid:"ef9a0199-26ed-4064-806f-4ad64efa6eb3"}
 */
function quit() {
	application.exit()
}

/**
 * @properties={typeid:24,uuid:"f08f8103-2a91-4e41-b76b-6ee8a8ebcd33"}
 */
function resetMenu() {
	plugins.window.getMenuBar().reset();
	//i18n.setLocale('en', 'EN')

	plugins.excelxport.exportEnabled = true;

}

/**
 * @properties={typeid:24,uuid:"72d085d2-5359-44c3-a1da-7d03c97c1e2b"}
 */
function restrictedMenu() {
	var number = plugins.window.getMenuBar().getMenuIndexByText('Opties')//get the MenubarMenu object from the MenubarMenuBar
	var menu = plugins.window.getMenuBar().getMenu(number);
	menu.removeItem([0, 1, 2]);

	number = plugins.window.getMenuBar().getMenuIndexByText('Help')//get the MenubarMenu object from the MenubarMenuBar
	menu = plugins.window.getMenuBar().getMenu(number);
	menu.removeItem([0]);

}

/**
 * @properties={typeid:24,uuid:"c49135ca-caf5-4024-84ca-495e3b650dde"}
 */
function sb_gDEVFix() {
	if (globals.chkDevFix != 1) {
		if (application.getApplicationType() == 3) {
			globals.sb_gNLServerURLs = ["http:\/\/87.249.116.144", "http:\/\/online.studiebijbel.nl"]
			globals.sb_gESServerURLs = ["http:\/\/217.114.108.59"]
			globals.sb_gDEVServerURLs = ["http:\/\/87.249.116.177", "http:\/\/ts.ambitius.com"]

			if (application.getApplicationType() == 3) {
				var vDialog = plugins.dialogs.showQuestionDialog("Selecteer versie", "Nederlands Versie 1 - Spaans Versie 2 - Ontwikkel Versie 3", "Versie 1", "Versie 2", "Versie 3")
				if (vDialog == "Versie 1") {
					globals.sb_gNLServerURLs.push("http:\/\/localhost")
					//scopes.tools.output("nederlands")
				} else if (vDialog == "Versie 2") {
					globals.sb_gESServerURLs.push("http:\/\/localhost")
					//scopes.tools.output("Spaans")
				} else {
					globals.sb_gDEVServerURLs.push("http:\/\/localhost")
					//scopes.tools.output("DEV")
				}
			}
			globals.sb_gNLServerURLs.push("http:\/\/localhost")
			globals.sb_SYS_registerPlugins();

			var vUrl = application.getServerURL()
			var vUrlIndex = utils.stringPosition(vUrl, ":", 6, 1)
			globals.sb_gCurrentServerUrl = utils.stringLeft(vUrl, (vUrlIndex - 1))
			//	globals.sb_gCurrentServerUrl = "http:\/\/217.114.108.59"
		}

		globals.chkDevFix = 1
	}
	return true;
}

/**
 * @properties={typeid:24,uuid:"2ca85192-6000-4c99-b163-9e877eb43ec5"}
 * @param {JSEvent} [event]
 */
function sb_history(event) {
	if (!globals.sb_gHistory) {
		globals.sb_gHistory = new Array();
	}

	var oHistory = new Object();
	oHistory.testament = globals.sb_gTestament;
	oHistory.book = globals.book;
	oHistory.chapter = globals.chapter;
	oHistory.verse = globals.verse;
	if(globals.sb_gTestament == "New")
	{
		if (globals.griek_version) {
			oHistory.onlyGreek = '';
		} else {
			oHistory.onlyGreek = i18n.getI18NMessage('onlyGreek')
		}
		
		oHistory.textVersion = globals.text_version;
	} else {
		
		if (globals.heb_version) {
			oHistory.onlyHebrew = '';
		} else {
			oHistory.onlyHebrew = i18n.getI18NMessage('msg_onlyHebrew')
		}
	}
	globals.sb_gHistory.push(oHistory)

	if (
		(application.getMethodTriggerElementName() != "btn_prev" && application.getMethodTriggerElementName() != "btn_next")
		&& (application.getMethodTriggerElementName() != "back" && application.getMethodTriggerElementName() != "forward")
	) {
		globals.sb_gHistoryPoint = (globals.sb_gHistory.length - 1)
		globals.sb_gHistoryStart = null
	}
}

/**
 * @properties={typeid:24,uuid:"292f1cea-3cab-44d9-9058-4316e621b488"}
 * @AllowToRunInFind
 */
function sb_import_wordTransLNT() {
	var aTypes = new Array();
	aTypes.push('TR');
	aTypes.push('H-F');
	aTypes.push('N25');
	aTypes.push('N27');

//	var vVerseID = arguments[0];
//	var vGreek = "";
//	var iIndex, vNewText, vWordsStrong;

	//scopes.tools.output(vVerseID);

	/*

	 SELECT
	 word_original,
	 word_transliteration,
	 word_translation,
	 word_strong,
	 verse_id,
	 tr,
	 hf,
	 n25,
	 n27,
	 word_order
	 FROM words
	 WHERE verse_id IN (1000095, 1000096, 1000097)
	 AND word_strong IS NOT NULL
	 AND word_strong!=''
	 ORDER BY verse_id, word_order

	 */

	return false;
	////////
//
//	if (vVerseID > 0) {
//		for (m in aTypes) {
//			if (forms.words_fill_in.controller.find()) {
//				if (aTypes[m] == 'TR') {
//					forms.words_fill_in.tr = 1;
//				}
//				if (aTypes[m] == 'H-F') {
//					forms.words_fill_in.hf = 1;
//				}
//				if (aTypes[m] == 'N25') {
//					forms.words_fill_in.n25 = 1;
//				}
//				if (aTypes[m] == 'N27') {
//					forms.words_fill_in.n27 = 1;
//				}
//
//				forms.words_fill_in.verse_id = vVerseID;
//				forms.words_fill_in.controller.search();
//			}
//
//			var j = 0;
//			var vPreviousCode = 0;
//
//			var vWords = '<html><body><table><tr><td><table cellpassind="4" cellspacing="4">';
//			/** @type JSRecord<db:/sb/words> */
//			var vRecord
//			for (var i = 1; i <= forms.words_fill_in.foundset.getSize(); i++) {
//				vRecord = forms.words_fill_in.foundset.getRecord(i);
//				forms.words_fill_in.foundset.setSelectedIndex(i);
//				forms.words_fill_in.words_to_word_variants.setSelectedIndex(i);
//
//				var iDisplay = 1;
//				var iColored = 0;
//				var iCertainMode = 0;
//				var vCode = "";
//
//				/*	if(aTypes[m] == 'TR' && forms.words_fill_in.words_to_word_variants.tr == 0)
//				 {
//				 iDisplay = 0;
//				 } else if(aTypes[m] == 'H-F' && forms.words_fill_in.words_to_word_variants.hf == 0)
//				 {
//				 iDisplay = 0;
//				 } else if(aTypes[m] == 'N25' && forms.words_fill_in.words_to_word_variants.n25 == 0)
//				 {
//				 iDisplay = 0;
//				 } else if(aTypes[m] == 'N27' && forms.words_fill_in.words_to_word_variants.n27 == 0)
//				 {
//				 iDisplay = 0;
//				 } */
//
//				if (iDisplay == 1) {
//					if (forms.words_fill_in.tr == 0 || forms.words_fill_in.hr == 0 || forms.words_fill_in.n25 == 0 || forms.words_fill_in.n27 == 0) {
//						iColored = 1;
//					}
//
//					if (forms.words_fill_in.words_to_word_variants.code_no != null && forms.words_fill_in.words_to_word_variants.code_no != "") {
//						vCode = forms.words_fill_in.words_to_word_variants.code_no;
//					}
//
//					/////////////////////////////////////////////////////////////////////////
//
//					j++;
//
//					if (j % 4 == 1) {
//						vWords = vWords.concat('<tr>');
//					}
//
//					vWords = vWords.concat('<td valign="top">');
//
//					//if(utils.stringTrim(vCode))
//					if (vCode) {
//						if (vPreviousCode != vCode) {
//							vPreviousCode = vCode;
//							if (iColored == 1) {
//								vWords = vWords.concat('<font color="#7A004D">');
//								vWords = vWords.concat('<sup><font size="3">');
//								vWords = vWords.concat(vCode);
//								vWords = vWords.concat('</font></sup>');
//								vWords = vWords.concat('</font>');
//							}
//						}
//
//						// Certain modes
//						vGreek = "";
//						if (iCertainMode == 1) {
//							vGreek = vGreek.concat('[');
//						}
//
//						vGreek = vGreek.concat('<a href="javascript:forms.study_words.searchWord(\'');
//						iIndex = vRecord.word_strong.indexOf('.');
//						vWordsStrong = "";
//
//						if (iIndex > 0) {
//							vWordsStrong = vRecord.word_strong.substring(0, iIndex);
//						} else {
//							vWordsStrong = vRecord.word_strong;
//						}
//
//						vGreek = vGreek.concat(vWordsStrong);
//
//						if (iColored == 1) {
//							vGreek = vGreek.concat('\')" style="color:#7A004D;text-decoration:none"><font face="GreekSBBold" color="#7A004D">');
//						} else {
//							vGreek = vGreek.concat('\')" style="color:#000000;text-decoration:none"><font face="GreekSBBold"	color="#000000">');
//						}
//
//						vGreek = vGreek.concat(vRecord.word_original);
//
//						vGreek = vGreek.concat('</font></a>');
//
//						if (iCertainMode == 1) {
//							vGreek = vGreek.concat(']');
//						}
//
//						vWords = vWords.concat(vGreek);
//
//						if (iColored == 1) {
//							vWords = vWords.concat('<font color="#7A004D"');
//						}
//
//						vWords = vWords.concat('<br />');
//						vWords = vWords.concat(vRecord.word_transliteration);
//						vWords = vWords.concat('<br />');
//						vWords = vWords.concat(vRecord.word_translation);
//						if (iColored == 1) {
//							vWords = vWords.concat('</font>');
//						}
//
//						vWords = vWords.concat('</td>');
//
//						if (j % 4 == 0) {
//							vWords = vWords.concat('</tr>');
//						}
//					}
//
//					/// Manu scripts
//
//					if (forms.fill_manuscript_info.controller.find()) {
//						forms.fill_manuscript_info.verse_id = vVerseID;
//						forms.fill_manuscript_info.controller.search();
//					}
//				}
//			}
//			/** @type JSRecord<db:/sb/manuscript_info> */
//			var vRecord2
//			for (var z = 1; z <= forms.fill_manuscript_info.foundset.getSize(); z++) {
//				vRecord2 = forms.fill_manuscript_info.foundset.getRecord(z);
//
//				var iDisplay2 = 1;
//				if (aTypes[m] == 'TR' && vRecord2.tr == 0) {
//					iDisplay2 = 0
//				}
//				if (aTypes[m] == 'H-F' && vRecord2.tr == 0) {
//					iDisplay2 = 0
//				}
//				if (aTypes[m] == 'N25' && vRecord2.tr == 0) {
//					iDisplay2 = 0
//				}
//				if (aTypes[m] == 'N27' && vRecord2.tr == 0) {
//					iDisplay2 = 0
//				}
//				if (iDisplay2 == 1) {
//					vWords = vWords.concat('</table></td></tr></table>');
//					vWords = vWords.concat('<table><tr><td><font size="3">');
//
//					if (vRecord2.code_no != 0) {
//						vWords = vWords.concat(vRecord2.code_no);
//					}
//					vWords = vWords.concat(' ');
//					var vText = vRecord2.manuscript_text;
//
//					if (vText != null) {
//						var vIndex1 = vText.indexOf('<grk>');
//						var vIndex2 = vText.indexOf('</grk>');
//
//						if (vIndex1 > 0) {
//							var vGreek2 = vText.substring(vIndex1 + 5, vIndex2);
//							vGreek2 = plugins.SB_NT.getGreek(vGreek2);
//
//							vNewText = vText.substring(0, vIndex1);
//							vNewText = vNewText.concat('<font size="3" face="GreekSB">');
//							vNewText = vNewText.concat(vGreek2);
//							vNewText = vNewText.concat('</font>');
//							vNewText = vNewText.concat(vText.substring(vIndex2 + 6));
//						} else {
//							vNewText = vText
//						}
//
//						vWords = vWords.concat(vNewText);
//						vWords = vWords.concat('</font></td></tr>');
//					}
//				}
//			}
//			vWords = vWords.concat('</body></html>');
//			// Foundset genereren
//			var vFoundset = databaseManager.getFoundSet('sb', 'verses');
//
//			if (vFoundset.find()) {
//				vFoundset.pk = vVerseID;
//				vFoundset.search();
//			}
//
//			if (aTypes[m] == 'TR') {
//				vFoundset.words_html_tr = vWords;
//				vFoundset.words_html_tr_gr = vGreek;
//			}
//			if (aTypes[m] == 'H-F') {
//				vFoundset.words_html_hf = vWords;
//				vFoundset.words_html_hf_gr = vGreek;
//			}
//			if (aTypes[m] == 'N25') {
//				vFoundset.words_html_n25 = vWords;
//				vFoundset.words_html_n25_gr = vGreek;
//			}
//			if (aTypes[m] == 'N27') {
//				vFoundset.words_html_n27 = vWords;
//				vFoundset.words_html_n27_gr = vGreek;
//			}
//
//		}
//	}

}

/**
 * @properties={typeid:24,uuid:"3d27517b-e18f-4b88-a247-fc05bc354f51"}
 * @param {Array} vVerseID
 */
function sb_import_wordTransLOT(vVerseID) {
	var k
	var rowSize = 4
	var cont = Array(rowSize)
	var cont_gr = Array(rowSize)
	var updateQuery = "";
	var query = "select word_original, word_transliteration, word_translation, word_strong, verse_id from words where verse_id IN (" + vVerseID.join(', ') + ") and word_strong is not null and word_strong!='' order by verse_id, word_order"
	var res = databaseManager.getDataSetByQuery('sb', query, null, -1)
	var size = res.getMaxRowIndex()
	var i;
	if (size >= 0) {
		var iCurrentVerse = 0;
		for (var j = 1; j <= size; j++) {
			i = j;
			if (iCurrentVerse != res.getValue(i, 5)) {
				if (j != 1) {
					updateQuery += "UPDATE verses SET words_html_tr = '" + header + content + footer + "',words_html_tr_gr='" + header + content_gr + footer + "' WHERE pk=" + res.getValue( (i - 1), 5) + ";\n";
				}
				iCurrentVerse = res.getValue(i, 5)
				var header = '<html><body><table><tr><td><table cellpadding="4" cellspacing="4">'
				var content = ''
				var content_gr = ''
				var footer = '</table></td></tr></table></body></html>'
			}
			//res.rowIndex = j

			if ( (j - 1) % rowSize == 0) {
				content += '<tr>'
				content_gr += '<tr>'
			}

			if (res.getValue(i, 4)) {
				var strong = res.getValue(i, 4)
				var vIndex = strong.indexOf('.', 0)
				if (vIndex > 0)
					strong = strong.substring(0, vIndex)

				//	cont[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B><br><font face="SIL Heb Trans">'+plugins.SILEzraToUnicode.convertToEzra(res[2])+'</font><br>' + res[3] + '</td>'
				//	cont_gr[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B></td>'
				cont[rowSize - (j - 1) % rowSize - 1] = "<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + globals.stringToCharNo(res.getValue(i, 1)) + "</font></B><br><font face=\"SIL Heb Trans\">" + (res.getValue(i, 2)) + "</font><br>" + utils.stringReplace(res.getValue(i, 3), "'", "&#39;") + "</td>"
				cont_gr[rowSize - (j - 1) % rowSize - 1] = "<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + globals.stringToCharNo(res.getValue(i, 1)) + "</font></B></td>"
			} else {
				cont[rowSize - (j - 1) % rowSize - 1] = ''
				cont_gr[rowSize - (j - 1) % rowSize - 1] = ''
			}

			if (j % rowSize == 0) {
				for (k = 0; k < rowSize; k++) {
					content += cont[k]
					content_gr += cont_gr[k]
				}
				content += '</tr>'
				content_gr += '</tr>'
			}

		}//j
		if (size % rowSize != 0) {
			for (k = 0; k < rowSize - size % rowSize; k++) {
				content += '<td valign="top">&nbsp;</td>'
				content_gr += '<td valign="top">&nbsp;</td>'
			}
			for (k = rowSize - size % rowSize; k < rowSize; k++) {
				content += cont[k]
				content_gr += cont_gr[k]
			}

			content += '</tr>'
			content_gr += '</tr>'
		}

	}

	//var updateQuery = "UPDATE verses SET words_html_tr = '" + header + content + footer + "',words_html_tr_gr='"+ header + content_gr + footer + "' WHERE pk=" + vVerseID
	//scopes.tools.output(    updateQuery )
	var success = plugins.rawSQL.executeSQL('sb', "verses", updateQuery)
	if (!success) {
		//scopes.tools.output("Verses words cannot be updated")
	} else {
		//	databaseManager.refreshRecordFromDatabase(forms.verses_fill_in.foundset, -1)
		plugins.rawSQL.flushAllClientsCache('sb', 'verses');
	}

}

/**
 * @properties={typeid:24,uuid:"5880a091-ae7c-4a4d-8252-248e7bd95a29"}
 */
function scrollConcordance() {
	globals.iConcordance += arguments[0]

	globals.wlink(globals.selectedWordStudy, true)
}

/**
 * @properties={typeid:24,uuid:"2ed740d0-a327-4a08-9967-5e8423aa4d81"}
 */
function selectAll() {
	forms[globals.gFName].elements[globals.gElName].selectAll();
}

/**
 * @param {Number} vPK
 * @properties={typeid:24,uuid:"9b9a2b85-a5b7-40a9-8be2-c91be8f53029"}
 * @AllowToRunInFind
 */
function setBookChapVerse(vPK) {
	/** @type JSRecord<db:/sb/verses> */
	var record;

	//forms.verses_fill_in.foundset.clearFoundSet()
	//forms.verses_fill_in.controller.loadAllRecords()

	if (forms.verses_fill_in.controller.find()) {
		forms.verses_fill_in.pk = vPK;
		forms.verses_fill_in.controller.search()
	}
	if (forms.verses_fill_in.foundset.getSize() > 0) {
		record = forms.verses_fill_in.foundset.getRecord(1)
		globals.verse = record.verse_number
		globals.book = record.calc_book_name
		var chap_id = record.chapter_id
		globals.chapter_pk = chap_id
	}
	//forms.chapters_fill_in.foundset.clearFoundSet()
	if (forms.chapters_fill_in.controller.find()) {
		forms.chapters_fill_in.pk = chap_id
		forms.chapters_fill_in.controller.search()
	}

	/** @type JSRecord<db:/sb/chapters> */
	record = forms.chapters_fill_in.foundset.getRecord(1)
	globals.chapter = record.chapter_no

	// Get testament
	var vSQL = "SELECT testament, pk FROM books WHERE book_name = ?";
	var vQuery = databaseManager.getDataSetByQuery('sb', vSQL, [globals.book], 1);
	globals.sb_gTestament = vQuery.getValue(1, 1);
	globals.book_id = vQuery.getValue(1, 2);

}

/**
 * @properties={typeid:24,uuid:"cbadef21-d308-4de3-a3e1-4dfe1cd659e1"}
 * @param {Number} arg
 * @AllowToRunInFind
 */
function setVersePath(arg) {
	var aux = ''
		/** @type JSRecord<db:/sb/verses> */
	var record
	//forms.verses_fill_in.foundset.clearFoundSet()
	if (forms.verses_fill_in.controller.find()) {
		forms.verses_fill_in.pk = arg
		forms.verses_fill_in.controller.search()
	}
	if (forms.verses_fill_in.foundset.getSize() > 0) {
		record = forms.verses_fill_in.foundset.getRecord(1)
		var verse_no = record.verse_number
		forms.chapters_fill_in.foundset.clear()
		if (forms.chapters_fill_in.controller.find()) {
			forms.chapters_fill_in.pk = record.chapter_id
			forms.chapters_fill_in.controller.search()
		}
		/** @type JSRecord<db:/sb/chapters> */
		if (forms.chapters_fill_in.foundset.getSize() > 0) {
			record = forms.chapters_fill_in.foundset.getRecord(1)
			var chapter_no = record.chapter_no
			forms.books_fill_in.foundset.clear()
			if (forms.books_fill_in.controller.find()) {
				forms.books_fill_in.pk = record.book_id
				forms.books_fill_in.controller.search()
			}
			/** @type JSRecord<db:/sb/books> */
			if (forms.books_fill_in.foundset.getSize() > 0) {
				record = forms.books_fill_in.foundset.getRecord(1)
				aux += record.book_name
				aux += ' '
				aux += chapter_no
				aux += ':'
				aux += verse_no
			}
		}
	}

	globals.verse_path = aux
}

/**
 * @param {Number} vID
 * @param {*} [param1]
 * @param {*} [type]
 * @properties={typeid:24,uuid:"cb2ac99d-31e2-4aa5-886e-0f4fd733d588"}
 * @AllowToRunInFind
 */
function showCommentaryInDialog(vID, param1, type) {

	//Migrate: Use SOLUTIONMODEL
	//var vID = arguments[0]

	//SMM - 16-06-2011
	if (!globals.formCountCommentInstance) {
		globals.form_comment_width = globals.getUserSetting('form_comment_instance_width');
		globals.form_comment_height = globals.getUserSetting('form_comment_instance_height');
		globals.formCountCommentInstance = 1;
	} else {
		globals.formCountCommentInstance++;
	}

	var vForm = solutionModel.getForm('comment_instance_new')
	var vNewFormName = 'comment_instance' + application.getUUID().toString().substr(0, 8);
	var ok = solutionModel.cloneForm(vNewFormName, vForm)
	var vFormname = ok.name

	if (forms[vFormname].foundset.find()) {
		/** @type JSRecord<db:/sb/commentary_blocks> */
		forms[vFormname].foundset.pk = vID;
		var vCount = forms[vFormname].foundset.search();
	}
	
	var vTitle = forms[vFormname].title;
	vTitle = utils.stringReplace(vTitle, '<h1>', '')
	vTitle = utils.stringReplace(vTitle, '</h1>', '')
	vTitle = utils.stringReplace(vTitle, '<h2>', '')
	vTitle = utils.stringReplace(vTitle, '</h2>', '')
	
	if (!vTitle) {
		vTitle = i18n.getI18NMessage('cvb.lbl.commentary');
	}

	var vTotalTitle = forms[vFormname].commentary_blocks_to_books.book_name + " " + forms[vFormname].chapter_from + ":" + forms[vFormname].verses_from
	if (forms[vFormname].verses_to != forms[vFormname].verses_from) {
		vTotalTitle += "-" + forms[vFormname].chapter_to + ":" + forms[vFormname].verses_to
	}
	var vInput = vTitle; //document.getElementById("input-code").innerHTML;
	var vOutput = vInput.replace(/<\/?[^>]+(>|$)/g, "");

	vTotalTitle += " - " + vOutput;

	vTotalTitle = utils.stringReplace(vTotalTitle,"\n"," ");
	
	scopes.tools.output(vTotalTitle)
	
	if (ok) {
		//var vFormName = 'instance_'+globals.pinkenelis
		if (arguments[2] == 'search') {
			globals.sb_blockFootnoteLinkSearchForm = 1
		}
		
		if(globals.sb_gSearchType == 1) {
			//application.showFormInDialog(forms[vFormname], -1, -1, -1, -1, vTotalTitle, true, false, vFormname, false)
			//application.showFormInDialog( form,  [x],  [y],  [width],  [height],  [dialogTitle],  [resizable],  [showTextToolbar],  [windowName],  [modal])
			//SMM 20-05-2011
			var vDialog = application.createWindow(vFormname, JSWindow.DIALOG, null);
			vDialog.title = vTotalTitle;
			if (globals.form_comment_width && globals.form_comment_height) {
				vDialog.setInitialBounds(-1, -1, globals.form_comment_width, globals.form_comment_height)
			}
			vDialog.show(forms[vFormname]);
			
			forms[vFormname].controller.recreateUI()
		} else if (globals.sb_gSearchType == 2) {
			forms.web_sb_read.fv_title = vTotalTitle;
			forms.web_sb_read.fv_html = forms[vFormname].showCommentary; //commentaries_to_verses_to_commentary_blocks
			forms.web_sb_read.fv_print = null;
			
			forms.web_sb_form.elements.tab_notes.tabIndex = 4;
			forms.web_sb_form.elements.tab_notes.visible = true;
		}
	}

	//Some sit
	if (arguments[1] == true) {
		var query = "SELECT cb.title || cb.htmltext_short as commentary, list('<f><b>' || f.footnote_number || '</b></f>&nbsp;' || f.htmltext, '<br>'  ORDER BY f.footnote_number) as footnote, cb.pk FROM commentary_blocks cb LEFT OUTER JOIN footnotes f" + " ON cb.pk=f.commentary_block_id WHERE cb.htmltext IS NOT NULL AND length(cb.htmltext)>15" + " AND cb.book_id=" + forms[vFormname].book_id + " AND (cb.chapter_from<" + globals.chapter + " or (cb.chapter_from=" + forms[vFormname].chapter_from + "  and cb.verses_from<=" + forms[vFormname].verses_from + "))" + " AND (cb.chapter_to>" + globals.chapter + " or (cb.chapter_to=" + forms[vFormname].chapter_from + " and cb.verses_to>=" + forms[vFormname].verses_from + "))" + " GROUP BY cb.title, cb.htmltext_short, cb.pk	ORDER BY cb.pk"

		var res = databaseManager.getDataSetByQuery('sb', query, null, 100)
		return res.getRowAsArray(1)
	}
	return [];
}

/**
 * @properties={typeid:24,uuid:"f9c892db-dece-4174-ac62-ba462c2b4361"}
 * @AllowToRunInFind
 * @param {Number} cbl_id
 * @param {Number} fnr
 * @param {String} type
 */
function showFootnoteInDialog(cbl_id, fnr, type) {
	var vID = arguments[0]
	var vFNNumber = arguments[1]
	if (!globals.pinkenelis) {
		globals.pinkenelis = 1;
	} else {
		globals.pinkenelis++;
	}

	var ok = application.createNewFormInstance('footnote_instance', 'footnote_instance_' + globals.pinkenelis)
	if (forms['footnote_instance_' + globals.pinkenelis].foundset.find()) {
		forms['footnote_instance_' + globals.pinkenelis].foundset.commentary_block_id = vID;
		forms['footnote_instance_' + globals.pinkenelis].foundset.footnote_number = vFNNumber
		forms['footnote_instance_' + globals.pinkenelis].foundset.search();
	}

	var vSQL = "SELECT books.book_name, commentary_blocks.chapter_from, commentary_blocks.verses_from  FROM commentary_blocks INNER JOIN books ON commentary_blocks.book_id = books.pk WHERE commentary_blocks.pk = ?"
	var vQuery = databaseManager.getDataSetByQuery("sb", vSQL, [vID], 1)

	var vTitle = vQuery.getValue(1, 1) + " " + vQuery.getValue(1, 2) + ":" + vQuery.getValue(1, 3) + " " + i18n.getI18NMessage('cvb.lbl.footnotenumber') + " " + vFNNumber

		//var vTitle = forms['footnote_instance_'+globals.pinkenelis].title;
		//var vTitle = "HOI"

		//	vTitle = utils.stringReplace(vTitle, '<h1>', '')
	//	vTitle = utils.stringReplace(vTitle, '</h1>', '')

	if (!vTitle) {
		vTitle = i18n.getI18NMessage('cvb.lbl.commentary');
	}

	//var vTotalTitle = forms['comment_instance_'+globals.pinkenelis].commentary_blocks_to_books.book_name + " "+ forms['comment_instance_'+globals.pinkenelis].chapter_from + ":"+ forms['comment_instance_'+globals.pinkenelis].verses_from
	//if(forms['comment_instance_'+globals.pinkenelis].verses_to != forms['comment_instance_'+globals.pinkenelis].verses_from)
	//{
	//	vTotalTitle += "-"+ forms['comment_instance_'+globals.pinkenelis].chapter_to + ":"+ forms['comment_instance_'+globals.pinkenelis].verses_to
	//}
	//var vInput = vTitle; //document.getElementById("input-code").innerHTML;
	//var vOutput = vInput.replace(/<\/?[^>]+(>|$)/g, "");

	//vTotalTitle += " - " + vOutput;

	if (ok) {
		var vFormName = 'instance_' + globals.pinkenelis
		if (arguments[2] == 'search') {
			globals.sb_blockFootnoteLinkSearchForm = 1
		}
		
		if(globals.sb_gSearchType == 1) {
			//application.showFormInDialog(forms['footnote_instance_' + globals.pinkenelis], -1, -1, -1, -1, vTitle, true, false, vFormName, false)
			//SMM 20-05-2011
			var vForm = application.createWindow(vFormName, JSWindow.DIALOG, null);
			vForm.title = vTitle
			vForm.show(forms['footnote_instance_' + globals.pinkenelis]);
		} else if(globals.sb_gSearchType == 2) {
			forms.web_sb_read.fv_title = vTitle;
			forms.web_sb_read.fv_html = forms['footnote_instance_' + globals.pinkenelis].foundset.searchHTML;
			forms.web_sb_read.fv_print = null;

			forms.web_sb_form.elements.tab_notes.tabIndex = 4;
			forms.web_sb_form.elements.tab_notes.visible = true;
		}
	}

	// Some sit
	/*if(arguments[1] == true)
	 {
	 var query = "SELECT cb.title || cb.htmltext_short as commentary, list('<f><b>' || f.footnote_number || '</b></f>&nbsp;' || f.htmltext, '<br>'  ORDER BY f.footnote_number) as footnote, cb.pk FROM commentary_blocks cb LEFT OUTER JOIN footnotes f" +
	 " ON cb.pk=f.commentary_block_id WHERE cb.htmltext IS NOT NULL AND length(cb.htmltext)>15" +
	 " AND cb.book_id=" + forms['comment_instance_'+globals.pinkenelis].book_id +
	 " AND (cb.chapter_from<" + globals.chapter + " or (cb.chapter_from=" + forms['comment_instance_'+globals.pinkenelis].chapter_from + "  and cb.verses_from<=" + forms['comment_instance_'+globals.pinkenelis].verses_from + "))" +
	 " AND (cb.chapter_to>" + globals.chapter + " or (cb.chapter_to=" + forms['comment_instance_'+globals.pinkenelis].chapter_from + " and cb.verses_to>=" + forms['comment_instance_'+globals.pinkenelis].verses_from + "))" +
	 " GROUP BY cb.title, cb.htmltext_short, cb.pk	ORDER BY cb.pk"

	 var res = databaseManager.getDataSetByQuery(forms.articles.controller.getServerName(),query,null, 100)
	 return res.getRowAsArray(1)
	 }*/
}

/**
 * @param {Boolean} vOT
 * @properties={typeid:24,uuid:"0faddf3e-ee16-4cef-909f-2a182bf875c1"}
 */
function showOTData(vOT) {
    //SMM 18-07-2011 
	//Content
	if (vOT) {			
		//if (globals.ot == 0) {			
			globals.study_analyze = ''			
		//}			
		forms.book_notes.elements.footnote.visible = false				
		globals.ot = 1
		databaseManager.saveData()
	} else {		
		//if (globals.ot == 1) {
			globals.commentary = ''
		//}
		forms.book_notes.elements.footnote.visible = true				
		globals.ot = 0
		databaseManager.saveData()
	}
}

/**
 * @param {String} vOT
 * @properties={typeid:24,uuid:"9ba6656c-2600-4b34-81c6-ba442af3c23e"}
 */
function showOTData_old(vOT) {
		//Labels
		//study verse words
		//forms.study_words.elements.versions.visible = !ot
		//forms.study_words.elements.versionsText.visible = !ot
		//forms.study_words.elements.grieks.visible = !ot
		//forms.study_words.elements.heb.visible = ot

		//word study
		//forms.word_study.elements.study.visible = true
		//forms.word_study.elements.commentary.visible = false

		//book_commment
		//forms.book_comment.elements.comment.visible = !ot
		//forms.book_comment.elements.footnote.visible = ot

	//book_notes
	forms.book_notes.elements.footnote.visible = vOT

	//Content
	if (vOT) {
		if (globals.ot == 0) {
			//globals.study_analyze = ''
		}
		globals.ot = 1
	} else {
		if (globals.ot == 1) {
			//globals.study_analyze = ''
			globals.commentary = ''
		}
		globals.ot = 0
	}
}

/**
 * @param i Text
 * @properties={typeid:24,uuid:"8e2812fa-081c-406b-b683-0ca424255f85"}
 */
function stringToCharNo(i) {
	var input = i + "";
	//arguments[0] = 'ab' // plugins.SILEzraToUnicode.convertToEzra('ab')//\'√ürA√êb') //'ab'
	//if(arguments[0])
	if (input) {
		/*if(arguments[0].charCodeAt(1) >= 61440)
		 {
		 return arguments[0];
		 }*/

		if (input.charCodeAt(1) >= 61440) {
			return input;
		}

		var vChars = new Array();
		var vCharsNo = new Array();
		var vNewArray = new Array();
		/*
		 for(klmi = 0; klmi < arguments[0].length; klmi++)
		 {
		 vChars.push(arguments[0].charAt(klmi));
		 vCharsNo.push(arguments[0].charCodeAt(klmi));
		 //vNewArray.push(utils.getUnicodeCharacter((arguments[0].charCodeAt(klmi)+61440)))
		 vNewArray.push("&#"+(arguments[0].charCodeAt(klmi)+61440)+";")

		 }*/

		for (var klmi = 0; klmi < input.length; klmi++) {
			vChars.push(input.charAt(klmi));
			vCharsNo.push(input.charCodeAt(klmi));
			//vNewArray.push(utils.getUnicodeCharacter((arguments[0].charCodeAt(klmi)+61440)))
			vNewArray.push("&#" + (input.charCodeAt(klmi) + 61440) + ";")

		}

		var vNewString = vNewArray.join('');


		return vNewString;
	}
	return null
}

/**
 * @param {String} vtext
 * @properties={typeid:24,uuid:"0806f5db-f3dd-4938-bf39-e54e0b5a237d"}
 */
function TextChangeFont1ToCaps(vtext) {
	//Not working
	if (vtext == null)
		return null

	var regexp = /<font1>([.]+)<\/font1>/gi
	var vTemp = vtext.replace(regexp, '<font1>$1.toUpperCase()<\/font1>')
	return vTemp
}

/**
 * @param {String} vtext
 * @properties={typeid:24,uuid:"8744aeef-c625-40f7-8127-dbf4739af5b2"}
 */
function TextChangeFReferenceToSuper(vtext) {
	var regexp = /<f>([\d]+)<\/f>/gi
	var vTemp = vtext.replace(regexp, '<f><sup><b>$1</b></sup></f>')

	return vTemp
}

/**
 * @param {String} vtext
 * @properties={typeid:24,uuid:"79ba88c9-ac6c-4ccc-b5ea-396e9cf54619"}
 */
function TextChangeSuReferenceToSuper(vtext) {

	var regexp = /<su>([.]+)<\/su>/gi
	var vTemp = vtext.replace(regexp, '<sup>$1</sup>')

	return vTemp
}

/**
 * @param {String} original
 * @properties={typeid:24,uuid:"c642480d-0482-4f1e-9fc6-827fc866692b"}
 */
function TextChangeToGreek(original) {
	var newOriginal
	var index1 = original.indexOf('<pct>')
	var index2 = original.indexOf('</pct>')
	if (index1 > 0) {
		newOriginal = original.substring(0, index1)

	} else if (index1 == 0) {
		newOriginal = original.substring(index2 + 6)
	} else
		newOriginal = original
	var greek = (newOriginal)
	if (index1 > 0) {
		greek = greek.concat(original.substring(index1 + 5, index2))
	} else if (index1 == 0) {
		var aux = greek
		greek = original.substring(index1 + 5, index2)
		greek = greek.concat(aux)

	}

	original = greek

	return original

}

/**
 * @param {String} vtext
 * @properties={typeid:24,uuid:"822956a1-9f27-4add-95a6-0fa1b0b3d014"}
 */
function TextFlinkFillIn(vtext) {
	var regexp = /<f><sup><b>([\d]+)<\/b>/gi
	var vTemp = vtext.replace(regexp, '<f><sup><b><a href="javascript:globals.flink(\'$1\')">$1</a><\/b>')

	return vTemp;

}

/**
 * @properties={typeid:24,uuid:"c62f32ec-b166-4b80-b242-7151ec7fe590"}
 */
function TextReplaceHebrewInFootnotes(i) {
	var input = i + "";
	var regexp = /<tr>([^<]+)<\/tr>/i
	var arr = input.match(regexp)
	var heb

	while (arr != null && arr.length > 0) {
		//Migratie: Alle plugins.SILEzraToUnicode vervangen
		heb = "<tra><font style=\"font-family: SIL Heb Trans\">" + globals.stringToCharNo(arr[1]) + "</font></tra>"
		input = input.replace(regexp, heb)
		arr = input.match(regexp)
	}
}

/**
 * @properties={typeid:24,uuid:"d25b28a1-14b0-422f-aa18-3f2c6951ca4e"}
 * @param {*} vTemp
 */
function TextReplaceSpecialChars(vTemp) {
	var aux
	do {
		aux = vTemp
		vTemp = vTemp.replace('e^', '&#275;')
		vTemp = vTemp.replace('a^', '&#257;')
		vTemp = vTemp.replace('i^', '&#299;')
		vTemp = vTemp.replace('o^', '&#333;')
		vTemp = vTemp.replace('u^', '&#363;')
		vTemp = vTemp.replace(">Q<", ">&#8216<");
		vTemp = vTemp.replace(">W<", ">&#8217<");

		vTemp = vTemp.replace('E^', '&#274;')
		vTemp = vTemp.replace('A^', '&#256;')
		vTemp = vTemp.replace('I^', '&#298;')
		vTemp = vTemp.replace('O^', '&#332;')

		vTemp = vTemp.replace("</I>W", "</I>&#8217");
		vTemp = vTemp.replace("#91", "&#8216")
		vTemp = vTemp.replace("#92", "&#8217")

		vTemp = vTemp.replace("√¢‚Ç¨‚Ñ¢", "&#8217;")
		vTemp = vTemp.replace("√¢‚Ç¨Àú", "&#8216;")
		vTemp = vTemp.replace("<l level=\"1\">", "<l level=\"1\" ><br>&nbsp;&nbsp;&nbsp;&nbsp;")
		//temp = temp.replace("^","-")
	} while (vTemp != aux)

	return vTemp
}

/**
 * @properties={typeid:24,uuid:"8c9e2515-6dc9-4fb9-99b1-8fdc28e67b89"}
 * @param {String} vtext
 */
function TextTlinkClear(vtext) {
	var index1 = vtext.indexOf('<tlink>')
	while (index1 >= 0) {
		var index2 = vtext.indexOf('\=', index1)
		var index3 = vtext.indexOf('</tlink>', index1)
		var aux = vtext.substring(0, index1)
		if (index2 >= 0) {
			aux = aux.concat(vtext.substring(index1 + 7, index2))
		} else {
			aux = aux.concat(vtext.substring(index1 + 7, index3))
		}
		aux = aux.concat(vtext.substring(index3 + 8))
		aux = aux.concat()
		vtext = aux
		index1 = vtext.indexOf('<tlink>', index1 + 1)
	}

	return vtext
}

/**
 * @properties={typeid:24,uuid:"603c1a5b-c2ce-441e-9a9a-2694a963a420"}
 * @param {*} vtext
 */
function TextTlinkFill(vtext) {
	var index1 = vtext.indexOf('<tlink>')
	var number
	while (index1 >= 0) {
		var index2 = vtext.indexOf('\=', index1)
		var index3 = vtext.indexOf('</tlink>', index1)
		if (index3 >= 0) {
			if (index2 >= 0) {
				number = vtext.substring(index2 + 1, index3)
			} else
				number = ''
			var aux = vtext.substring(0, index1)
			aux = aux.concat('<a href="javascript:globals.tlink(\'')
			aux = aux.concat(number)
			aux = aux.concat('\')">')
			if (index2 >= 0) {
				aux = aux.concat(vtext.substring(index1 + 7, index2))
			} else {
				aux = aux.concat(vtext.substring(index1 + 7, index3))
			}
			aux = aux.concat('</a>')
			aux = aux.concat(vtext.substring(index3 + 8))
			vtext = aux
		}
		index1 = vtext.indexOf('<tlink>', index1 + 1)
	}

	return vtext

}

/**
 * @properties={typeid:24,uuid:"706d2501-5e4f-4238-99be-f2ed0cff3079"}
 * @param {String} vtext
 */
function TextWlinkClear(vtext) {
	var index1 = vtext.indexOf('<wlink>')
	while (index1 >= 0) {
		var index2 = vtext.indexOf('\=', index1)
		var index3 = vtext.indexOf('</wlink>', index1)
		var aux = vtext.substring(0, index1)
		if (index2 >= 0) {
			aux = aux.concat(vtext.substring(index1 + 7, index2))
		} else {
			aux = aux.concat(vtext.substring(index1 + 7, index3))
		}
		aux = aux.concat(vtext.substring(index3 + 8))
		aux = aux.concat()
		vtext = aux
		index1 = vtext.indexOf('<wlink>', index1 + 1)
	}

	return vtext
}

/**
 * @properties={typeid:24,uuid:"19eb2a38-bc66-437a-b6c2-a2881c684d46"}
 * @param {*} vtext
 */
function TextWlinkFill(vtext) {
	var index1 = vtext.indexOf('<wlink>')
	var number
	while (index1 >= 0) {
		var index2 = vtext.indexOf('\=', index1)
		var index3 = vtext.indexOf('</wlink>', index1)
		if (index3 >= 0) {
			if (index2 >= 0) {
				number = vtext.substring(index2 + 1, index3)
			} else
				number = ''
			var aux = vtext.substring(0, index1)
			aux = aux.concat('<a href="javascript:wlink(\'')
			aux = aux.concat(number)
			aux = aux.concat('\')">')
			if (index2 >= 0) {
				aux = aux.concat(vtext.substring(index1 + 7, index2))
			} else {
				aux = aux.concat(vtext.substring(index1 + 7, index3))
			}
			aux = aux.concat('</a>')
			aux = aux.concat(vtext.substring(index3 + 8))
			vtext = aux
		}
		index1 = vtext.indexOf('<wlink>', index1 + 1)
	}

	return vtext

}

/**
 * @properties={typeid:24,uuid:"dff77f43-a6b3-4f19-892f-44e6db8e7921"}
 * @param {*} inp
 */
function tlink(inp) {
	if (utils.stringLeft(currentcontroller.getName(), 8) == "sb_edit_") {
		return
	}
	// Toggle between the elements opn the footnote screen
	// Added by RB / 02/07/2010
	// TODO: Notities moet in nieuw tab getoond worden...
	//forms.book_notes.elements.notec.visible = false;
	//forms.book_notes.elements.note.visible = true;

	if (globals.flag == "false") {
		globals.flag = "true";
		globals.tlink(arguments[0]);
	}

	var arg = '', myhtml
	arg = arg.concat(arguments[0].toString())

	var verse_ids = globals.getVerseIdFromTlink(arg);

	var showOnlySV = false
	if (!arguments[1]) {
		myhtml = globals.viewVerses(verse_ids, showOnlySV);
	} else {
		myhtml = globals.viewVerses(verse_ids, showOnlySV, true);
	}

	if (!arguments[1] && verse_ids.length > 5) {
		var vShowAll = i18n.getI18NMessage('html_showAll');
		myhtml = myhtml.concat("<b><a href=\"javascript:globals.tlink('" + arguments[0] + "', 'true')\">" + vShowAll + "</a></b>");
	}

	myhtml = myhtml.concat('</body></html>')
	if (globals.chkYouInThisVerse == 1) {
		globals.chkYouInThisVerse = 0
		myhtml = "<html><body><font color=\"red\">" + i18n.getI18NMessage('cvb.lbl.verseSelected') + "</font></body></html>";
	} else if (myhtml.length <= 41 && globals.sb_demo_chk == 1) {
		myhtml = "<html><body><font color=\"red\">" + i18n.getI18NMessage('CVB.lbl.youNeedFullversion') + "</font></body></html>";
	} else if (myhtml.length <= 41) {
		myhtml = "<html><body><font color=\"red\">" + i18n.getI18NMessage('CVB.lbl.verseNotPresent') + "</font></body></html>";
	}
	//TODO:Rick screwed this one up!
	globals.notes = myhtml
	
	if(application.getApplicationType() != APPLICATION_TYPES.WEB_CLIENT) {
		forms.book_notes.controller.recreateUI();	
		forms.sb_form.resizeSplitTab(null, null)
	}	else {
		forms.book_notes.elements.note.caretPosition = 0;
		forms.book_notes.elements.note.setScroll(0,0);
		
		forms.web_sb_subform.elements.tabs.tabIndex = 1;
		forms.web_sb_commentary.elements.tabs.tabIndex = 1;
	
		// Addition 27-05-2016
		// Detect if reading pane is open.
		if(forms.web_sb_form.elements.tab_notes.visible === true) {
			forms.web_sb_form.elements.tab_notes.visible = false;
		}
	
	}
	
	
//var dl = forms.sb_form.elements.bean_321.dividerLocation
	//forms.sb_form.elements.bean_321.dividerLocation = dl
	//forms.sb_form.elements.bean_321.bottomComponent = forms.sb_form.elements.tabs_book_notes

}

/**
 * @param {JSEvent|Number} event //SMM 24-05-2011  event DEPRECATED
 * @properties={typeid:24,uuid:"f193795b-505f-42d8-83e0-b658efd40579"}
 */
function viewVerse(event) {
	
	// globals.selected_verse_id
	globals.selected_verse_id = arguments[0]

	globals.setBookChapVerse(globals.selected_verse_id)

	globals.doNotPopup = 1;
	globals.showOTData(globals.isOT());
	globals.doNotPopup = null;
	//Added
	forms.book_notes.viewNotesForSelectedVerse()

	forms.sb_form.setBookId();
	forms.sb_form.setChapterId();
	forms.sb_form.setVerseIdNew(globals.selected_verse_id);
}

/**
 * @properties={typeid:24,uuid:"6c368a35-ffba-4d7a-a672-e5f41325fdc5"}
 * @param {Array<Number>} verse_ids
 * @param {Boolean} showOnlySV
 * @param {Boolean} [bln]
 */
function viewVerses(verse_ids, showOnlySV, bln) {
	/** @type {String} */
	var myhtml = '<html><body><table>'
	
	var vMax;

	if (!arguments[2] && verse_ids.length > 5) {
		vMax = 5;
	} else {
		vMax = verse_ids.length
	}

	for (var i = 0; i < vMax; i++) {
		if (verse_ids[i] == globals.selected_verse_id) {
			globals.chkYouInThisVerse = 1
			continue;
		} else {
			globals.chkYouInThisVerse = 0
		}
		myhtml += '<tr><td valign=\"top\" nowrap><table><tr><td><a href=\"javascript:globals.viewVerse('
		myhtml += verse_ids[i]
		myhtml += ')\"><font color=\"#000000\">'
		globals.setVersePath(verse_ids[i]);
		myhtml += globals.verse_path
		myhtml += '</font></a></td></tr></table></td><td valign=\"top\">'
		myhtml += globals.getTranslationsForVerse(verse_ids[i], showOnlySV)
		myhtml += '</td></tr>'
	}

	myhtml += '</table>';	
	return myhtml

}

/**
 * @properties={typeid:24,uuid:"05ea7848-315c-4803-84fa-93b24c6ace14"}
 * @param {String|*} vStrong
 * @param {Object} [vConcordance]
 * @param {String} [vVersion]
 * @param {String} [vAbbr]
 */
function wlink(vStrong, vConcordance, vVersion, vAbbr) {
	
	scopes.tools.output("vStrong = " + vStrong);
	scopes.tools.output("vConcordance = " + vConcordance);
	scopes.tools.output("vVersion = " + vVersion);
	
	// fix voor OT - 09-01-2012 - in overleg met Arjan de Heer
/*	if(globals.sb_gTestament == "Old" && !arguments[2])
	{
		return false;
	}*/
	if(vVersion == undefined)
	{
		// DONT VORRY, BE GAPPY :-D
		// addition, we also need
		var vArgs = [];
		if(vStrong.match(/OT/))
		{
			vArgs.push('Old');
		} else {
			vArgs.push('New');
		}
		
		var vSQL = "SELECT version_key, version_abbr FROM word_study_version WHERE version_testament = ? AND version_default = 1";
		var vDS = databaseManager.getDataSetByQuery('sb', vSQL, vArgs, 1);
		
		vVersion = vDS[0]['version_key'];
		vAbbr = vDS[0]['version_abbr']
	}

// 	DIT IS NIET LANGER VAN TOEPASSING OP DE SPAANSE VERSIE!
//	if (globals.sb_APP_getServerLang() == "ESP") {
//		globals.DIALOGS.showInfoDialog('',i18n.getI18NMessage('cvb.lbl.esp.nowordstudies'), "Ok");
//		return false;
//	}
	
//	var vUrl = application.getServerURL()
	//plugins.dialogs.showErrorDialog('', vUrl);

	if (utils.stringLeft(currentcontroller.getName(), 8) == "sb_edit_") {
		return false;
	}

	if (globals.flag == "false") {
		globals.flag = "true";
		globals.wlink(vStrong);
	}
	var arg = '';
	arg = arg.concat(vStrong)
	globals.myWordStudyID = arg
	globals.selectedWordStudy = arg
	var continueCounter = vConcordance
	if (!continueCounter)
	{
		globals.iConcordance = 0
	}
	
	forms.word_study.viewWordStudy(vStrong, vConcordance, vVersion, vAbbr)
	
	// Addition 27-05-2016
	// Detect if reading pane is open.
	if(application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT) {
		if(forms.web_sb_form.elements.tab_notes.visible === true) {
			forms.web_sb_form.elements.tab_notes.visible = false;
		}
	}
	return true;
}

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"21bede14-6d79-4540-afca-aed6dbe84b93",variableType:4}
 */
var sb_demo_chk = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"53c40996-286b-4b9d-834d-1d10d7450e20",variableType:8}
 */
var sb_gCurrentGroupCode;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"7ea51ca4-d508-4cbe-b23f-ee747dbad763",variableType:8}
 */
var sb_gCurrentOrgID;

/**
 * @properties={typeid:35,uuid:"714f7d64-851c-4769-8575-5bb64b2af1f8",variableType:-4}
 */
var sb_gCurrentServerUrl;

/**
 * @properties={typeid:35,uuid:"113b4490-1886-43ed-8f11-3c1c45db42e0",variableType:-4}
 * @type {*}
 */
var sb_gCurrentSession;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"8839d796-dbc8-486b-a5e7-0f0cf7b7110d",variableType:8}
 */
var sb_gCurrentUserID;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"b6e298d6-bcd0-4307-aaa7-0a60c68e3d1b"}
 */
var sb_gCurrentUserUUID = '';

/**
 * @properties={typeid:35,uuid:"17b9f64b-478d-4877-92d3-d95f0d70d962",variableType:-4}
 * @type {Array<String>}
 */
var sb_gDEVServerURLs;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1715c5f9-3a12-4992-a0cf-0bf02a82046b",variableType:8}
 */
var sb_gDialogStatus;

/**
 * @properties={typeid:35,uuid:"229fc09d-cefb-47ff-b624-dd2bc3d832c7",variableType:-4}
 * @type {Array<String>}
 */
var sb_gESServerURLs;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"278a6589-6273-4b0e-90da-9ff40659ff11"}
 */
var sb_gLoginName = '';

/**
 * @properties={typeid:35,uuid:"11a692f2-209b-4ed8-bf8e-250a8bb3866e",variableType:-4}
 * @type {Array<String>}
 */
var sb_gNLServerURLs;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"069ff6b9-0c2c-421b-a3ee-8fca42ce1ac3"}
 */
var sb_gOrganisation = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"d2f37f04-de7c-4ef9-8ecd-06a1df4638ef"}
 */
var sb_gPassword = '';

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"6c07ae4f-e605-4cb6-90dc-c394081b91ef",variableType:93}
 */
var sb_gTempDate01;

/**
 * @type {Date}
 *
 * @properties={typeid:35,uuid:"221b3687-4f9b-4778-9349-4aca1e44641c",variableType:93}
 */
var sb_gTempDate02;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"fed91f34-8ad2-4fcd-8288-a36a7c648b3d"}
 */
var sb_gTempText01 = '';


/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"022f6749-54cc-4a74-9a1e-7a1144ffaa39"}
 */
var sb_UserSearchValue = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"bc372ccb-80b7-4d7c-88c5-016f613f99fb",variableType:8}
 */
var sbMaxUsers;

/**
 * @properties={typeid:24,uuid:"553ac502-16c3-426c-9c76-096824c21755"}
 */
function sb_APP_close() {
	
	application.removeAllClientInfo()
	
	if (globals.sb_gCurrentSession) {
		globals.sb_gCurrentSession.logoff_stamp = application.getServerTimeStamp()
		databaseManager.saveData()
	}

	if(application.getApplicationType() == APPLICATION_TYPES.SMART_CLIENT || application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT) {
		application.exit();
	}
}

/**
 * @properties={typeid:24,uuid:"016ed33d-d60f-4a19-9f5d-5584aea58dc8"}
 */
function sb_APP_logoff() {
	security.logout()
	application.closeSolution('CvB_online')
}

/**
 * @properties={typeid:24,uuid:"13a9d54b-e7ca-4471-a5db-3581c3a838ef"}
 */
function sb_APP_startup() {
	/**************************************************************************************
	 Method: 	globals.sb_APP_startup();

	 Created:	Karel Broer,
	 Modifier:	Karel Broer 02.03.2009 //get external ipaddress from client via http request
	 Modifier:	Karel Broer 03.04.2009 //added remove admin buttons for regular users
	 Modifier:	Karel Broer 21.04.2009 //check if vIP contains ipadress

	 Purpose:	Run startup methods

	 Arguments:	-

	 **************************************************************************************/
	
	application.output(application.getServerURL());
	
	application.putClientProperty(APP_UI_PROPERTY.TABLEVIEW_WC_DEFAULT_SCROLLABLE, true);
	
//	readSettingsFile();
	
//	scopes.tools.output("BrowserSuite versie " + plugins.BrowserSuite.getVersion());
	
	//Register the plugins
	globals.sb_SYS_registerPlugins();
	var vQuestion;
	//Fill the globals with all various server IPS or DNS names
	globals.chkDevFix = 1;
	globals.sb_gNLServerURLs = ["http:\/\/87.249.116.144", "http:\/\/online.studiebijbel.nl"]
	globals.sb_gESServerURLs = ["http:\/\/87.249.116.162"]
	globals.sb_gDEVServerURLs = ["http:\/\/87.249.116.177", "http:\/\/ts.ambitius.com"]
	var vUrl = application.getServerURL()
	var vUrlIndex = utils.stringPosition(vUrl, ":", 6, 1)
	globals.sb_gCurrentServerUrl = utils.stringLeft(vUrl, (vUrlIndex - 1))

/*	if (application.getApplicationType() == 3 || globals.sb_gCurrentServerUrl == "http:\/\/127.0.0.1" || globals.sb_gCurrentServerUrl == "http:\/\/localhost") {
		var vDialog = globals.DIALOGS.showQuestionDialog("Selecteer versie", "Nederlands Versie 1 - Spaans Versie 2 - Ontwikkel Versie 3", "Versie 1", "Versie2", "Versie3")
		if (vDialog == "Versie 1") {
			globals.sb_gNLServerURLs.push("http:\/\/127.0.0.1")
			globals.sb_gNLServerURLs.push("http:\/\/localhost")
			//scopes.tools.output("nederlands")
		} else if (vDialog == "Versie 2") {
			globals.sb_gESServerURLs.push("http:\/\/127.0.0.1")
			globals.sb_gESServerURLs.push("http:\/\/localhost")
			//scopes.tools.output("Spaans")
		} else {
			globals.sb_gDEVServerURLs.push("http:\/\/127.0.0.1")
			globals.sb_gDEVServerURLs.push("http:\/\/localhost")
			//scopes.tools.output("DEV")
		}

	}*/

	//globals.sb_gCurrentServerURL = "http:\/\/217.114.108.59"
	var vIcon = plugins.http.getMediaData('media:///favicon.png')
	plugins.it2be_tools.setSolutionIcon(vIcon)
	plugins.it2be_tools.setSolutionTitle("i18n:CVB.application.title")

	//Remove all menu bars and create custom one after login
	var ClientType = application.getApplicationType()
	var vMenuBar = plugins.window.getMenuBar();
	if (ClientType != APPLICATION_TYPES.SMART_CLIENT) {
		vMenuBar.removeAllMenus();
	} else {
		vMenuBar.reset();
	}
	
	if(globals.sb_gCurrentServerUrl == "http:\/\/ts.ambitius.com:9595")
	{
		vQuestion = plugins.dialogs.showWarningDialog('i18n:CVB.dialog.attention', 'i18n:cvb.message.loginDeveloper', 'i18n:cvb.btn.yes', 'i18n:cvb.btn.no');
		if (vQuestion == i18n.getI18NMessage('cvb.btn.no')) {
			application.exit();
		}
	}
	
	if (globals.sb_APP_getServerLang() == "ESP") {
		i18n.setLocale('es', 'Spain');
		application.updateUI(1)
		globals.sb_search_book_translations = "RVR95";
	} else if (globals.sb_APP_getServerLang() == "NL") {
		i18n.setLocale('nl', 'Nederland');
		application.updateUI(1)
	} else if (plugins.it2be_tools.arrayContains(globals.sb_gDEVServerURLs, globals.sb_gCurrentServerUrl)) {
		//i18n.setLocale('nl', 'Nederland');
		//application.updateUI(1)
		vQuestion = plugins.dialogs.showWarningDialog('i18n:CVB.dialog.attention', 'i18n:cvb.message.loginDeveloper', 'i18n:cvb.btn.yes', 'i18n:cvb.btn.no');
		if (vQuestion == i18n.getI18NMessage('cvb.btn.no')) {
			application.exit();
		}
	} else {
		vQuestion = plugins.dialogs.showWarningDialog('Error', 'Server IP Error. Neem contact op met CvB', 'ok');
		if (vQuestion == 'ok') {
			application.exit();
		}
	}
 
	if(application.getApplicationType() == APPLICATION_TYPES.SMART_CLIENT) {
		i18n.setLocale('nl', 'Nederland');
		application.updateUI(1);
	}
	
	var vIP;
	//get external ipadress from client
//	plugins.http.getPageData(url,[http_clientname], [username])
	if(application.getApplicationType() != APPLICATION_TYPES.WEB_CLIENT)
	{
		// incase that the client NOT IS the webclient query the ambitius website
		vIP = plugins.http.getPageData('http:\/\/www.ambitius.com\/tools\/getip.php?key=ambhash');
	} else {
		// incase the client IS the webclient
		vIP = application.getIPAddress();
	}
	//store CVB files
	globals.sb_FILE_storeCvBFiles();
	scopes.tools.output(vIP);
	if (!vIP) {
		forms.sb_login_frm.controller.show() // go to login form
		return
	}

	//find organisations that have this ip adres
	var vSearchIP = '%' + vIP.toString()
	var vSQL = 'SELECT sb_organisation_id FROM sb_organisation WHERE ipaddress_security_chk = ? AND ipaddress LIKE ?'
	var vDS = databaseManager.getDataSetByQuery('sb_data', vSQL, [1, vSearchIP], 1)
	if (vDS && vDS.getMaxRowIndex() > 0) {
		//go to main form if ipadress is valid
		globals.sb_gCurrentOrgID = vDS.getValue(1, 1)
		application.addClientInfo(vIP)
		if (!globals.sb_SEC_checkMaxUsers(globals.sb_gCurrentOrgID, vIP)) {
			return
		}

		globals.sb_gCurrentUserID = null
		globals.sb_gLoginName = plugins.it2be_tools.client().userName

		globals.sb_REC_createLogRecord();
		globals.sb_gCurrentSession.used_ip_chk = 1
		globals.sb_gCurrentGroupCode = 3
		databaseManager.saveData()

		//globals.sb_MENU_setMenubar()
		globals.sb_FORM_removeElements();
		;

		//Go to MainForm
		if(application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT) {
			forms.web_sb_form.controller.show()
		} else {
			forms.sb_form.controller.show()
		}

		//globals.sb_NAV_goToMainForm();
	} else {
		forms.sb_login_frm.controller.show() // go to login form
	}
}

/**
 * @properties={typeid:24,uuid:"f8876ba6-4f52-40d3-85a2-412b8469133c"}
 * @AllowToRunInFind
 */
function sb_DIALOG_showAdminDialog() {
	var vDialogForm = 'sb_admin_org_frm'

	if (forms.sb_organisation.controller.find()) {
		forms.sb_organisation.sb_organisation_id = globals.sb_gCurrentOrgID
		forms.sb_organisation.controller.search()
	}
	//application.showFormInDialog(forms[vDialogForm], -1, -1, -1, -1, 'i18n:CVB.button.admin', false, false, 'admin', true)
	//SMM 20-05-2011
	var vForm = application.createWindow('admin', JSWindow.MODAL_DIALOG, null);
	vForm.setInitialBounds(-1, -1, -1, -1);
	vForm.title = 'i18n:CVB.button.admin';
	vForm.show(forms[vDialogForm]);

}

/**
 * @properties={typeid:24,uuid:"3c0d5326-e762-4633-ac9d-d9e16905debc"}
 */
function sb_DIALOG_showRootAdminDialog() {
	//var vForm = 'sb_admin_root_frm'
	//application.showFormInDialog(forms[vForm], -1, -1, -1, -1, 'i18n:CVB.button.admin', false, false, 'root', true)
	//SMM 20-05-2011
	var vForm = application.createWindow('root', JSWindow.MODAL_DIALOG, null);
	vForm.title = 'i18n:CVB.button.admin';
	vForm.setInitialBounds(-1, -1, -1, -1)
	vForm.show(forms['sb_admin_root_frm']);
}

/**
 * @properties={typeid:24,uuid:"b2a1bc45-8b72-42f9-8f8a-12b0a58bb26f"}
 */
function sb_DIALOG_showUserInfoDialog() {
	var vDialogForm = 'sb_login_report_new_dlg' //SMM 27-05-2011
		//application.showFormInDialog(forms[vDialogForm], -1, -1, -1, -1, 'i18n:CVB.title.userInfo', true, false, 'user_report', true)
	//SMM 20-05-2011
	var vForm = application.createWindow('user_report', JSWindow.MODAL_DIALOG, null);
	vForm.title = 'i18n:CVB.title.userInfo';
	vForm.setInitialBounds(50, 50, 1000, 500)
	vForm.show(forms[vDialogForm]);
}

/**
 * @properties={typeid:24,uuid:"4e0d9fcf-cde6-4139-a0e8-a4209eb35259"}
 */
function sb_EMAIL_sendLoginSpecs() {
	application.setStatusText('')

	var vLoginName = arguments[0]
	var vPassword = arguments[1]
	var vEmail = arguments[2]
	var vFirstname = arguments[3]
	var vLastname = arguments[4]
	var vOrganisation = arguments[5]
	var vFullName = vFirstname + ' ' + vLastname
	var vFullEmail = vFullName + ' <' + vEmail + '>'
	var vSubject = 'Welkom bij StudyBible Online!'
	var vFrom = 'StudyBible Online <noreply@studiebijbel.nl>'

	var vHTML = '<HTML><BODY>'

	//show progress bar
	forms.sb_contact_dlg.elements.tabs.tabIndex = 2
	//plugins.busy.busy(i18n.getI18NMessage('CVB.dialog.sending_email'),true);
	application.sleep(1000);

	vHTML += 'Beste ' + vFullName + ',<br><br>'
	vHTML += 'Welkom bij StudyBible Online.<br><br>'

	vHTML += 'Hierbij uw StudyBible Online account informatie:<br><br>'

	vHTML += '----------------------------<br>'
	vHTML += 'Inlognaam: ' + vLoginName + '<br>'
	vHTML += 'Wachtwoord: ' + vPassword + '<br>'
	vHTML += 'Organisatie: ' + vOrganisation + '<br>'
	vHTML += '----------------------------<br><br>'

	vHTML += 'Bewaar deze email zorgvuldig a.u.b.<br>'
	vHTML += 'Mocht u problemen ondervinden met inloggen, neem dan contact op met uw StudyBible Online administrator.<br>'
	vHTML += 'Bedankt voor uw inschrijving en veel succes met het gebruik van StudyBible Online!<br><br>'

	vHTML += 'Vriendelijke groeten,<br><br>'

	vHTML += 'Het StudyBible Online Team'
	vHTML += '</BODY></HTML>'

	var vAuthorization = new Array("mail.smtp.host=smtp.gmail.com",
			"mail.smtp.auth=true",
			"mail.smtp.starttls.enable=true",
			"mail.smtp.port=587",
			"mail.smtp.username=studybibleonline@gmail.com",
			"mail.smtp.password=!noxs4you2");

	var vResult = plugins.mail.sendMail(vFullEmail, vFrom, vSubject, vHTML, null, null, null, vAuthorization);
	if (!vResult) {
		forms.sb_contact_dlg.elements.tabs.tabIndex = 1
		plugins.dialogs.showErrorDialog('cvb.message.error', 'i18n:CVB.dialog.error_sending_email', 'i18n:CVB.lbl.ok')
		//plugins.busy.busy(i18n.getI18NMessage('CVB.dialog.error_sending_email'), true)
		//application.sleep(3000);
		return false
	} else {
		forms.sb_contact_dlg.elements.tabs.tabIndex = 1
		plugins.dialogs.showInfoDialog('Info', i18n.getI18NMessage('CVB.dialog.account_data_is_send_by_email', [vFullEmail]), 'i18n:CVB.lbl.ok')
		//plugins.busy.busy(i18n.getI18NMessage('CVB.dialog.account_data_is_send_by_email', [vFullEmail]), true)
		//application.sleep(3000);
		return true
	}

}

/**
 * @properties={typeid:24,uuid:"95c3f746-2232-4635-89ce-ffcfc2684b3a"}
 */
function sb_FILE_storeCvBFiles() {
	/**************************************************************************************
	 Method: 	globals.sb_FILE_storeCvBFiles();

	 Created:	Karel Broer,  13-10-2008
	 Modifier:	Adrian Doroiman, (24-11-2008)
	 Added font install on windows
	 5-12-2008
	 Fixed some bugs in the copy help files script
	 2-19-2009
	 Tried to cover some possible bugs
	 Created:	Karel Broer,  10-12-2008 //added font install on Mac

	 Purpose:	Check if files exist on client cpu, if not, save them to .servoy/CVB folder

	 Arguments:	-

	 **************************************************************************************/
	// Deprecated!
	return true;
}

/**
 * @properties={typeid:24,uuid:"95e36c42-b080-47c3-bb28-68ec85709e06"}
 */
function sb_FORM_removeElements() {
	//do not remove elements if user is root or administrator
	if (globals.sb_gCurrentGroupCode < 3 && application.getApplicationType() == APPLICATION_TYPES.SMART_CLIENT) {
		return false
	}

	var vAllForms = new Array('sb_form', 'study_words', 'book_comment', 'verse_translation', 'word_study');

	var vFormName;
	var vAllFormElements = new Array();
	var vElementName;
	var vx, k;
	for (vx in vAllForms) {
		vFormName = vAllForms[vx]
		if (forms[vFormName]) {
			vAllFormElements = forms[vFormName].elements.allnames
			if (vAllFormElements.length > 0) {

				for (k in vAllFormElements) {
					vElementName = vAllFormElements[k]
					if (utils.stringLeft(vElementName.toLowerCase(), 6) == 'admin_') {
						forms[vFormName].elements[vElementName].visible = false
					}
				}
			}
		}
	}
	return true;
}

/**
 * @properties={typeid:24,uuid:"46587a64-151b-499c-becc-d461a834a5ec"}
 */
function sb_HELP_openHelp() {
	/**************************************************************************************
	 Method: 	globals.sb_HELP_openHelp();

	 Created:	Karel Broer,  13-10-2008
	 Modifier:	name or initials,  date(dd-MM-yyyy) //edit notes

	 Purpose:	Show help

	 Arguments:	-

	 **************************************************************************************/

	var vServoyFolder = '.servoy'
	var vSeparator = plugins.it2be_tools.client().fileSeparator
	var vLocalClientPath = plugins.it2be_tools.client().userHome
	var vServoyFolderPath = vLocalClientPath + vSeparator + vServoyFolder
	var vCVBFolder = vServoyFolderPath + vSeparator + 'CVB'
	var vWinHelpFile = vCVBFolder + vSeparator + 'Studiebijbel_handleiding.chm'
	var vMacHelpFile = vCVBFolder + vSeparator + 'HTML' + vSeparator + 'welcometopic.htm'
	var vFile
	var vName

	if (utils.stringMiddle(application.getOSName(), 1, 7) == "Windows") {
		vFile = plugins.file.convertToJSFile(vWinHelpFile)
		vName = vFile.getAbsolutePath();
		application.executeProgram('rundll32', ['url.dll,FileProtocolHandler', vName])
	} else {
		vFile = plugins.file.convertToJSFile(vMacHelpFile)
		vName = vFile.getAbsolutePath()
		application.executeProgram('open', ['-a', 'safari', vName])
	}
}

/**
 * @properties={typeid:24,uuid:"7dcf6788-1fe2-4b54-b91e-e7ba211623a7"}
 * @param {String} vOption
 */
function sb_MENU_setAdminMenu(vOption) {
	var vMenuBar = plugins.window.getMenuBar();
	var vOptiesIndex = vMenuBar.getMenuIndexByText(i18n.getI18NMessage('CVB.lbl.options'));
	
	var vMenu = vMenuBar.getMenu(vOptiesIndex);
	var vItem = vMenu.addMenuItem();
	
	if(vOption == 'root') {
		// Management Item
		vItem.text = i18n.getI18NMessage('CVB.lbl.management');
		vItem.setMethod(globals.sb_DIALOG_showRootAdminDialog);
		// Show User Info Item
		vItem = vMenu.addMenuItem();
		vItem.text = i18n.getI18NMessage('CVB.title.userInfo');
		vItem.setMethod(globals.sb_DIALOG_showUserInfoDialog);
	} else if (vOption == 'admin') {
		vItem.text = i18n.getI18NMessage('CVB.lbl.management');
		vItem.setMethod(globals.sb_DIALOG_showAdminDialog);
	}
	
	if(vOption == "root" || vOption == "admin") {
		vItem = vMenu.addMenuItem();
		vItem.text = i18n.getI18NMessage("cvbl.bl.subscriptions");
		vItem.setMethod(sb_DIALOG_showSubscriptionsDialog);
		
		vItem = vMenu.addMenuItem();
		vItem.text = "Vouchers";
		vItem.setMethod(sb_DIALOG_showVouchersDialog);
	}
	
	/*
	var vOptiesIndex = plugins.it2be_menubar.getMenuIndexByText(i18n.getI18NMessage('CVB.lbl.options'))
	var vMenu = plugins.it2be_menubar.getMenu(vOptiesIndex)
	var vItem = vMenu.addItem()
	if (vOption == 'root') {
		vItem.set('i18n:CVB.lbl.management', globals.sb_DIALOG_showRootAdminDialog, null, null)
		vItem = vMenu.addItem()
		vItem.set('i18n:CVB.title.userInfo', globals.sb_DIALOG_showUserInfoDialog, null, null)
	}
	if (vOption == 'admin') {
		vItem.set('i18n:CVB.lbl.management', globals.sb_DIALOG_showAdminDialog, null, null)
	}*/
}

/**
 * @properties={typeid:24,uuid:"6D4D1293-41E8-4C59-A41E-D371E5E3E311"}
 */
function sb_DIALOG_showSubscriptionsDialog() {
	var vWindow = application.createWindow("sb_subscription_root_frm", JSWindow.MODAL_DIALOG);
	vWindow.title = i18n.getI18NMessage("cvbl.bl.subscriptions");
	vWindow.setInitialBounds(-1, -1, -1, -1);
	vWindow.show(forms.sb_subscription_root_frm);
}

/**
 * @properties={typeid:24,uuid:"F7A256A2-9097-47F6-A289-517582973B09"}
 */
function sb_DIALOG_showVouchersDialog() {
	var vWindow = application.createWindow("sb_subscription_voucher_root_frm", JSWindow.MODAL_DIALOG);
	vWindow.title = i18n.getI18NMessage("Vouchers");
	vWindow.setInitialBounds(-1, -1, -1, -1);
	vWindow.show(forms.sb_subscription_voucher_root_frm);
}

/**
 * @properties={typeid:24,uuid:"1a9d48f7-3826-4384-a98c-9386633f3956"}
 */
function sb_MENU_setMenubar() {
	//Get the application type
	var vClientType = application.getApplicationType()
	//type 1 = SERVER
	//type 2 = CLIENT
	//type 3 = DEVELOPER
	//type 4 = HEADLESS_CLIENT
	//type 5 = WEB_CLIENT
	//type 6 = RUNTIME

	//Developer FIX
	if (globals.customMenuDone != 1 && vClientType != 3) {
		//Migratie: Aangepast zodat de menu bar weer gaat werken in servoy 5 / 6
		//Remove all servoy menu's
		plugins.window.getMenuBar().removeAllMenus()
		//plugins.it2be_menubar.removeAllMenus()
		//File menu
		//var menu_file = plugins.it2be_menubar.addMenu()
		var menu_file = plugins.window.getMenuBar().addMenu()
		menu_file.text = 'i18n:cvb.lbl.file'
		menu_file.addMenuItem('i18n:CVB.lbl.quit', globals.quit)

		//Edit menu
		//get the MenubarMenu object from the MenubarMenuBar
		//var menu = plugins.it2be_menubar.addMenu();
		var menu = plugins.window.getMenuBar().addMenu()
		//set the MenubarMenu object
		//menu.set("i18n:servoy.menuitem.edit");
		menu.text = "i18n:servoy.menuitem.edit"
		//get the MenubarMenuItem object from the (Sub-)menu
		//var item = menu.addItem();
		menu.addMenuItem("i18n:cvb.menu.howtocopy")
		//set the MenubarMenuItem object
		//item.set("i18n:cvb.menu.howtocopy", null);
		//get the MenubarMenuItem object from the (Sub-)menu
		//item = menu.addItem();
		//set the MenubarMenuItem object
		//item.set("i18n:cvb.menu.howtoselect", null);
		menu.addMenuItem("i18n:cvb.menu.howtoselect")

		if (globals.sb_gCurrentGroupCode == 1) {
			//Options menu
			//get the MenubarMenu object from the MenubarMenuBar
			//var menu = plugins.it2be_menubar.addMenu();
			//set the MenubarMenu object
			//menu.set("i18n:CVB.lbl.options");

			var vMenu2 = plugins.window.getMenuBar().addMenu()
			vMenu2.text = "i18n:CVB.lbl.options"
		}
		//Help menu
		//get the MenubarMenu object from the MenubarMenuBar
		//var menu = plugins.it2be_menubar.addMenu();
		var menu3 = plugins.window.getMenuBar().addMenu()
		menu3.text = "i18n:CVB.lbl.help"
		//set the MenubarMenu object
		//menu.set("i18n:CVB.lbl.help");


		menu3.addMenuItem("i18n:CVB.lbl.help", forms.sb_form.openHelp)

		//var item = menu.addItem();
		//set the MenubarMenuItem object
		//item.set("i18n:CVB.lbl.help",forms.sb_form.openHelp);
		//	}
		//get the MenubarMenuItem object from the (Sub-)menu
		//var item = menu.addItem();
		//set the MenubarMenuItem object
		//item.set("i18n:servoy.menuitem.about",globals.openAbout);
		menu3.addMenuItem("i18n:servoy.menuitem.about", globals.openAbout)

		//Set some more menu options for client
		plugins.excelxport.exportEnabled = false
		plugins.excelxport.importEnabled = false
		plugins.textxport.exportEnabled = false
		plugins.textxport.importEnabled = false

		//remove toolbars
		application.setToolbarVisible('edit', false)
		application.setToolbarVisible('align', false)
		application.setToolbarVisible('design', false)
		application.setToolbarVisible('draw', false)
		application.setToolbarVisible('text', false)
		application.setToolbarVisible('distribute', false)

		globals.customMenuDone = 1
	}
	return true;
}

/**
 * @properties={typeid:24,uuid:"f35dfe1f-c494-4149-acfc-83220f26631f"}
 */
function sb_NAV_goToAdmin() { }

/**
 * @properties={typeid:24,uuid:"d0a1e54f-14d3-49dd-ae6e-2257efaf364b"}
 */
function sb_NAV_goToMainForm() {
	if (forms.sb_form) {
		globals.init();
	}
}

/**
 * @properties={typeid:24,uuid:"0991813e-606b-46f4-a77b-9b6ed30b5d9c"}
 */
function sb_REC_createLogRecord() {
	globals.sb_gCurrentSession = forms.sb_login_frm.foundset.getRecord(forms.sb_login_frm.foundset.newRecord())

	globals.sb_gCurrentSession.sb_organisation_id = globals.sb_gCurrentOrgID;
	globals.sb_gCurrentSession.sb_contact_id = globals.sb_gCurrentUserID;
	globals.sb_gCurrentSession.creationdate = application.getServerTimeStamp();
	globals.sb_gCurrentSession.creator = globals.sb_gLoginName;
	globals.sb_gCurrentSession.current_user_amount = application.getActiveClientCount(false);
	globals.sb_gCurrentSession.ip_address = plugins.it2be_tools.client().IP;
	globals.sb_gCurrentSession.java_version = plugins.it2be_tools.client().javaVersion;
	globals.sb_gCurrentSession.os_name = plugins.it2be_tools.client().osName;
	globals.sb_gCurrentSession.os_version = plugins.it2be_tools.client().osVersion;
	
	if(application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT){
		globals.sb_gCurrentSession.browser_agent =  Packages.org.apache.wicket.RequestCycle.get().getClientInfo().getUserAgent()+"";
	}
	
	
//	globals.sb_gCurrentSession.ext_ip_address = plugins.http.getPageData('http:\/\/www.ambitius.com\/tools\/getip.php?key=ambhash')
	databaseManager.saveData()
	return true;
}

/**
 * @properties={typeid:24,uuid:"1fbda561-28cf-4a0b-b0d0-b783bc57e21f"}
 * @param {JSEvent} event
 */
function sb_REC_deleteRecord(event) {
//	globals.test();
	var vAnsw = plugins.dialogs.showQuestionDialog('i18n:cvb.message.deleteRecord','i18n:cvb.message.deleteRecord','i18n:cvb.btn.yes','i18n:cvb.btn.no' )
	if (vAnsw != i18n.getI18NMessage('i18n:cvb.btn.yes')) {
		return false
	}

	databaseManager.recalculate(forms.sb_organisation_detail_frm.foundset)

	var vForm = event.getFormName();
	var vIndex = forms[vForm].foundset.getSelectedIndex()
	forms[vForm].foundset.deleteRecord(vIndex)
	return true
}

/**
 * @properties={typeid:24,uuid:"3e7518e0-0dcf-43fa-b4cb-ac555eb587db"}
 */
function sb_REC_newOrganisation() {
	/** @type JSRecord<db:/sb_data/sb_organisation> */
	var vRecord = forms.sb_organisation_tbl.foundset.getRecord(forms.sb_organisation_tbl.foundset.newRecord(false, false))
	databaseManager.saveData(vRecord)
	forms.sb_organisation_tbl.foundset.setSelectedIndex(forms.sb_organisation_tbl.foundset.getSize())

	forms.sb_admin_root_frm.elements.organisation_name.requestFocus()
}

/**
 * @properties={typeid:24,uuid:"0ed1530e-9039-448e-b5ea-95b6125b9d84"}
 * @param {Number} vOrganisationID
 * @param {String} [vIPAddress]
 */
function sb_SEC_checkMaxUsers(vOrganisationID, vIPAddress) {
//	var vOrganisationID = arguments[0]
//	var vIPAddress = arguments[1]
	var vCount

	var vSQL = 'SELECT license_amount FROM sb_organisation WHERE sb_organisation_id = ?'
	var vDS = databaseManager.getDataSetByQuery('sb_data', vSQL, [vOrganisationID], 1)
	var vLicenseAmount = vDS.getValue(1, 1)
	
	if (vIPAddress) {
		vCount = application.getClientCountForInfo(vIPAddress)
	} else {
		vCount = application.getClientCountForInfo(vOrganisationID.toString())
	}

	if(globals.sb_gCurrentGroupCode == 1 || globals.sb_gCurrentGroupCode == 2) {
		return true;
	}
	
	if (vCount > vLicenseAmount) {
		globals.DIALOGS.showWarningDialog('i18n:cvb.message.warning', i18n.getI18NMessage('cvb.message.license'), 'i18n:CVB.lbl.ok')
		return false
	} else {
		return true
	}
}

/**
 * @properties={typeid:24,uuid:"9ecfd909-cc60-4e80-a033-b841d10d6e32"}
 */
function sb_SEC_createSysUsers() {
	//globals.sb_SEC_createSysUsers()

	var vUsersDS = security.getUsers()
	/** @type{String} */
	var vCurrentUsers = null

	if (vUsersDS.getMaxRowIndex() > 0) {
		vCurrentUsers = vUsersDS.getColumnAsArray(2)
		vCurrentUsers = vCurrentUsers.join(',')
	}

	var vCount = 0

	var vSQL = 'SELECT c.sb_organisation_id, c.login_name,  c.login_pw, c.sb_user_uuid, g.group_name FROM sb_contact c, sb_group g \
			WHERE c.sb_group_code = g.group_code'
	var vDS = databaseManager.getDataSetByQuery('sb_data', vSQL, null, -1)
	var vUserName
	var vPassword
	var vUUID
	var vGroupName
	var vGroupsDS = security.getGroups()
	/** @type{String} */
	var vCurrentGroups = null;
	if (vGroupsDS.getMaxRowIndex() > 0) {
		vCurrentGroups = vGroupsDS.getColumnAsArray(2)
		vCurrentGroups = vCurrentGroups.join(',')
	}

	if (vDS.getMaxRowIndex() > 0) {
		for (var i = 1; i <= vDS.getMaxRowIndex(); i++) {
			vUserName = vDS.getValue(i, 1) + '_' + vDS.getValue(i, 2)
			vPassword = vDS.getValue(i, 3)
			vUUID = vDS.getValue(i, 4)
			vGroupName = vDS.getValue(i, 5)

			if (utils.stringPatternCount(vCurrentGroups, vGroupName) < 1) {
				security.createGroup(vGroupName)
			}

			if (utils.stringPatternCount(vCurrentUsers, vUserName) < 1) {
				//create user in application server
				security.createUser(vUserName, vPassword, vUUID)
				security.addUserToGroup(vUUID, vGroupName)
				vCount++
			}
		}

	}

	plugins.dialogs.showInfoDialog('i18n:CVB.dialog.info', vCount + ' i18n:cvb.message.usersCreated', 'i18n:CVB.lbl.ok')
}

/**
 * @properties={typeid:24,uuid:"2d133bcf-1be3-492d-8c29-e6598e21ad7b"}
 */
function sb_SEC_dataFilter() {
	if (globals.sb_gCurrentGroupCode == 1) {
		return true;
	}

	if (!globals.sb_gCurrentOrgID) {
		return true;
	}

	var vServer = 'sb';
	var vTables = new Array('sb_contact', 'sb_organisation')
	var vResult = false
	var vTabelName
	for (var i in vTables) {
		vTabelName = vTables[i]
		vResult = databaseManager.addTableFilterParam(vServer, vTabelName, 'sb_organisation_id', '=', globals.sb_gCurrentOrgID)
	}

	return vResult
}

/**
 * @properties={typeid:24,uuid:"11b126fd-c3fa-442a-9dac-4f54efb3b683"}
 */
function sb_SEC_login() {
	/**************************************************************************************
	 Method: 	globals.sb_SEC_login();

	 Created:	Karel Broer,  13-10-2008
	 Modifier:	Karel Broer,  17-02-2009 //added functionality to let user login only once
	 Modifier:	Karel Broer,  26-03-2009 //added servoy security for users
	 Modifier:	Karel Broer,  03-04-2009 //added remove admin buttons for regular users
	 Modifier:	Rick Bonkestoter, 07-07-2009 // just some enhancements

	 Purpose:	1. Check user login specs
	 2. Set specific menu's
	 3. Got to main form

	 Arguments:	-

	 //TODO: get client active working with userManager plugin
	 **************************************************************************************/
	//Fix so the ctrl-L funct in dev doesn't give a error
	
	globals.sb_gDEVFix();

//	var vLanguage = plugins.UserManager.Client().language;
	/// OTHER

	//var vServer = forms.sb_login_frm.controller.getServerName()
	var vFormName = (application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT)?"web_sb_login_sub_frm":"sb_login_frm";

	globals.sb_gLoginName = forms[vFormName].v_username;
	globals.sb_gPassword = (forms[vFormName].v_password);
//	globals.sb_gOrganisation = forms[vFormName].v_organisation;
	
	application.sleep(100);

	if(!globals.sb_gLoginName || !globals.sb_gPassword)
	{
		globals.DIALOGS.showErrorDialog("Error",i18n.getI18NMessage('cvb.lbl.mandatoryfields'), "Ok");
		return false;
	}
	
//	var vOrganisation = globals.sb_gOrganisation

	/*var vSQL = "SELECT c.sb_contact_id, c.sb_organisation_id, c.sb_group_code, c.sb_user_uuid, g.group_name, c.demo_user_chk, c.name_first, \
			FROM sb_contact c \
			LEFT JOIN sb_group g ON c.sb_group_code = g.group_code \
			WHERE lower(c.login_name) = ? \
			AND (c.login_pw) = ? \
			AND lower(c.organisation_name) = ? \
			AND (c.sb_end_date IS NULL OR c.sb_end_date > NOW())	"
	var vDS = databaseManager.getDataSetByQuery('sb_data', vSQL, [globals.sb_gLoginName.toLowerCase(), globals.sb_gPassword, vOrganisation.toLowerCase()], 1)*/
	var SB = new scopes.StudyBible.StudieBijbel();
	
	var vDS = SB.Login(globals.sb_gLoginName, globals.sb_gPassword);
	
	if (vDS && vDS.getMaxRowIndex() == 1) {

		globals.sb_gCurrentUserID = vDS.getValue(1, 1);
		globals.sb_gCurrentOrgID = vDS.getValue(1, 2);
		globals.sb_gCurrentGroupCode = vDS.getValue(1, 3);
		globals.sb_gCurrentUserUUID = vDS.getValue(1, 4);
		globals.sb_gCurrentUserName = vDS.getValue(1, 7);
		var vGroupName = vDS.getValue(1, 5);

		// For demo users
		var vDemo = vDS.getValue(1, 6);
		//	databaseManager.saveData()

		if (vDemo) {
			globals.sb_demo_chk = 1
			databaseManager.addTableFilterParam('sb', 'books', 'demo_chk', '=', 1);
			databaseManager.addTableFilterParam('sb', 'chapters', 'demo_chk', '=', 1);
			databaseManager.addTableFilterParam('sb', 'verses', 'demo_chk', '=', 1);
			databaseManager.addTableFilterParam('sb', 'verse_translations', 'demo_chk', '=', 1);
		} else {
			globals.sb_demo_chk = 0;
		}

		globals.show_books = 1;

		var vHasContinues = false;

		
		// Check if there are any ACTIVE subscriptions with sb_trail or sb_abonnement
		var vToday = new Date();
		vToday.setHours(0, 0, 0);
		var vMax = 0; var vExpiredOn = null;
		var vSubscriptions = SB.GetUserSubscriptions(globals.sb_gCurrentUserID);
		for(var vSub in vSubscriptions) {
			if(vSubscriptions[vSub]['active'] == 1 && (vSubscriptions[vSub]['token'] == 'sb_prepaid' || vSubscriptions[vSub]['token'] == 'sb_trail' || vSubscriptions[vSub]['token'] == 'sb_abonnement'))
			{
				if(vSubscriptions[vSub]['token'] == 'sb_abonnement') {
					vHasContinues = true;
				}
				//application.output("Token found! Valid till " +vSubscriptions[vSub].validTill);
				var vDate = vSubscriptions[vSub].validTill + "";
				vDate = vDate.split('-');
				vDate = new Date(parseInt(vDate[0], 10), parseInt(vDate[1], 10)-1, parseInt(vDate[2], 10));
				vDate.setHours(23,59,59);
				if(vDate >= vToday) {
					vMax = (vSubscriptions[vSub]['amount']>vMax)?vSubscriptions[vSub]['amount']:vMax;
				} else {
					if(vMax <= 0) {
						/* Verlopen :'( */
						if(vExpiredOn == null || vDate >= vExpiredOn) {
							vExpiredOn = vDate;
						}
					}
				}
			}
		}
		
		// When vMax still is 0 there no active licenses for the user
		if(vMax == 0)
		{
			if(globals.sb_gCurrentGroupCode != 1 && globals.sb_gCurrentGroupCode != 2) {
				var vMessage;
				if(vExpiredOn) {
					// License expired on a date!
					vMessage = i18n.getI18NMessage("cvb.license.expired_on", [utils.dateFormat(vExpiredOn, "dd-MM-yyyy")]);
				} else {
					// Just no valid license!
					vMessage = i18n.getI18NMessage("cvb.license.no_valid");
				}
				// We better can stop the further checks, user had no valid subscription!
				globals.DIALOGS.showWarningDialog("Info",vMessage, "OK");
				return false;
			}
		}
		

		if (!globals.sb_SEC_singleUserCheck(vMax)) {
			return false;
		}
		
		if (!globals.sb_SEC_checkMaxUsers(globals.sb_gCurrentOrgID)) {
			return false;
		}

//		forms.sb_login_progress_frm.controller.show()
//		application.updateUI(5)
		globals.sb_REC_createLogRecord();

		application.setUserProperty('cvb_username', globals.sb_gLoginName)
		application.setUserProperty('cvb_organisation', globals.sb_gOrganisation)

		application.addClientInfo(globals.sb_gCurrentOrgID.toString())
		application.addClientInfo(globals.sb_gLoginName.toLowerCase())
		application.addClientInfo(globals.sb_gOrganisation)
		
		if(application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT) {
			var useragent = Packages.org.apache.wicket.RequestCycle.get().getClientInfo().getUserAgent();
			application.addClientInfo(useragent);
		}
		
		// Only set this additional type if its an webclient, smartclients are allowed
		if(application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT)
			plugins.UserManager.Client().additionalInfo = [globals.sb_gLoginName.toLowerCase()];

	//	security.login(globals.sb_gLoginName, globals.sb_gCurrentUserUUID, [vGroupName])

		//Create the custom menu
		globals.sb_MENU_setMenubar();

		switch (globals.sb_gCurrentGroupCode) {

		//root user, load root admin menu
		case 1:
			globals.sb_MENU_setAdminMenu('root');
			globals.show_books = 0;
			break;

		//admin user, load admin menu
		case 2:
			globals.sb_MENU_setAdminMenu('admin');
			globals.show_books = 0;
			break;
		}

		globals.sb_FORM_removeElements();
		//Go to the mainForm
		if(application.getApplicationType() == APPLICATION_TYPES.SMART_CLIENT) {
			forms.sb_form.controller.show()
		} else {
			// Check some stuff before continuing!
			if(vHasContinues) {
				/** @type {JSFoundSet<db:/sb_data/sb_contact>} */
				var vFS = databaseManager.getFoundSet("sb_data", "sb_contact");
				vFS.loadRecords("SELECT sb_contact_id FROM sb_contact WHERE sb_contact_id = ?", [globals.sb_gCurrentUserID]);
				
				if(vFS.getSize() == 1){
					/** @type {JSRecord<db:/sb_data/sb_contact>} */
					var vRecord = vFS.getRecord(1);
					if(!vRecord.login_pw_old || vRecord.login_name == "rick@directict.nl"){
						// Yeey we have the record!
						if(utils.hasRecords(vRecord.sb_contact_to_sb_contact_payment)) {
							if((vRecord.sb_contact_to_sb_contact_payment.cardholder == "" && vRecord.sb_contact_to_sb_contact_payment.iban == "") || (!vRecord.sb_contact_to_sb_contact_payment.cardholder && !vRecord.sb_contact_to_sb_contact_payment.iban)) {
								// Go to other something!
								forms.web_sb_login_frm.EVENT_changeTab("iban");
								return false;
							}
						} else {
							// Go to other something!
							forms.web_sb_login_frm.EVENT_changeTab("iban");
							return false
						}
					}
				}
				
			}
			forms.web_sb_form.controller.show();
		}

	} else {
		var vMessage 	= i18n.getI18NMessage('CVB.dialog.message.wrong_login');
		var vAttention 	= i18n.getI18NMessage('CVB.dialog.attention');
		var vOk			= i18n.getI18NMessage('CVB.lbl.ok');
		
		globals.DIALOGS.showInfoDialog(vAttention,vMessage,vOk);
	}
	return true;
}

/**
 * @param {Number} [vMax]
 * @properties={typeid:24,uuid:"6bc25ec8-c86d-4041-a8cd-cb490f6684a1"}
 */
function sb_SEC_singleUserCheck(vMax) {
	// Return TRUE for the time beeing
	// See Servoy ISSUE https://support.servoy.com/browse/SVY-1007
	var a =0;
	// Administrators and CVB Administrators should ALWAYS be able to login multiple times!
	if(globals.sb_gCurrentGroupCode == 1 || globals.sb_gCurrentGroupCode == 2) {
		return true;
	}
	
	//  Fixed on 24-04-2014!!
	plugins.UserManager.updateClientInfo()
	var vConnectecUsers = plugins.UserManager.getWebClients();
	var vClient;
	var vCurrent = 0;
	for(var i in vConnectecUsers) {
		vClient = vConnectecUsers[i];
		if(vClient.additionalInfo) {
			if(vClient.additionalInfo[0] == globals.sb_gLoginName && globals.sb_gLoginName != globals.sb_gLogoutName) {
				vCurrent++;
				/*// Dit geld alleen als de andere client een webclient is EN de nieuwe client ook een webclient is.
				if(vClient.applicationType == 'Webclient' && application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT) {
					// vragen of de persoon mag worden uitgelogd!
					
					
					var vQuestion = globals.DIALOGS.showQuestionDialog(i18n.getI18NMessage('cvb.title.question'), i18n.getI18NMessage('cvb.message.already_loggedin'),i18n.getI18NMessage('cvb.lbl.continue'), i18n.getI18NMessage('cvb.btn.cancel'));
					if(vQuestion == i18n.getI18NMessage('cvb.lbl.continue')) 
					{
						vClient.shutdown();
					} else {
						//application.exit();
						return false
					}
				}*/
			}
		}
	}

	if(vCurrent >= vMax) {
		// Oh-oh we hebben een issue!
		// Te veel clients op dit adres ingelogd!
		
		// Omdat er teveel licenties in gebruik is moeten we vragen of ze er 1 willen uitloggen!
		var vQuestion = i18n.getI18NMessage("cvb.message.license_new", [vMax])
		var vQ = globals.DIALOGS.showQuestionDialog('i18n:cvb.message.warning', vQuestion, 'i18n:cvb.btn.yes', 'i18n:cvb.btn.no')
		
		if(vQ == i18n.getI18NMessage("cvb.btn.yes")) {
			for(var i in vConnectecUsers) {
				vClient = vConnectecUsers[i];
				if(vClient.additionalInfo) {
					if(vClient.additionalInfo[0] == globals.sb_gLoginName && globals.sb_gLoginName != globals.sb_gLogoutName) {
						vCurrent++;
						// Dit geld alleen als de andere client een webclient is EN de nieuwe client ook een webclient is.
						if(vClient.applicationType == 'Webclient' && application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT) {
							// vragen of de persoon mag worden uitgelogd!
							vClient.shutdown();
							globals.sb_gLogoutName = globals.sb_gLoginName;
							return true;
						}
					}
				}
			}
		}
		return false;
	}
	
	return true;
}

/**
 * @properties={typeid:24,uuid:"d7a4a24d-c5de-4212-9111-b9c32e6fb229"}
 * @AllowToRunInFind
 */
function sb_SYS_recalcTable() {
	var vForm = arguments[0]
	forms[vForm].controller.loadAllRecords()
	databaseManager.recalculate(forms[vForm].foundset)
	plugins.dialogs.showInfoDialog('i18n:CVB.dialog.info', 'i18n:cvb.message.recalcSuccess', 'i18n:CVB.lbl.ok')
}

/**
 * @properties={typeid:24,uuid:"195cd0c7-9f0c-4693-80ae-f4ca34842fcb"}
 */
function sb_SYS_registerPlugins() {
	/**************************************************************************************
	 Method: 	globals.sb_SYS_registerPlugins();

	 Created:	Karel Broer 09-03-2009
	 Modifier:	Karel Broer 01-04-2009 //added UserManager plugin license

	 Purpose:	Register third party plugins

	 Arguments:	-

	 **************************************************************************************/
	/*
	 //tablebean
	 if(plugins.drmaison){
	 plugins.drmaison.registerTableBean('Centrum voor Bijbelonderzoek', '2PoO4dMvDAu/252MtmQhu1LbtPBHeTSu978TmXglBVk11yMeTbDAF49C7rlAIx9d')
	 }

	 //userManager
	 if(plugins.UserManager){
	 plugins.UserManager.register('Centrum voor Bijbelonderzoek', 'q9SA5eCyb08ffrWuArsAQUsg+jE4mrWCgLOU5keUg5p0JBEAMFKds3lZs0AlQZoUH8JLUwgE3G9GAGD1P2o1oQ==')
	 }*/

	if (plugins.it2be_tools) {
//		plugins.it2be_tools.register("jc7cuph3hfmi2afhk9r03a0b961rb61veod9g2vvvs02bgrc9nkm9e9u4rr209vip8g88mc631c238c7m1pohqo7b0fthd0jmivq96rvqd6k368em6iqgi956vfsctfj6bubogb415mo3s5ihbg5lltf9abhivp09u2um4jqtvk4btkdj39sjbenrnke5grd6dpf47ott2fq9uqeo9d5r2jk0drmj4giftkjccani2pbiv4v9tb2ojn4cm51mmoogstm6f955gpkbdqi9a71232l9l6re9fops6sb0151aep8krp2k6sb8sfrfn0rl55atkkq7m7raq8af0npm59ct5rsv96jtvett1bha4g4gsc9gi2n1eai8jmm7l2bcnle4rj1vik8065flh3fdn42rh9i3ugqeh2c4ht8s5bm3de586hm8u3sgupctbcuuu9jv1t0sp8d0k3g8lrk50shkldk03ctef1viabmv3thbhbalt784d7r773doilhprtfp2mb7b6u5g8pi5v5svo18kl44k0vjddt386v6mq2c6f42j8ajpftk4s8rpkiigam0asimst8emb9cf6q0kdhmn1v173mlcbklg59sr6k1p510geq796lgc5m4ubjlv116hua48nbkj3jk2et0roged9ia75jeab7fts1chnspvip64pq3kqbc4hn2kotv3sku1kqf1ijksl0c94uree7e8sana96nbo0483vq5ci4s7d3qbqfbnt88o8mvif5k169clggru5legbrkbucbiva09dukj6kbcc7l4rtmuqv44bm1qv6d");
	}

	//userManager
	if (plugins.UserManager) {
		//UserManager unlimited users pro update
		plugins.UserManager.register('STB Automatisering & Advies bv', 'q9SA5eCyb085cvATVO8s9vUixCNi/VnowK2A6LL0KRavwlmhkv24YM3R/syVum4q5tBKt0aq7WxKr7s22QDjIA==')
		//plugins.UserManager.register('Rutger Slager', 'q9SA5eCyb08ffrWuArsAQXoy+8L1fb7BREATK5HM332Ko5NwIWOMJFwIPgETWKfD')
	}
}

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"b66562b0-9b3c-4ce9-8513-e6a6eb3dda17",variableType:4}
 */
var commentary_id = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3ffad9b7-e079-4c6d-8ad1-44e940df6665",variableType:8}
 */
var sb_edit_book_1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"801b70f6-bd7c-428a-a438-abdf1f9f81a1",variableType:8}
 */
var sb_edit_book_2;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"720688b2-8691-4f2b-b309-82d604ef9572",variableType:4}
 */
var sb_edit_EditCommentaryBlocksVisible = 0;

/**
 * @properties={typeid:24,uuid:"1a24c4ae-428c-4b52-b4b7-5bf40e072d4f"}
 */
function StartProcessor() { }

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"556d5ab7-aa90-4cd2-ad52-655132e16684"}
 */
var sb_edit_htmlTextCommentary = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"17c83fa3-57b9-4990-ac9f-5d3dea1874cc"}
 */
var sb_edit_htmlTextFootnote = '';

/**
 * @properties={typeid:24,uuid:"d9808e7d-42e6-4fe7-8b8a-320d6a570390"}
 * @param {String} html
 */
function ConvertHtmlToText(html) {

	//Test for null values
	if (!html)
		return html

	//forms.commentary_blocks.controller.setSelectedIndex(516)
	//html = forms.commentary_blocks.htmltext

	//Need to change the special characters
	html = globals.sb_edit_HtmlToTextChangeToSpecialChars(html);

	//Remove tlink, flink and wlink
	html = globals.sb_edit_HtmlToTextRemoveLinks(html);

	//Change <sup> to <su>; must be done after flink removing
	html = globals.sb_edit_HtmlToTextChangeSuperToSu(html);

	//Remove hebrew font
	html = globals.sb_edit_HtmlToTextChangeHebrewWords(html);

	//Remove greek font - Perhaps no necessary?
	//Remove hebrew words (<or> tags) - no occurences in the database so far

	// Some new shit
	var regexp = /<a href=[^>]+>([^<]+)<\/a>/gi;

	html = html.replace(regexp, '$1')

	html = utils.stringReplace(html, '<BR>', '\n')

	return html
}

/**¬ß
 * @param {String} vtext
 * @param {String} [bookAbbr]
 * @param {Number} [vChapter]
 * @properties={typeid:24,uuid:"2daa5f2e-ef95-4b62-8357-151ae62d1bfa"}
 */
function ConvertTextToHtml(vtext, bookAbbr, vChapter) {
	//var vtext = arguments[0]
	//var bookAbbr = arguments[1]
	//var chapter = arguments[2]

	//Test for null
	if (!vtext)
		return vtext

		
	// Quick & Dirty but works
	vtext = vtext.replace("Jo&euml;l","Jo√´l");

	//Need to change the special characters
	vtext = globals.sb_edit_TextToHtmlChangeSpecialCharsToHtml(vtext);
	//Add flink
	vtext = globals.sb_edit_TextToHtmlFillFlink(vtext);
	//Add wlink, with greek words
	vtext = globals.sb_edit_TextToHtmlFillWlink(vtext);
	//Add tlink
	vtext = globals.sb_edit_TextToHtmlFillTlink(vtext, bookAbbr, vChapter);
	//Change <su> to <sup>
	vtext = globals.sb_edit_TextToHtmlChangeSuToSuper(vtext);
	//Fill hebrew font
	vtext = globals.sb_edit_TextToHtmlChangeHebrewWords(vtext);
	//Fill hebrew words (<or> tags) - no occurences in the database so far

	// Lets change the short title of the article to a linkje
	var vSQL = "SELECT article_small_title, pk FROM articles WHERE article_small_title IS NOT NULL";
	var vQuery = databaseManager.getDataSetByQuery('sb', vSQL, null, -1);
	
	vtext = GetRealChar(vtext);
	/*var vCharsFrom = ['&euml;', '&ouml;', '&auml;'];
	var vCharsTo = ["√´", "√∂", "√§"];
	
	for(var i = 0; i <= vCharsFrom.length; i ++) {
		vtext = utils.stringReplace(vtext, vCharsFrom[i], vCharsTo[i]);
	}*/
	
	for (var i = 1; i <= vQuery.getMaxRowIndex(); i++) {
		var _r = vQuery[(i)-1]['article_small_title'];
			
		vtext = utils.stringReplace(vtext, vQuery.getValue(i, 1), '<a href="javascript:forms.viewArticle.openArticle(' + vQuery.getValue(i, 2) + ')">' + vQuery.getValue(i, 1) + '</a>')
	}

	
	return vtext
}

/**
 * @param {String} vText
 * @properties={typeid:24,uuid:"80313cd3-c965-485b-9aba-6017ad02d87c"}
 */
function sb_edit_HtmlToTextChangeFlink(vText) {

	var regexp = /<f><sup><b><a href="javascript:globals.flink\('([\d]+)'\)">([\d]+)<\/a><\/b><\/sup><\/f>/gi;

	var vTemp = vText.replace(regexp, '<f>$1</f>')

	return vTemp;

}

/**
 * @param {String} vtext
 * @properties={typeid:24,uuid:"25e575e5-1cb0-426a-a0b5-6dd54e1b9a5b"}
 */
function sb_edit_HtmlToTextChangeHebrewWords(vtext) {
	var regExp = /<tra><font[^>]+>([^<]+)<\/font><\/tra>/i
	var arr = vtext.match(regExp)
	var heb

	while (arr != null && arr.length > 0) {
		/** @type {String} */
		var original = arr[1]
		var vx = new Array();
		for (var i = 0; i < original.length; i++)
			vx[i] = original.charCodeAt(i)
		original =(vx)
		

		heb = "<tr>" + original + "</tr>"
		vtext = vtext.replace(regExp, heb)
		arr = vtext.match(regExp)
	}

	return vtext
}

/**
 * @param {String} vTemp
 * @properties={typeid:24,uuid:"35467cd5-34dd-40a1-b4c0-a5d399bc81bb"}
 */
function sb_edit_HtmlToTextChangeSuperToSu(vTemp) {

	vTemp = vTemp.replace("<sup>", "<su>");
	vTemp = vTemp.replace("</sup>", "</su>");

	return vTemp
}

/**
 * @properties={typeid:24,uuid:"d0e031ca-a5b5-422c-82f1-54125c766289"}
 * @param {String} vText
 */
function sb_edit_HtmlToTextChangeTlink(vText) {

	var regexp = /<a href="javascript:globals.tlink[^>]+>([^<]+)<\/a>/gi;

	var vTemp = vText.replace(regexp, '$1')

	return vTemp;

}

/**
 * @param {String} vText
 * @properties={typeid:24,uuid:"ea40f56e-92de-46c4-b1ec-4b94fb548606"}
 */
function sb_edit_HtmlToTextChangeToSpecialChars(vText) {
	if (!vText) {
		return vText;
	}

	var specialCharsArray = globals.sb_edit_HtmlToTextGetSpecialCharsArray();
	var from = specialCharsArray[0]
	var to = specialCharsArray[1]

	var aux
	do {
		aux = vText
		for (var i in from)
			vText = vText.replace(new RegExp(from[i], "g"), to[i]);

	} while (vText != aux)

	return vText
}

/**
 * @properties={typeid:24,uuid:"3b49016b-e679-4582-94e3-5c0709cfc56d"}
 * @type {String} vtext
 */
function sb_edit_HtmlToTextChangeWlink(vtext) {

		// text = "De Griekse uitdrukking <a href=\"javascript:wlink('2862')\"><I>meta-noein</I></a>"

	//Change also the global method call, because that's the way it should be
	var regexp = /<a href="javascript:wlink\('([\d]+)'\)"><I>([^<]+)<\/I><\/a>/gi;
	var regexp2 = /<a href="javascript:globals.wlink\('([\d]+)'\)"><I>([^<]+)<\/I><\/a>/gi;

	/** @type {String} */
	var vTemp = vtext.replace(regexp, '<i>$1 $2</i>');
	vTemp = vTemp.replace(regexp2, '<i>$1 $2</i>');

	return vTemp;

}

/**
 * @properties={typeid:24,uuid:"ef5f90f7-db25-4d79-8c71-6fc345e97acc"}
 */
function sb_edit_HtmlToTextGetSpecialCharsArray() {
	var replaceArrayFrom = new Array();
	var replaceArrayResults = new Array();
	var replaceArray = new Array();

	replaceArrayFrom.push('&#235;');
	replaceArrayResults.push('√´');
	replaceArrayFrom.push('&#275;');
	replaceArrayResults.push('ƒì')
	replaceArrayFrom.push('&#257;');
	replaceArrayResults.push('ƒÅ')
	replaceArrayFrom.push('&#299;');
	replaceArrayResults.push('ƒ´')
	replaceArrayFrom.push('&#333;');
	replaceArrayResults.push('≈ç')
	replaceArrayFrom.push('&#363;');
	replaceArrayResults.push('≈´')
	replaceArrayFrom.push(">&#8216;<");
	replaceArrayResults.push(">Q<")
	replaceArrayFrom.push(">&#8217;<");
	replaceArrayResults.push(">W<")
	replaceArrayFrom.push('&#274;');
	replaceArrayResults.push('ƒí')
	replaceArrayFrom.push('&#256;');
	replaceArrayResults.push('ƒÄ')
	replaceArrayFrom.push('&#298;');
	replaceArrayResults.push('ƒ™')
	replaceArrayFrom.push('&#332;');
	replaceArrayResults.push('≈å')
	replaceArrayFrom.push('&#362;');
	replaceArrayResults.push('≈™')

	replaceArrayFrom.push("&#8216;");
	replaceArrayResults.push("‚Äò")
	replaceArrayFrom.push("#8216;");
	replaceArrayResults.push("‚Äò")
	replaceArrayFrom.push("&#8216");
	replaceArrayResults.push("‚Äò")
	replaceArrayFrom.push("#8216");
	replaceArrayResults.push("‚Äò")

	replaceArrayFrom.push("&#8217;");
	replaceArrayResults.push("‚Äô")
	replaceArrayFrom.push("#8217;");
	replaceArrayResults.push("‚Äô")
	replaceArrayFrom.push("&#8217");
	replaceArrayResults.push("‚Äô")
	replaceArrayFrom.push("#8217");
	replaceArrayResults.push("‚Äô")

	replaceArrayFrom.push("<l level=\"1\" ><br>&nbsp;&nbsp;&nbsp;&nbsp;");
	replaceArrayResults.push("<l level=\"1\">")
	replaceArrayFrom.push("&nbsp;");
	replaceArrayResults.push(" ")
	replaceArrayFrom.push("&lt;");
	replaceArrayResults.push("<")
	replaceArrayFrom.push("&gt;");
	replaceArrayResults.push(">")
	replaceArrayFrom.push("<divineName>");
	replaceArrayResults.push("<font1>")
	replaceArrayFrom.push("</divineName>");
	replaceArrayResults.push("</font1>")

	// Additions by Rick

	replaceArrayFrom.push("<p>");
	replaceArrayResults.push("")
	replaceArrayFrom.push("</p>");
	replaceArrayResults.push("")

	replaceArrayFrom.push('√É¬´');
	replaceArrayResults.push("√´");
	replaceArrayFrom.push('&#8226');
	replaceArrayResults.push("‚Ä¢");
	replaceArrayFrom.push('<br>');
	replaceArrayResults.push("\n");
	replaceArrayFrom.push('√É¬Ø');
	replaceArrayResults.push('√Ø');
	replaceArrayFrom.push('√¢‚Ç¨‚Äú√Ç');
	replaceArrayResults.push('-');
	replaceArrayFrom.push('√Ç √¢‚Ç¨‚Äú');
	replaceArrayResults.push('-');
	replaceArrayFrom.push('√É¬§');
	replaceArrayResults.push('√§');
	replaceArrayFrom.push('√É¬º');
	replaceArrayResults.push('√º');
	replaceArrayFrom.push('√É¬©');
	replaceArrayResults.push('√©');

	replaceArray[0] = replaceArrayFrom
	replaceArray[1] = replaceArrayResults
	return replaceArray;
}

/**
 * @param {String} vTemp
 * @properties={typeid:24,uuid:"a022b180-f41b-42f9-b40b-7d1f6bcf17c8"}
 */
function sb_edit_HtmlToTextRemoveLinks(vTemp) {
	//Method to remove links from a html text and returns the text without links and properly formatted
	//Tags where links are found: <wlink>, <tlink>, <flink>

	//Flink change
	vTemp = globals.sb_edit_HtmlToTextChangeFlink(vTemp);

	//Tlink change
	vTemp = globals.sb_edit_HtmlToTextChangeTlink(vTemp);

	//Wlink change
	vTemp = globals.sb_edit_HtmlToTextChangeWlink(vTemp);

	return vTemp

	/* Testing of wlink
	 forms.commentary_blocks.controller.setSelectedIndex(616)
	 var temp = forms.commentary_blocks.htmltext
	 temp = globals.sb_edit_HtmlToTextChangeWlink(temp);
	 //scopes.tools.output(temp)
	 */

	/* Testing of flink
	 forms.commentary_blocks.controller.setSelectedIndex(184)
	 var temp = forms.commentary_blocks.htmltext
	 temp = globals.sb_edit_HtmlToTextChangeFlink(temp);
	 //scopes.tools.output(temp)
	 */

	/* Testing of tlink
	 forms.commentary_blocks.controller.setSelectedIndex(615)
	 var temp = forms.commentary_blocks.htmltext
	 temp = globals.sb_edit_HtmlToTextChangeTlink(temp);
	 //scopes.tools.output(temp)
	 */

}

/**
 * @param {String} vText
 * @param {Number} number
 *
 * @properties={typeid:24,uuid:"4aedf66d-bd65-4633-99ac-fac4dc162721"}
 */
function sb_edit_ReorderFootnotes(vText, number) {
	//Method to reorder the footnotes in a given text
	//arguments[0]: the text
	//arguments[1]: where to start counting from (the first new footnote number)
	//Returns the text with the footnotes renumbered

	var bTag = "[cvb_f]"
	var bTagLength = bTag.length
	var eTag = "[/cvb_f]"
	//var eTagLength = eTag.length
	var indexNext = vText.indexOf(bTag, 0)
	var i = number
	while (indexNext >= 0) {
		var indexEnd = vText.indexOf(eTag, indexNext)
		vText = vText.substring(0, indexNext + bTagLength) + i + vText.substr(indexEnd);
		indexNext = vText.indexOf(bTag, indexEnd)
		i++;
	}

	return vText
}

 /**
 * TODO generated, please specify type and doc for the params
 * @param str
 *
 * @properties={typeid:24,uuid:"8312ACAB-0EBC-4406-BBC4-95007AB681FA"}
 */
function decodeHtmlEntity(str) {
  return str.replace(/&#(\d+);/g, function(match, dec) {
    return String.fromCharCode(dec);
  });
};

/**
 * TODO generated, please specify type and doc for the params
 * @param inp
 *
 * @properties={typeid:24,uuid:"E533477D-4771-4F55-A0E3-69B7D694CC3D"}
 */
function GetRealChar(inp) { 
	var vCharsFrom = ['&nbsp;','&iexcl;','&cent;','&pound;','&curren;','&yen;','&brvbar;','&sect;','&uml;','&copy;','&ordf;','&laquo;','&not;','&shy;','&reg;','&macr;','&deg;','&plusmn;','&sup2;','&sup3;','&acute;','&micro;','&para;','&middot;','&cedil;','&sup1;','&ordm;','&raquo;','&frac14;','&frac12;','&frac34;','&iquest;','&Agrave;','&Aacute;','&Acirc;','&Atilde;','&Auml;','&Aring;','&AElig;','&Ccedil;','&Egrave;','&Eacute;','&Ecirc;','&Euml;','&Igrave;','&Iacute;','&Icirc;','&Iuml;','&ETH;','&Ntilde;','&Ograve;','&Oacute;','&Ocirc;','&Otilde;','&Ouml;','&times;','&Oslash;','&Ugrave;','&Uacute;','&Ucirc;','&Uuml;','&Yacute;','&THORN;','&szlig;','&agrave;','&aacute;','&acirc;','&atilde;','&auml;','&aring;','&aelig;','&ccedil;','&egrave;','&eacute;','&ecirc;','&euml;','&igrave;','&iacute;','&icirc;','&iuml;','&eth;','&ntilde;','&ograve;','&oacute;','&ocirc;','&otilde;','&ouml;','&divide;','&oslash;','&ugrave;','&uacute;','&ucirc;','&uuml;','&yacute;','&thorn;','&yuml;','&quot;','&amp;','&lt;','&gt;','&OElig;','&oelig;','&Scaron;','&scaron;','&Yuml;','&circ;','&tilde;','&ensp;','&emsp;','&thinsp;','&zwnj;','&zwj;','&lrm;','&rlm;','&ndash;','&mdash;','&lsquo;','&rsquo;','&sbquo;','&ldquo;','&rdquo;','&bdquo;','&dagger;','&Dagger;','&permil;','&lsaquo;','&rsaquo;','&euro;','&fnof;','&Alpha;','&Beta;','&Gamma;','&Delta;','&Epsilon;','&Zeta;','&Eta;','&Theta;','&Iota;','&Kappa;','&Lambda;','&Mu;','&Nu;','&Xi;','&Omicron;','&Pi;','&Rho;','&Sigma;','&Tau;','&Upsilon;','&Phi;','&Chi;','&Psi;','&Omega;','&alpha;','&beta;','&gamma;','&delta;','&epsilon;','&zeta;','&eta;','&theta;','&iota;','&kappa;','&lambda;','&mu;','&nu;','&xi;','&omicron;','&pi;','&rho;','&sigmaf;','&sigma;','&tau;','&upsilon;','&phi;','&chi;','&psi;','&omega;','&thetasym;','&upsih;','&piv;','&bull;','&hellip;','&prime;','&Prime;','&oline;','&frasl;','&weierp;','&image;','&real;','&trade;','&alefsym;','&larr;','&uarr;','&rarr;','&darr;','&harr;','&crarr;','&lArr;','&uArr;','&rArr;','&dArr;','&hArr;','&forall;','&part;','&exist;','&empty;','&nabla;','&isin;','&notin;','&ni;','&prod;','&sum;','&minus;','&lowast;','&radic;','&prop;','&infin;','&ang;','&and;','&or;','&cap;','&cup;','&int;','&there4;','&sim;','&cong;','&asymp;','&ne;','&equiv;','&le;','&ge;','&sub;','&sup;','&nsub;','&sube;','&supe;','&oplus;','&otimes;','&perp;','&sdot;','&lceil;','&rceil;','&lfloor;','&rfloor;','&lang;','&rang;','&loz;','&spades;','&clubs;','&hearts;','&diams;'];
	var vCharsTo = ['&#160;','&#161;','&#162;','&#163;','&#164;','&#165;','&#166;','&#167;','&#168;','&#169;','&#170;','&#171;','&#172;','&#173;','&#174;','&#175;','&#176;','&#177;','&#178;','&#179;','&#180;','&#181;','&#182;','&#183;','&#184;','&#185;','&#186;','&#187;','&#188;','&#189;','&#190;','&#191;','&#192;','&#193;','&#194;','&#195;','&#196;','&#197;','&#198;','&#199;','&#200;','&#201;','&#202;','&#203;','&#204;','&#205;','&#206;','&#207;','&#208;','&#209;','&#210;','&#211;','&#212;','&#213;','&#214;','&#215;','&#216;','&#217;','&#218;','&#219;','&#220;','&#221;','&#222;','&#223;','&#224;','&#225;','&#226;','&#227;','&#228;','&#229;','&#230;','&#231;','&#232;','&#233;','&#234;','&#235;','&#236;','&#237;','&#238;','&#239;','&#240;','&#241;','&#242;','&#243;','&#244;','&#245;','&#246;','&#247;','&#248;','&#249;','&#250;','&#251;','&#252;','&#253;','&#254;','&#255;','&#34;','&#38;','&#60;','&#62;','&#338;','&#339;','&#352;','&#353;','&#376;','&#710;','&#732;','&#8194;','&#8195;','&#8201;','&#8204;','&#8205;','&#8206;','&#8207;','&#8211;','&#8212;','&#8216;','&#8217;','&#8218;','&#8220;','&#8221;','&#8222;','&#8224;','&#8225;','&#8240;','&#8249;','&#8250;','&#8364;','&#402;','&#913;','&#914;','&#915;','&#916;','&#917;','&#918;','&#919;','&#920;','&#921;','&#922;','&#923;','&#924;','&#925;','&#926;','&#927;','&#928;','&#929;','&#931;','&#932;','&#933;','&#934;','&#935;','&#936;','&#937;','&#945;','&#946;','&#947;','&#948;','&#949;','&#950;','&#951;','&#952;','&#953;','&#954;','&#955;','&#956;','&#957;','&#958;','&#959;','&#960;','&#961;','&#962;','&#963;','&#964;','&#965;','&#966;','&#967;','&#968;','&#969;','&#977;','&#978;','&#982;','&#8226;','&#8230;','&#8242;','&#8243;','&#8254;','&#8260;','&#8472;','&#8465;','&#8476;','&#8482;','&#8501;','&#8592;','&#8593;','&#8594;','&#8595;','&#8596;','&#8629;','&#8656;','&#8657;','&#8658;','&#8659;','&#8660;','&#8704;','&#8706;','&#8707;','&#8709;','&#8711;','&#8712;','&#8713;','&#8715;','&#8719;','&#8721;','&#8722;','&#8727;','&#8730;','&#8733;','&#8734;','&#8736;','&#8743;','&#8744;','&#8745;','&#8746;','&#8747;','&#8756;','&#8764;','&#8773;','&#8776;','&#8800;','&#8801;','&#8804;','&#8805;','&#8834;','&#8835;','&#8836;','&#8838;','&#8839;','&#8853;','&#8855;','&#8869;','&#8901;','&#8968;','&#8969;','&#8970;','&#8971;','&#9001;','&#9002;','&#9674;','&#9824;','&#9827;','&#9829;','&#9830;'];
	for(var i = 0; i <= vCharsFrom.length; i ++) {
		inp = utils.stringReplace(inp, vCharsFrom[i], vCharsTo[i]);
	}
	return decodeHtmlEntity(inp);
}

/**
 * @param {String} vText
 * @properties={typeid:24,uuid:"aecb21cf-05f0-4fc4-b839-840b39f60fed"}
 */
function sb_edit_TextToHtmlChangeHebrewWords(vText) {
	var regexp = /\[cvb_tr\]([^\[]+)\[\/cvb_tr\]/i
	var arr = vText.match(regexp)
	var heb
	

	while (arr != null && arr.length > 0) {
		arr[1] = GetRealChar(arr[1]);
		
		//Migratie: Alle plugins.SILEzraToUnicode vervangen
		//heb = "<tra><font style=\"font-family: SIL Heb Trans\">MOMO" + globals.stringToCharNo(arr[1]) + "</font></tra>"
		heb = '<tra><font style="font-family: SIL Heb Trans">' + globals.stringToCharNo(arr[1]) + '</font></tra>';
		vText = vText.replace(regexp, heb)
		arr = vText.match(regexp)
	}

	return vText
}

/**
 * @param {String} vTemp
 * @properties={typeid:24,uuid:"c46a41e3-873b-4f46-ae65-c1d99e5096fc"}
 */
function sb_edit_TextToHtmlChangeSpecialCharsToHtml(vTemp) {
	var specialCharsArray = globals.sb_edit_TextToHtmlGetSpecialCharsArray();

	var aux
	do {
		aux = vTemp
		for (var specialChar in specialCharsArray)
			vTemp = vTemp.replace(new RegExp(specialChar, "g"), specialCharsArray[specialChar]);

	} while (vTemp != aux)

	return vTemp
}

/**
 * @param {String} vText
 * @properties={typeid:24,uuid:"73288e8d-7cb1-4691-b625-2b2c5b3cc0e1"}
 */
function sb_edit_TextToHtmlChangeSuToSuper(vText) {
	var regexp = /\[cvb_su\]([^\[]+)\[\/cvb_su\]/gi
	var vTemp = vText.replace(regexp, '<sup>$1</sup>')

	return vTemp
}

/**
 * @param {String} vText
 * @properties={typeid:24,uuid:"8d611b7f-fa97-4e06-9435-1e7048ebc752"}
 */
function sb_edit_TextToHtmlFillFlink(vText) {

	//var regexp = /<f>([\d]+)<\/f>/gi
	var regexp = /\[cvb_f\]([\d]+)\[\/cvb_f\]/gi
	var vTemp = vText.replace(regexp, '<sup><strong><a href="javascript:globals.flink(\'$1\')">$1</a><\/strong><\/sup>')

	return vTemp;
}

/**
 * @properties={typeid:24,uuid:"23a34a0b-f538-436f-a0a2-708735d75c47"}
 * @param {String} vText
 * @param {String} [vBookAttr]
 * @param {Number} [vChapterd]
 */
function sb_edit_TextToHtmlFillTlink(vText, vBookAttr, vChapterd) {
	//Set a space for the text so when there is a link in the begin it will also work

	//var text =+ arguments[0]
	var versLinks;
	
	/** @type {*} */
	var match;
	
	//text = "In Gen.1:1‚Äì2:3 wordt Matt.1:2-17. vgl. Hos.1:2; Spr.8:22-23, Mat.24:21    en Joh.1:1. Then Jes.11:7 en 65:25. Also schepping (Joh.1:1-3; Kol.1:16). " +
	//		"in Ez.27:13; 32:26; 38:2-3; 39:1 genoemd. S p  Matt.1:2-17. and olkeren ( Gen.12:3;  18:18;  22:18)." +
	//			"S p  Gen.1, 17 and olkeren ( Gen.12:3,5-7 22:18)." +
	//	"(<i>2:12</i>,<i>48</i>), Chaldee√´n en vs.1-3, 5 und vs.2 for ok "
	var i, z;
	var books = globals.sb_edit_TextToHtmlGetBookAbbreviationsArray();
	if (globals.sb_APP_getServerLang() == "ESP") {
		versLinks = new Array();
		versLinks.push("vs.");
		versLinks.push("vers√≠culos ");
		versLinks.push("vers√≠culo ");
		versLinks.push("Vs.");
		versLinks.push("Vers√≠culos ");
		versLinks.push("Vers√≠culo ");
	} else {
		versLinks = new Array();
		versLinks.push("vs.");
		versLinks.push("verzen ");
		versLinks.push("vers ");
		versLinks.push("Vs.");
		versLinks.push("Verzen ");
		versLinks.push("Vers ");
	}

	//Join the 2 arrays
	books = books.concat(versLinks)
	books.sort();
	books.reverse()

	// Get the book abbreviation
	var vSQL = "SELECT abbreviation FROM books WHERE pk = ?"
	var vResult = databaseManager.getDataSetByQuery('sb', vSQL, [globals.book_id], 1);
	var vBookAbbr = vResult.getValue(1, 1) + globals.chapter + ":"
	var vBookAbbrOnly = vResult.getValue(1, 1)

	var prefixRegex = "("

	//books is the array retrieved from the database + the manually inserted items like: 'vs','verse +'...

	for (i in books) {
		prefixRegex += books[i]
		if (i != (books.length) - 1) {
			prefixRegex += "|"
		}
	}
	prefixRegex = prefixRegex + ")"
	prefixRegex = utils.stringReplace(prefixRegex, ".", "\\.")
	//var vRegEX = prefixRegex + "(\\s+|[0-9.:;,-]+)+\\b";
	//var vRegEX =  prefixRegex + "\\s?(\\s+|[0-9.:;,-en]+)+([0-9a-z]+\\b|\\b)";

	//Veranderd 22-06-2010 DEZE WERKT DON'T TOUCH!!!
	//@Modifier Ren√© van Veen
	var vRegEX = prefixRegex + "\\s?(\\s+|[0-9.:;,-]+|[en])+([0-9a-z]+^\\b|([a-z])|\\b)";
	//Aanpassing gedaan zodat die ook vs.5a matched
	//var vRegEX = prefixRegex + "(\\d+([-,:]*\\d)*|(-;\\d*))"

	//Oldest regex
	//var vRegEX =  prefixRegex + "\\s?(\\s.|[0-9.:;,-]+|^[en])+([0-9]|[a-z]+^\\b|\\b)";
	var vRegEX2 = prefixRegex + "\\s?(\\s+|[0-9.:;,-en]+)+";

	//scopes.tools.output(vRegEX)
	var regexp = new RegExp(vRegEX, "g");
	var regexp2 = new RegExp(vRegEX2, "g");
	match = regexp.exec(vText);

	var vMatchedStuff = [];

	while (match¬† != null) {
		var vObj = { };
		vObj.startIndex = match.index;
		vObj.stopIndex = (match.index + match[0].length);
		vObj.chars = match[0].length

		var extendedMatch = "" + match[0] + "";

		regexp2.lastIndex = 0;
		var singleMatch = regexp2.exec(extendedMatch.toString());

		//that's necessary due to javascript issue bug

		if (singleMatch == null) {
			singleMatch = regexp2.exec(extendedMatch.toString());
		}

		if (singleMatch != null) {
			//scopes.tools.output(extendedMatch + " -- " + singleMatch[0]);
			extendedMatch = singleMatch[0];
			vObj.stopIndex = (match.index + singleMatch[0].length);
			vObj.chars = singleMatch[0].length
		}

		vObj.text = extendedMatch;
		vObj.extra = singleMatch[1]
		vMatchedStuff.push(vObj);

		// Do a second match, else it will fail!
		// Now it will continue to the next match in string.
		match = regexp.exec(vText);
	}

	vMatchedStuff.reverse();

	var vRegEX3 = "[0-9]+([0-9:-]+)?";
	var regexp3 = new RegExp(vRegEX3, "g");

	for (i in vMatchedStuff) {
		var vBefore = vText.substring(0, vMatchedStuff[i].startIndex);
		var vAfter = vText.substring(vMatchedStuff[i].stopIndex);

		// Some scary stuff
		var vString = vMatchedStuff[i].text;

		/** @type {*} */
		var vTest = regexp3.exec(vString)
		var q = 0;
		var vUBOOK = "";
		var vRetAr = [];
		while (vTest != null) {
			if (vTest.index == 0) {
				vTest = regexp3.exec(vString);
				continue;
			}
			//scopes.tools.output(i + " => " + test[0]);
			// Get the book name!!!!!!
			var vOBJ = { };
			if (q == 0) {
				vUBOOK = vString.substring(0, vTest.index);
				vOBJ.title = vUBOOK + vTest[0];
				vOBJ.startIndex = 0;
				vOBJ.stopIndex = (vTest.length);
			} else {
				vOBJ.title = vTest[0];
				vOBJ.startIndex = vTest.index
				vOBJ.stopIndex = (vTest.index + vTest.length);
			}

			if (vUBOOK.match("vs.") || vUBOOK.match("verzen ") || vUBOOK.match("vers") || vUBOOK.match("Vs.") || vUBOOK.match("Verzen ") || vUBOOK.match("Vers ")) {
				//scopes.tools.output(vBookAbbr);
				//vLinkString = ;
				var vLinkString = vUBOOK
				if (vTest[0].match(':')) {
					vLinkString = vLinkString.replace("vs.", vBookAbbrOnly)
					vLinkString = vLinkString.replace("verzen ", vBookAbbrOnly)
					vLinkString = vLinkString.replace("vers ", vBookAbbrOnly)
					vLinkString = vLinkString.replace("Vs.", vBookAbbrOnly)
					vLinkString = vLinkString.replace("Verzen ", vBookAbbrOnly)
					vLinkString = vLinkString.replace("Vers ", vBookAbbrOnly)
				} else {
					vLinkString = vLinkString.replace("vs.", vBookAbbr)
					vLinkString = vLinkString.replace("verzen ", vBookAbbr)
					vLinkString = vLinkString.replace("vers ", vBookAbbr)
					vLinkString = vLinkString.replace("Vs.", vBookAbbr)
					vLinkString = vLinkString.replace("Verzen ", vBookAbbr)
					vLinkString = vLinkString.replace("Vers ", vBookAbbr)
				}
				vOBJ.vlink = true;
				vOBJ.book = vLinkString;
			} else {
				vOBJ.vlink = false;
				vOBJ.book = vUBOOK;
			}

			vOBJ.vers = vTest[0]

			vRetAr.push(vOBJ);
			q++;
			vTest = regexp3.exec(vString)
		}
		vRetAr.reverse()
		for (z in vRetAr) {
			var vBefore2 = vString.substring(0, vRetAr[z].startIndex);
				
			//get the last of verse of the matches
			var vLastElement = vRetAr[(vRetAr.length)-1];
			var vChapter = vLastElement.vers.split(':')[0];
			// check if the verse NOT contains a :
			var vVerse = vRetAr[z].vers + "";
			// AANZETTEN IN EERSTVOLGENDE AKKOORD VAN NIEUWE SCOPING
			// NIEUWE FEATURE DUS GEEN BUG!!!
			if(!vVerse.match(':') && vLastElement.vers.match(':'))
			{
				vRetAr[z].vers = vChapter + ":" + vRetAr[z].vers;
			}
			vChapter = null;
			var vAfter2 = vString.substring( (vRetAr[z].startIndex) + vRetAr[z].title.length)

			var vMultiVerse = vRetAr[z].vers.split('-');
			if (vMultiVerse.length > 1 && vRetAr[z].vlink) {
				//scopes.tools.output(vMultiVerse);
				vLinkString = vMultiVerse[0] + "-" + globals.chapter + ":" + vMultiVerse[1]
			} else if (vMultiVerse.length > 1 && !vMultiVerse[1].match(":")) {
				var vPosBook = vMultiVerse[0].indexOf(":", 0)
				var vFirstBook = vMultiVerse[0].substring(0, vPosBook)
				vLinkString = vMultiVerse[0] + "-" + vFirstBook + ":" + vMultiVerse[1]
			} else {
				vLinkString = vRetAr[z].vers;
			}

			vString = vBefore2 + "<a href=\"javascript:globals.tlink('" + vRetAr[z].book + vLinkString + "')\">" + vRetAr[z].title + "</a>" + vAfter2
		}

		q++;

		vText = vBefore + vString + vAfter;
	}

	return vText;
}

/**
 * @param {String} vtext
 * @properties={typeid:24,uuid:"7648A4E8-2D25-4BA0-9635-608C9F199184"}
 */
function sb_edit_TextToHtmlFillWlink(vtext) {

	//text = "magi√´rs (<i>2745 magoi</i> is letterlijk ‚Äòmagi√´rs‚Äô) "

	var regexp = /\[cvb_i\]([\d]+)\s([^\[]+)\[\/cvb_i\]/i
	var arr = vtext.match(regexp)
	var vwlink

	//Tried something here, thought plugin was necessary, but it seems not the case
	while (arr != null && arr.length > 0) {
		var original = arr[2]
		var greek = original + "";
		
		var vSplitOriginal = greek.split(" ", 200);
		
		if(vSplitOriginal[0] == arr[1])
		{
			vSplitOriginal.reverse().pop();
			vSplitOriginal.reverse();
		}
		
		greek = vSplitOriginal.join(" ");
		
		
		vwlink = '<a href="javascript:globals.wlink(\'' + arr[1] + '\')"><I>' + greek + '</I></a>';
		vtext = vtext.replace(regexp, vwlink)
		arr = vtext.match(regexp)
	}

	return vtext
}

/**
 * @properties={typeid:24,uuid:"777b7d32-987c-4db9-b5c3-fd762e453767"}
 */
function sb_edit_TextToHtmlGetBookAbbreviationsArray() {
	//Method that returns as array that contains possible abbreviations of all the books

	var abrev = new Array()
	// ORDER BY book_name ASC
	var query = "SELECT abbreviation FROM books ORDER BY book_name ASC"
	var res = databaseManager.getDataSetByQuery('sb', query, null, -1)
	if (res.getMaxRowIndex() > 0)
		abrev = abrev.concat(res.getColumnAsArray(1))
	if (globals.sb_APP_getServerLang() == "NL") {
		abrev.push('1 Cor.',
			'1Cor.',
			'2 Cor.',
			'2Cor.',
			'Col.',
			'1 Thess.',
			'1Thess.',
			'2 Thess.',
			'2Thess.',
			'Jac.',
			'1 Petr.',
			'1Petr.',
			'2 Petr.',
			'2Petr.',
			'1 Sam.',
			'2 Sam.',
			'1 Kon.',
			'2 Kon.',
			'1 Kron.',
			'1Kron.',
			'2 Kron.',
			'2Kron.',
			'Esther',
			'Pred.',
			'Ezech.',
			'Ez.',
			'Obadja',
			'Micha',
			'Zef.',
			'Matt.',
			//toegevoegd als test
			'Hebr.',
			'1 Tim.',
			'2 Tim.',
			'Openb.',
			'Marc.'
		)
	}
	return abrev
}

/**
 * @properties={typeid:24,uuid:"81488abf-c182-498c-85c8-b404ab8b2396"}
 */
function sb_edit_TextToHtmlGetSpecialCharsArray() {
	var replaceArray = new Array();
	replaceArray['e^'] = '&#275;'
	replaceArray['a^'] = '&#257;'
	replaceArray['i^'] = '&#299;'
	replaceArray['o^'] = '&#333;'
	replaceArray['u^'] = '&#363;'
	replaceArray[">Q<"] = ">&#8216;<"
	replaceArray[">W<"] = ">&#8217;<"
	replaceArray['E^'] = '&#274;'
	replaceArray['A^'] = '&#256;'
	replaceArray['I^'] = '&#298;'
	replaceArray['O^'] = '&#332;'

	replaceArray['ƒì'] = '&#275;'
	replaceArray['ƒÅ'] = '&#257;'
	replaceArray['ƒ´'] = '&#299;'
	replaceArray['≈ç'] = '&#333;'
	replaceArray['≈´'] = '&#363;'
	replaceArray['ƒí'] = '&#274;'
	replaceArray['ƒÄ'] = '&#256;'
	replaceArray['ƒ™'] = '&#298;'
	replaceArray['≈å'] = '&#332;'
	replaceArray['≈™'] = '&#362;'

	replaceArray["</I>W"] = "</I>&#8217;"
	replaceArray["√¢‚Ç¨‚Ñ¢"] = "&#8217;"
	replaceArray["√¢‚Ç¨Àú"] = "&#8216;"
	replaceArray["<l level=\"1\">"] = "<l level=\"1\" ><br>&nbsp;&nbsp;&nbsp;&nbsp;"
	replaceArray["‚Äò"] = "&#8216;"
	replaceArray["‚Äô"] = "&#8217;"
//	replaceArray["\\n"] = "<BR>";

	// Aditions by Rick//
	//replaceArray["<font1>"] = "<small style=\"text-transform: uppercase\">";
	//replaceArray["</font1>"] = "</small>";

	return replaceArray;
}

/**
 * @properties={typeid:24,uuid:"54a2a491-3a3c-4a31-853d-c8e81ae2af19"}
 * @type {*} vVerseID
 * @AllowToRunInFind
 */
function sb_edit_WordsTranslationToHTML_nt(vVerseID) {
	
	if(!vVerseID) {
		return false;
	}
	
	var vNewText, vSQL2
	var aTypes = new Array();
	aTypes.push('TR');
	aTypes.push('H-F');
	aTypes.push('N25');
	aTypes.push('N27');

	var vGreek = "";
	var iIndex, vWordsStrong;

	// this function needs to be edited that there will be additional columns for mobile
	// so there has to be the following columns
	// words_html_tr_mobile, words_html_hf_mobile, words_html_n25_mobile, words_html_n27_mobile
	
	
	if (vVerseID > 0) {
		for (var m in aTypes) {
			databaseManager.saveData()
//			application.sleep(500);
			//if(forms.words_fill_in.controller.find())
			//{
			if (aTypes[m] == 'TR') {
				vSQL2 = "SELECT pk FROM words WHERE (word_original != '' AND word_original IS NOT NULL) AND verse_id = " + vVerseID + " AND words.tr = 1 ORDER BY word_order"
				//forms.words_fill_in.tr = 1;
			} else if (aTypes[m] == 'H-F') {
				vSQL2 = "SELECT pk FROM words WHERE (word_original != '' AND word_original IS NOT NULL) AND verse_id = " + vVerseID + " AND words.hf = 1 ORDER BY word_order"

				//forms.words_fill_in.hf = 1;
			} else if (aTypes[m] == 'N25') {
				vSQL2 = "SELECT pk FROM words WHERE (word_original != '' AND word_original IS NOT NULL) AND verse_id = " + vVerseID + " AND words.n25 = 1 ORDER BY word_order"

				//forms.words_fill_in.n25 = 1;
			} else if (aTypes[m] == 'N27') {
				vSQL2 = "SELECT pk FROM words WHERE (word_original != '' AND word_original IS NOT NULL) AND verse_id = " + vVerseID + " AND words.n27 = 1 ORDER BY word_order"

				//forms.words_fill_in.n27 = 1;
			}

			//forms.words_fill_in.verse_id = vVerseID;
			//forms.words_fill_in.controller.search();
			//}
			/** @type JSFoundset<db:/sb/words> */
			var vFoundset2 = databaseManager.getFoundSet("sb", "words")
			vFoundset2.loadRecords(vSQL2)

			var j = 0;
			var vPreviousCode = 0;

			var vWords = '<html><body><table><tr><td><table cellpadding=\"4\" cellspacing=\"4\">';
			var vGreek2 = "<html><body><table><tr><td><table cellpadding=\"4\" cellspacing=\"4\">"
			
			var vMobile = '<html><body><table><tr><td><table cellpadding=\"2\" cellspacing=\"2\">';
			
			vGreek = null;
			
			/** @type JSRecord<db:/sb/words> */
			var vRecord
			for (var i = 1; i <= vFoundset2.getSize(); i++) {
				vRecord = vFoundset2.getRecord(i);
				vFoundset2.setSelectedIndex(i);
				vRecord.words_to_word_variants.setSelectedIndex(i);

				var iDisplay = 1;
				var iColored = 0;
				var iCertainMode = 0;
				var vCode = "";

				if (iDisplay == 1) {
					
					if (vRecord.tr == 0 || vRecord.hf == 0 || vRecord.n25 == 0 || vRecord.n27 == 0 || vRecord.tr == null || vRecord.hf == null || vRecord.n25 == null || vRecord.n27 == null) {
						iColored = 1;
					}
						
					if (vRecord.words_to_word_variants.code_no != null && vRecord.words_to_word_variants.code_no != "" && vRecord.words_to_word_variants.code_no != "  ") {
						vCode = vRecord.words_to_word_variants.code_no;
					} else if(vRecord.code_no != null && vRecord.code_no != "" && vRecord.code_no != " ") {
						vCode = vRecord.code_no;
					}
					
					/////////////////////////////////////////////////////////////////////////

					j++;

					if (j % 4 == 1) {
						vWords += '<tr>';
						vGreek2 += '<tr>';
					}
					
					if (j%2==1)
					{
						vMobile += "<tr>";
					}

					vWords += '<td valign=\"top\">';
					vGreek2 += '<td valign=\"top\">';

					vMobile += '<td valign="top">';
					
					if (vCode) {
						if (vPreviousCode != vCode) {
							vPreviousCode = vCode;
						//	if (iColored == 1) {
								vWords += '<font color=\"#7A004D\">';
								vWords += '<sup><font size=\"3\">';
								vWords += vCode;
								vWords += '</font></sup>';
								vWords += '</font>';
						//	}
						}
					}
					// Certain modes
					vGreek = "";
					if (iCertainMode == 1) {
						vGreek += '[';
					}

					//vGreek = vGreek.concat('<a href="javascript:forms.study_words.searchWord(\'');
					vGreek += '<a href=\"javascript:forms.study_words.searchWord(\''
					iIndex = vRecord.word_strong.indexOf('.');
					vWordsStrong = "";

					if (iIndex > 0) {
						vWordsStrong = vRecord.word_strong.substring(0, iIndex);
					} else {
						vWordsStrong = vRecord.word_strong;
					}

					vGreek += vWordsStrong;

					if (iColored == 1) {
						//vGreek = vGreek.concat('\')" style="color:#7A004D;text-decoration:none"><font face="GreekSBBold" color="#7A004D">');
						vGreek += '\')\" style=\"color:#7A004D;text-decoration:none\"><font face=\"GreekSBBold\" color=\"#7A004D\">'
					} else {
						//vGreek = vGreek.concat('\')" style="color:#000000;text-decoration:none"><font face="GreekSBBold"	color="#000000">');
						vGreek += '\')\" style=\"color:#000000;text-decoration:none\"><font face=\"GreekSBBold\"	color=\"#000000\">'
					}

					vGreek += vRecord.word_original;

					vGreek += '</font></a>';

					if (iCertainMode == 1) {
						vGreek += ']';
					}

					vWords += vGreek;
					vMobile += vGreek;

					if (iColored == 1) {
						vWords += '<font color=\"#7A004D\">';
						vMobile += '<font color="#7A004D">';
					}

					vWords += '<br />';
					vWords += vRecord.word_transliteration;
					vWords += '<br />';
					vWords += vRecord.word_translation;
					if (iColored == 1) {
						vWords += '</font>';
					}
					
					vMobile += "<br />";
					vMobile += vRecord.word_transliteration;
					vMobile += '<br />'
					vMobile += vRecord.word_translation;
					if(iColored == 1)
					{
						vMobile += '</font>';
					}

					vWords += '</td>';
					vMobile += '</td>';

					vGreek2 += vGreek
					vGreek2 += '</td>'

					if (j % 4 == 0) {
						vWords += '</tr>';
						vGreek2 += '</tr>';
					}
					
					if(j%2==0) {
						vMobile += "</tr>";
					}
					
					//}

					/// Manuscripts

					if (forms.fill_manuscript_info.controller.find()) {
						forms.fill_manuscript_info.verse_id = vVerseID;
						// ADDIDTIONS
						switch (aTypes[m]) {
						case "TR":
							forms.fill_manuscript_info.tr = 1
							break;

						case "H-F":
							forms.fill_manuscript_info.hf = 1;
							break;

						case "N25":
							forms.fill_manuscript_info.n25 = 1;
							break;

						case "N27":
							forms.fill_manuscript_info.n27 = 1;
							break;
						}
						forms.fill_manuscript_info.controller.search();
					}
				}
			}

			var vFistTime = 1
			/** @type JSRecord<db:/sb/manuscript_info> */
			var vRecord2
			for (var z = 1; z <= forms.fill_manuscript_info.foundset.getSize(); z++) {
				vRecord2 = forms.fill_manuscript_info.foundset.getRecord(z);

				var iDisplay2 = 1;
				if (aTypes[m] == 'TR' && vRecord2.tr == 0) {
					iDisplay2 = 0
				}
				if (aTypes[m] == 'H-F' && vRecord2.tr == 0) {
					iDisplay2 = 0
				}
				if (aTypes[m] == 'N25' && vRecord2.tr == 0) {
					iDisplay2 = 0
				}
				if (aTypes[m] == 'N27' && vRecord2.tr == 0) {
					iDisplay2 = 0
				}
				iDisplay2 = 1;

				if (iDisplay2 == 1) {
					if (vFistTime == 1) {
						vWords += '</table></td></tr></table>';
						vGreek2 += '</table></td></tr></table>'
						vFistTime = 0
						vMobile += "</table></td></tr></table>";
					}
					vWords += '<table><tr><td><font size="3">';
					vMobile += '<table><tr><td><font size="3">';
					
					if (vRecord2.code_no != 0) {
						vWords += vRecord2.code_no;
						vMobile += vRecord2.code_no;
					}
					vWords += ' ';
					vMobile += ' ';
					var vText = vRecord2.manuscript_text;

					if (vText != null) {
						var vIndex1 = vText.indexOf('<grk>');
//						var vIndex2 = vText.indexOf('</grk>');

						if (vIndex1 > -1) {
							/*	MME: 14-10-2011 tijdelijk uit voor conversie.
							var vGreek3 = vText.substring(vIndex1 + 5, vIndex2);
							vGreek3 = plugins.SB_NT.getGreek(vGreek3);
							

							vNewText = vText.substring(0, vIndex1);
							vNewText += '<font size=\"3\" face=\"GreekSB\">';
							vNewText += vGreek3;
							vNewText += '</font>';
							vNewText += vText.substring(vIndex2 + 6);
							*/
						} else {
							vNewText = vText
						}

						vWords += vNewText;
						vWords += '</font></td></tr></table>';
						
						vMobile += vNewText;
						vMobile += '</font></td></tr></table>';
					}
				}
			}
			if (vFistTime == 1) {
				vWords += '</table></td></tr></table>'
				vGreek2 += '</table></td></tr></table>'
				vMobile += '</table></td></tr></table>';
			}
			vWords += '</body></html>';
//			vGreek += '</body></html>';
			vGreek2 += "</body></html>";
			vMobile += "</body></html>";
			
			// Foundset genereren
			/** @type JSFoundset<db:/sb/verses> */
			var vFoundset = databaseManager.getFoundSet('sb', 'verses');

			if (vFoundset.find()) {
				vFoundset.pk = vVerseID;
				vFoundset.search();
			}

			if (aTypes[m] == 'TR') {
				vFoundset.words_html_tr = vWords;
				vFoundset.words_html_tr_gr = vGreek2;
				vFoundset.words_html_tr_mobile = vMobile;
			}
			if (aTypes[m] == 'H-F') {
				vFoundset.words_html_hf = vWords;
				vFoundset.words_html_hf_gr = vGreek2;
				vFoundset.words_html_hf_mobile = vMobile;
			}
			if (aTypes[m] == 'N25') {
				
				vFoundset.words_html_n25 = vWords;
				vFoundset.words_html_n25_gr = vGreek2;
				vFoundset.words_html_n25_mobile = vMobile;
			}
			if (aTypes[m] == 'N27') {
				
				vFoundset.words_html_n27 = vWords;
				vFoundset.words_html_n27_gr = vGreek2;
				vFoundset.words_html_n27_mobile = vMobile;
			}
			

			vGreek	= null;
			vGreek2 = null;
			vWords 	= null;
			vMobile = null;
			databaseManager.saveData()
		}
	}
	databaseManager.saveData()
	return true;
}

/**
 * @properties={typeid:24,uuid:"7c5fef2c-7026-4988-995c-0bc3c2769e3c"}
 * @param {*} vVerseID
 */
function sb_edit_WordsTranslationToHTML_ot(vVerseID) {
	if(!vVerseID){
		return false;
	}
	
	var rowSize = 4
	var cont = Array(rowSize)
	var cont_gr = Array(rowSize)
	var k
	var query = "select word_original, word_transliteration, word_translation, word_strong from words where verse_id=" + vVerseID + " and word_strong is not null and word_strong!='' order by word_order"

	//SMM - 16-05-2011
	var res = databaseManager.getDataSetByQuery('sb', query, null, 1000)

	//var res = databaseManager.getDataSetByQuery(forms.books.controller.getServerName(), query, null, 1000)

	var size = res.getMaxRowIndex()
	if (size != 0) {
		var header = '<html><body><table><tr><td><table cellpadding="4" cellspacing="4">'
		var content = ''
		var content_gr = ''
		var footer = '</table></td></tr></table></body></html>'
		for (var j = 1; j <= size; j++) {
			res.rowIndex = j

			if ( (j - 1) % rowSize == 0) {
				content += '<tr>'
				content_gr += '<tr>'
			}

			//	WTF???
			//	plugins.it2be_tools.defaultPrinter

			if (res[4]) {
				/** @type {String} */
				var strong = res[4]
				var vindex = strong.indexOf('.', 0)
				if (vindex > 0)
					strong = strong.substring(0, vindex)

				//	cont[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B><br><font face="SIL Heb Trans">'+plugins.SILEzraToUnicode.convertToEzra(res[2])+'</font><br>' + res[3] + '</td>'
				//	cont_gr[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B></td>'
				//	cont[rowSize-(j-1)%rowSize-1] = "<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + plugins.SILEzraToUnicode.convertToEzra(res[1]) + "</font></B><br><font face=\"SIL Heb Trans\">"+plugins.SILEzraToUnicode.convertToEzra(res[2])+"</font><br>" +  utils.stringReplace(res[3],"'", "&#39;") + "</td>"
				//	cont_gr[rowSize-(j-1)%rowSize-1] ="<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + plugins.SILEzraToUnicode.convertToEzra(res[1]) + "</font></B></td>"
				cont[rowSize - (j - 1) % rowSize - 1] = "<td valign=\"top\"><B><a style=\"text-decoration: none\" href=\"javascript:globals.wlink('" + strong + "')\"><font face=\"SIL Ezra\" color=\"#000000\">" + globals.stringToCharNo(res[1]) + "</font></a></B><br><font face=\"SIL Heb Trans\">" + globals.stringToCharNo(res[2]) + "</font><br>" + utils.stringReplace(res[3], "'", "&#39;") + "</td>"
				cont_gr[rowSize - (j - 1) % rowSize - 1] = "<td valign=\"top\"><B><a style=\"text-decoration: none\ href=\"javascript:globals.wlink('" + strong + "')\"><font face=\"SIL Ezra\" color=\"#000000\">" + globals.stringToCharNo(res[1]) + "</font></a></B></td>"

			} else {
				cont[rowSize - (j - 1) % rowSize - 1] = ''
				cont_gr[rowSize - (j - 1) % rowSize - 1] = ''
			}

			if (j % rowSize == 0) {
				for (k = 0; k < rowSize; k++) {
					content += cont[k]
					content_gr += cont_gr[k]
				}
				content += '</tr>'
				content_gr += '</tr>'
			}

		}//j
		if (size % rowSize != 0) {
			for (k = 0; k < rowSize - size % rowSize; k++) {
				content += '<td valign="top">&nbsp;</td>'
				content_gr += '<td valign="top">&nbsp;</td>'
			}
			for (k = rowSize - size % rowSize; k < rowSize; k++) {
				content += cont[k]
				content_gr += cont_gr[k]
			}

			content += '</tr>'
			content_gr += '</tr>'
		}

		//var updateQuery = "UPDATE verses SET words_html_tr = '" + header + content + footer + "',words_html_tr_gr='"+ header + content_gr + footer + "' WHERE pk=" + vVerseID +";";
		//

		// Foundset method?
		/** @type{JSFoundset<db:/sb/verses>} */
		var vFoundset = databaseManager.getFoundSet('sb', 'verses');
		vFoundset.loadRecords("SELECT pk FROM verses WHERE pk = " + vVerseID);

		if (vFoundset.pk == vVerseID) {
			vFoundset.words_html_tr = header + content + footer;
			vFoundset.words_html_tr_gr = header + content_gr + footer;
			databaseManager.saveData();
		}

		return true;
		//	//scopes.tools.output(    updateQuery )
		/*	var success =	plugins.rawSQL.executeSQL( forms.books.controller.getServerName(),  "verses",  updateQuery)
		 if(!success)
		 //scopes.tools.output("Verses words cannot be updated")
		 else
		 databaseManager.refreshRecordFromDatabase(forms.verses_fill_in.foundset, -1)*/
		//	plugins.rawSQL.flushAllClientsCache(forms.books.controller.getServerName(), '')
	}//size not zero
	return true
}

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"c083571c-8735-4044-9545-8b32f5c63cf7"}
 */
var sb_export_charset = 'UTF-16';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"ca10a985-664a-46ae-9e9b-da59954515d5",variableType:4}
 */
var sb_import_backupCommentaryId = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"da10bf9b-5e04-4ad6-8941-726e4e7fb801",variableType:8}
 */
var sb_import_book_id;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"4186cb30-d350-4aa8-8a0e-f558d4badb40",variableType:4}
 */
var sb_import_bookId;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"1c3ba06c-cbe8-4ff9-8c0c-0ef69e1ab654",variableType:8}
 */
var sb_import_chapter;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"ebab6069-662b-42b3-be62-952ace8e7a2e",variableType:4}
 */
var sb_import_chapterFromId = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"02917270-0fc2-4e07-8944-ebd290aeb8a6",variableType:4}
 */
var sb_import_chapterToId = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"f8643505-f24a-4f1c-b03c-f533c3ff5922"}
 */
var sb_import_commentary = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"cd5557a3-01e5-4c17-b677-4d9b39edbfd3",variableType:4}
 */
var sb_import_commentaryAndFootnotesValidated = 0;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"f462aa95-f2d4-4021-9210-a5130589709f",variableType:4}
 */
var sb_import_commentaryBlockCreated = 0;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"538380fd-7fe9-4519-a31b-5f4e02e277e5"}
 */
var sb_import_commentaryError = '';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"6b9e7ef8-5428-42bb-8b50-755eaa070a40",variableType:4}
 */
var sb_import_commentaryId = 1;

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"cb2d35e8-e34f-416a-bd5c-58641f5596cf"}
 */
var sb_import_file = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"a2584397-708f-46c2-abd4-629e2ed0b6ac"}
 */
var sb_import_footnotes = '';

/**
 * @type {String}
 *
 * @properties={typeid:35,uuid:"f769f1af-6713-4cde-93e8-6656ff16c1d8"}
 */
var sb_import_testament = 'Old';

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"3670167c-c4e9-4ec7-bbd1-27a591cb74a4",variableType:4}
 */
var sb_import_verseFromId = 1;

/**
 * @type {Number}
 *
 * @properties={typeid:35,uuid:"b777df31-3324-4ffe-a309-df0edaa9fb8a",variableType:4}
 */
var sb_import_verseToId = 1;

/**
 * @properties={typeid:24,uuid:"e1a1f142-e535-47f4-83ee-2b8e1012ae1f"}
 */
function sb_import_versTrans() {
	//application.showFormInDialog(forms.sb_import_verse_translations, -1, -1, -1, -1, "i18n:servoy.menuitem.import", false, false, forms.sb_import_verse_translations, true)
	//SMM 20-05-2011
	var vForm = application.createWindow('forms.sb_import_verse_translations', JSWindow.MODAL_DIALOG, null);
	vForm.title = i18n.getI18NMessage('servoy.menuitem.import')
	vForm.show(forms.sb_import_verse_translations);

}

/**
 * @properties={typeid:24,uuid:"2e9544df-7bc7-4aa5-901a-f3f5f498b147"}
 */
function sb_import_versWords() {
	//application.showFormInDialog(forms.sb_import_verse_words, -1, -1, -1, -1, "i18n:servoy.menuitem.import", false, false, forms.sb_import_verse_words, true)
	//SMM 20-05-2011
	var vForm = application.createWindow('forms.sb_import_verse_words', JSWindow.MODAL_DIALOG, null);
	vForm.title = i18n.getI18NMessage('servoy.menuitem.import')
	vForm.show(forms.sb_import_verse_words);

}

/**
 * @properties={typeid:24,uuid:"F61012FA-4C52-436B-9F0C-11FC972529B6"}
 */
function showFormLoginReportDetail(vDate) {
	//vDate = utils.dateFormat(vDate, 'MM-dd-yyyy')
	plugins.dialogs.showQuestionDialog('warning', 'TEST test : ' + vDate, 'i18n:cvb.btn.yes', 'i18n:cvb.btn.no')
	return

}

/**
 * @param {JSEvent} event
 * @param {String} element
 * @properties={typeid:24,uuid:"557201F2-0BB4-4D49-99DB-6D301711DF6E"}
 */
function TinyMCE_Load(event, element) {
	if (forms[event.getFormName()].elements[element].editorType == 'TinyMCE') {
		var js = {
			entity_encoding : "raw",
			content_css: application.getServerURL() + "/css/custom_content.css?" + new Date().getTime(),
			language: i18n.getCurrentLanguage(),
			//                forced_root_block : false,
			//                force_br_newlines : true,
			//                force_p_newlines : false,
			theme_advanced_buttons1: 'bold,italic,underline,strikethrough,|,forecolor,backcolor,removeformat,|,justifyleft,justifycenter,justifyright,justifyfull,|,link,unlink,anchor,code,image,|,search,replace',
			theme_advanced_buttons2: 'formatselect,fontselect,fontsizeselect,|,tablecontrols,|,outdent,indent,blockquote,|,sub,sup',
			theme_advanced_buttons3: '""',
			theme_advanced_buttons4: '""',
			plugins: 'safari,spellchecker,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template',
			theme_advanced_font_sizes: "8px=8px, 10px=10px, 11px=11px, 12px=12px, 14px=14px, 16px=16px,18px=18px,20px=20px,22px=22px,24px=24px,26px=26px,28px=28px,36px=36px,48px=48px,72px=72px",
			theme_advanced_toolbar_location: 'top', theme_advanced_toolbar_align: 'left'
		};
		forms[event.getFormName()].elements[element].setCustomConfiguration(js);
	}
}

/**
 * @properties={typeid:24,uuid:"D85CB5A5-F018-4D9B-94E1-12A88AFE0DBF"}
 * @param {string} key
 * @param {Object} value
 */
function setUserSetting(key, value) {
	if (!key) {
		return null
	}

	//if (!value) {
	//return null
	//}
	/*
	 var vIsNumeric
	 if (value != null && !value.toString().match(/^[-]?\d*\.?\d*$/)){
	 vIsNumeric = false
	 scopes.tools.output(key + " is NUMERIC " + value)
	 }
	 else {
	 vIsNumeric = true;
	 scopes.tools.output(key + " is not NUMERIC " + value)
	 }
	 */

//	var vArgs, vUpdateSQL, vSucces, insertArray, vInsertSQL, vExist
	var vUserID = globals.sb_gCurrentUserID;

	var vSQL = 'SELECT user_setting_id FROM user_setting WHERE sb_contact_id = ? AND key_name = ?'
//	var vDS = databaseManager.getDataSetByQuery('sb_data', vSQL, vArgs, -1);
	var vFS = databaseManager.getFoundSet('sb_data', 'user_setting');
	vFS.loadRecords(vSQL, [vUserID, key]);
	
//	if (vDS && (vDS.getMaxRowIndex() > 0)) vExist = true
//	else vExist = false
	var vRecord;
	if (vFS.getSize() == 1) {
		vRecord = vFS.getRecord(1);
		vRecord.key_value = value;
		scopes.tools.output('=UPDATE==');
		scopes.tools.output(key);
		scopes.tools.output(value);
		scopes.tools.output(vUserID);
		scopes.tools.output('===END===');
		
		/*vArgs = new Array()
		vArgs.push(value);
		vArgs.push(vUserID);
		vArgs.push(key);
		vUpdateSQL = 'UPDATE user_setting SET key_value = ?'
		vUpdateSQL += ' WHERE sb_contact_id = ? AND key_name = ?'
		vSucces = plugins.rawSQL.executeSQL('sb_data', 'user_setting', vUpdateSQL, vArgs);*/
	} else {
		vRecord = vFS.getRecord(vFS.newRecord());
		vRecord.key_name = key;
		vRecord.key_value = value;
		vRecord.sb_contact_id = vUserID;
		scopes.tools.output('=INSERT=');
		scopes.tools.output(key);
		scopes.tools.output(value);
		scopes.tools.output(vUserID);
		scopes.tools.output('===END===');
		/*vInsertSQL = "INSERT INTO user_setting(key_name,key_value,sb_contact_id) VALUES (?, ?, ?)";
		insertArray = new Array()
		insertArray[0] = key
		insertArray[1] = value
		insertArray[2] = vUserID
		vSucces = plugins.rawSQL.executeSQL('sb_data', 'user_setting', vInsertSQL, insertArray);*/
	}
	scopes.tools.output("Userdata Saved: " + databaseManager.saveData(vRecord));
	//if (vSucces){
	//plugins.rawSQL.flushAllClientsCache('sb_data', 'user_setting')
	//}
	return true
}

/**
 * @properties={typeid:24,uuid:"336A3461-A6D7-48B3-A61E-CEF1C1629676"}
 * @param {string} key
 * @param {string} [initial]
 */
function getUserSetting(key, initial) {
	if (!key) {
		return null
	}

	//var vSQL = 'SELECT ' + key + ' FROM user_setting WHERE sb_contact_id = ?'
	var vSQL = 'SELECT key_value FROM user_setting WHERE sb_contact_id = ? AND key_name = ?'
	var vArgs = new Array()
	vArgs.push(globals.sb_gCurrentUserID)
	vArgs.push(key)
	var vDS = databaseManager.getDataSetByQuery('sb_data', vSQL, vArgs, -1);

	switch (vDS.getMaxRowIndex()) {
//	case 0:
//		return null //'ERROR: No value found for key "' + key
	case 1:
		return vDS.getValue(1, 1)
	default:
		return initial//'ERROR: Multiple values found for key '+  + key
	}
}

/**
 * @properties={typeid:24,uuid:"394DE11A-8C37-4DEE-B68C-34B84C4D25AA"}
 */
function sb_REC_createUserSettingRecord() {

	var vCurrentUserRecord
	if (!utils.hasRecords(sb_g_current_user.sb_contact_to_user_setting)) {
		vCurrentUserRecord = sb_g_current_user.sb_contact_to_user_setting.getRecord(sb_g_current_user.sb_contact_to_user_setting.newRecord());
	} else {
		vCurrentUserRecord = sb_g_current_user.sb_contact_to_user_setting.getRecord(1);
	}
	return vCurrentUserRecord;
}

/**
 * @properties={typeid:24,uuid:"C0C524FD-4978-4F9F-8598-4FBE656091A5"}
 * @param {String} bodyText
 * @param {String} searchTerm
 * @param {String} [highlightStartTag]
 * @param {String} [highlightEndTag]
 */
function cvb_doHighlight(bodyText, searchTerm, highlightStartTag, highlightEndTag) {

	// the highlightStartTag and highlightEndTag parameters are optional
	if ( (!highlightStartTag) || (!highlightEndTag)) {
		highlightStartTag = "<font style='color:blue; background-color:yellow;'>";
		highlightEndTag = "</font>";
	}
	var newText = "";
	var i = -1;
	var lcSearchTerm = searchTerm.toLowerCase();
	var lcBodyText = bodyText.toLowerCase();

	while (bodyText.length > 0) {
		i = lcBodyText.indexOf(lcSearchTerm, i + 1);
		if (i < 0) {
			newText += bodyText;
			bodyText = "";
		} else {
			// skip anything inside an HTML tag
			if (bodyText.lastIndexOf(">", i) >= bodyText.lastIndexOf("<", i)) {
				// skip anything inside a <script> block
				if (lcBodyText.lastIndexOf("/script>", i) >= lcBodyText.lastIndexOf("<script", i)) {
					newText += bodyText.substring(0, i) + highlightStartTag + bodyText.substr(i, searchTerm.length) + highlightEndTag;
					bodyText = bodyText.substr(i + searchTerm.length);
					lcBodyText = bodyText.toLowerCase();
					i = -1;
				}
			}
		}
	}
	return newText;
}

/**
 * Called before the form component is rendered.
 *
 * @param {JSRenderEvent} event the render event
 *
 * @properties={typeid:24,uuid:"1B245E5F-4AC9-45FD-91BC-E505B8600D56"}
 */
function onRender(event) {
	if((event.getRecordIndex()%2 == 0))
	{
		event.getRenderable().bgcolor = "#FFFFFF"
	} else {
		event.getRenderable().bgcolor = "#EFEFEF";
	}
	
}

/**
 * @properties={typeid:24,uuid:"5860BCA7-D738-434A-A9B4-0E5CF580A355"}
 */
function sb_APP_getServerLang() {
	var vSQL = "SELECT * FROM sb_servers WHERE lower(server_host) = ?";
	var vDS = databaseManager.getDataSetByQuery('sb_data', vSQL, [application.getServerURL().toLowerCase()], 1);
	
	if(vDS.getMaxRowIndex() > 0) {
		return vDS[0]["server_lang"];
	} else {
		return "NL";
	}
	
}

/**
 * @properties={typeid:24,uuid:"92AFB6CC-1FBA-463A-94F6-453617ADA27C"}
 */
function sb_import_articles() {
	var vWin = application.createWindow('articleImport', JSWindow.MODAL_DIALOG);
	
	vWin.title = "i18n:cvb.lbl.article_wizard";
	
	vWin.resizable = true;
	
	forms.import_articleWizard_dlg.elements.steps.tabIndex = 1;
	forms.import_articleWizard_step1_pan.f_filename = null;
	forms.import_articleWizard_step1_pan.f_results = null;
	forms.import_articleWizard_step1_pan.elements.btn_next.enabled = false;
	 
	vWin.show(forms.import_articleWizard_dlg);
	vWin.setInitialBounds(-1, -1, 810, 610);
}

/**
 * @properties={typeid:24,uuid:"E5B451F3-F501-489C-B97D-E4AAB95AA239"}
 * @AllowToRunInFind
 */
function openSynopsisIn() {
	forms.temp_articles.foundset.clear()
	forms.temp_articles.controller.find()
	forms.temp_articles.filename = 'Inleiding op de synopsis'
	forms.temp_articles.controller.search()
	if (forms.temp_articles.foundset.getSize() > 0) {
		/** @type JSRecord<db:/sb/articles> */
		var record = forms.temp_articles.foundset.getRecord(1)
		forms.articles.openArticle(record.pk, 'Inleiding op de synopsis', '')
	}
}

/**
 * // TODO generated, please specify type and doc for the params
 * @param {String} [synopsis_no]
 *
 * @properties={typeid:24,uuid:"D4C2A45B-3DF8-4066-B8BE-D10069FF511C"}
 */
function openSynopsis(synopsis_no)
{
	if(application.getApplicationType() == APPLICATION_TYPES.WEB_CLIENT) {
		
		if(!synopsis_text) {
			synopsis_text = plugins.http.getPageData(application.getServerURL()+"/synopsis/index.html");
		}
		//synopsis_text = plugins.http.getPageData("https://web.studiebijbel.nl/synopsis/index.html");
		
		forms.web_sb_read.fv_title = "Synopsis";
		forms.web_sb_read.fv_html = synopsis_text;
		forms.web_sb_read.fv_print = null;
		
		forms.web_sb_form.elements.tab_notes.tabIndex = 4;
		forms.web_sb_form.elements.tab_notes.visible = true;
		
		application.showURL("#"+((synopsis_no)?synopsis_no:"top"), "_SELF");		
		return false;
	}
	forms.frm_synopsis_dlg.fv_html = "<html><body><iframe height=\"100%\" width=\"100%\" frameborder=\"0\" src=\"/synopsis/index.html#" + synopsis_no+ "\" border=0></iframe></body></html>";
	
	var vWindow = application.createWindow('frm_synopsys_dlg', JSWindow.MODAL_DIALOG);
	vWindow.title= 'Synopsis';
	vWindow.setInitialBounds(-1, -1, -1, -1);
	vWindow.show(forms.frm_synopsis_dlg);
}

/**
 * @properties={typeid:24,uuid:"5E25B983-F865-4831-9E6F-237EEA469411"}
 */
function sb_import_wordstudy() {
	var vWin = application.createWindow('wordstudyImport', JSWindow.MODAL_DIALOG);
	
	vWin.title = "i18n:cvb.lbl.wordstudy_wizard";
	
	vWin.resizable = true;
	
	forms.import_wordstudyWizard_dlg.elements.steps.tabIndex = 1;
	forms.import_wordstudyWizard_step1_pan.f_filename = null;
	forms.import_wordstudyWizard_step1_pan.f_results = null;
	forms.import_wordstudyWizard_step1_pan.elements.btn_next.enabled = false;
	 
	vWin.show(forms.import_wordstudyWizard_dlg);
	vWin.setInitialBounds(-1, -1, 810, 610)
}

/**
 * @properties={typeid:24,uuid:"C86F1E2A-3356-4605-9D2A-8B077D50BE63"}
 */
function SET_wordStudyVerion(vTestament) {
	var vSQL = "SELECT version_key, version_abbr FROM word_study_version WHERE version_testament = ? AND version_default = ?";
	var vDS = databaseManager.getDataSetByQuery('sb', vSQL, [vTestament, 1], 1);
	
	scopes.tools.output('vTestament => ' + vTestament);
	
	if(vDS.getMaxRowIndex() == 1)
	{
		forms.word_study.f_abbr = vDS[0]['version_abbr'];
		forms.word_study.f_version = vDS[0]['version_key'];
	}
	
}

/**
 * @properties={typeid:24,uuid:"510E23FC-8900-473E-AB36-82EF9559CB17"}
 */
function exitApp() {
	
	application.removeClientInfo(globals.sb_gCurrentOrgID.toString());
	application.removeClientInfo(globals.sb_gLoginName.toLowerCase());
	application.removeClientInfo(globals.sb_gOrganisation);
	
	sb_gLogoutName = sb_gLoginName;

	var serverUrl = '/servoy-webclient/templates/default/expired.html'
	application.showURL(serverUrl, '_self')
	application.exit();
	//application.closeSolution("StudyBible");
}

/**
 * @properties={typeid:24,uuid:"68DCD01C-C39C-43F6-B2C8-3F7C54D35B2F"}
 */
function readSettingsFile() {
	if(plugins.it2be_tools.server().fileExists("C:\cvb_settings.json")) {
		var vSettings = plugins.it2be_tools.server().readTXTFile("C:\cvb_settings.json");
		var vJSON = JSON.parse(vSettings);
		SETTINGS = vJSON;
	}
}


/**
 * @properties={typeid:24,uuid:"1FDC13DA-4870-422C-86D4-6C0896C13F67"}
 */
function openHelpURL() {
	//return false;
	var vUrl;
	if(sb_APP_getServerLang() == "NL") {
		vURL = "www.studiebijbel.nl/help/";
	} else {
		vURL = "www.bibliadeestudio.org/ayuda/";
		//application.showURL("https://www.bibliadeestudio.org/ayuda/", "_BLANK");
	}
	
	globals.DIALOGS.showInfoDialog("i18n:CVB.lbl.help", i18n.getI18NMessage("cvb.lbl.helpinfo", [vURL]));
	
//	if(application.getApplicationType() == APPLICATION_TYPES.SMART_CLIENT) {
		//application.showURL(vURL, "_BLANK");
/*	} else {
		forms.web_sb_webbrowser.fv_title = i18n.getI18NMessage('CVB.lbl.help')
		forms.web_sb_webbrowser.browse(vURL);
		forms.web_sb_form.elements.tab_notes.tabIndex = 7;
		forms.web_sb_form.elements.tab_notes.visible = true;
	}
*/	
}
	