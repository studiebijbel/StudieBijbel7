/**
 * @type String
 *
 * @properties={typeid:35,uuid:"06f2d5fe-73e5-4f37-885e-7606babdc4a8",variableType:12}
 */
var books_NT = 'New';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"20cb2340-69f4-4e40-a0dd-a187f5262f37",variableType:12}
 */
var books_OT = 'Old';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"9ddb5231-b66b-4358-a2f8-983b0320162b",variableType:4}
 */
var sb_print_notes = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"34e7a4e5-8b84-4bb9-a320-05773fc3a828",variableType:4}
 */
var sb_search_allbooks = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"7d6ff42f-64f8-4692-b5ab-e9e63ce48e89",variableType:12}
 */
var sb_search_bible_books = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"6ac9b6fc-3512-4549-b791-43b40df5cd93",variableType:12}
 */
var sb_search_bible_books_nt = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8ba3b635-ddab-4e50-aec3-20226d50b412",variableType:12}
 */
var sb_search_book_translations = 'SV\nNBG\nNBV';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"a6f5f6b7-9098-4fac-843a-e976c0849b58",variableType:4}
 */
var sb_search_books_all_nt = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"6e2ec5b2-4e21-44d4-99b6-38e13d7e59a8",variableType:4}
 */
var sb_search_books_all_ot = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"c4deab2b-d8dd-4e51-a4e3-109707fe1c20",variableType:4}
 */
var sb_search_commentaryNotes = 0;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"509c1ff9-56fc-44e6-83b8-5d1724ca1189",variableType:12}
 */
var sb_search_criteria = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"49433a11-2c80-4f35-814d-79c01448585a",variableType:4}
 */
var sb_search_in_biblebooks = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"657c42cf-8ea2-4a7a-ba39-3ed3e97c8096",variableType:4}
 */
var sb_search_in_studywords = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"ce34847e-6608-44c6-b8fa-0ae233b733a5",variableType:4}
 */
var sb_search_search_articles = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"784d8f3f-d6fc-4280-bb84-4ca465f46f8a",variableType:4}
 */
var sb_search_search_commentary = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"40b7e0d7-9d97-4593-86e4-5b815f159e8c",variableType:4}
 */
var sb_search_search_footnotes = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"e70aade3-bf88-4b36-978e-de6da9924f78",variableType:4}
 */
var sb_search_search_searchresults = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"98eb56b0-542d-403a-84dc-8a3243dda256",variableType:4}
 */
var sb_search_search_spacing = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"b2dc4600-54b8-442c-9862-5058b775ee5f",variableType:4}
 */
var sb_search_search_translations = 1;


/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"8fc843d9-79a1-4198-af10-8ca0de33d90e",variableType:4}
 */
var ALWAYSCHECKED = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"a0c080cd-8ae7-4d5d-b160-0e3049fccecb",variableType:4}
 */
var sb_print_bibleTranslations = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"364418c8-1d82-40c6-81b3-10a311e0cd5f",variableType:12}
 */
var sb_print_words = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"0c6be806-3254-4224-9486-d02ab9cf838f",variableType:4}
 */
var sb_print_wordStudy_concordance = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"f4699ee1-8f55-4f5a-8f1f-f39fe4168764",variableType:12}
 */
var about = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"21a3897f-397b-4386-8c14-4757452e5be8",variableType:12}
 */
var acceptLicense = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"1ba3e184-6e04-4c9e-a429-40c0bf51a760",variableType:12}
 */
var allConcordantie = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"3c43cc00-59dd-417d-a023-9970945b8d93",variableType:12}
 */
var article = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"0d2fe401-9be2-4fbb-8b3a-78210b6f8ee4",variableType:12}
 */
var article_names = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"1389f2fe-9803-4c6e-a991-4f19e68d976b",variableType:12}
 */
var article_title = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"e9dcb3cf-ef73-4a6b-8b51-c32d33740797",variableType:12}
 */
var bank = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"c86171d4-16a8-41f4-8883-b1b143d5ea02",variableType:12}
 */
var book = 'Matteüs';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"5dce0bf8-2b3b-41f8-9cca-e32f7478f0ca",variableType:4}
 */
var book_id;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"6dda3b49-a9c6-467f-a0df-39e1e3d08a46",variableType:4}
 */
var chapter = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"0689099f-9151-46e4-9890-d6f8aabb416b",variableType:4}
 */
var chapter_id;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"7481a7ec-fc11-4481-a23b-a98ae2fbf9de",variableType:8}
 */
var chapter_pk = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"2c53d5d6-67f9-48dd-b9f4-18a106430be6",variableType:4}
 */
var chkDevFix;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"b1209f12-08d7-45e9-b361-57798c13d551",variableType:4}
 */
var chkYouInThisVerse;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"db2e5305-f714-4105-9d3d-5d395fae8b34",variableType:4}
 */
var choise;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"779458ed-c43e-4617-a1bf-62fe32baf8bf",variableType:12}
 */
var code = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"4b5d24e1-a9a0-45ed-8616-5cbdf16923da",variableType:4}
 */
var colored;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"c2196439-10f6-4612-8c3e-9ae0901854da",variableType:12}
 */
var commentary = '';

/**
 * @properties={typeid:35,uuid:"75eb1d94-208a-417d-8cc7-cdb4e4a2864d",variableType:-4}
 */
var commentary_print;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"827639c2-82ac-4c48-a7f0-28de4f3a7d2a",variableType:12}
 */
var concordantie = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"17c89b07-7ee4-4fe0-9b33-c529b8bf2db1",variableType:4}
 */
var countUpdateWordStudy = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"4a2dce93-2208-4d9f-bb39-a18355d102c2",variableType:4}
 */
var countUpdateWordStudy2 = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"a9b2641d-243a-431a-9668-0d97511ceb19",variableType:4}
 */
var customMenuDone = 0;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"9abe3c24-593b-4dd3-abfa-e375b5cf43e4",variableType:12}
 */
var d_article_names = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"82e7ff66-72e7-445e-94cf-1b9a6e2fcd12",variableType:12}
 */
var d_commentary = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"abe58c3e-f131-4393-959d-4a53c4727340",variableType:12}
 */
var d_notes = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"6eecdd63-8109-4eb0-b448-e0ba70a9e167",variableType:12}
 */
var d_search_results = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"9aa7e548-37b7-42dc-8c8d-4ad3a1192b9d",variableType:12}
 */
var d_study_analyze = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"5cb0c9ab-b8ed-4f37-a847-55460090a1d8",variableType:12}
 */
var d_verse_translation = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"076f4b36-15c2-4aa5-893a-b08337735cb7",variableType:12}
 */
var d_words = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8b97e2fe-6efc-4d86-a92c-40dbe5923f13",variableType:12}
 */
var dataset = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"b4fe1810-251d-430a-b80f-6ee310a64d00",variableType:4}
 */
var didTreeViewInit = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"054d9102-2136-4bfa-8a92-acd59b02b8d9",variableType:8}
 */
var didTreeViewInitOriginal = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"0a5cd813-9b99-475f-86fa-737be49687d2",variableType:4}
 */
var doNotPopup;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"630e32ab-4889-429c-862b-0c08f253f07b",variableType:12}
 */
var doRollback = 'true';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"16139030-99b5-4790-bedd-b0894291c42c",variableType:12}
 */
var downloadURL = '<html><a href="www.google.com">google</a></html>';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8dc978bc-85c6-4e8a-a332-f4ee04e56f52",variableType:12}
 */
var event_instance_form = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"d53914a4-403b-49c9-8d26-5d41f0da9e1e",variableType:4}
 */
var event_instance_getX;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"c9f1cee7-44c7-4ab0-a0f8-72fd168e5425",variableType:4}
 */
var event_instance_getY;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"cd94af67-4921-41e6-a832-6fd4008bfc55",variableType:12}
 */
var flag = 'false';

/**
 * @properties={typeid:35,uuid:"a609d306-9daf-48ce-8acc-8492ff6f6282",variableType:-4}
 */
var formCount;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"ff7a9a6e-3f32-4323-99a1-0ee52d2edcab",variableType:12}
 */
var gElName = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"f8ec6df1-53a9-4e8f-941c-892471aaea14",variableType:12}
 */
var gFName = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"12969e3a-b00c-4537-8710-20fabac45cff",variableType:4}
 */
var griek;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"ea349e46-a375-4357-8484-1074dc33ba8f",variableType:12}
 */
var griek_version = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8741f5e5-1641-429e-8db2-a93333c7b319",variableType:12}
 */
var heb_version = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"e2ae2e87-030c-4ada-974f-7befa55a8698",variableType:12}
 */
var hml_note = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"9b5cdfd9-a983-456a-8f7e-f0dd1cb5f824",variableType:4}
 */
var iConcordance;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"a830f784-e17d-48c6-bfad-a496427631c2",variableType:4}
 */
var index = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"a52303c8-ff3d-466e-a969-f63469be2da2",variableType:12}
 */
var initWS = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"d14a7159-f8d5-4153-860d-df6bbc0441a2",variableType:12}
 */
var isLeaf = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"b89f56f8-6bee-4c52-80b9-72be8fbcd6c0",variableType:12}
 */
var licentieCode = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"7cf0449a-41fe-429e-bee1-ada3db34c233",variableType:12}
 */
var log = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"04d4e38c-0abb-43c1-a973-90134651b23d",variableType:4}
 */
var maxOTBook = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"591eb67f-e3ad-4122-bf12-654a78431443",variableType:4}
 */
var maxOTChapter = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"c433d796-0530-403c-b6c1-69ec6e46322d",variableType:4}
 */
var myWordStudyAnalyzePK;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"b4bef08f-40de-4b00-9136-38a722cc4ab8",variableType:12}
 */
var myWordStudyID = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"5c5f94a6-6f6d-48ee-aa50-1a4f0ae2e963",variableType:12}
 */
var newNote = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"7a98fabf-80f4-47cd-bbfd-e33560232cae",variableType:4}
 */
var nodes_id;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8aa86182-eca2-41ac-a19f-90533997f0e4",variableType:12}
 */
var notes = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"76bbbc89-2787-4792-aeda-170f8bf60371",variableType:4}
 */
var one = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"db4278c2-84ed-4371-8c8f-b4de68a48535",variableType:4}
 */
var ot = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"12e5a2ef-0d5a-4a45-98f1-6e16e7d82fdb",variableType:12}
 */
var otallcomment = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"bd67c196-a703-40ee-ac18-70d43380816b",variableType:4}
 */
var parent_id;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"ddde9932-e4f8-4df5-a438-8aabb5503449",variableType:4}
 */
var parent_id1 = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"af07cd1a-7187-4fa0-83d0-3e274ea9c81c",variableType:4}
 */
var parent_id2 = -1;

/**
 * @properties={typeid:35,uuid:"6010ce6e-e638-4610-8c52-93f8219aaf76",variableType:-4}
 */
var pinkenelis;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"fb22f66f-1f92-43a5-a8c2-bbf0736b1913",variableType:12}
 */
var postcode = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"0981d024-78aa-4f76-96ab-a181e1e607b2",variableType:12}
 */
var print1 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"fa700d53-cc82-4634-96e0-5c545a76ca12",variableType:12}
 */
var print2 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"7e86afac-d751-4d40-ac63-fa5efde5963b",variableType:12}
 */
var print3 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"bf61873d-dd94-42ef-abba-2af883b13136",variableType:12}
 */
var print4 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8b380e0f-fca0-49f3-97ea-d5ebea8ff93a",variableType:12}
 */
var print5 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"068d576e-9c02-417d-a855-a575b015a98a",variableType:12}
 */
var print6 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"3f6f024d-75ad-48b7-86fe-6e4625ca7deb",variableType:12}
 */
var print7 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"c3512f1f-1b72-4fd4-a219-9f61c6c1ca8b",variableType:12}
 */
var print8 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"806764fe-00c9-4a11-bc07-0a06c618818f",variableType:12}
 */
var print_abrev = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"dc8e1771-2d97-48d8-8cea-204bb997ab64",variableType:12}
 */
var print_AlleenGrieks = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"d25b17b9-6f54-4dae-b7d2-e9800cbd400a",variableType:12}
 */
var print_option = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"c4cf8f13-6def-4828-b98c-332f5cf46da0",variableType:12}
 */
var print_preview = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"ae30f1c8-8f4d-4547-8759-db9104edf112",variableType:12}
 */
var print_versions = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"ba31cc04-af00-470e-b5ce-044b546fec67",variableType:12}
 */
var print_WordStudy = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"833dc6d4-deed-4022-ad19-7c0069698361",variableType:12}
 */
var relationType = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"6efee254-4fa7-429d-b2f5-eeb4450dda21",variableType:4}
 */
var rowCount;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"b366ded2-dbd7-4c00-a6ff-5ec655391977",variableType:12}
 */
var sb_blockFootnoteLinkSearchForm = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"2efdaaf6-6645-4fb0-8572-9650bdba7053",variableType:4}
 */
var sb_frmOnHideCHK = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"aaff6a52-dc83-48cf-a5b6-14e805ccefdb",variableType:4}
 */
var sb_gBookID = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"f3b04412-2193-47d8-b664-53cc193e9f25",variableType:4}
 */
var sb_gBookIntegral = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"7b222d1c-f91c-4a2f-a37e-9a4547c17c20",variableType:4}
 */
var sb_gBookPartial = 2;

/**
 * @properties={typeid:35,uuid:"8380d754-e987-4a20-a09f-95144c0a6c3d",variableType:-4}
 */
var sb_gHistory;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"e96994d7-eb35-4265-935f-6691310d41d6",variableType:4}
 */
var sb_gHistoryPoint;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"6a55bb91-695c-4a93-8d8b-5d7f923d2082",variableType:4}
 */
var sb_gHistoryStart;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"251ac6b8-988c-4d12-b28b-a9a50e5bdb1e",variableType:4}
 */
var sb_gSelectedFootNoteNo = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"75187b0c-0be6-4179-ab20-ae3ef670342d",variableType:4}
 */
var sb_gShowOnline = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"da2f10bb-4031-4bfc-ab17-d172ac979cc1",variableType:12}
 */
var sb_gTestament = 'New';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"38ec611b-6c8c-4717-95e3-40c5967cc00e",variableType:12}
 */
var sb_gTestamentReal = 'OT';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"3ea7eed8-9e5a-4dde-8cda-217a879bffa9",variableType:12}
 */
var sb_gTranslationPartial = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"02965699-405b-466d-a59c-5dc987f87206",variableType:12}
 */
var sb_gTranslationPartial2 = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"96028cdc-508b-4744-bdb4-d90ff7dfad8b",variableType:4}
 */
var sb_importCommentarie = 0;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"32f934f6-0418-41d8-b6b4-673dc3f0207c",variableType:12}
 */
var sb_searchTransl_tabText = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"b57561fb-2024-4268-80e3-e18af6d9c094",variableType:12}
 */
var search_book = 'Alle boeken...';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"a84f99f7-b281-4353-84e3-5f04c9a7c081",variableType:12}
 */
var search_in = 'Bijbelvertalingen';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"e4521c08-7725-4df6-997e-fed6cd536424",variableType:12}
 */
var search_in1 = 'Bijbelvertalingen';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"d8c922b6-c988-4047-b46b-642f487bff28",variableType:12}
 */
var search_in2 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"76b2b1f6-0d53-42fa-b288-c33516a1432e",variableType:12}
 */
var search_in3 = '';

/**
 * @properties={typeid:35,uuid:"be8e2b38-4367-4250-a20d-a6f3210d7911",variableType:-4}
 */
var search_PRINT_sql;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"dc626864-06b6-4a7f-973a-d3028ffe876b",variableType:12}
 */
var search_results = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"56bb13d8-0082-4f9d-ad76-1b5c284a9289",variableType:12}
 */
var search_term1 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"9d1a789d-c39b-40ee-aa7d-1ccae95b1b59",variableType:12}
 */
var search_term2 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"86edd02b-98d6-47d0-bd49-dc7eca66b3a3",variableType:12}
 */
var search_translation = 'SV';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"863ac726-9b07-427d-924f-317b76ff591b",variableType:12}
 */
var search_type1 = 'Woord(en)';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"1af3caea-a347-41c5-96a2-c069710a9a43",variableType:12}
 */
var search_type2 = 'Woord(en)';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"4ed0fb93-8abd-4dbe-a81f-d02b2e349ea2",variableType:12}
 */
var select = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"99bf2a16-40e3-42dd-bf83-83da74f97799",variableType:4}
 */
var selected_node_id = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"7482f80a-e300-4bde-813f-6b4717d49481",variableType:4}
 */
var selected_verse_id;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"76aee26b-1fa3-4a21-8445-fa77f37d6910",variableType:12}
 */
var selectedWordStudy = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"ee0d6e53-e8bb-4e33-89b6-4a6d46503c76",variableType:12}
 */
var selectOT = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"84b2bc61-a081-4ee2-b90d-5dfdc84df0c4",variableType:4}
 */
var show_books = 1;

/**
 * @properties={typeid:35,uuid:"9277afcd-fef6-41b2-9b19-4d0576bd667d",variableType:-4}
 */
var showOverlapDLGHTML;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"444e6610-8df6-43ea-bc02-b4778f317c08",variableType:12}
 */
var sql_input = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"cc5e3a0d-c0b0-4f7b-8aff-c2503658e522",variableType:12}
 */
var sql_output = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"c0040ea2-ba55-4e19-b226-e2c9625d6d07",variableType:8}
 */
var step_size = 20;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"f538713f-56d9-4e85-b59e-e463103427d8",variableType:12}
 */
var straat = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"c8fbbc2d-6037-44d5-8217-db64d283d03a",variableType:12}
 */
var study_analyze = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"6672cc69-67b1-441e-b3e6-1d48976754f4",variableType:12}
 */
var synopsis = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"a7d6355e-7a3a-49ea-9c5f-d9a7b9751841",variableType:12}
 */
var temp = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"86683b7b-c9ee-4977-babf-59229bb7a0ed",variableType:4}
 */
var tempbookid;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"eedb92d9-2f91-4b65-ba9f-5d6b34739167",variableType:12}
 */
var test_html = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"85cbe2b7-e62c-45d4-9fed-f74ce3eaf6e9",variableType:12}
 */
var test_variable = 'x';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"9760d058-bbc0-4abb-904f-6a5b9416f0ce",variableType:12}
 */
var testamentFirstTime = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8f500696-ccd3-47b8-b625-71b0e0e26c94",variableType:12}
 */
var text = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"0d72845e-2b3c-403c-8b50-8bc6b076dbdb",variableType:12}
 */
var text_version = 'TR';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"13f22a83-73e3-43e3-82c8-5a68f5b4313d",variableType:12}
 */
var tot_search_results = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8ebcae35-6e2d-416d-95f0-4faab0048595",variableType:12}
 */
var translation = 'SV';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"7874b68d-14a2-4b2c-9dbf-8a73ca61f544",variableType:12}
 */
var translation2 = '';

/**
 * @properties={typeid:35,uuid:"b3f2d082-dba2-4698-b0e5-00932fa7bdf8",variableType:-4}
 */
var TreeArray;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"f0118e76-ec3e-43c7-9807-af0ccbc6d3a0",variableType:12}
 */
var Treedemo_showclicked = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"99daa704-1898-4739-8053-53216f21bae0",variableType:12}
 */
var TreeHTML = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"e09721c3-7b9a-4a76-b123-35f4fae90e2e",variableType:4}
 */
var TreeLAF = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"2c4ad411-fbe4-47da-a8b1-90af2b65f91b",variableType:12}
 */
var TreeNodeAction = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"e0420f94-a479-4e61-948e-81d3fa681da1",variableType:12}
 */
var TreeNodeSelected = '';

/**
 * @properties={typeid:35,uuid:"80d77948-b567-4bad-8429-3691e984fb99",variableType:-4}
 */
var uniqueComments;

/**
 * @properties={typeid:35,uuid:"f7c19a7c-e73d-4a92-a43f-71a21014f06e",variableType:-4}
 */
var uniqueVerses;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"15da750d-7dd1-4013-9f16-74ebd8506f72",variableType:12}
 */
var url = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"51ce9aba-8acc-4b54-90db-36edc76e10d1",variableType:4}
 */
var UsedHistory = 0;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"a06c193b-d1c3-464c-9155-f8403c94f3bb",variableType:12}
 */
var userClientNo = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"22faa951-8e2b-4538-ae50-71897f31a437",variableType:12}
 */
var userEmail = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"d6832fd7-910b-43be-9645-0c7bfb84ae87",variableType:12}
 */
var userInstallationCode = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"bf415d07-b72e-472d-a996-c7e4affb095a",variableType:12}
 */
var userName = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"a766c1ad-5f38-437b-b606-87c78234a8b8",variableType:12}
 */
var userPhone = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"a1aa46db-bc7d-4c4f-85d1-bd31ab19bdd5",variableType:4}
 */
var var_init = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"9b8a5dd1-a98b-44c1-b0c3-1308a4e529ee",variableType:4}
 */
var verse = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"6c45e6f2-5836-4453-9171-b0dbe8dafb64",variableType:4}
 */
var verse_id;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"1434e7b4-4d68-4551-9b3f-c90226c64512",variableType:4}
 */
var verse_id_calc_last;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"04fd5cbe-48a1-4f02-837f-fa4780f63678",variableType:12}
 */
var verse_path = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"a7f88307-bdff-4950-85e6-f0821f5dd3d9",variableType:12}
 */
var verse_translation = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8c246caf-2522-482f-8758-9a95a69a03ca",variableType:12}
 */
var version = '2.0 OT + NT- release candidate 5';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"c9ba5c62-5fbf-4a4c-bb8f-d37bba4ea8e8",variableType:12}
 */
var woonplatz = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8d2e00d3-b00f-43ca-aad4-23059de83a7b",variableType:12}
 */
var woordstudie = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"f48c026e-cbce-4cf3-a0dc-2c91796d96c9",variableType:12}
 */
var woordvormen = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"89e83684-7820-49d7-b1ed-0a51bc6e225b",variableType:4}
 */
var word_number;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"d0eb99c1-98aa-4220-92cd-5b028bf10547",variableType:12}
 */
var words = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"8c4616f5-12b9-4237-a85d-e436d64a4eba",variableType:12}
 */
var words_study = 'Woordstudie';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"45434bc4-3c1e-4e8e-9040-83044921a1ef",variableType:12}
 */
var x = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"d8dcce52-6b57-42ac-b5f3-83241684e587",variableType:4}
 */
var sb_export_exportAllBooks = 0;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"c42e5cbe-7078-49ba-9859-83a108086d1e",variableType:12}
 */
var sb_export_gFromVerse = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"42dbd5e0-1d06-4fe2-b6d5-0e0aa345bee7",variableType:12}
 */
var sb_export_gSelectedBookTrans = 'SV';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"160e79f7-056f-4ca9-8b40-1697210182de",variableType:12}
 */
var sb_export_gVerse = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"30788577-9cb5-48a0-8e38-81f696c0a72f",variableType:4}
 */
var sb_export_toChapter;


/**
 * @properties={typeid:24,uuid:"4c40a051-250b-4c38-ae61-6787d4b9702c"}
 */
function amb_checkEsp()
{
if(plugins.it2be_tools.arrayContains(globals.sb_gESServerURLs, globals.sb_gCurrentServerUrl))
{
	return true;
} else {
	return false;
}
}

/**
 * @properties={typeid:24,uuid:"2fd66dd0-c4c7-4ec2-bf4f-12aa17a4a32f"}
 */
function amb_removeWijzigMenu()
{
plugins.it2be_menubar.removeMenu(1);

var vNewMenu = plugins.it2be_menubar.addMenu(1);
vNewMenu.setText("i18n:servoy.menuitem.edit");
//vNewMenu.setMnemonic("w");

var menu = plugins.it2be_menubar.getMenu(1);

// when you don't define an index the item will be added at the last position
// this is what you usually do to build a new menu
var item = menu.addItem();

// create the settings for the specified menu item
// minimum settings are the text and method properties
// the method can be a global or form method
// be sure to enter the method WITHOUT '()' at the end
item.set("i18n:cvb.menu.howtocopy", null);

var item = menu.addItem();

// create the settings for the specified menu item
// minimum settings are the text and method properties
// the method can be a global or form method
// be sure to enter the method WITHOUT '()' at the end
item.set("i18n:cvb.menu.howtoselect", null);
}

/**
 * @properties={typeid:24,uuid:"c73a4c08-02dc-4dce-a020-5ed8ad5c8c0e"}
 * @AllowToRunInFind
 */
function completeConcordances()
{


var textData = plugins.file.readTXTFile('c:\\missing.txt');
if(textData.length > 0){
	var i = 0
	while(i < textData.length){
		var index1 = textData.indexOf('\t',i)
		var index2 = textData.indexOf('\n',index1)
		var pkNr = textData.substring(i,index1)
		var subscrId = textData.substring(index1+1,index2)
		i = index2+1
		forms.verses_fill_in.controller.find()
		forms.verses_fill_in.subscr_id = subscrId
		forms.verses_fill_in.controller.search()
		if(forms.verses_fill_in.foundset.getSize()>0){
			var record = forms.verses_fill_in.foundset.getRecord(1)
			var verseId = record.pk
			forms.word_concordance.controller.find()
			forms.word_concordance.pk = pkNr
			forms.word_concordance.controller.search()
			if(forms.word_concordance.foundset.getSize()>0){
				forms.word_concordance.foundset.setSelectedIndex(1);
				forms.word_concordance.verse_id = verseId
			}
			else {
				plugins.dialogs.showInfoDialog('','pk '+pkNr +' not found','OK' )
			}
		}
		else {
			plugins.dialogs.showInfoDialog('','subscr_id'+subscrId +' not found','OK' )
		}
	}
}

}

/**
 * @properties={typeid:24,uuid:"322e21a8-67c2-4446-aebb-b3ca9b4805ed"}
 * @AllowToRunInFind
 */
function convertArticleHebrTransToUnicode()
{
var vFoundset = databaseManager.getFoundSet('sb', 'articles');
vFoundset.loadAllRecords();

if(vFoundset.find())
{
	vFoundset.article_text = '%<font face="SIL Heb Trans">%';
	var vCount = vFoundset.search();
}


// Loop trough the foundset s
for(i = 1; i <= vFoundset.getSize(); i++)
{
	var vRecord = vFoundset.getRecord(i);
	var vHTML = vRecord.article_html;

	var vWordSplit = vRecord.article_html.split('<font face="SIL Heb Trans">');
	// Loop trough stringlengt
	for(k = 1; k < vWordSplit.length; k++)
	{	
		if(vWordSplit[k])
		{
			splitWord = vWordSplit[k].split('</font>');
			vHTML = utils.stringReplace(vHTML, splitWord[0], globals.stringToCharNo(splitWord[0]))
		}
	}
	vRecord.article_html = vHTML;
}

databaseManager.saveData();
plugins.dialogs.showErrorDialog('', 'done')

}

/**
 * @properties={typeid:24,uuid:"f2c23984-3f80-4fac-9c71-b31a00e978a2"}
 * @AllowToRunInFind
 */
function ConvertCommentaryFromPlainToHTML()
{
// Create foundset (fictive)
var vFoundset = databaseManager.getFoundSet('sb', 'commentary_blocks')
	vFoundset.loadAllRecords();
var vRecord;

var totalRecords = databaseManager.getFoundSetCount(vFoundset)

// Loop trough the foundset
for(var i = 1; i <= vFoundset.getSize(); i++)
//for(var i = 1; i <= 10; i++)
{
	if(i%10==0)
	{
		application.setStatusText("Commentary "+i + " of "+totalRecords);
		application.updateUI();
	}

	if(i%200==0)
	{
		databaseManager.saveData();
	}
	
	vRecord = vFoundset.getRecord(i);
	
	forms.commentary_blocks.controller.find()
	forms.commentary_blocks.pk = vRecord.pk
	forms.commentary_blocks.controller.search()

	
	// Book
	globals.book_id = vRecord.book_id;
	var vSQL = "SELECT book_name FROM books WHERE pk = " + vRecord.book_id;
	var vQuery = databaseManager.getDataSetByQuery('sb', vSQL, [], -1)
 	globals.book = vQuery.getValue(1,1);
	
	//text = 
	// Change the chapter:verse to links
	// If the plaintext does not exist
	if(!vRecord.plaintext){	vRecord.plaintext = globals.ConvertHtmlToText(vRecord.htmltext); }
	vRecord.htmltext = globals.ConvertTextToHtml(vRecord.plaintext);
}
databaseManager.saveData();
}

/**
 * @properties={typeid:24,uuid:"7509dc7a-9754-4c93-9a38-30d958ddef23"}
 * @AllowToRunInFind
 */
function ConvertFootnotesHtmlToPlainText()
{
// Create foundset (fictive)
var vFoundset = databaseManager.getFoundSet('sb', 'footnotes')
	vFoundset.loadAllRecords();
var vRecord;

var totalRecords = databaseManager.getFoundSetCount(vFoundset)

// Loop trough the foundset
for(var i = 1; i <= vFoundset.getSize(); i++)
//for(var i = 1; i <= 10; i++)
{
	if(i%10==0)
	{
		application.setStatusText("Footnote "+i + " of "+totalRecords);
		application.updateUI();
	}

	if(i%200==0)
	{
		databaseManager.saveData();
	}
	
	vRecord = vFoundset.getRecord(i);
	
	/*
	forms.commentary_blocks.controller.find()
	forms.commentary_blocks.pk = vRecord.pk
	forms.commentary_blocks.controller.search()
	*/
	/*
	// Book
	globals.book_id = vRecord.book_id;
	var vSQL = "SELECT book_name FROM books WHERE pk = " + vRecord.book_id;
	var vQuery = databaseManager.getDataSetByQuery('sb', vSQL, [], -1)
 	globals.book = vQuery.getValue(1,1);
	
	//text = 
	// Change the chapter:verse to links
	// If the plaintext does not exist
	if(!vRecord.plaintext){	vRecord.plaintext = globals.ConvertHtmlToText(vRecord.htmltext); }
	vRecord.htmltext = globals.ConvertTextToHtml(vRecord.plaintext);
	*/
	vRecord.plaintext = globals.ConvertHtmlToText(vRecord.htmltext)
}
databaseManager.saveData();
}

/**
 * @properties={typeid:24,uuid:"332db37d-5907-4721-8397-f2f8f62db5a0"}
 */
function copy()
{
application.setClipboardContent(forms[globals.gFName].elements[globals.gElName].getSelectedText()); 
}

/**
 * @properties={typeid:24,uuid:"69588e6e-2f57-43ae-beb3-447abb58cb29"}
 */
function createBackup()
{

// create backup file for the "notes" table
var query = 'select pk, verse_id, note from notes where note is not null';
var res = databaseManager.getDataSetByQuery("sb", query, null, 100000);

var count = res.getMaxRowIndex()

var aux = ''
for(var i=1;i <= count;i++){
	var record = res.getRowAsArray(i)
	aux = aux.concat('<note>')
	aux = aux.concat(record[0])
	aux = aux.concat(' ')
	aux = aux.concat(record[1])
	aux = aux.concat(' ')
	aux = aux.concat(record[2])
	aux = aux.concat('</note>\n')
}

var jsfile = plugins.file.getHomeDirectory()
var path = jsfile.getAbsolutePath()
var success = plugins.file.writeTXTFile(path+'/backupSBNotes.txt',aux);
if(success == true){
	plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.backupComplete'+ path +'\\backupSBNotes.txt','i18n:CVB.lbl.ok');
}
else {
	var thePressedButton = plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.backupNotComplete','i18n:CVB.lbl.ok');
}


}

/**
 * @properties={typeid:24,uuid:"e895fe5a-1bc2-4349-9263-573e2edddefb"}
 */
function cvb_setGreek()
{
if(globals.griek_version)
{
	globals.griek_version = '';
} else {
	globals.griek_version = i18n.getI18NMessage('onlyGreek')
}

forms.study_words.viewWordsForSelectedVerse();
}

/**
 * @properties={typeid:24,uuid:"84df43db-796e-42cf-8800-34352ac8b56b"}
 */
function cvb_setHebrew()
{
if(globals.heb_version)
{
	globals.heb_version = '';
} else {
	globals.heb_version = i18n.getI18NMessage('msg_onlyHebrew')
}

forms.study_words.viewWordsForSelectedVerse();
}

/**
 * @properties={typeid:24,uuid:"22a02639-fcee-4656-81d1-c59fe4d3bbad"}
 */
function cvb_setVersion()
{
globals.text_version = arguments[0]
forms.study_words.viewWordsForSelectedVerse();
}

/**
 * @properties={typeid:24,uuid:"83d2d14c-53e4-48b5-a878-b6447d71a02d"}
 */
function elementNameFocus()
{
globals.gElName = application.getMethodTriggerElementName()
globals.gFName = application.getMethodTriggerFormName()
}

/**
 * @properties={typeid:24,uuid:"ec9cd707-f646-47a8-afa6-f19d114b57b4"}
 */
function flink(event)
{
//if(globals.sb_edit_EditCommentaryBlocksVisible==1)
//{
//	forms.footnotes.foundset.setSelectedIndex(utils.stringToNumber(arguments[0]))
//	return
//}
if(globals.sb_blockFootnoteLinkSearchForm == 1)
{
	plugins.dialogs.showWarningDialog( "Warning", 'i18n:cvb.lbl.errorlinkfootnote')
	return false
}
if(globals.flag == "false")
{
	globals.flag = "true";
	globals.flink(arguments[0]);
}

var arg = ''
arg += arguments[0]

var text = globals.otallcomment

globals.sb_gSelectedFootNoteNo = arguments[0]
forms.book_notes.elements.notec.visible = true;
forms.book_notes.elements.note.visible = false;


//databaseManager.saveData()

var index1 = text.indexOf('<b>' + arg, 0)
var index2 = text.indexOf('<f>', index1)
if(index2<0)
	index2 = text.length - 1
		
	globals.notes = '<html><body><table><tr><td>' + text.substring(index1, index2) + '<br>' + globals.hml_note +  globals.otallcomment + '</td></tr></table></body></html>'
	//var dl = forms.sb_form.elements.bean_321.dividerLocation
	//forms.sb_form.elements.bean_321.dividerLocation = dl
	//forms.sb_form.elements.bean_321.bottomComponent = forms.sb_form.elements.tabs_book_notes
	
	forms.sb_form.resizeSplitTab(event,'book_notes')
	
}

/**
 * @properties={typeid:24,uuid:"38effe83-45dc-4544-b729-e7f67a9a1acb"}
 */
function getCommentaryAndFootnotesForSelectedVerse()
{
	// change this code, it contains a Sybase "list" function
	// this cannot be used in PostgreSQL
	
var query = "SELECT cb.title || cb.htmltext_short as commentary, list('<f><b>' || f.footnote_number || '</b></f>&nbsp;' || f.htmltext, '<br>'  ORDER BY f.footnote_number) as footnote, cb.pk FROM commentary_blocks cb LEFT OUTER JOIN footnotes f" +
	" ON cb.pk=f.commentary_block_id WHERE cb.htmltext IS NOT NULL AND length(cb.htmltext)>15" +
	" AND cb.book_id=" + globals.book_id +
	" AND (cb.chapter_from<" + globals.chapter + " or (cb.chapter_from=" + globals.chapter + "  and cb.verses_from<=" + globals.verse + "))" +
	" AND (cb.chapter_to>" + globals.chapter + " or (cb.chapter_to=" + globals.chapter + " and cb.verses_to>=" + globals.verse + "))" +
	" AND cb.active_now = 1" +
	" GROUP BY cb.title, cb.htmltext_short, cb.pk	ORDER BY cb.pk"


var res = databaseManager.getDataSetByQuery(forms.articles.controller.getServerName(),query,null, 100)
return res.getRowAsArray(1)
}

/**
 * @properties={typeid:24,uuid:"9e8c0c58-be10-4dec-bd02-6ec2412b2be5"}
 */
function getSolutionName()
{
var jsfile = plugins.file.getDesktopFolder()
var str = jsfile.getAbsolutePath()


}

/**
 * @properties={typeid:24,uuid:"6156066b-6a91-42ef-9f03-ccff0e583189"}
 */
function getTranslationsForVerse()
{
var verse_id = arguments[0]

var aSelection;
aSelection = globals.translation.split('\n');
// Add some semolicons!
for(i in aSelection)
{
	aSelection[i] = "'" + aSelection[i] + "'";
}

if(globals.sb_gTranslationPartial)
{
	var bSelection = globals.sb_gTranslationPartial.split('\n')
	// Add some semolicons!
	for(i in bSelection)
	{
		bSelection[i] = "'" + bSelection[i] + "'";
	}
}
var vSelString = aSelection.join(', ');
if(globals.sb_gTranslationPartial && bSelection.length > 0)
{
	vSelString += ", " + bSelection.join(', ');
}

var vSQL = "SELECT transl_text, translation_book_id FROM verse_translations"
		 + " INNER JOIN translation_books ON verse_translations.translation_book_id = translation_books.pk WHERE "
		 + "translation_book_id IN ( SELECT pk FROM translation_books WHERE code IN ("+vSelString+") ORDER BY nt_order ASC) "
		 + "AND transl_text IS NOT NULL AND transl_text!='' AND verse_id = "+verse_id
		 + " GROUP BY translation_books.nt_order, translation_book_id, transl_text"
		 + " ORDER BY translation_books.nt_order, translation_book_id"

res = databaseManager.getDataSetByQuery('sb', vSQL, null, -1)

var html = '<table>'
if(res != null) 
{
	for(var i=1;i<= res.getMaxRowIndex();i++) 
	{
		res.rowIndex = i
		var resTR = databaseManager.getDataSetByQuery('sb','select code from translation_books where pk='+res.getValue(i,2), null, 10000)
		resTR.rowIndex = 1
		html = html.concat('<TR><TD><B>')
		if (!arguments[1])
			html = html.concat(resTR.getValue(1,1))
		html = html.concat('</B>  ')
		html = html.concat(res.getValue(i,1)) + "<br>";
		html = html.concat('</TD></TR>')
	}
}

html += '</table>'

return html;

}

/**
 * @properties={typeid:24,uuid:"d3e121f9-875d-43d2-ad8a-1438ab6c7b60"}
 */
function getTranslationsForVerse_old()
{
var verse_id = arguments[0]



var res
if(!arguments[1])
 	res = databaseManager.getDataSetByQuery('sb','select transl_text,translation_book_id from verse_translations where verse_id = ' + verse_id + ' group by translation_book_id, transl_text', null, 10000)
else
	res = databaseManager.getDataSetByQuery('sb','select transl_text,translation_book_id from verse_translations where translation_book_id=1000001 and verse_id = ' + verse_id, null, 1)

var html = '<table>'
if(res != null) 
{
	for(var i=1;i<= res.getMaxRowIndex();i++) 
	{
		res.rowIndex = i
		var resTR = databaseManager.getDataSetByQuery('sb','select code from translation_books where pk='+res.getValue(i,2), null, 10000)
		resTR.rowIndex = 1
		html = html.concat('<TR><TD><B>')
		if (!arguments[1])
			html = html.concat(resTR.getValue(1,1))
		html = html.concat('</B>  ')
		html = html.concat(res.getValue(i,1));
		html = html.concat('</TD></TR>')
	}
}

html += '</table>'

return html;

}

/**
 * @properties={typeid:24,uuid:"33408f4a-394e-4735-8247-1f295ec245aa"}
 */
function getVerseIdFromTlink()
{
var link = arguments[0]

//var match = link.match(/([A-Z][^.]+\.)(?:(\d+)(?::(\d+))?(v+)?(?:[\-–](\d+)(?::(\d+))?)?)?/);

//var match = link.match(/(\d?\s?[A-Z][^.]?(.)|+\.)(?:(\d+)(?::(\d+))?(v+)?(?:[\-–](\d+)(?::(\d+))?)?)?/);
var match = link.match(/(\d?\s?[A-Z][^\d]+)(?:(\d+)(?::(\d+))?(v+)?(?:[\-–](\d+)(?::(\d+))?)?)?/);



if (match != null) {
	var abbr = match[1]
	var chap = match[2]
	var chapTo = chap
	if(match[5])
		chapTo = match[5]
	var vers = ""
	if(match[3])
		vers = match[3]
	var versend = vers
	if(match[6])
		versend = match[6]
	
	//Treat the case of v and vv
	if(match[4])
		versend = '' + (utils.stringToNumber(versend) + match[4].length)
	
} else
{
	// Match attempt failed
	return new Array()
}


/* Old code 
var index1 = link.indexOf('.', 0)

var abbr = link.substring(0, index1+1)
var abbrshort = link.substring(0, index1)
var abbrshortdot = link.substring(0, index1-1) + '.'

var index2 = link.indexOf(':', index1)
var index3 = link.indexOf('-', index2)
var index4 = link.indexOf(':', index3)

var chap = link.substring(index1+1, index2)
var vers = link.substring(index2+1)

//1 chapter book
if(index2<0)
{
	chap = 1
	vers = link.substring(index1+1)
}

var versend = vers
if(index3>0)
{
	if(index2>=0)
	{
		vers = link.substring(index2+1, index3)
		versend = link.substring(index4+1)
	}
	else
	{
		vers = link.substring(index1+1, index3)
		versend = link.substring(index3+1)
	}
}
*/


switch(abbr)
{
	case '1 Cor.':
	case '1Cor.': 	abbr = '1Kor.'
					break;
	case '2 Cor.':
	case '2Cor.': 	abbr = '2Kor.'
					break;
	case 'Col.':	abbr = 'Kol.'
					break;
	case '1 Thess.':
	case '1Thess.': abbr = '1Tes.'
					break;
	case '2 Thess.':
	case '2Thess.': abbr = '2Tes.'
					break;
	case 'Jac.':	abbr = 'Jak.'
					break;
	case '1 Petr.':
	case '1Petr.': 	abbr = '1Pet.'
					break;
	case '2 Petr.':
	case '2Petr.': 	abbr = '2Pet.'
					break;
	case '1 Sam.':	abbr = '1Sam.'
					break;
	case '2 Sam.':	abbr = '2Sam.'
					break;
	case '1 Kon.':	abbr = '1Kon.'
					break;
	case '2 Kon.':	abbr = '2Kon.'
					break;
	case '1 Kron.':
	case '1Kron.': 	abbr = '1Kr.'
					break;
	case '2 Kron.':
	case '2Kron.': 	abbr = '2Kr.'
					break;
	case 'Esther':	abbr = 'Est.'
					break;
	case 'Pred.':	abbr = 'Pr.'
					break;
	case 'Ezech.':
	case 'Ez.': 	abbr = 'Eze.'
					break;
	case 'Obadja':	abbr = 'Ob.'
					break;
	case 'Micha':	abbr = 'Mi.'
					break;
	case 'Zef.':	abbr = 'Sef.'
					break;
	case 'Matt.': 	abbr = 'Mat.'
					break;								
}

var query = 'select v.pk from verses v, books b, chapters c where v.chapter_id=c.pk and c.book_id=b.pk and b.abbreviation='
query +='\'' +abbr + '\'' + ' and c.chapter_no>=' + chap  + ' and c.chapter_no<=' + chapTo
if(vers)
{
	query += ' and ((v.verse_number>=' + vers + ' and c.chapter_no='+chap +') or c.chapter_no>' + chap + ')'
	
 	query += ' and ((v.verse_number<=' + versend + ' and c.chapter_no=' + chapTo + ') or c.chapter_no<' + chapTo + ')'
}


if(globals.sb_demo_chk == 1)
{
	query += " AND v.demo_chk = 1";
}

query +=' order by v.pk'



var res = databaseManager.getDataSetByQuery('sb', query, null, 50)

if(res.getMaxRowIndex()>0)
{
	return res.getColumnAsArray(1)
}

return new Array()
}

/**
 * @properties={typeid:24,uuid:"f31ed911-50c5-4d6f-b0c4-4890178e4b6b"}
 */
function goThroughVerseTranslations()
{
var res = databaseManager.getTableCount(forms.verses_fill_in.foundset)

for(var i=1; i<=res; i++){
	if(i%100==0)
	{
		application.setStatusText('Updating ' + i + ' of ' + res)
		application.updateUI(0)
	}
	forms.verses_fill_in.controller.setSelectedIndex(i)
}
}

/**
 * @properties={typeid:24,uuid:"7c3d9f06-3e82-4753-a73a-022ddb844515"}
 */
function ImportFromManuscriptInfo()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,code_no,hf,\"text\",n25,n27,tr,verse_id from manuscript_info ',null, 20000)


for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_manuscript_info.controller.newRecord()	
		forms.fill_manuscript_info.pk = res[1]
		forms.fill_manuscript_info.code_no =res[2]
		forms.fill_manuscript_info.hf = res[3]
		forms.fill_manuscript_info.manuscript_text = res[4]
		forms.fill_manuscript_info.n25 = res[5]
		forms.fill_manuscript_info.n27 = res[6]
		forms.fill_manuscript_info.tr = res[7]
		forms.fill_manuscript_info.verse_id = res[8]
		forms.fill_manuscript_info.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"6d35082b-4b0b-489b-962d-ca39c081f675"}
 */
function importFromSBToAll()
{
//globals.ImportFromManuscriptInfo();	done	
//globals.ImportFromWordVariants();		done


//globals.ImportFromSBWebToBooks('Old'); done
//globals.ImportFromSBWebToChapters();	done	
//globals.ImportFromSBWebToVerses();	done

//globals.ImportFromSBWebToWords();			done
//globals.ImportFromSBWebToArticles();	done
//globals.ImportFromSBWebToBookArticle();	ok
//globals.importToBookInleiding();		ok
//globals.importToParagraphs();			done
//globals.importToSynopsis();			ok
//globals.importToSynopsisRef();		ok
//globals.importToSynopsisText();		ok
//globals.ImportFromSBWebToWordStudy();	ok
//globals.ImportFromSBWebToVerseTranslation();	done
//globals.ImportFromSBWebToTranslationBooks();	ok
//globals.importToWordStudyAnalyze();										ok
//globals.importToAnalyzeConcordance();										ok
//globals.importToWordStudyConcordance();		done

}

/**
 * @properties={typeid:24,uuid:"045fb175-e0a4-46c1-8a0b-beaed5bcbc7c"}
 */
function ImportFromWordVariants()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,code_no,hf,mode_hf,mode_n25,mode_n27,mode_tr,n25,n27,subscr_id,tr,word_id from word_variants ',null, 50000)


for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_word_variants.controller.newRecord()	
		forms.fill_word_variants.pk = res[1]
		forms.fill_word_variants.code_no = res[2]
		forms.fill_word_variants.hf = res[3]
		forms.fill_word_variants.mode_hf = res[4]
		forms.fill_word_variants.mode_n25 = res[5]
		forms.fill_word_variants.mode_n27 = res[6]
		forms.fill_word_variants.mode_tr = res[7]
		forms.fill_word_variants.n25 = res[8]
		forms.fill_word_variants.n27 = res[9]
		forms.fill_word_variants.subscr_id = res[10]
		forms.fill_word_variants.tr = res[11]
		forms.fill_word_variants.word_id = res[12]
		forms.fill_word_variants.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"10722275-f4b9-4d50-b645-a1379f66c7f5"}
 * @AllowToRunInFind
 */
function importMissingWS()
{
forms.fill_in_words_study.controller.find()
forms.fill_in_words_study.word_strong = '0252'
forms.fill_in_words_study.controller.search()
var record = forms.fill_in_words_study.foundset.getRecord(1)
var res2 = databaseManager.getDataSetByQuery('sb_web','select pk,original,transliteration,\"number\",word_study_id,\"translation\" from word_study_analyze where word_study_id='+record.pk,null, 10000)
	
	for (var j=1; j<=res2.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res2.getMaxRowIndex())
		application.updateUI()
	    //res2.rowIndex = j
		forms.fill_word_study_analyze.controller.newRecord()	
		//application.output(res2.getValue(j,1))
		forms.fill_word_study_analyze.pk = res2.getValue(j,1)
		forms.fill_word_study_analyze.original = res2.getValue(j,2)
		forms.fill_word_study_analyze.transliteration = res2.getValue(j,3)
		forms.fill_word_study_analyze.word_number = res2.getValue(j,4)
		forms.fill_word_study_analyze.word_study_id = res2.getValue(j,5)
		forms.fill_word_study_analyze.word_translation = res2.getValue(j,6)
		forms.fill_word_study_analyze.controller.saveData()
		
	}

}

/**
 * @properties={typeid:24,uuid:"e1a8cea7-7d68-4911-8040-8a6ca7a209b3"}
 * @AllowToRunInFind
 */
function importNBVTranslation()
{
var translationFolder = "D:\\Adi\\Work\\StudyB\\new version\\NBV-OTNT_OSIS_2007-09-25\\"

var files = plugins.file.getFolderContents(translationFolder)

var length = files.length
for(var i=39; i<length; i++)
{
	var file = files[i]
	
	var text = plugins.file.readTXTFile(file)
	
	var bookMatch =text.match("<title level=\".\">(.+)</title></title>")
	var book = bookMatch[1]
	
	var chapters = text.split("<chapter sID=")
		
	var chapterLength = chapters.length

	if(chapterLength==1)
	{
	
	text = "<chapter sID=" + text
	chapters = text.split("<chapter sID=")
	chapterLength = chapters.length
	}
	
	for(var j = 1; j<chapterLength; j++)
	{
		var chapterText = chapters[j]
		var regChapter = /([\d]+)/gi
		var chapterMatch = chapterText.match(regChapter)
	//	var chapter = chapterMatch[0]
		var chapter = j
	//application.output(chapter)
		
		var verses = chapterText.split(" sID=")
		for(var k=1; k<verses.length; k++)
		{
			var verseText = verses[k]
			
			var indexNumber = verseText.indexOf("."+chapter+".",0)
			var indexQuotes = verseText.indexOf("\"",indexNumber)		
			var indexSpace = verseText.indexOf(" ",indexNumber)	
			
			var finalI = indexQuotes
			if(indexQuotes+1 != indexSpace)
				finalI = indexSpace	
			var verse = verseText.substring(indexNumber+("."+chapter+".").length, finalI)
		//	var verse = k
			
			var indexStart = verseText.indexOf("/>", indexQuotes)
			var indexEnd = verseText.indexOf("<note osisID=", indexStart)
			if(indexEnd<indexStart)
				indexEnd = verseText.indexOf("<verse eID=", indexStart)
			
			var content = verseText.substring(indexStart+2, indexEnd)
			
			forms.chapters_fill_in.controller.loadAllRecords()
			forms.chapters_fill_in.controller.find()
			forms.chapters_fill_in.book_id = i+1
			forms.chapters_fill_in.chapter_no = chapter
			forms.chapters_fill_in.controller.search()
			
			forms.verses_fill_in.controller.loadAllRecords()
			forms.verses_fill_in.controller.find()
			forms.verses_fill_in.chapter_id = forms.chapters_fill_in.pk
			forms.verses_fill_in.verse_number = verse
			forms.verses_fill_in.controller.search()
					
			if(forms.verses_fill_in.foundset.getSize()==0)
			{
				continue;
			}
			
			forms.fill_verse_translation.controller.loadAllRecords()
			forms.fill_verse_translation.controller.find()
			forms.fill_verse_translation.verse_id = forms.verses_fill_in.pk
			forms.fill_verse_translation.translation_book_id = 1000005
			forms.fill_verse_translation.controller.search()
			if(forms.fill_verse_translation.foundset.getSize()==0)
			{
				forms.fill_verse_translation.controller.newRecord()
			}
			
			forms.fill_verse_translation.verse_id = forms.verses_fill_in.pk
			forms.fill_verse_translation.translation_book_id = 1000005
			forms.fill_verse_translation.transl_text = globals.TextReplaceSpecialChars(content)
			forms.fill_verse_translation.controller.saveData()
		}
	}
}
}

/**
 * @properties={typeid:24,uuid:"8b24c2cd-5e19-4890-b713-1287135f11a2"}
 */
function importToAnalyzeConcordance()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,analyze_id,concordance_id from analyze_concordance ',null, 10000)

for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_analyze_concordance.controller.newRecord()	
		forms.fill_analyze_concordance.pk = res[1]
		forms.fill_analyze_concordance.analyze_id = res[2]
		forms.fill_analyze_concordance.concordance_id = res[3]
		forms.fill_analyze_concordance.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"862c1cfe-21a5-47f2-ad42-65b36e83fe70"}
 */
function importToBookInleiding()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,article_id,book_id from book_inleiding',null, 100000)

for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.book_inleiding.controller.newRecord()	
		forms.book_inleiding.pk = res[1]
		forms.book_inleiding.article_id = res[2]
		forms.book_inleiding.book_id = res[3]
		forms.book_inleiding.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"99c86a46-73aa-4912-a16b-247ea0ac0298"}
 * @AllowToRunInFind
 */
function importToParagraphs()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,article_id,image,link,link_text,link_url,text,title,weight from paragraphs',null, 1000000)
var length = res.getMaxRowIndex()
for (var j=1; j<=res.getMaxRowIndex();j++){
		if(j%10==0)
		{
			application.setStatusText(''+ j + ' of '+length)
			application.updateUI()
		}
		
		forms.fill_paragraphs.controller.find()
		forms.fill_paragraphs.pk = res.getValue(j,1)
		forms.fill_paragraphs.controller.search()
		if(forms.fill_paragraphs.foundset.getSize()==0)
		{
			forms.fill_paragraphs.controller.newRecord()	
			forms.fill_paragraphs.pk = res.getValue(j,1)
		}
		forms.fill_paragraphs.article_id = res.getValue(j,2)
		forms.fill_paragraphs.image = res.getValue(j,3)
		forms.fill_paragraphs.link = res.getValue(j,4)
		forms.fill_paragraphs.link_text = res.getValue(j,5)
		forms.fill_paragraphs.link_url = res.getValue(j,6)
		if(res.getValue(j,7) != null) {
		var newE = res.getValue(j,7).replace('e^','&#275;')
		var newA = newE.replace('a^','&#257;')
		var newI = newA.replace('i^','&#299;')
		var newO = newI.replace('o^','&#333;')
		var newU = newO.replace('u^','&#363;')
		forms.fill_paragraphs.paragraph_text = newU
		}
		else
			forms.fill_paragraphs.paragraph_text = res.getValue(j,7)
		forms.fill_paragraphs.title = res.getValue(j,8)
		forms.fill_paragraphs.weight = res.getValue(j,9)
		forms.fill_paragraphs.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"24764296-9a4e-4fae-8fba-5ebeaf9ba3bc"}
 */
function importToSynopsis()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,joh_verse_from,joh_verse_to,luc_verse_from,luc_verse_to,marc_verse_from,marc_verse_to,matt_verse_from,matt_verse_to,synopsis_name from synopsis',null, 1000000)

for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_synopsis.controller.newRecord()	
		forms.fill_synopsis.pk = res[1]
		forms.fill_synopsis.joh_verse_from = res[2]
		forms.fill_synopsis.joh_verse_to = res[3]
		forms.fill_synopsis.luc_verse_from = res[4]
		forms.fill_synopsis.luc_verse_to = res[5]
		forms.fill_synopsis.marc_verse_from = res[6]
		forms.fill_synopsis.marc_verse_to = res[7]
		forms.fill_synopsis.matt_verse_from = res[8]
		forms.fill_synopsis.matt_verse_to = res[9]
		forms.fill_synopsis.synopsis_name = res[10]
		forms.fill_synopsis.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"f23b5208-a7cf-4e99-86f4-5356b1895554"}
 */
function importToSynopsisRef()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,text_id,verse_from,verse_top from synopsis_ref',null, 100000)

for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_synopsis_ref.controller.newRecord()	
		forms.fill_synopsis_ref.pk = res[1]
		forms.fill_synopsis_ref.text_id = res[2]
		forms.fill_synopsis_ref.verse_from = res[3]
		forms.fill_synopsis_ref.verse_top = res[4]
		forms.fill_synopsis_ref.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"e872c60b-f692-4758-b423-89465df0fca0"}
 */
function importToSynopsisText()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,syn_number,text_jh,text_lk,text_mk,text_mt from synopsis_text',null, 100000)

for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_synopsis_text.controller.newRecord()	
		forms.fill_synopsis_text.pk = res[1]
		forms.fill_synopsis_text.syn_number = res[2]
		forms.fill_synopsis_text.text_jh = res[3]
		forms.fill_synopsis_text.text_lk = res[4]
		forms.fill_synopsis_text.text_mk = res[5]
		forms.fill_synopsis_text.text_mt = res[6]
		forms.fill_synopsis_text.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"8531d4fc-f84a-420c-b3e8-8bcc93c17da1"}
 */
function importToVerseCritics()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,hf_greeksource,hf_transeditions,n25_greeksource,n25_transleditions,n27_greeksource,n27_transleditions,order,verse_id from verse_critics',null, 100000)

for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_verse_critics.controller.newRecord()	
		forms.fill_verse_critics.pk = res[1]
		forms.fill_verse_critics.hf_greeksource = res[2]
		forms.fill_verse_critics.hf_transeditions = res[3]
		forms.fill_verse_critics.n25_greeksource = res[4]
		forms.fill_verse_critics.n25_transleditions = res[5]
		forms.fill_verse_critics.n27_greeksource = res[6]
		forms.fill_verse_critics.n27_transleditions = res[7]
		forms.fill_verse_critics.order_no = res[8]
		forms.fill_verse_critics.verse_id = res[9]
		forms.fill_verse_critics.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"0b980926-f2a9-42a6-9727-302ed56a4e13"}
 */
function importToWordDetails()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,explanation,original,word_strong,word_transliteration from word_details',null, 100000)

for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_word_details.controller.newRecord()	
		forms.fill_word_details.pk = res[1]
		forms.fill_word_details.explanation = res[2]
		forms.fill_word_details.original = res[3]
		forms.fill_word_details.word_strong = res[4]
		forms.fill_word_details.word_transliteration = res[5]
		forms.fill_word_details.controller.saveData() 
}
}

/**
 * @properties={typeid:24,uuid:"2d84a6dc-fe88-4204-b3dd-1fe2000df90f"}
 */
function importToWordStudyAnalyze()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,original,transliteration,\"number\",word_study_id,\"translation\" from word_study_analyze ',null, 10000)

for (var j=1; j<=res.getMaxRowIndex();j++){
		application.setStatusText(''+ j + ' of '+res.getMaxRowIndex())
		application.updateUI()
	    res.rowIndex = j
		forms.fill_word_study_analyze.controller.newRecord()	
		forms.fill_word_study_analyze.pk = res[1]
		forms.fill_word_study_analyze.original = res[2]
		if( res[3] != null){
		var newE = res[3].replace('e^','&#275;')
		var newA = newE.replace('a^','&#257;')
		var newI = newA.replace('i^','&#299;')
		var newO = newI.replace('o^','&#333;')
		var newU = newO.replace('u^','&#363;')
		forms.fill_word_study_analyze.transliteration = newU
		}
		else
			forms.fill_word_study_analyze.transliteration = res[3]
		forms.fill_word_study_analyze.word_number = res[4]
		forms.fill_word_study_analyze.word_study_id = res[5]
		forms.fill_word_study_analyze.word_translation = res[6]
		forms.fill_word_study_analyze.controller.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"34ff5d81-5af5-4e5a-8438-adee7229cac8"}
 */
function importToWordStudyConcordance()
{
var res = databaseManager.getDataSetByQuery('sb_web','select pk,tc_code,verse_id,word_analyze_id,\"text\" from word_study_concordance WHERE pk>1056209 ORDER BY pk',null, 100000)
var length = res.getMaxRowIndex()

for (var j=1; j<=length;j++){
	    res.rowIndex = j
		if(j%10==0)
		{
			application.setStatusText(''+ j + ' (' + res[1] + ')' + ' of '+length)
			application.updateUI()
		}

		forms.fill_word_study_concordance.controller.newRecord()	
		forms.fill_word_study_concordance.pk = res[1]
		forms.fill_word_study_concordance.tc_code = res[2]
		forms.fill_word_study_concordance.verse_id = res[3]
		forms.fill_word_study_concordance.word_analyze_id = res[4]
		forms.fill_word_study_concordance.word_text = res[5]
		forms.fill_word_study_concordance.controller.saveData()
}
		
}

/**
 * @properties={typeid:24,uuid:"e762489c-2c78-404e-8812-769f0abfbfb2"}
 */
function init()
{
/**************************************************************************************
Method: 	globals.init();

Created:	Unknown
Modifier:	Karel Broer 02.03.2009 //remove all toolbars when application is not developer

Purpose:	Startup method

Arguments:	- 

**************************************************************************************/	

//plugins.SB_NT.setWindowIcon('SB.png')
//globals.sb_MENU_setMenubar();

/*


//globals.maxOTChapter = 0;
//globals.maxOTChapter = 403;
//globals.maxOTBook = 14;

//globals.version = globals.maxOTChapter > 0 ?
//"2.0" : "2.0 NT"



//globals.testLPWeb()



//Get the application type
var vClientType = application.getApplicationType()


//remove all toolbars when application is not developer

if(vClientType != 3){
	
	if(globals.customMenuDone == 0)
	{
	globals.modifyMenu();
	globals.customMenuDone = 1
	}
	
	//remove import and export functions
	plugins.excelxport.exportEnabled = false
	plugins.excelxport.importEnabled = false
	plugins.textxport.exportEnabled = false
	plugins.textxport.importEnabled = false

	//remove toolbars
	application.setToolbarVisible('edit', false)
	application.setToolbarVisible('align', false)
	application.setToolbarVisible('design', false)
	application.setToolbarVisible('draw', false)
	application.setToolbarVisible('text', false)
	application.setToolbarVisible('distribute', false)

}

//application.setStatusText('gereed')
application.updateUI()

*/




}

/**
 * @properties={typeid:24,uuid:"8e51230f-a0c1-4022-bc1a-e74e52b65cc6"}
 */
function isOT()
{
return (globals.chapter_pk < 930)
}

/**
 * @properties={typeid:24,uuid:"434b20da-5269-41fa-8cfd-b6056a65a9c0"}
 */
function licenceUpdate()
{

var myfile = plugins.file.showFileOpenDialog();
if(myfile != null){
	var srcFile = myfile.getAbsolutePath()
	var extension = srcFile.substring(srcFile.length-4,srcFile.length)
	
	if( extension == '.lic') {
		if(utils.stringMiddle(application.getOSName(),1,7) == "Windows") 	{ 
			file = plugins.file.convertStringToJSFile('c:\\WINDOWS')
			if(file.exists()){
				destFile = 'c:\\WINDOWS\\SB.lic'
			}
			else {
				file = plugins.file.convertStringToJSFile('c:\\WinNT')
				if(file.exists()){
					destFile = 'c:\\WinNT\\SB.lic'
				}
				else {
					plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.windowsFolderNotFound','i18n:CVB.lbl.ok');
				}
			}
		}

		var success = plugins.file.copyFile(srcFile, destFile )
		if(success == false){
			plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.cannotCopyLicence','i18n:CVB.lbl.ok');
		} else {
			plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.refreshLicence','i18n:CVB.lbl.ok')
		}
	}
	else {
		plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.invalidLicense','i18n:CVB.lbl.ok')
	}
}

}

/**
 * @properties={typeid:24,uuid:"9219ad58-c7fa-4366-a235-aae56289c39b"}
 */
function modifyMenu()
{
/**************************************************************************************
Method: 	globals.modifyMenu();

Created:	Unknown
Modifier:	Karel Broer 02.03.2009 //do not remove menubars from developer

Purpose:	Set Servoy menu

Arguments:	- 

**************************************************************************************/	

//Do not modify menu in web client
var vClientType = application.getApplicationType()
if(vClientType == 5)
	return

//do not remove menubars from developer
if(vClientType != 3){
	for(var i = plugins.it2be_menubar.getMenuCount()-1 ; i >= 0 ; i--)
	{
		var menu_item = plugins.it2be_menubar.getMenu(i)
		if(menu_item.getText()!="Tools")
			plugins.it2be_menubar.removeMenu(i)
	}
}

//plugins.it2be_menubar.removeMenu(0,1,2,3,4,6,7,8)

//File menu
var menu_file = plugins.it2be_menubar.addMenu()
menu_file.setText('i18n:CVB.lbl.file')
var menu_exit = menu_file.addItem()
menu_exit.set('i18n:CVB.lbl.quit', globals.quit);

//Edit menu
//get the MenubarMenu object from the MenubarMenuBar
var menu = plugins.it2be_menubar.addMenu();
//set the MenubarMenu object
menu.set("i18n:servoy.menuitem.edit");
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Kopieer",globals.copy,null,null,"control C");
//get the MenubarMenuItem object from the (Sub-)menu
item = menu.addItem();
//set the MenubarMenuItem object
item.set("Selecteer alles",globals.selectAll,null,null,"control A");

//Options menu
//get the MenubarMenu object from the MenubarMenuBar
var menu = plugins.it2be_menubar.addMenu();
//set the MenubarMenu object
menu.set("i18n:CVB.lbl.options");
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Backup eigen notities",globals.createBackup);
//get the MenubarMenuItem object from the (Sub-)menu
item = menu.addItem();
//set the MenubarMenuItem object
item.set("Herstel eigen notities",globals.updateNotes);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Software registreren",globals.activateLicence);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Installeer licentie",globals.licenceUpdate);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Activeer log",globals.activateLog);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Deactiveer log",globals.deactivateLog);

//Help menu
//get the MenubarMenu object from the MenubarMenuBar
var menu = plugins.it2be_menubar.addMenu();
//set the MenubarMenu object
menu.set("i18n:CVB.lbl.help");

var vUrl = application.getServerURL()
//plugins.dialogs.showErrorDialog('', vUrl);

if(!plugins.it2be_tools.arrayContains(globals.sb_gESServerURLs, globals.sb_gCurrentServerUrl))
{
	//get the MenubarMenuItem object from the (Sub-)menu
	var item = menu.addItem();
	//set the MenubarMenuItem object
	item.set("i18n:CVB.lbl.help",forms.sb_form.openHelp);
}
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("i18n:servoy.menuitem.about",globals.openAbout);

}

/**
 * @properties={typeid:24,uuid:"a79e336c-9874-4f77-b9cf-0c431a28f207"}
 * @AllowToRunInFind
 */
function newWinSearch()
{


globals.d_search_results = globals.search_results
application.showFormInDialog(forms.d_search_results,50,50,500,500)

}

/**
 * @properties={typeid:24,uuid:"b77ecb92-f211-4d70-81f6-5b6bb5899a78"}
 */
function node_selected()
{
forms.sb_form.node_selected(arguments[0], arguments[1])
}

/**
 * @properties={typeid:24,uuid:"b4a160f2-04f0-47cb-af9d-8a4de4f4a8c3"}
 */
function onClose()
{
//plugins.Kydome_Menus.resetMenuBar();

var file = plugins.file.convertStringToJSFile(globals.temp)
if( file.exists()){
	plugins.file.deleteFile(file)
}


}

/**
 * @properties={typeid:24,uuid:"44b27330-168d-4421-be33-472430c051c9"}
 */
function openAbout()
{
globals.about = '<html><body><p align="center"><b><br>Studiebijbel - Internetversie ' + globals.sb_gVersion
var vDate = new Date()
if(i18n.getCurrentLanguage() == 'es')
{
	globals.about += '<table><tr><td>© Comentario Bíblico del CVB: la fundación Centro de Investigación Bíblica http:\/\/www.comentariobiblilcocvb.com, Stichting Centrum voor Bijbelonderzoek, http:\/\/www.studiebijbel.nl Todos los derechos reservados</td></tr><tr><td>En el Comentario Bíblico del CvB se utiliza una serie de traducciones de la Biblia, entre otras las mencionadas a continuación. Para éstas se aplican los siguientes derechos:<br/><br/></td></tr></table><table><tr><td>La Palabra Spanje</td><td>Versión Texto bíblico: La Palabra 2010 ® <br />© Sociedad Bíblica, http:\/\/sociedadbiblica.org <br />Todos los derechos reservados</td></tr><tr><td>Reina Valera 1995</td><td>Versión Texto bíblico: Reina-Valera 95 ® <br />© United Bible Societies Association, Inc., 1995. <br />Todos los derechos reservados http:\/\/www.biblesociety.org</td></tr><tr><td>Reina Valera 1960</td><td>El texto Bíblico ha sido tomado de la versión Reina-Valera © 1960 Sociedades Bíblicas en América Latina; © renovado 1988 Sociedades Bíblicas Unidas. Utilizado con permiso. http:\/\/www.americanbible.org y http:\/\/www.bibles.com <br/>Reina-Valera 1960™ es una marca registrada de la American Bible Society, y puede ser usada solamente bajo licencia.</td></tr><tr><td>Nueva Biblia Latinoamericana de Hoy</td><td>Nueva Biblia Latinoamericana de Hoy Copyright © 2005 by The Lockman Foundation, La Habra, Calif.  All rights reserved.<br/>For Permission to Quote Information visit http:\/\/www.lockman.org </td></tr><tr><td>Biblia Hebraica Stuttgartensia</td><td>Biblia Hebraica Stuttgartensia, edited by Karl Elliger and Wilhelm Rudolph, Fifth Revised Edition, edited by Adrian Schenker, © 1977 and 1997 Deutsche Bibelgesellschaft, Stuttgart. Used by permission.</td></tr><tr><td>Traducción interlineal griego-español</td><td>Antonio Solé Pons, Santa Margarida de Montbui (Barcelona)<br/>Nuevo Testamento Griego-Español ajustado<br/>Inscrito en el Registro de la Propiedad Intelectual de Barcelona con el nº: B-1006-10<br/>Utilizado con permiso<br/>antonicarme.sole@hotmail.com </td></tr></table>'
} else {
	globals.about += '<br> Copyright &#169;' + vDate.getFullYear() + ' Centrum voor Bijbelonderzoek<br>Postbus 503, 3900 AM<br>Veenendaal.<br>Email: info@studiebijbel.nl</b></p></body></html>'
}
application.showFormInDialog(forms.about,-1,-1,-1,-1, 'i18n:servoy.menuitem.about', false, false, 'about', true)
}

/**
 * @properties={typeid:24,uuid:"4f1b4509-c065-43e2-98bf-86b9e13f8489"}
 */
function openPdf()
{
/**************************************************************************************
Method:         globals.openPdf();

Creator         : Adrian Doroiman
Modifier        : Karel Broer,  13-10-2008 //set path dynamicly using .servoy/CVB folder

Purpose         : Open Grammatica_totaal.pdf

Arguments:      -

**************************************************************************************/

var vFile = 'Grammatica_totaal.pdf'
var vServoyFolder = '.servoy'
var vSeparator = plugins.it2be_tools.client().fileSeparator
var vLocalClientPath = plugins.it2be_tools.client().userHome
var vServoyFolderPath = vLocalClientPath + vSeparator + vServoyFolder
var vCVBFolder = vServoyFolderPath + vSeparator + 'CVB'
var vFilePath = vCVBFolder +  vSeparator + vFile

if(utils.stringMiddle(application.getOSName(),1,7) == "Windows")
{
   application.executeProgram('rundll32', 'url.dll,FileProtocolHandler',vFilePath)
}
else {
       application.executeProgram('open','-a','preview',vFilePath)
}
}

/**
 * @properties={typeid:24,uuid:"2e088758-42dd-4a5f-ae5b-d1ae03d9b496"}
 */
function printForm()
{
if(!globals.isOT())
	application.showFormInDialog(forms.print_form)
else
	application.showFormInDialog(forms.print_form_ot)
}

/**
 * @properties={typeid:24,uuid:"ef9a0199-26ed-4064-806f-4ad64efa6eb3"}
 */
function quit()
{
application.exit()
}

/**
 * @properties={typeid:24,uuid:"f08f8103-2a91-4e41-b76b-6ee8a8ebcd33"}
 */
function resetMenu()
{
//plugins.Kydome_Menus.resetMenuBar()
plugins.it2be_menubar.resetMenuBar()
//i18n.setLocale('en', 'EN')

plugins.excelxport.exportEnabled  = true;



}

/**
 * @properties={typeid:24,uuid:"72d085d2-5359-44c3-a1da-7d03c97c1e2b"}
 */
function restrictedMenu()
{
var number = plugins.it2be_menubar.getMenuIndexByText('Opties')//get the MenubarMenu object from the MenubarMenuBar
var menu = plugins.it2be_menubar.getMenu(number);
menu.removeItem(0, 1, 2);

var number = plugins.it2be_menubar.getMenuIndexByText('Help')//get the MenubarMenu object from the MenubarMenuBar
var menu = plugins.it2be_menubar.getMenu(number);
menu.removeItem(0);

}

/**
 * @properties={typeid:24,uuid:"c49135ca-caf5-4024-84ca-495e3b650dde"}
 */
function sb_gDEVFix()
{
if(globals.chkDevFix != 1)
{
	if(application.getApplicationType() == 3)
	{
	globals.sb_gNLServerURLs = ["http:\/\/87.249.116.144","http:\/\/online.studiebijbel.nl"]
	globals.sb_gESServerURLs = ["http:\/\/217.114.108.59"]
	globals.sb_gDEVServerURLs = ["http:\/\/87.249.116.177","http:\/\/ts.ambitius.com"]
	
	if(application.getApplicationType() == 3)
	{
		var vDialog = plugins.dialogs.showQuestionDialog("Selecteer versie", "Nederlands Versie 1 - Spaans Versie 2 - Ontwikkel Versie 3", "Versie 1", "Versie 2", "Versie 3")
		if(vDialog == "Versie 1"){
			globals.sb_gNLServerURLs.push("http:\/\/localhost")
			//application.output("nederlands")
		} else if(vDialog == "Versie 2")
		{
			globals.sb_gESServerURLs.push("http:\/\/localhost")
			//application.output("Spaans")
		} else 
		{
			globals.sb_gDEVServerURLs.push("http:\/\/localhost")
			//application.output("DEV")
		}
	}
	
	globals.sb_SYS_registerPlugins();
	
	var vUrl = application.getServerURL()
	var vUrlIndex = utils.stringPosition(vUrl, ":", 6, 1)
	globals.sb_gCurrentServerUrl = utils.stringLeft(vUrl,(vUrlIndex -1))
//	globals.sb_gCurrentServerUrl = "http:\/\/217.114.108.59"
	}
	
	globals.chkDevFix = 1
}
}

/**
 * @properties={typeid:24,uuid:"2ca85192-6000-4c99-b163-9e877eb43ec5"}
 */
function sb_history()
{
if(!globals.sb_gHistory)
{
	globals.sb_gHistory = new Array();
}

var oHistory = new Object();
	oHistory.testament = globals.sb_gTestament;
	oHistory.book = globals.book;
	oHistory.chapter = globals.chapter;
	oHistory.verse = globals.verse;
	
globals.sb_gHistory.push(oHistory)
if (application.getMethodTriggerElementName() != "back" && application.getMethodTriggerElementName() != "forward"){
	globals.sb_gHistoryPoint = (globals.sb_gHistory.length -1)
	globals.sb_gHistoryStart = null
}
}

/**
 * @properties={typeid:24,uuid:"292f1cea-3cab-44d9-9058-4316e621b488"}
 * @AllowToRunInFind
 */
function sb_import_wordTransLNT()
{
var aTypes = new Array();
	aTypes.push('TR');
	aTypes.push('H-F');
	aTypes.push('N25');
	aTypes.push('N27');
	
var vVerseID = arguments[0];
var vGreek = "";
var iIndex, vWordsStrong;

//application.output(vVerseID);

/*

SELECT 
    word_original, 
    word_transliteration, 
    word_translation, 
    word_strong, 
    verse_id,  
    tr, 
    hf, 
    n25, 
    n27, 
    word_order
FROM words 
WHERE verse_id IN (1000095, 1000096, 1000097) 
AND word_strong IS NOT NULL 
AND word_strong!='' 
ORDER BY verse_id, word_order
 
*/






return false;
////////

if(vVerseID > 0)
{
	for(m in aTypes) 
	{
		if(forms.words_fill_in.controller.find())
		{
			if(aTypes[m] == 'TR')
			{
				forms.words_fill_in.tr = 1;
			}
			if(aTypes[m] == 'H-F')
			{
				forms.words_fill_in.hf = 1;
			}
			if(aTypes[m] == 'N25')
			{
				forms.words_fill_in.n25 = 1;
			}
			if(aTypes[m] == 'N27')
			{
				forms.words_fill_in.n27 = 1;
			}
			
			forms.words_fill_in.verse_id = vVerseID;
			forms.words_fill_in.controller.search();
		}
		
		var j = 0;
		var vPreviousCode = 0;
		
		var vWords = '<html><body><table><tr><td><table cellpassind="4" cellspacing="4">';
		
		for(var i = 1; i <= forms.words_fill_in.foundset.getSize(); i++)
		{
			var vRecord = forms.words_fill_in.foundset.getRecord(i);
			forms.words_fill_in.foundset.setSelectedIndex(i);
			forms.words_fill_in.words_to_word_variants.setSelectedIndex(i);
			
			var iDisplay = 1;
			var iColored = 0;
			var iCertainMode = 0;
			var vCode = ""; 
			
		/*	if(aTypes[m] == 'TR' && forms.words_fill_in.words_to_word_variants.tr == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'H-F' && forms.words_fill_in.words_to_word_variants.hf == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N25' && forms.words_fill_in.words_to_word_variants.n25 == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N27' && forms.words_fill_in.words_to_word_variants.n27 == 0)
			{
				iDisplay = 0;
			} */
			
			if(iDisplay == 1)
			{
				if(forms.words_fill_in.tr == 0 || forms.words_fill_in.hr == 0 || forms.words_fill_in.n25 == 0 || forms.words_fill_in.n27 == 0)
				{
					iColored = 1;
				}
				
				if(forms.words_fill_in.words_to_word_variants.code_no != null && forms.words_fill_in.words_to_word_variants.code_no != "")
				{
					vCode = forms.words_fill_in.words_to_word_variants.code_no;
				}
				
				
				/////////////////////////////////////////////////////////////////////////
				
				j++;
				
				if(j%4 == 1)
				{
					vWords = vWords.concat('<tr>');
				}
				
				vWords = vWords.concat('<td valign="top">');
				
				//if(utils.stringTrim(vCode))
				if(vCode)
				{
					if(vPreviousCode != vCode)
					{
						vPreviousCode = vCode;
						if(iColored == 1)
						{
							vWords = vWords.concat('<font color="#7A004D">');
							vWords = vWords.concat('<sup><font size="3">');
							vWords = vWords.concat(vCode);
							vWords = vWords.concat('</font></sup>');
							vWords = vWords.concat('</font>');
						}
					}
					
					// Certain modes
					vGreek = "";
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat('[');
					}
					
					vGreek = vGreek.concat('<a href="javascript:forms.study_words.searchWord(\'');
					iIndex = vRecord.word_strong.indexOf('.');
					vWordsStrong = "";
					
					if(iIndex > 0)
					{
						vWordsStrong = vRecord.word_strong.substring(0, iIndex);
					} else {
						vWordsStrong = vRecord.word_strong;
					}
					
					vGreek = vGreek.concat(vWordsStrong);
					
					if(iColored == 1)
					{
						vGreek = vGreek.concat('\')" style="color:#7A004D;text-decoration:none"><font face="GreekSBBold" color="#7A004D">');
					} else {
						vGreek = vGreek.concat('\')" style="color:#000000;text-decoration:none"><font face="GreekSBBold"	color="#000000">');
					}
					
					vGreek = vGreek.concat(vRecord.word_original);
					
					vGreek = vGreek.concat('</font></a>');
						
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat(']');
					}
					
					vWords = vWords.concat(vGreek);
					
					if(iColored == 1)
					{
						vWords = vWords.concat('<font color="#7A004D"');
					}
					
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_transliteration);
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_translation);
					if(iColored == 1)
					{
						vWords = vWords.concat('</font>');
					}
					
					vWords = vWords.concat('</td>');
					
					if(j%4 == 0)
					{
						vWords = vWords.concat('</tr>');
					}
				}
				
				
				/// Manu scripts
				
				if(forms.fill_manuscript_info.controller.find())
				{
					forms.fill_manuscript_info.verse_id = vVerseID;
					forms.fill_manuscript_info.controller.search();
				}
			}
		}
		
		for(var z = 1; z <= forms.fill_manuscript_info.foundset.getSize(); z++)
		{
			var vRecord2 = forms.fill_manuscript_info.foundset.getRecord(z);
			
			var iDisplay2 = 1;
			if(aTypes[m] == 'TR' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'H-F' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N25' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N27' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(iDisplay2 == 1)
			{
				vWords = vWords.concat('</table></td></tr></table>');
				vWords = vWords.concat('<table><tr><td><font size="3">');
				
				if(vRecord2.code_no != 0)
				{
					vWords = vWords.concat(vRecord2.code_no);
				}
				vWords = vWords.concat(' ');
				var vText = vRecord2.manuscript_text;
				
				if(vText != null)
				{
					var vIndex1 = vText.indexOf('<grk>');
					var vIndex2 = vText.indexOf('</grk>');
					
					if(vIndex1 > 0)
					{
						var vGreek2 = vText.substring(vIndex1+5, vIndex2);
							vGreek2 = plugins.SB_NT.getGreek(vGreek2);
						
						var vNewText = vText.substring(0, vIndex1);
						vNewText = vNewText.concat('<font size="3" face="GreekSB">');
						vNewText = vNewText.concat(vGreek2);
						vNewText = vNewText.concat('</font>');
						vNewText = vNewText.concat(vText.substring(vIndex2+6));
					} else {
						var vNewText = vText
					}
					
					vWords = vWords.concat(vNewText);
					vWords = vWords.concat('</font></td></tr>');
				}
			}
		}
		vWords = vWords.concat('</body></html>');
		// Foundset genereren
		var vFoundset = databaseManager.getFoundSet('sb', 'verses');
		
		if(vFoundset.find())
		{		
			vFoundset.pk = vVerseID;
			vFoundset.search();
		}
		
		if(aTypes[m] == 'TR')
		{
			vFoundset.words_html_tr = vWords;
			vFoundset.words_html_tr_gr = vGreek;
		}
		if(aTypes[m] == 'H-F')
		{
			vFoundset.words_html_hf = vWords;
			vFoundset.words_html_hf_gr = vGreek;
		}
		if(aTypes[m] == 'N25')
		{
			vFoundset.words_html_n25 = vWords;
			vFoundset.words_html_n25_gr = vGreek;
		}
		if(aTypes[m] == 'N27')
		{
			vFoundset.words_html_n27 = vWords;
			vFoundset.words_html_n27_gr = vGreek;
		}
		
	}
}


}

/**
 * @properties={typeid:24,uuid:"2c15897c-cf69-4ff7-9f35-804be93bf949"}
 * @AllowToRunInFind
 */
function sb_import_wordTransLNT_old()
{
var aTypes = new Array();
	aTypes.push('TR');
	aTypes.push('H-F');
	aTypes.push('N25');
	aTypes.push('N27');
	
var vVerseID = arguments[0];
var vGreek = "";
var iIndex, vWordsStrong;

//application.output(vVerseID);

if(vVerseID > 0)
{
	for(m in aTypes) 
	{
		if(forms.words_fill_in.controller.find())
		{
			if(aTypes[m] == 'TR')
			{
				forms.words_fill_in.tr = 1;
			}
			if(aTypes[m] == 'H-F')
			{
				forms.words_fill_in.hf = 1;
			}
			if(aTypes[m] == 'N25')
			{
				forms.words_fill_in.n25 = 1;
			}
			if(aTypes[m] == 'N27')
			{
				forms.words_fill_in.n27 = 1;
			}
			
			forms.words_fill_in.verse_id = vVerseID;
			forms.words_fill_in.controller.search();
		}
		
		var j = 0;
		var vPreviousCode = 0;
		
		var vWords = '<html><body><table><tr><td><table cellpassind="4" cellspacing="4">';
		
		for(var i = 1; i <= forms.words_fill_in.foundset.getSize(); i++)
		{
			var vRecord = forms.words_fill_in.foundset.getRecord(i);
			forms.words_fill_in.foundset.setSelectedIndex(i);
			forms.words_fill_in.words_to_word_variants.setSelectedIndex(i);
			
			var iDisplay = 1;
			var iColored = 0;
			var iCertainMode = 0;
			var vCode = ""; 
			
		/*	if(aTypes[m] == 'TR' && forms.words_fill_in.words_to_word_variants.tr == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'H-F' && forms.words_fill_in.words_to_word_variants.hf == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N25' && forms.words_fill_in.words_to_word_variants.n25 == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N27' && forms.words_fill_in.words_to_word_variants.n27 == 0)
			{
				iDisplay = 0;
			} */
			
			if(iDisplay == 1)
			{
				if(forms.words_fill_in.tr == 0 || forms.words_fill_in.hr == 0 || forms.words_fill_in.n25 == 0 || forms.words_fill_in.n27 == 0)
				{
					iColored = 1;
				}
				
				if(forms.words_fill_in.words_to_word_variants.code_no != null && forms.words_fill_in.words_to_word_variants.code_no != "")
				{
					vCode = forms.words_fill_in.words_to_word_variants.code_no;
				}
				
				
				/////////////////////////////////////////////////////////////////////////
				
				j++;
				
				if(j%4 == 1)
				{
					vWords = vWords.concat('<tr>');
				}
				
				vWords = vWords.concat('<td valign="top">');
				
				//if(utils.stringTrim(vCode))
				if(vCode)
				{
					if(vPreviousCode != vCode)
					{
						vPreviousCode = vCode;
						if(iColored == 1)
						{
							vWords = vWords.concat('<font color="#7A004D">');
							vWords = vWords.concat('<sup><font size="3">');
							vWords = vWords.concat(vCode);
							vWords = vWords.concat('</font></sup>');
							vWords = vWords.concat('</font>');
						}
					}
					
					// Certain modes
					vGreek = "";
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat('[');
					}
					
					vGreek = vGreek.concat('<a href="javascript:forms.study_words.searchWord(\'');
					iIndex = vRecord.word_strong.indexOf('.');
					vWordsStrong = "";
					
					if(iIndex > 0)
					{
						vWordsStrong = vRecord.word_strong.substring(0, iIndex);
					} else {
						vWordsStrong = vRecord.word_strong;
					}
					
					vGreek = vGreek.concat(vWordsStrong);
					
					if(iColored == 1)
					{
						vGreek = vGreek.concat('\')" style="color:#7A004D;text-decoration:none"><font face="GreekSBBold" color="#7A004D">');
					} else {
						vGreek = vGreek.concat('\')" style="color:#000000;text-decoration:none"><font face="GreekSBBold"	color="#000000">');
					}
					
					vGreek = vGreek.concat(vRecord.word_original);
					
					vGreek = vGreek.concat('</font></a>');
						
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat(']');
					}
					
					vWords = vWords.concat(vGreek);
					
					if(iColored == 1)
					{
						vWords = vWords.concat('<font color="#7A004D"');
					}
					
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_transliteration);
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_translation);
					if(iColored == 1)
					{
						vWords = vWords.concat('</font>');
					}
					
					vWords = vWords.concat('</td>');
					
					if(j%4 == 0)
					{
						vWords = vWords.concat('</tr>');
					}
				}
				
				
				/// Manu scripts
				
				if(forms.fill_manuscript_info.controller.find())
				{
					forms.fill_manuscript_info.verse_id = vVerseID;
					forms.fill_manuscript_info.controller.search();
				}
			}
		}
		
		for(var z = 1; z <= forms.fill_manuscript_info.foundset.getSize(); z++)
		{
			var vRecord2 = forms.fill_manuscript_info.foundset.getRecord(z);
			
			var iDisplay2 = 1;
			if(aTypes[m] == 'TR' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'H-F' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N25' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N27' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(iDisplay2 == 1)
			{
				vWords = vWords.concat('</table></td></tr></table>');
				vWords = vWords.concat('<table><tr><td><font size="3">');
				
				if(vRecord2.code_no != 0)
				{
					vWords = vWords.concat(vRecord2.code_no);
				}
				vWords = vWords.concat(' ');
				var vText = vRecord2.manuscript_text;
				
				if(vText != null)
				{
					var vIndex1 = vText.indexOf('<grk>');
					var vIndex2 = vText.indexOf('</grk>');
					
					if(vIndex1 > 0)
					{
						var vGreek2 = vText.substring(vIndex1+5, vIndex2);
							vGreek2 = plugins.SB_NT.getGreek(vGreek2);
						
						var vNewText = vText.substring(0, vIndex1);
						vNewText = vNewText.concat('<font size="3" face="GreekSB">');
						vNewText = vNewText.concat(vGreek2);
						vNewText = vNewText.concat('</font>');
						vNewText = vNewText.concat(vText.substring(vIndex2+6));
					} else {
						var vNewText = vText
					}
					
					vWords = vWords.concat(vNewText);
					vWords = vWords.concat('</font></td></tr>');
				}
			}
		}
		vWords = vWords.concat('</body></html>');
		// Foundset genereren
		var vFoundset = databaseManager.getFoundSet('sb', 'verses');
		
		if(vFoundset.find())
		{		
			vFoundset.pk = vVerseID;
			vFoundset.search();
		}
		
		if(aTypes[m] == 'TR')
		{
			vFoundset.words_html_tr = vWords;
			vFoundset.words_html_tr_gr = vGreek;
		}
		if(aTypes[m] == 'H-F')
		{
			vFoundset.words_html_hf = vWords;
			vFoundset.words_html_hf_gr = vGreek;
		}
		if(aTypes[m] == 'N25')
		{
			vFoundset.words_html_n25 = vWords;
			vFoundset.words_html_n25_gr = vGreek;
		}
		if(aTypes[m] == 'N27')
		{
			vFoundset.words_html_n27 = vWords;
			vFoundset.words_html_n27_gr = vGreek;
		}
		
	}
}


}

/**
 * @properties={typeid:24,uuid:"2a1ce317-7635-4d1e-afd5-0f5468cf1076"}
 * @AllowToRunInFind
 */
function sb_import_wordTransLNT_older()
{
var aTypes = new Array();
	aTypes.push('TR');
	aTypes.push('H-F');
	aTypes.push('N25');
	aTypes.push('N27');
	
var vVerseID = arguments[0];
var vGreek = "";
var iIndex, vWordsStrong;

//application.output(vVerseID);

if(vVerseID > 0)
{
	for(m in aTypes) 
	{
		if(forms.words_fill_in.controller.find())
		{
			if(aTypes[m] == 'TR')
			{
				forms.words_fill_in.tr = 1;
			}
			if(aTypes[m] == 'H-F')
			{
				forms.words_fill_in.hf = 1;
			}
			if(aTypes[m] == 'N25')
			{
				forms.words_fill_in.n25 = 1;
			}
			if(aTypes[m] == 'N27')
			{
				forms.words_fill_in.n27 = 1;
			}
			
			forms.words_fill_in.verse_id = vVerseID;
			forms.words_fill_in.controller.search();
		}
		
		var j = 0;
		var vPreviousCode = 0;
		
		var vWords = '<html><body><table><tr><td><table cellpassind="4" cellspacing="4">';
		
		for(var i = 1; i <= forms.words_fill_in.foundset.getSize(); i++)
		{
			var vRecord = forms.words_fill_in.foundset.getRecord(i);
			forms.words_fill_in.foundset.setSelectedIndex(i);
			forms.words_fill_in.words_to_word_variants.setSelectedIndex(i);
			
			var iDisplay = 1;
			var iColored = 0;
			var iCertainMode = 0;
			var vCode = ""; 
			
		/*	if(aTypes[m] == 'TR' && forms.words_fill_in.words_to_word_variants.tr == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'H-F' && forms.words_fill_in.words_to_word_variants.hf == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N25' && forms.words_fill_in.words_to_word_variants.n25 == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N27' && forms.words_fill_in.words_to_word_variants.n27 == 0)
			{
				iDisplay = 0;
			} */
			
			if(iDisplay == 1)
			{
				if(forms.words_fill_in.tr == 0 || forms.words_fill_in.hr == 0 || forms.words_fill_in.n25 == 0 || forms.words_fill_in.n27 == 0)
				{
					iColored = 1;
				}
				
				if(forms.words_fill_in.words_to_word_variants.code_no != null && forms.words_fill_in.words_to_word_variants.code_no != "")
				{
					vCode = forms.words_fill_in.words_to_word_variants.code_no;
				}
				
				
				/////////////////////////////////////////////////////////////////////////
				
				j++;
				
				if(j%4 == 1)
				{
					vWords = vWords.concat('<tr>');
				}
				
				vWords = vWords.concat('<td valign="top">');
				
				//if(utils.stringTrim(vCode))
				if(vCode)
				{
					if(vPreviousCode != vCode)
					{
						vPreviousCode = vCode;
						if(iColored == 1)
						{
							vWords = vWords.concat('<font color="#7A004D">');
							vWords = vWords.concat('<sup><font size="3">');
							vWords = vWords.concat(vCode);
							vWords = vWords.concat('</font></sup>');
							vWords = vWords.concat('</font>');
						}
					}
					
					// Certain modes
					vGreek = "";
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat('[');
					}
					
					vGreek = vGreek.concat('<a href="javascript:forms.study_words.searchWord(\'');
					iIndex = vRecord.word_strong.indexOf('.');
					vWordsStrong = "";
					
					if(iIndex > 0)
					{
						vWordsStrong = vRecord.word_strong.substring(0, iIndex);
					} else {
						vWordsStrong = vRecord.word_strong;
					}
					
					vGreek = vGreek.concat(vWordsStrong);
					
					if(iColored == 1)
					{
						vGreek = vGreek.concat('\')" style="color:#7A004D;text-decoration:none"><font face="GreekSBBold" color="#7A004D">');
					} else {
						vGreek = vGreek.concat('\')" style="color:#000000;text-decoration:none"><font face="GreekSBBold"	color="#000000">');
					}
					
					vGreek = vGreek.concat(vRecord.word_original);
					
					vGreek = vGreek.concat('</font></a>');
						
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat(']');
					}
					
					vWords = vWords.concat(vGreek);
					
					if(iColored == 1)
					{
						vWords = vWords.concat('<font color="#7A004D"');
					}
					
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_transliteration);
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_translation);
					if(iColored == 1)
					{
						vWords = vWords.concat('</font>');
					}
					
					vWords = vWords.concat('</td>');
					
					if(j%4 == 0)
					{
						vWords = vWords.concat('</tr>');
					}
				}
				
				
				/// Manu scripts
				
				if(forms.fill_manuscript_info.controller.find())
				{
					forms.fill_manuscript_info.verse_id = vVerseID;
					forms.fill_manuscript_info.controller.search();
				}
			}
		}
		
		for(var z = 1; z <= forms.fill_manuscript_info.foundset.getSize(); z++)
		{
			var vRecord2 = forms.fill_manuscript_info.foundset.getRecord(z);
			
			var iDisplay2 = 1;
			if(aTypes[m] == 'TR' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'H-F' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N25' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N27' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(iDisplay2 == 1)
			{
				vWords = vWords.concat('</table></td></tr></table>');
				vWords = vWords.concat('<table><tr><td><font size="3">');
				
				if(vRecord2.code_no != 0)
				{
					vWords = vWords.concat(vRecord2.code_no);
				}
				vWords = vWords.concat(' ');
				var vText = vRecord2.manuscript_text;
				
				if(vText != null)
				{
					var vIndex1 = vText.indexOf('<grk>');
					var vIndex2 = vText.indexOf('</grk>');
					
					if(vIndex1 > 0)
					{
						var vGreek2 = vText.substring(vIndex1+5, vIndex2);
							vGreek2 = plugins.SB_NT.getGreek(vGreek2);
						
						var vNewText = vText.substring(0, vIndex1);
						vNewText = vNewText.concat('<font size="3" face="GreekSB">');
						vNewText = vNewText.concat(vGreek2);
						vNewText = vNewText.concat('</font>');
						vNewText = vNewText.concat(vText.substring(vIndex2+6));
					} else {
						var vNewText = vText
					}
					
					vWords = vWords.concat(vNewText);
					vWords = vWords.concat('</font></td></tr>');
				}
			}
		}
		vWords = vWords.concat('</body></html>');
		// Foundset genereren
		var vFoundset = databaseManager.getFoundSet('sb', 'verses');
		
		if(vFoundset.find())
		{		
			vFoundset.pk = vVerseID;
			vFoundset.search();
		}
		
		if(aTypes[m] == 'TR')
		{
			vFoundset.words_html_tr = vWords;
			vFoundset.words_html_tr_gr = vGreek;
		}
		if(aTypes[m] == 'H-F')
		{
			vFoundset.words_html_hf = vWords;
			vFoundset.words_html_hf_gr = vGreek;
		}
		if(aTypes[m] == 'N25')
		{
			vFoundset.words_html_n25 = vWords;
			vFoundset.words_html_n25_gr = vGreek;
		}
		if(aTypes[m] == 'N27')
		{
			vFoundset.words_html_n27 = vWords;
			vFoundset.words_html_n27_gr = vGreek;
		}
		
	}
}


}

/**
 * @properties={typeid:24,uuid:"3d27517b-e18f-4b88-a247-fc05bc354f51"}
 */
function sb_import_wordTransLOT()
{
var vVerseID = arguments[0]

var rowSize = 4
var cont = Array(rowSize)
var cont_gr = Array(rowSize)
var updateQuery = "";
var query="select word_original, word_transliteration, word_translation, word_strong, verse_id from words where verse_id IN (" + vVerseID.join(', ') + ") and word_strong is not null and word_strong!='' order by verse_id, word_order"
var res = databaseManager.getDataSetByQuery(forms.books.controller.getServerName(),query, null, -1)
var size = res.getMaxRowIndex()
if(size>=0)
{
	var iCurrentVerse = 0;
	for ( var j=1; j<=size; j++ )
	{
		i=j;
		if(iCurrentVerse != res.getValue(i,5))
		{
			if(j!=1)
			{
				updateQuery += "UPDATE verses SET words_html_tr = '" + header + content + footer + "',words_html_tr_gr='"+ header + content_gr + footer + "' WHERE pk=" + res.getValue((i-1),5)+";\n";
			}
			iCurrentVerse = res.getValue(i,5)
			var header = '<html><body><table><tr><td><table cellpadding="4" cellspacing="4">'
			var content = ''
			var content_gr = ''
			var footer = '</table></td></tr></table></body></html>'
		}
		//res.rowIndex = j
	
		if((j-1)%rowSize==0)
		{
			content+='<tr>'
			content_gr+='<tr>'
		}
		
		if(res.getValue(i,4))
		{
			var strong = res.getValue(i,4)
			var index=strong.indexOf('.', 0)
			if(index>0)
				strong = strong.substring(0, index)
			
		//	cont[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B><br><font face="SIL Heb Trans">'+plugins.SILEzraToUnicode.convertToEzra(res[2])+'</font><br>' + res[3] + '</td>'				
		//	cont_gr[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B></td>'
			cont[rowSize-(j-1)%rowSize-1] = "<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + plugins.SILEzraToUnicode.convertToEzra(res.getValue(i,1)) + "</font></B><br><font face=\"SIL Heb Trans\">"+plugins.SILEzraToUnicode.convertToEzra(res.getValue(i,2))+"</font><br>" + utils.stringReplace(res.getValue(i,3),"'", "&#39;") + "</td>"				
			cont_gr[rowSize-(j-1)%rowSize-1] ="<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + plugins.SILEzraToUnicode.convertToEzra(res.getValue(i,1)) + "</font></B></td>"
		}
		else
		{
			cont[rowSize-(j-1)%rowSize-1]=''
			cont_gr[rowSize-(j-1)%rowSize-1]=''
		}
		
		if(j%rowSize==0)
		{
			for(var k=0; k<rowSize;k++)
			{
				content+=cont[k]
				content_gr+=cont_gr[k]
			}
			content+='</tr>'
			content_gr+='</tr>'
		}
		
	}//j		
	if(size%rowSize!=0)
	{
		for(var k=0; k<rowSize-size%rowSize; k++)
		{
			content += '<td valign="top">&nbsp;</td>' 
			content_gr += '<td valign="top">&nbsp;</td>'
		}
		for(var k=rowSize-size%rowSize; k<rowSize;k++)
		{
			content+=cont[k]
			content_gr+=cont_gr[k]
		}

		content+='</tr>'
		content_gr+='</tr>'
	}

}	

//var updateQuery = "UPDATE verses SET words_html_tr = '" + header + content + footer + "',words_html_tr_gr='"+ header + content_gr + footer + "' WHERE pk=" + vVerseID
	//application.output(    updateQuery )
var success =	plugins.rawSQL.executeSQL( forms.books.controller.getServerName(),  "verses",  updateQuery)
if(!success)
{
	//application.output("Verses words cannot be updated")
} else {
//	databaseManager.refreshRecordFromDatabase(forms.verses_fill_in.foundset, -1)
	plugins.rawSQL.flushAllClientsCache('sb', 'verses');
}

}

/**
 * @properties={typeid:24,uuid:"5880a091-ae7c-4a4d-8252-248e7bd95a29"}
 */
function scrollConcordance()
{
globals.iConcordance += arguments[0]

globals.wlink(globals.selectedWordStudy, true)
}

/**
 * @properties={typeid:24,uuid:"2ed740d0-a327-4a08-9967-5e8423aa4d81"}
 */
function selectAll()
{
forms[globals.gFName].elements[globals.gElName].selectAll(); 
}

/**
 * @properties={typeid:24,uuid:"9b9a2b85-a5b7-40a9-8be2-c91be8f53029"}
 * @AllowToRunInFind
 */
function setBookChapVerse()
{

//forms.verses_fill_in.foundset.clearFoundSet()
//forms.verses_fill_in.controller.loadAllRecords()

if(forms.verses_fill_in.controller.find())
{
	forms.verses_fill_in.pk = arguments[0]
	forms.verses_fill_in.controller.search()
	}
if(forms.verses_fill_in.foundset.getSize()>0) {
	var record = forms.verses_fill_in.foundset.getRecord(1)
	globals.verse = record.verse_number
	globals.book = record.calc_book_name
	var chap_id = record.chapter_id
	globals.chapter_pk = chap_id
}
//forms.chapters_fill_in.foundset.clearFoundSet()
if(forms.chapters_fill_in.controller.find())
{
	forms.chapters_fill_in.pk = chap_id
	forms.chapters_fill_in.controller.search()
}
var record = forms.chapters_fill_in.foundset.getRecord(1)
globals.chapter = record.chapter_no

// Get testament
var vSQL = "SELECT testament, pk FROM books WHERE book_name = ?";
var vQuery = databaseManager.getDataSetByQuery('sb', vSQL, [globals.book], 1);
globals.sb_gTestament = vQuery.getValue(1,1);
globals.book_id = vQuery.getValue(1,2);

}

/**
 * @properties={typeid:24,uuid:"cbadef21-d308-4de3-a3e1-4dfe1cd659e1"}
 * @AllowToRunInFind
 */
function setVersePath()
{
var arg = arguments[0]
var aux = ''
//forms.verses_fill_in.foundset.clearFoundSet()
if(forms.verses_fill_in.controller.find())
{
	forms.verses_fill_in.pk = arg
	forms.verses_fill_in.controller.search()
}
if(forms.verses_fill_in.foundset.getSize() > 0){
	var record = forms.verses_fill_in.foundset.getRecord(1)
	var verse_no = record.verse_number
	forms.chapters_fill_in.foundset.clearFoundSet()
	if(forms.chapters_fill_in.controller.find())
	{
		forms.chapters_fill_in.pk = record.chapter_id
		forms.chapters_fill_in.controller.search()
	}
	if( forms.chapters_fill_in.foundset.getSize() > 0){
		var record = forms.chapters_fill_in.foundset.getRecord(1)
		var chapter_no = record.chapter_no
		forms.books_fill_in.foundset.clearFoundSet()
		if(forms.books_fill_in.controller.find())
		{
			forms.books_fill_in.pk = record.book_id
			forms.books_fill_in.controller.search()
		}
		if( forms.books_fill_in.foundset.getSize() > 0){
			var record = forms.books_fill_in.foundset.getRecord(1)
			aux += record.book_name
			aux += ' '
			aux += chapter_no
			aux += ':'
			aux += verse_no
		}
	}
}


globals.verse_path = aux
}

/**
 * @param {Number} vID
 * @properties={typeid:24,uuid:"cb2ac99d-31e2-4aa5-886e-0f4fd733d588"}
 * @AllowToRunInFind
 */
function showCommentaryInDialog(vID)
{
	
	//Migrate: Use SOLUTIONMODEL
//var vID = arguments[0]

var vForm = solutionModel.getForm('comment_instance')
var vNewFormName = 'comment_instance' + application.getUUID().toString().substr(0,8);
var ok = solutionModel.cloneForm(vNewFormName, vForm)
var vFormname = ok.name

if(forms[vFormname].foundset.find())
{
	/** @type JSRecord<db:/sb/commentary_blocks> */
	forms[vFormname].foundset.pk = vID;
	forms[vFormname].foundset.search();
}
var vTitle = forms[vFormname].title;
vTitle = utils.stringReplace(vTitle, '<h1>', '')
vTitle = utils.stringReplace(vTitle, '</h1>', '')

if(!vTitle) { vTitle = i18n.getI18NMessage('cvb.lbl.commentary'); }

var vTotalTitle = forms[vFormname].commentary_blocks_to_books.book_name + " "+ forms[vFormname].chapter_from + ":"+ forms[vFormname].verses_from
if(forms[vFormname].verses_to != forms[vFormname].verses_from)
{
vTotalTitle += "-"+ forms[vFormname].chapter_to + ":"+ forms[vFormname].verses_to
}
var vInput = vTitle; //document.getElementById("input-code").innerHTML;
var vOutput = vInput.replace(/<\/?[^>]+(>|$)/g, "");

vTotalTitle += " - " + vOutput;

if (ok)
{
//var vFormName = 'instance_'+globals.pinkenelis
if(arguments[2] == 'search')
{
	globals.sb_blockFootnoteLinkSearchForm = 1
}
application.showFormInDialog(forms[vFormname],  -1,  -1,  -1,  -1,  vTotalTitle,  true, false,  vFormname, false)
//application.showFormInDialog( form,  [x],  [y],  [width],  [height],  [dialogTitle],  [resizable],  [showTextToolbar],  [windowName],  [modal])
}

//Some sit
if(arguments[1] == true)
{
var query = "SELECT cb.title || cb.htmltext_short as commentary, list('<f><b>' || f.footnote_number || '</b></f>&nbsp;' || f.htmltext, '<br>'  ORDER BY f.footnote_number) as footnote, cb.pk FROM commentary_blocks cb LEFT OUTER JOIN footnotes f" +
" ON cb.pk=f.commentary_block_id WHERE cb.htmltext IS NOT NULL AND length(cb.htmltext)>15" +
" AND cb.book_id=" + forms[vFormname].book_id +
" AND (cb.chapter_from<" + globals.chapter + " or (cb.chapter_from=" + forms[vFormname].chapter_from + "  and cb.verses_from<=" + forms[vFormname].verses_from + "))" +
" AND (cb.chapter_to>" + globals.chapter + " or (cb.chapter_to=" + forms[vFormname].chapter_from + " and cb.verses_to>=" + forms[vFormname].verses_from + "))" +
" GROUP BY cb.title, cb.htmltext_short, cb.pk	ORDER BY cb.pk"

var res = databaseManager.getDataSetByQuery(forms.articles.controller.getServerName(),query,null, 100)
return res.getRowAsArray(1)
}
/*
var vTitle = forms['comment_instance_'+globals.pinkenelis].title;
	vTitle = utils.stringReplace(vTitle, '<h1>', '')
	vTitle = utils.stringReplace(vTitle, '</h1>', '')

if(!vTitle) { vTitle = i18n.getI18NMessage('cvb.lbl.commentary'); }

var vTotalTitle = forms['comment_instance_'+globals.pinkenelis].commentary_blocks_to_books.book_name + " "+ forms['comment_instance_'+globals.pinkenelis].chapter_from + ":"+ forms['comment_instance_'+globals.pinkenelis].verses_from
if(forms['comment_instance_'+globals.pinkenelis].verses_to != forms['comment_instance_'+globals.pinkenelis].verses_from)
{
	vTotalTitle += "-"+ forms['comment_instance_'+globals.pinkenelis].chapter_to + ":"+ forms['comment_instance_'+globals.pinkenelis].verses_to
}
var vInput = vTitle; //document.getElementById("input-code").innerHTML;
var vOutput = vInput.replace(/<\/?[^>]+(>|$)/g, "");

vTotalTitle += " - " + vOutput;

if (ok)
{
	var vFormName = 'instance_'+globals.pinkenelis
	if(arguments[2] == 'search')
	{
		globals.sb_blockFootnoteLinkSearchForm = 1
	}
	application.showFormInDialog(forms['comment_instance_'+globals.pinkenelis],  -1,  -1,  -1,  -1,  vTotalTitle,  true, false,  vFormName, false)
//	application.showFormInDialog( form,  [x],  [y],  [width],  [height],  [dialogTitle],  [resizable],  [showTextToolbar],  [windowName],  [modal])
}

// Some sit
if(arguments[1] == true)
{
	var query = "SELECT cb.title || cb.htmltext_short as commentary, list('<f><b>' || f.footnote_number || '</b></f>&nbsp;' || f.htmltext, '<br>'  ORDER BY f.footnote_number) as footnote, cb.pk FROM commentary_blocks cb LEFT OUTER JOIN footnotes f" +
	" ON cb.pk=f.commentary_block_id WHERE cb.htmltext IS NOT NULL AND length(cb.htmltext)>15" +
	" AND cb.book_id=" + forms['comment_instance_'+globals.pinkenelis].book_id +
	" AND (cb.chapter_from<" + globals.chapter + " or (cb.chapter_from=" + forms['comment_instance_'+globals.pinkenelis].chapter_from + "  and cb.verses_from<=" + forms['comment_instance_'+globals.pinkenelis].verses_from + "))" +
	" AND (cb.chapter_to>" + globals.chapter + " or (cb.chapter_to=" + forms['comment_instance_'+globals.pinkenelis].chapter_from + " and cb.verses_to>=" + forms['comment_instance_'+globals.pinkenelis].verses_from + "))" +
	" GROUP BY cb.title, cb.htmltext_short, cb.pk	ORDER BY cb.pk"
	
	var res = databaseManager.getDataSetByQuery(forms.articles.controller.getServerName(),query,null, 100)
	return res.getRowAsArray(1)
}
*/

}

/**
 * @properties={typeid:24,uuid:"f9c892db-dece-4174-ac62-ba462c2b4361"}
 * @AllowToRunInFind
 */
function showFootnoteInDialog()
{
var vID = arguments[0]
var vFNNumber = arguments[1]
if(!globals.pinkenelis)
{
	globals.pinkenelis = 1;
} else {
	globals.pinkenelis++;
}


var ok = application.createNewFormInstance('footnote_instance', 'footnote_instance_'+globals.pinkenelis)
if(forms['footnote_instance_'+globals.pinkenelis].foundset.find())
{
	forms['footnote_instance_'+globals.pinkenelis].foundset.commentary_block_id = vID;
	forms['footnote_instance_'+globals.pinkenelis].foundset.footnote_number = vFNNumber
	forms['footnote_instance_'+globals.pinkenelis].foundset.search();
}


var vSQL = "SELECT books.book_name, commentary_blocks.chapter_from, commentary_blocks.verses_from  FROM DBA.commentary_blocks INNER JOIN DBA.books ON commentary_blocks.book_id = books.pk WHERE commentary_blocks.pk = ?"
var vQuery = databaseManager.getDataSetByQuery("sb", vSQL, [vID], 1)

var vTitle = vQuery.getValue(1,1) + " "+ vQuery.getValue(1,2) + ":"+ vQuery.getValue(1,3) + " "+ i18n.getI18NMessage('cvb.lbl.footnotenumber') + " " + vFNNumber

//var vTitle = forms['footnote_instance_'+globals.pinkenelis].title;
//var vTitle = "HOI"

//	vTitle = utils.stringReplace(vTitle, '<h1>', '')
//	vTitle = utils.stringReplace(vTitle, '</h1>', '')

if(!vTitle) { vTitle = i18n.getI18NMessage('cvb.lbl.commentary'); }

//var vTotalTitle = forms['comment_instance_'+globals.pinkenelis].commentary_blocks_to_books.book_name + " "+ forms['comment_instance_'+globals.pinkenelis].chapter_from + ":"+ forms['comment_instance_'+globals.pinkenelis].verses_from
//if(forms['comment_instance_'+globals.pinkenelis].verses_to != forms['comment_instance_'+globals.pinkenelis].verses_from)
//{
//	vTotalTitle += "-"+ forms['comment_instance_'+globals.pinkenelis].chapter_to + ":"+ forms['comment_instance_'+globals.pinkenelis].verses_to
//}
//var vInput = vTitle; //document.getElementById("input-code").innerHTML;
//var vOutput = vInput.replace(/<\/?[^>]+(>|$)/g, "");

//vTotalTitle += " - " + vOutput;

if (ok)
{
	var vFormName = 'instance_'+globals.pinkenelis
	if(arguments[2] == 'search')
	{
		globals.sb_blockFootnoteLinkSearchForm = 1
	}
	application.showFormInDialog(forms['footnote_instance_'+globals.pinkenelis],  -1,  -1,  -1,  -1,  vTitle,  true, false,  vFormName, false)
}

// Some sit
/*if(arguments[1] == true)
{
	var query = "SELECT cb.title || cb.htmltext_short as commentary, list('<f><b>' || f.footnote_number || '</b></f>&nbsp;' || f.htmltext, '<br>'  ORDER BY f.footnote_number) as footnote, cb.pk FROM commentary_blocks cb LEFT OUTER JOIN footnotes f" +
	" ON cb.pk=f.commentary_block_id WHERE cb.htmltext IS NOT NULL AND length(cb.htmltext)>15" +
	" AND cb.book_id=" + forms['comment_instance_'+globals.pinkenelis].book_id +
	" AND (cb.chapter_from<" + globals.chapter + " or (cb.chapter_from=" + forms['comment_instance_'+globals.pinkenelis].chapter_from + "  and cb.verses_from<=" + forms['comment_instance_'+globals.pinkenelis].verses_from + "))" +
	" AND (cb.chapter_to>" + globals.chapter + " or (cb.chapter_to=" + forms['comment_instance_'+globals.pinkenelis].chapter_from + " and cb.verses_to>=" + forms['comment_instance_'+globals.pinkenelis].verses_from + "))" +
	" GROUP BY cb.title, cb.htmltext_short, cb.pk	ORDER BY cb.pk"
	
	var res = databaseManager.getDataSetByQuery(forms.articles.controller.getServerName(),query,null, 100)
	return res.getRowAsArray(1)
}*/
}

/**
 * @properties={typeid:24,uuid:"0faddf3e-ee16-4cef-909f-2a182bf875c1"}
 */
function showOTData()
{
var ot = arguments[0]

forms.book_notes.elements.footnote.visible = ot

//Content
if(ot)
{
	if(globals.ot==0)
	{
		//globals.study_analyze = ''
	}
	globals.ot = 1
}
else
{
	if(globals.ot == 1)
	{
		globals.commentary = ''
	}
	globals.ot = 0
}
}

/**
 * @properties={typeid:24,uuid:"9ba6656c-2600-4b34-81c6-ba442af3c23e"}
 */
function showOTData_old()
{
var ot = arguments[0]

//Labels
//study verse words
//forms.study_words.elements.versions.visible = !ot
//forms.study_words.elements.versionsText.visible = !ot
//forms.study_words.elements.grieks.visible = !ot
//forms.study_words.elements.heb.visible = ot

//word study
//forms.word_study.elements.study.visible = true
//forms.word_study.elements.commentary.visible = false

//book_commment
//forms.book_comment.elements.comment.visible = !ot
//forms.book_comment.elements.footnote.visible = ot

//book_notes
forms.book_notes.elements.footnote.visible = ot

//Content
if(ot)
{
	if(globals.ot==0)
	{
		//globals.study_analyze = ''
	}
	globals.ot = 1
}
else
{
	if(globals.ot == 1)
	{
		//globals.study_analyze = ''
		globals.commentary = ''
	}
	globals.ot = 0
}
}

/**
 * @param i Text
 * @properties={typeid:24,uuid:"8e2812fa-081c-406b-b683-0ca424255f85"}
 */
function stringToCharNo(i)
{
	var input = i + "";
	//arguments[0] = 'ab' // plugins.SILEzraToUnicode.convertToEzra('ab')//\'ßrAÐb') //'ab'
	//if(arguments[0])
	if(input)
	{
		/*if(arguments[0].charCodeAt(1) >= 61440)
		{
			return arguments[0];
		}*/
		
		if(input.charCodeAt(1) >= 61440)
		{
			return input;
		}
		
		var vChars = new Array();
		var vCharsNo = new Array();
		var vNewArray = new Array();
		/*
		for(klmi = 0; klmi < arguments[0].length; klmi++)
		{
			vChars.push(arguments[0].charAt(klmi));
			vCharsNo.push(arguments[0].charCodeAt(klmi));
			//vNewArray.push(utils.getUnicodeCharacter((arguments[0].charCodeAt(klmi)+61440)))
			vNewArray.push("&#"+(arguments[0].charCodeAt(klmi)+61440)+";")
			
		}*/
		
		for(var klmi = 0; klmi < input.length; klmi++)
		{
			vChars.push(input.charAt(klmi));
			vCharsNo.push(input.charCodeAt(klmi));
			//vNewArray.push(utils.getUnicodeCharacter((arguments[0].charCodeAt(klmi)+61440)))
			vNewArray.push("&#"+(input.charCodeAt(klmi)+61440)+";")
			
		}		
		
		var vNewString = vNewArray.join('');
		
		var a = 0;
		
		return vNewString;
	} 
	return null
}

/**
 * @properties={typeid:24,uuid:"dfb65f55-3b00-4346-aae5-490f2ba7a78f"}
 */
function tempMethod()
{
plugins.it2be_menubar.removeAllMenus()

//File menu
var menu_file = plugins.it2be_menubar.addMenu()
menu_file.setText('Bestand')
var menu_exit = menu_file.addItem()
menu_exit.set('Afsluiten', globals.quit);

//Edit menu
//get the MenubarMenu object from the MenubarMenuBar
var menu = plugins.it2be_menubar.addMenu();
//set the MenubarMenu object
menu.set("Wijzigen");
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Kopieer",globals.copy,null,null,"control C");
//get the MenubarMenuItem object from the (Sub-)menu
item = menu.addItem();
//set the MenubarMenuItem object
item.set("Selecteer alles",globals.selectAll,null,null,"control A");

//Options menu
//get the MenubarMenu object from the MenubarMenuBar
var menu = plugins.it2be_menubar.addMenu();
//set the MenubarMenu object
menu.set("Opties");
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Backup eigen notities",globals.createBackup);
//get the MenubarMenuItem object from the (Sub-)menu
item = menu.addItem();
//set the MenubarMenuItem object
item.set("Herstel eigen notities",globals.updateNotes);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Software registreren",globals.activateLicence);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Installeer licentie",globals.licenceUpdate);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Activeer log",globals.activateLog);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Deactiveer log",globals.deactivateLog);

//Help menu
//get the MenubarMenu object from the MenubarMenuBar
var menu = plugins.it2be_menubar.addMenu();
//set the MenubarMenu object
menu.set("Help");
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Help",forms.sb_form.openHelp);
//get the MenubarMenuItem object from the (Sub-)menu
var item = menu.addItem();
//set the MenubarMenuItem object
item.set("Over",globals.openAbout);

}

/**
 * @properties={typeid:24,uuid:"e8c7e018-5d46-40b4-b05f-7a7d31d70479"}
 * @AllowToRunInFind
 */
function test()
{
var aux = ''
aux = 'pk\tword_strong\tprevious\tnext\n'
forms.word_concordance.controller.find()
forms.word_concordance.verse_id = '^'
forms.word_concordance.controller.search()
//application.output(''+forms.word_concordance.foundset.getSize())
for(var i=1;i<=forms.word_concordance.foundset.getSize();i++){
	application.setStatusText(i+' of '+forms.word_concordance.foundset.getSize())
	application.updateUI()
	var record = forms.word_concordance.foundset.getRecord(i)
	aux = aux.concat(record.pk)
	aux = aux.concat('\t')
	forms.word_study.controller.find()
	forms.word_study.pk = record.calc_word_study_id
	forms.word_study.controller.search()
	if(forms.word_study.foundset.getSize()>0){
		forms.word_study.foundset.setSelectedIndex(1)
		aux = aux.concat(forms.word_study.word_strong)
		aux = aux.concat('\t')
	}
	forms.fill_word_study_concordance.controller.find()
	forms.fill_word_study_concordance.pk = record.pk - 1
	forms.fill_word_study_concordance.controller.search()
	var rec_prev = forms.fill_word_study_concordance.foundset.getRecord(1)
	forms.verses_fill_in.controller.find()
	forms.verses_fill_in.pk = rec_prev.verse_id
	forms.verses_fill_in.controller.search()
	forms.verses_fill_in.foundset.setSelectedIndex(1)
	aux = aux.concat(forms.verses_fill_in.subscr_id)
	aux = aux.concat('\t')
	
	forms.fill_word_study_concordance.controller.find()
	forms.fill_word_study_concordance.pk = record.pk + 1
	forms.fill_word_study_concordance.controller.search()
	var rec_next = forms.fill_word_study_concordance.foundset.getRecord(1)
	forms.verses_fill_in.controller.find()
	forms.verses_fill_in.pk = rec_next.verse_id
	forms.verses_fill_in.controller.search()
	forms.verses_fill_in.foundset.setSelectedIndex(1)
	aux = aux.concat(forms.verses_fill_in.subscr_id)
	aux = aux.concat('\n')
	
}

plugins.file.writeTXTFile('c:\\concordances.txt', aux)
}

/**
 * @properties={typeid:24,uuid:"0523b2d8-c0cd-4eeb-ac6c-9b80a8264b7b"}
 */
function testLP()
{
if(utils.stringMiddle(application.getOSName(),1,7) == "Windows")
{
	var file = plugins.file.convertStringToJSFile('servoy_runtime.jar')
	var crtDir = file.getAbsolutePath()
	var name = ''
	var index = crtDir.lastIndexOf('\\')
	crtDir = crtDir.substring(0,index)
	file = plugins.file.convertStringToJSFile('c:\\WINDOWS')
	if(file.exists()){
			name = 'C:\\WINDOWS\\SB.lic'
	}
	else {
			file = plugins.file.convertStringToJSFile('c:\\WINNT')
			if(file.exists()){
				name = 'C:\\WINNT\\SB.lic'
			}
			else {
				plugins.dialogs.showInfoDialog('', 'The Windows folder cannot be found.','OK');
			}
	}
	//application.output(name)
	//application.output(crtDir)
		
    var succes =plugins.SB.copyProtection(name)
	var goodSize = globals.maxOTChapter>0 ? 10607 : 10735
	var plFile = crtDir + "\\plugins\\SBPlugin.jar"
	var size  = plugins.file.getFileSize(plFile)
	var val= "error"
		
	if(size==goodSize)
		val = plugins.SB.test(name, crtDir)
//	val ="valid"
		
	//application.output("Result" + val)
	var aux = val + '\n';
	//var success = plugins.file.writeTXTFile(crtDir+'/log.txt',aux);
	if(val == "valid"){
		var nrCP = plugins.SB.copyProtection(name)
		aux = aux.concat(nrCP)
		if( nrCP == '0'){
		 	//no copy protection
		    
			var zile = plugins.SB.remainingDays(name)	
			if (zile>=0 && zile<30)
			{
			plugins.dialogs.showInfoDialog('','' + (parseInt(zile )+1) +  ' dagen tot licentie verloopt. Gelieve uw software te registreren.','OK');
			}
			globals.userInstallationCode = plugins.SB.getInstallationCode(name);
		}
		else {
			//copy protection
			var zile = plugins.SB.remainingDays(name)	
			if (zile>=0  && zile<30)
			{
			plugins.dialogs.showInfoDialog('','' + (parseInt(zile )+1) +  ' dagen tot licentie verloopt. Gelieve uw software te registreren.','OK');
			}
			globals.userInstallationCode = plugins.SB.getInstallationCode(name);
		}
		//var success = plugins.file.writeTXTFile(crtDir+'/log.txt',aux);
		application.showForm(forms.sb_form)
		forms.sb_form.load();
	} else if(val == "demo"){
		application.showForm(forms.sb_form)
		globals.userInstallationCode = plugins.SB.getInstallationCode(name)
		forms.sb_form.load();
	} else if(val == "date") {
		plugins.dialogs.showInfoDialog('', 'De systeem datum was aangepast. Gelieve de systeem datum aan te passen en de applicatie te herstarten.', 'OK');
		globals.userInstallationCode = plugins.SB.getInstallationCode(name);
		application.showForm(forms.inputLicenceData);
		if(globals.customMenuDone == 0){
			globals.modifyMenu()
			globals.customMenuDone = 1
		}
		globals.restrictedMenu()
	} else {
		plugins.dialogs.showInfoDialog('', 'Licentie is niet geldig.','OK');
		globals.restrictedMenu()
		//show register window
		globals.userInstallationCode = plugins.SB.getInstallationCode(name)
		application.showForm(forms.inputLicenceData)
				if(globals.customMenuDone == 0){
			globals.modifyMenu()
			globals.customMenuDone = 1
		}
		globals.restrictedMenu()

		//application.exit();
	}
} else {
	var file = plugins.file.convertStringToJSFile('servoy_runtime.jar')
	var crtDir = file.getAbsolutePath()
	var index = crtDir.lastIndexOf('/')
	crtDir = crtDir.substring(0,index)
	//application.output(crtDir);
	
	//test if SBMac plugin exists - if not exit servoy
	var a = plugins.allnames;
	var isSBMacplugin = 0;
	for ( var i = 0 ; i < a.length ; i++ )
	{
	if (a[i].equals("SBMac")) isSBMacplugin = 1;
	}
	if (!isSBMacplugin) application.exit();
	
	var message = plugins.SBMac.testLic("14263")
	//application.output(message);
//	plugins.file.writeTXTFile(crtDir +'/log.txt',message);
	var index1 = message.indexOf('Init 0')
	if(index1 >=0 ){
		var index2 = message.indexOf('Find dongle 85')
		if(index2 >= 0){
			var index3 = message.indexOf('Read dongle 1')
			if(index3 >= 0){
				if(globals.var_init == 0){
					application.showForm(forms.sb_form)
					globals.var_init = 1
				}
			}
			else {
				index3 = message.indexOf('Read dongle -2')
				if(index3 >= 0){
					plugins.dialogs.showInfoDialog('', 'De gebruikerscode is fout. Gelieve de juiste gebruikerscode in te geven.', 'OK')
				} else {
					plugins.dialogs.showInfoDialog('', 'Fout tijdens uitlezen dongle.', 'OK')
				}
				application.exit()

			}
		}
		else {
			if(arguments[0] == true){
				plugins.dialogs.showInfoDialog('', 'De dongle is niet gevonden. Gelieve de dongle in uw USB poort te stoppen.', 'OK')
			}
			return "ok"
		}
	}
	else {
		plugins.dialogs.showInfoDialog('', 'Kan de dongle niet initialiseren.', 'OK')
		application.exit()
	}
}
}

/**
 * @properties={typeid:24,uuid:"a1648135-12b5-41a3-84a4-345a223eb237"}
 */
function testLPWeb()
{
application.showForm(forms.sb_form)
forms.sb_form.load();

}

/**
 * @properties={typeid:24,uuid:"af3c9e85-59c5-47ba-8f49-4a49c3b71d67"}
 */
function testMethod()
{
//application.output(plugins.UserManager.getVersion())
}

/**
 * @properties={typeid:24,uuid:"ae1c6b50-8bae-4fed-9c51-b7e583652277"}
 */
function testplugin()
{
//var str = plugins.start.test()
var str = plugins.UserManager.getVersion()
//application.output("UserManager Version: " + str)
}

/**
 * @properties={typeid:24,uuid:"0806f5db-f3dd-4938-bf39-e54e0b5a237d"}
 */
function TextChangeFont1ToCaps()
{
//Not working

var text = arguments[0]

if (text==null)
	return null

var regexp = /<font1>([.]+)<\/font1>/gi
var temp = text.replace(regexp, '<font1>$1.toUpperCase()<\/font1>')
return temp
}

/**
 * @properties={typeid:24,uuid:"8744aeef-c625-40f7-8127-dbf4739af5b2"}
 */
function TextChangeFReferenceToSuper()
{
var text = arguments[0]

var regexp = /<f>([\d]+)<\/f>/gi
var temp = text.replace(regexp, '<f><sup><b>$1</b></sup></f>')

return temp
}

/**
 * @properties={typeid:24,uuid:"79ba88c9-ac6c-4ccc-b5ea-396e9cf54619"}
 */
function TextChangeSuReferenceToSuper()
{
var text = arguments[0]

var regexp = /<su>([.]+)<\/su>/gi
var temp = text.replace(regexp, '<sup>$1</sup>')

return temp
}

/**
 * @properties={typeid:24,uuid:"c642480d-0482-4f1e-9fc6-827fc866692b"}
 */
function TextChangeToGreek()
{
var original = arguments[0]
var index1 = original.indexOf('<pct>')
var index2 = original.indexOf('</pct>')
if(index1 > 0){
		var newOriginal = original.substring(0,index1)
		
}  else if(index1 == 0) {
		var newOriginal = original.substring(index2+6)
}
else
		var newOriginal = original
var greek = plugins.SB_NT.getGreek(newOriginal)
if(index1 > 0) {
		greek = greek.concat(original.substring(index1+5,index2))
}
else if(index1 == 0){
	 	var aux = greek
		greek = original.substring(index1+5,index2)
		greek = greek.concat(aux)
		
}	

original = greek

return original

}

/**
 * @properties={typeid:24,uuid:"822956a1-9f27-4add-95a6-0fa1b0b3d014"}
 */
function TextFlinkFillIn()
{
var text = arguments[0]

var regexp = /<f><sup><b>([\d]+)<\/b>/gi
var temp = text.replace(regexp, '<f><sup><b><a href="javascript:globals.flink(\'$1\')">$1</a><\/b>')

return temp;

}

/**
 * @param text Text
 * @properties={typeid:24,uuid:"c62f32ec-b166-4b80-b242-7151ec7fe590"}
 */
function TextReplaceHebrewInFootnotes(i)
{
	var input = i+"";
	var regexp = /<tr>([^<]+)<\/tr>/i
	var arr = input.match(regexp)
	var heb
	
	while (arr!=null && arr.length>0)
	{
		//Migratie: Alle plugins.SILEzraToUnicode vervangen
		heb = "<tra><font style=\"font-family: SIL Heb Trans\">"+globals.stringToCharNo(arr[1])+"</font></tra>"
		input = input.replace(regexp, heb)
		arr = input.match(regexp)
	}
	
	/*	
	var text = arguments[0]
	var arr = text.match(/<tr>([^<]+)<\/tr>/i)
	var heb
	
	while (arr!=null && arr.length>0)
	{
		heb = "<tra><font style=\"font-family: 'SIL Heb Trans'\">"+plugins.SILEzraToUnicode.convertToEzra(arr[1])+"</font></tra>"
		text = text.replace(/<tr>([^<]+)<\/tr>/i, heb)
		arr = text.match(/<tr>([^<]+)<\/tr>/i)
	}	
	
	//application.output(arguments[0])
	//application.output(text)
	
	return text
	*/
}

/**
 * @properties={typeid:24,uuid:"d25b28a1-14b0-422f-aa18-3f2c6951ca4e"}
 */
function TextReplaceSpecialChars()
{
var temp = arguments[0]
var aux
do {
	aux = temp
	temp = temp.replace('e^','&#275;')
	temp = temp.replace('a^','&#257;')
	temp = temp.replace('i^','&#299;')
	temp = temp.replace('o^','&#333;')
	temp = temp.replace('u^','&#363;')
	temp = temp.replace(">Q<",">&#8216<");
	temp = temp.replace(">W<",">&#8217<");
	
	temp = temp.replace('E^','&#274;')
	temp = temp.replace('A^','&#256;')
	temp = temp.replace('I^','&#298;')
	temp = temp.replace('O^','&#332;')
		
	temp = temp.replace("</I>W","</I>&#8217");	
	temp = temp.replace("#91","&#8216")
	temp = temp.replace("#92","&#8217")
	
	temp = temp.replace("â€™", "&#8217;")
	temp = temp.replace("â€˜", "&#8216;")
	temp = temp.replace("<l level=\"1\">", "<l level=\"1\" ><br>&nbsp;&nbsp;&nbsp;&nbsp;")
	//temp = temp.replace("^","-")
} while( temp != aux )

return temp
}

/**
 * @properties={typeid:24,uuid:"8c9e2515-6dc9-4fb9-99b1-8fdc28e67b89"}
 */
function TextTlinkClear()
{
var text = arguments[0]
var index1 = text.indexOf('<tlink>')
while(index1 >= 0){
	var index2 = text.indexOf('\=',index1)
	var index3 = text.indexOf('</tlink>',index1)
	var aux = text.substring(0,index1)
	if(index2 >= 0){
		aux = aux.concat(text.substring(index1+7,index2))
	}
	else {
		aux = aux.concat(text.substring(index1+7,index3))
	}
	aux = aux.concat(text.substring(index3+8))
	aux = aux.concat()
	text = aux
	index1 = text.indexOf('<tlink>',index1+1)
}

return text
}

/**
 * @properties={typeid:24,uuid:"603c1a5b-c2ce-441e-9a9a-2694a963a420"}
 */
function TextTlinkFill()
{
var text = arguments[0]
var index1 = text.indexOf('<tlink>')
while(index1 >= 0){
	var index2 = text.indexOf('\=',index1)
	var index3 = text.indexOf('</tlink>',index1)
	if(index3 >=0)
	{
		if(index2 >= 0){
			var number = text.substring(index2+1,index3)
		}
		else
		   var number = ''
		var aux = text.substring(0,index1)
		aux = aux.concat('<a href="javascript:globals.tlink(\'')
		aux = aux.concat(number)
		aux = aux.concat('\')">')
		if(index2 >= 0){
			aux = aux.concat(text.substring(index1+7,index2))
		}
		else {
			aux = aux.concat(text.substring(index1+7,index3))
		}
		aux = aux.concat('</a>')
		aux = aux.concat(text.substring(index3+8))
		text = aux
	}
	index1 = text.indexOf('<tlink>',index1+1)
}

return text

}

/**
 * @properties={typeid:24,uuid:"706d2501-5e4f-4238-99be-f2ed0cff3079"}
 */
function TextWlinkClear()
{
var text = arguments[0]
var index1 = text.indexOf('<wlink>')
while(index1 >= 0){
	var index2 = text.indexOf('\=',index1)
	var index3 = text.indexOf('</wlink>',index1)
	var aux = text.substring(0,index1)
	if(index2 >= 0){
		aux = aux.concat(text.substring(index1+7,index2))
	}
	else {
		aux = aux.concat(text.substring(index1+7,index3))
	}
	aux = aux.concat(text.substring(index3+8))
	aux = aux.concat()
	text = aux
	index1 = text.indexOf('<wlink>',index1+1)
}

return text
}

/**
 * @properties={typeid:24,uuid:"19eb2a38-bc66-437a-b6c2-a2881c684d46"}
 */
function TextWlinkFill()
{
var text = arguments[0]
var index1 = text.indexOf('<wlink>')
while(index1 >= 0){
	var index2 = text.indexOf('\=',index1)
	var index3 = text.indexOf('</wlink>',index1)
	if(index3 >=0)
	{
		if(index2 >= 0){
			var number = text.substring(index2+1,index3)
		}
		else
		   var number = ''
		var aux = text.substring(0,index1)
		aux = aux.concat('<a href="javascript:wlink(\'')
		aux = aux.concat(number)
		aux = aux.concat('\')">')
		if(index2 >= 0){
			aux = aux.concat(text.substring(index1+7,index2))
		}
		else {
			aux = aux.concat(text.substring(index1+7,index3))
		}
		aux = aux.concat('</a>')
		aux = aux.concat(text.substring(index3+8))
		text = aux
	}
	index1 = text.indexOf('<wlink>',index1+1)
}

return text

}

/**
 * @properties={typeid:24,uuid:"dff77f43-a6b3-4f19-892f-44e6db8e7921"}
 */
function tlink()
{
if(utils.stringLeft(currentcontroller.getName(), 8) == "sb_edit_")
{
	return
}
	//application.output('TLINK WERKT')
	// Toggle between the elements opn the footnote screen
	// Added by RB / 02/07/2010
	// TODO: Notities moet in nieuw tab getoond worden...
	//forms.book_notes.elements.notec.visible = false;
	//forms.book_notes.elements.note.visible = true;
	
	if(globals.flag == "false")
	{
		globals.flag = "true";
		globals.tlink(arguments[0]);
	}
	
	var arg = ''
	arg = arg.concat(arguments[0])
	
	var verse_ids = globals.getVerseIdFromTlink(arg);
	
	var showOnlySV = false
	if(!arguments[1])
	{
		var myhtml = globals.viewVerses(verse_ids, showOnlySV);
	} else {
		var myhtml = globals.viewVerses(verse_ids, showOnlySV, true);
	}

	
	
	
	if(!arguments[1] && verse_ids.length > 5)
	{	
		var vShowAll = i18n.getI18NMessage('html_showAll');
		myhtml = myhtml.concat("<b><a href=\"javascript:globals.tlink('"+arguments[0]+"', 'true')\">" + vShowAll + "</a></b>");
	}
	
	
	myhtml = myhtml.concat('</body></html>')
	if(globals.chkYouInThisVerse == 1)
	{
		globals.chkYouInThisVerse = 0
		myhtml = "<html><body><font color=\"red\">" + i18n.getI18NMessage('cvb.lbl.verseSelected') + "</font></body></html>";
	}
	else if(myhtml.length <= 41 && globals.sb_demo_chk == 1)
	{
		myhtml = "<html><body><font color=\"red\">" + i18n.getI18NMessage('CVB.lbl.youNeedFullversion') + "</font></body></html>";
	} else if (myhtml.length <= 41) {
		myhtml = "<html><body><font color=\"red\">" + i18n.getI18NMessage('CVB.lbl.verseNotPresent') + "</font></body></html>";
	}
	//TODO:Rick screwed this one up! 
	globals.notes = myhtml
	forms.sb_form.resizeSplitTab()
	//var dl = forms.sb_form.elements.bean_321.dividerLocation
	//forms.sb_form.elements.bean_321.dividerLocation = dl
	//forms.sb_form.elements.bean_321.bottomComponent = forms.sb_form.elements.tabs_book_notes


}

/**
 * @properties={showInMenu:true,typeid:24,uuid:"b4a02fed-00d2-4fcf-b0d6-925553df6467"}
 */
function update()
{

//update the solution, rewrite the /lib/solution.runtime file
//var binaryFile = plugins.http.getMediaData('http://www-formal.stanford.edu/jmc/whatisai/whatisai.html');
var binaryFile = plugins.http.getMediaData('aa')
//update the database, rewrite /database/sb.db, delete sb.log
var binaryDB = plugins.http.getMediaData('aa')

var file = plugins.file.convertStringToJSFile('servoy_runtime.jar')
var name = file.getAbsolutePath()
if( binaryFile.length != 0){
	if(utils.stringMiddle(application.getOSName(),1,7) == "Windows") 	{ 
		var index = name.lastIndexOf('\\')
		var fileName = name.substring(0,index)
		//fileName = fileName.concat('\\lib\\solution.runtime')
		fileName = fileName.concat('\\docs\\test.html')
		var success = plugins.file.writeFile(fileName,binaryFile);
	}
	else {
		var index = name.lastIndexOf('/')
		var fileName = name.substring(0,index)
		//fileName = fileName.concat('/lib/solution.runtime')
		fileName = fileName.concat('/docs/test.html')
		var success = plugins.file.writeFile(fileName,binaryFile);
	}
}
else {
	var thePressedButton = plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.noNewUpdate','i18n:CVB.lbl.ok');
}

if( binaryDB.length != 0){
	if(utils.stringMiddle(application.getOSName(),1,7) == "Windows") 	{ 
		var index = name.lastIndexOf('\\')
		name = name.substring(0,index)
		fileName = name.concat('\\database\\sb.db')
		var success = plugins.file.writeFile(fileName,binaryFile);
		
		fileName = name.concat('\\database\\sb.log')
		if( fileName.exists()){
			plugins.file.deleteFile(fileName)
		}
		// read the backup file and copy the data in the notes table
		fileName = name.concat('\\docs\\backup.txt')
		var textData = application.readTXTFile(fileName);
		var i = 0
		while( i < textData.length ){
			var index = textData.indexOf('<note>',i)
			if( index >= 0 ){
				forms.notes.controller.newRecord()
				var index1 = textData.indexOf(' ',index)
				var str = textData.substring(index+6,index1)
				forms.notes.pk = parseInt(str)
				var index2 = textData.indexOf(' ',index1+1)
				var str = textData.substring(index1+1,index2)
				forms.notes.verse_id = parseInt(str)
				var index3 = textData.indexOf('</note>',index)
				forms.notes.note = textData.substring(index2+1,index3)
				forms.notes.controller.saveData()
				i = index + 6
			}
			else {
				break
			}
		}
	}
	else {
		var index = name.lastIndexOf('/')
		name = name.substring(0,index)
		fileName = name.concat('/database/sb.db')
		var success = plugins.file.writeFile(fileName,binaryFile);
		fileName = name.concat('/database/sb.log')
		if( fileName.exists()){
			plugins.file.deleteFile(fileName)
		}
	}
	
}
else {
	var thePressedButton = plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.noNewUpdateDB','i18n:CVB.lbl.ok');
}

}

/**
 * @properties={typeid:24,uuid:"9a91cf72-6edc-49fb-a0b4-809521a6ce74"}
 * @AllowToRunInFind
 */
function updateNotes()
{

	// read the backup file and copy the data in the notes table
	var jsfile = plugins.file.getHomeDirectory()
	var path = jsfile.getAbsolutePath()
	var fileName = ''
	if(utils.stringMiddle(application.getOSName(),1,7) == "Windows") 	{ 
		fileName = path.concat('\\backupSBNotes.txt')
	}
	else {
		fileName = path.concat('/backupSBNotes.txt')
	}
	var myfile = plugins.file.convertStringToJSFile(fileName)
	if( ! (myfile.exists())){
		var newfile = plugins.file.showFileOpenDialog(1,plugins.file.getHomeDirectory());
		if( newfile.getAbsolutePath() != plugins.file.getHomeDirectory().getAbsolutePath() && newfile.isFile()) {
			fileName = newfile.getAbsolutePath()
		} else {
			fileName = ''
		}		
		
	}
	//application.output(fileName)
	if( fileName != ''){
		var textData = application.readTXTFile(fileName);
		if(textData.length > 0){
//			forms.book_notes.foundset.deleteAllRecords();
			var i = 0
			while( i < textData.length ){
				var index = textData.indexOf('<note>',i)
				if( index >= 0 ){
					forms.notes.controller.find()
					var index1 = textData.indexOf(' ',index)
					var str = textData.substring(index+6,index1)
					
					forms.notes.pk = parseInt(str)
					forms.notes.controller.search()
					if(forms.notes.foundset.getSize()==0)
						forms.notes.controller.newRecord()
					
					var index2 = textData.indexOf(' ',index1+1)
					var str = textData.substring(index1+1,index2)
					forms.notes.verse_id = parseInt(str)
					var index3 = textData.indexOf('</note>',index)
					forms.notes.note = textData.substring(index2+1,index3)
					forms.notes.controller.saveData()
					i = index + 6
				}
				else {
					break
				}
			}
			plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.notesRestored','i18n:CVB.lbl.ok')
		} else {
				plugins.dialogs.showInfoDialog('', 'i18n:cvb.message.notesNotRestored','i18n:CVB.lbl.ok');
		}
	}
	
}

/**
 * @properties={typeid:24,uuid:"f193795b-505f-42d8-83e0-b658efd40579"}
 */
function viewVerse(event)
{
var old= globals.selected_verse_id
globals.selected_verse_id = arguments[0]

globals.setBookChapVerse(globals.selected_verse_id)

globals.doNotPopup = 1;
globals.showOTData(globals.isOT());
globals.doNotPopup = null;
//Added
forms.book_notes.viewNotesForSelectedVerse()

forms.sb_form.setBookId(event);
forms.sb_form.setChapterId(event);
forms.sb_form.setVerseIdNew(globals.selected_verse_id);
}

/**
 * @properties={typeid:24,uuid:"6c368a35-ffba-4d7a-a672-e5f41325fdc5"}
 */
function viewVerses()
{
var verse_ids = arguments[0]
var myhtml = '<html><body><table>'

var showOnlySV = arguments[1]


if(!arguments[2] && verse_ids.length > 5)
{
	vMax = 5;
} else {
	vMax = verse_ids.length
}

for(var i=0; i<vMax; i++)
{
	if(verse_ids[i]==globals.selected_verse_id)
	{
		globals.chkYouInThisVerse = 1
		continue;
	} else
	{
		globals.chkYouInThisVerse = 0
	}
	myhtml += '<tr><td valign=\"top\" nowrap><table><tr><td><a href=\"javascript:globals.viewVerse('
	myhtml += verse_ids[i]
	myhtml += ')\"><font color=\"#000000\">'
	globals.setVersePath(verse_ids[i]);
	myhtml += globals.verse_path
	myhtml += '</font></a></td></tr></table></td><td valign=\"top\">'
	myhtml += globals.getTranslationsForVerse(verse_ids[i], showOnlySV)
	myhtml += '</td></tr>'
}

myhtml += '</table>';

return myhtml

}

/**
 * @properties={typeid:24,uuid:"05ea7848-315c-4803-84fa-93b24c6ace14"}
 */
function wlink()
{
var vUrl = application.getServerURL()
//plugins.dialogs.showErrorDialog('', vUrl);

if(plugins.it2be_tools.arrayContains(globals.sb_gESServerURLs, globals.sb_gCurrentServerUrl))
{
	return false;
}

if(utils.stringLeft(currentcontroller.getName(), 8) == "sb_edit_")
{
	return
}

if(globals.flag == "false")
{
	globals.flag = "true";
	globals.wlink(arguments[0]);
}
var arg = ''
arg = arg.concat(arguments[0])
globals.myWordStudyID=arg
globals.selectedWordStudy = arg
var continueCounter = arguments[1]
if(!continueCounter)
	globals.iConcordance = 0

//now always NT at concordance
if(false)
{
//	application.setStatusText('Even geduld...')	
//	application.updateUI()
	
	var concordances = global_to_verses.concordance_lookup
	
	if(concordances!=null)
	{
	
		var ind = concordances.indexOf("<w>"+arg,0)
		var ind2 = concordances.indexOf("</w>", ind)
		var ind3 = concordances.indexOf("<vs>", ind)
		
		var word_concordance = 	concordances.substring(ind3, ind2)
		
		var concordance_array = word_concordance.split("<vs>")
		var length = concordance_array.length
		if(length>0)
		{
			var concordantie='<table><tr><td colspan=3><B>Concordantie</B></td></tr>'
			concordantie += globals.viewVerses(concordance_array.slice(globals.iConcordance+1, globals.iConcordance+globals.step_size+1), true)
			
			concordantie = concordantie.concat('<tr><td>')
			if(globals.iConcordance >= globals.step_size) {
				concordantie = concordantie.concat('<a href=\"javascript:globals.scrollConcordance(-'+globals.step_size+')\">Vorige</a>')
			}
			concordantie = concordantie.concat('</td><td>')
			if(globals.iConcordance < (length-globals.step_size)){
				concordantie = concordantie.concat('<a href=\"javascript:globals.scrollConcordance('+globals.step_size+')\">Volgende</a>')
			}
			concordantie = concordantie.concat('</td></tr>')	
			concordantie = concordantie.concat('</table>')
		
			globals.study_analyze = concordantie
		}
	//	application.setStatusText('gereed')	
	//	application.updateUI()
	}
}
else
	forms.word_study.viewWordStudy()
}

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"21bede14-6d79-4540-afca-aed6dbe84b93",variableType:4}
 */
var sb_demo_chk = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"53c40996-286b-4b9d-834d-1d10d7450e20",variableType:4}
 */
var sb_gCurrentGroupCode;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"7ea51ca4-d508-4cbe-b23f-ee747dbad763",variableType:4}
 */
var sb_gCurrentOrgID;

/**
 * @properties={typeid:35,uuid:"714f7d64-851c-4769-8575-5bb64b2af1f8",variableType:-4}
 */
var sb_gCurrentServerUrl;

/**
 * @properties={typeid:35,uuid:"113b4490-1886-43ed-8f11-3c1c45db42e0",variableType:-4}
 */
var sb_gCurrentSession;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"8839d796-dbc8-486b-a5e7-0f0cf7b7110d",variableType:4}
 */
var sb_gCurrentUserID;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"b6e298d6-bcd0-4307-aaa7-0a60c68e3d1b",variableType:12}
 */
var sb_gCurrentUserUUID = '';

/**
 * @properties={typeid:35,uuid:"17b9f64b-478d-4877-92d3-d95f0d70d962",variableType:-4}
 */
var sb_gDEVServerURLs;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"1715c5f9-3a12-4992-a0cf-0bf02a82046b",variableType:4}
 */
var sb_gDialogStatus;

/**
 * @properties={typeid:35,uuid:"229fc09d-cefb-47ff-b624-dd2bc3d832c7",variableType:-4}
 */
var sb_gESServerURLs;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"278a6589-6273-4b0e-90da-9ff40659ff11",variableType:12}
 */
var sb_gLoginName = '';

/**
 * @properties={typeid:35,uuid:"11a692f2-209b-4ed8-bf8e-250a8bb3866e",variableType:-4}
 */
var sb_gNLServerURLs;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"069ff6b9-0c2c-421b-a3ee-8fca42ce1ac3",variableType:12}
 */
var sb_gOrganisation = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"d2f37f04-de7c-4ef9-8ecd-06a1df4638ef",variableType:12}
 */
var sb_gPassword = '';

/**
 * @type Date
 *
 * @properties={typeid:35,uuid:"6c07ae4f-e605-4cb6-90dc-c394081b91ef",variableType:93}
 */
var sb_gTempDate01;

/**
 * @type Date
 *
 * @properties={typeid:35,uuid:"221b3687-4f9b-4778-9349-4aca1e44641c",variableType:93}
 */
var sb_gTempDate02;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"fed91f34-8ad2-4fcd-8288-a36a7c648b3d",variableType:12}
 */
var sb_gTempText01 = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"e2cadd41-59a4-4017-b6fe-153b221bd577",variableType:12}
 */
var sb_gVersion = '6.0.0-alpha';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"022f6749-54cc-4a74-9a1e-7a1144ffaa39",variableType:12}
 */
var sb_UserSearchValue = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"bc372ccb-80b7-4d7c-88c5-016f613f99fb",variableType:4}
 */
var sbMaxUsers;

/**
 * @properties={typeid:24,uuid:"553ac502-16c3-426c-9c76-096824c21755"}
 */
function sb_APP_close()
{
application.removeAllClientInfo()
if(globals.sb_gCurrentSession){
	globals.sb_gCurrentSession.logoff_stamp = application.getServerTimeStamp()
	databaseManager.saveData()
}
}

/**
 * @properties={typeid:24,uuid:"016ed33d-d60f-4a19-9f5d-5584aea58dc8"}
 */
function sb_APP_logoff()
{
security.logout()
application.closeSolution('CvB_online')
}

/**
 * @properties={typeid:24,uuid:"13a9d54b-e7ca-4471-a5db-3581c3a838ef"}
 */
function sb_APP_startup()
{
/**************************************************************************************
Method: 	globals.sb_APP_startup();

Created:	Karel Broer,
Modifier:	Karel Broer 02.03.2009 //get external ipaddress from client via http request
Modifier:	Karel Broer 03.04.2009 //added remove admin buttons for regular users
Modifier:	Karel Broer 21.04.2009 //check if vIP contains ipadress 

Purpose:	Run startup methods

Arguments:	- 

**************************************************************************************/	
//Register the plugins
globals.sb_SYS_registerPlugins();

//Fill the globals with all various server IPS or DNS names
globals.chkDevFix = 1;
globals.sb_gNLServerURLs = ["http:\/\/87.249.116.144","http:\/\/online.studiebijbel.nl"]
globals.sb_gESServerURLs = ["http:\/\/217.114.108.59"]
globals.sb_gDEVServerURLs = ["http:\/\/87.249.116.177","http:\/\/ts.ambitius.com"]
var vUrl = application.getServerURL()
var vUrlIndex = utils.stringPosition(vUrl, ":", 6, 1)
globals.sb_gCurrentServerUrl = utils.stringLeft(vUrl,(vUrlIndex -1))

if(application.getApplicationType() == 3 || globals.sb_gCurrentServerUrl == "http:\/\/127.0.0.1" || globals.sb_gCurrentServerUrl == "http:\/\/localhost" )
{
	var vDialog = globals.svy_mod_dialogs_global_showQuestionDialog("Selecteer versie", "Nederlands Versie 1 - Spaans Versie 2 - Ontwikkel Versie 3", "Versie 1", "Versie2", "Versie3")
	if(vDialog == "Versie 1"){
		globals.sb_gNLServerURLs.push("http:\/\/127.0.0.1")
		globals.sb_gNLServerURLs.push("http:\/\/localhost")
		//application.output("nederlands")
	} else if(vDialog == "Versie 2")
	{
		globals.sb_gESServerURLs.push("http:\/\/127.0.0.1")
		globals.sb_gESServerURLs.push("http:\/\/localhost")
		//application.output("Spaans")
	} else 
	{
		globals.sb_gDEVServerURLs.push("http:\/\/127.0.0.1")
		globals.sb_gDEVServerURLs.push("http:\/\/localhost")
		//application.output("DEV")
	}
		
	
}


//globals.sb_gCurrentServerURL = "http:\/\/217.114.108.59"
var vIcon = plugins.http.getMediaData('media:///SB.png')
plugins.it2be_tools.setSolutionIcon(vIcon)
plugins.it2be_tools.setSolutionTitle("i18n:CVB.application.title")


//Remove all menu bars and create custom one after login
var ClientType = application.getApplicationType()
if(ClientType != 3)
{
	plugins.it2be_menubar.removeAllMenus()
} else {
	plugins.it2be_menubar.resetMenuBar()
}
if(plugins.it2be_tools.arrayContains(globals.sb_gESServerURLs, globals.sb_gCurrentServerUrl))
{
	i18n.setLocale('es', 'Spain');
	application.updateUI(1)
	globals.sb_search_book_translations = "RVR1909\nRVR1960\nRVR1995";
} else if(plugins.it2be_tools.arrayContains(globals.sb_gNLServerURLs, globals.sb_gCurrentServerUrl))
{
	i18n.setLocale('nl', 'Nederland');
	application.updateUI(1)
} else if(plugins.it2be_tools.arrayContains(globals.sb_gDEVServerURLs, globals.sb_gCurrentServerUrl)) {
	//i18n.setLocale('nl', 'Nederland');
	//application.updateUI(1)
	var vQuestion = plugins.dialogs.showWarningDialog('i18n:CVB.dialog.attention', 'i18n:cvb.message.loginDeveloper', 'i18n:cvb.btn.yes', 'i18n:cvb.btn.no');
	if(vQuestion == i18n.getI18NMessage('cvb.btn.no'))
	{
		application.exit();
	}
} else 
{
	var vQuestion = plugins.dialogs.showWarningDialog('Error', 'Server IP Error. Neem contact op met CvB', 'ok');
	if(vQuestion == 'ok')
	{
		application.exit();
	}
}



//get external ipadress from client
var vIP = plugins.http.getPageData('http:\/\/www.ambitius.com\/tools\/getip.php?key=ambhash')

//store CVB files
globals.sb_FILE_storeCvBFiles();

if(!vIP){
	forms.sb_login_frm.controller.show() // go to login form
	return
}

//find organisations that have this ip adres
var vSearchIP = '%' + vIP.toString()
var vSQL = 'SELECT sb_organisation_id FROM sb_organisation WHERE ipaddress_security_chk = ? AND ipaddress LIKE ?'
var vDS = databaseManager.getDataSetByQuery(forms.sb_organisation.controller.getServerName(), vSQL, [1, vSearchIP], 1)
if(vDS && vDS.getMaxRowIndex() > 0){ //go to main form if ipadress is valid
	globals.sb_gCurrentOrgID = vDS.getValue(1,1)
	application.addClientInfo(vIP)
	if(!globals.sb_SEC_checkMaxUsers(globals.sb_gCurrentOrgID, vIP)){
		return
	}
	
	globals.sb_gCurrentUserID = null
	globals.sb_gLoginName = plugins.it2be_tools.client().userName
	
	globals.sb_REC_createLogRecord();
	globals.sb_gCurrentSession.used_ip_chk = 1
	globals.sb_gCurrentGroupCode = 3
	databaseManager.saveData()
	
	//globals.sb_MENU_setMenubar()
	globals.sb_FORM_removeElements();;
	
	//Go to MainForm
	forms.sb_form.controller.show()
	
	//globals.sb_NAV_goToMainForm();
}
else {
	forms.sb_login_frm.controller.show() // go to login form
}
}

/**
 * @properties={typeid:24,uuid:"77a10351-f1aa-4312-a9e9-0143f0747422"}
 */
function sb_DATA_sendDataToOnlineSBdatabase()
{
//get sybase servername
var vSybaseServer = forms.one.controller.getServerName()

//get online servername
var vOnlineServer = forms.sbweb_one.controller.getServerName()

//get all table names from online db
var vOnlineTables = databaseManager.getTableNames(vOnlineServer)

//init vars
var vOnlineTableName
var jTable
var vTableFields
var vTableField
var vSybaseSet
var SybaseSize
var vSybaseRecord
var vOnlineRecord
var vOnlineSet
var vOnlineSize

//loop through online tables
for(var t in vOnlineTables){
   vOnlineTableName = vOnlineTables[t]
   
     //in this example we don't want to copy the i18n table data
   if(vOnlineTableName == 'messages'){
     continue;
   }
   
   jTable = databaseManager.getTable(vOnlineServer, vOnlineTableName)

   //get fields from current online table
   vTableFields = jTable.getColumnNames()

   //update status text
   application.setStatusText( 'Copying table ' + vOnlineTableName)

   //load all sybase records
   vSybaseSet = databaseManager.getFoundSet(vSybaseServer, vOnlineTableName)
   vSybaseSet.loadAllRecords()
	SybaseSize = databaseManager.getFoundSetCount(vSybaseSet)
   
   //create online foundset
   vOnlineSet = databaseManager.getFoundSet(vOnlineServer, vOnlineTableName)
   vOnlineSet.loadAllRecords()
	vOnlineSize = databaseManager.getFoundSetCount(vOnlineSet)
	vOnlineSet.deleteAllRecords()
	vOnlineSet.clear()
   
   //loop through sybase foundset
   for(var i = 1 ; i <= vSybaseSet.getSize(); i++){
   
      //get sybase record
      vSybaseRecord = vSybaseSet.getRecord(i)
      
      //create new online record
      vOnlineRecord = vOnlineSet.getRecord(vOnlineSet.newRecord())
      
   
      //loop through fields from current online table
      for(var f in vTableFields){
         vTableField = vTableFields[f]
         
         //set sybase field data in online record, if field exists in sybase
         if(vSybaseRecord[vTableField]){
            vOnlineRecord[vTableField] = vSybaseRecord[vTableField]
         }
      }
      
      databaseManager.saveData()
   }
}

application.setStatusText('Ready')
}

/**
 * @properties={typeid:24,uuid:"f8876ba6-4f52-40d3-85a2-412b8469133c"}
 * @AllowToRunInFind
 */
function sb_DIALOG_showAdminDialog()
{
var vDialogForm = 'sb_admin_org_frm'

if(forms.sb_organisation.controller.find()){
	forms.sb_organisation.sb_organisation_id = globals.sb_gCurrentOrgID
	forms.sb_organisation.controller.search()
}
application.showFormInDialog( forms[vDialogForm],  -1, -1, -1,  -1,  'i18n:CVB.button.admin', false,  false, 'admin', true)

}

/**
 * @properties={typeid:24,uuid:"3c0d5326-e762-4633-ac9d-d9e16905debc"}
 */
function sb_DIALOG_showRootAdminDialog()
{
var vForm = 'sb_admin_root_frm'
application.showFormInDialog( forms[vForm],  -1, -1, -1,  -1,  'i18n:CVB.button.admin', false,  false, 'root', true)
}

/**
 * @properties={typeid:24,uuid:"b2a1bc45-8b72-42f9-8f8a-12b0a58bb26f"}
 */
function sb_DIALOG_showUserInfoDialog()
{
var vDialogForm = 'sb_login_report_dlg'

application.showFormInDialog( forms[vDialogForm],  -1, -1, -1,  -1,  'i18n:CVB.title.userInfo', true,  false, 'user_report', true)
}

/**
 * @properties={typeid:24,uuid:"4e0d9fcf-cde6-4139-a0e8-a4209eb35259"}
 */
function sb_EMAIL_sendLoginSpecs()
{
application.setStatusText('')

var vLoginName = arguments[0]
var vPassword = arguments[1]
var vEmail = arguments[2]
var vFirstname =  arguments[3]
var vLastname =  arguments[4]
var vOrganisation =  arguments[5]
var vFullName =  vFirstname + ' ' + vLastname
var vFullEmail = vFullName + ' <' + vEmail + '>'
var vSubject = 'Welkom bij StudyBible Online!'
var vFrom = 'StudyBible Online <noreply@studiebijbel.nl>'

var vHTML = '<HTML><BODY>'


//show progress bar
forms.sb_contact_dlg.elements.tabs.tabIndex = 2
//plugins.busy.busy(i18n.getI18NMessage('CVB.dialog.sending_email'),true);
application.sleep(1000);

vHTML += 'Beste ' + vFullName + ',<br><br>'
vHTML += 'Welkom bij StudyBible Online.<br><br>'

vHTML += 'Hierbij uw StudyBible Online account informatie:<br><br>'

vHTML += '----------------------------<br>'
vHTML += 'Inlognaam: ' + vLoginName + '<br>'
vHTML += 'Wachtwoord: '+ vPassword + '<br>'
vHTML += 'Organisatie: '+ vOrganisation + '<br>'	
vHTML += '----------------------------<br><br>'

vHTML += 'Bewaar deze email zorgvuldig a.u.b.<br>'
vHTML += 'Mocht u problemen ondervinden met inloggen, neem dan contact op met uw StudyBible Online administrator.<br>'
vHTML += 'Bedankt voor uw inschrijving en veel succes met het gebruik van StudyBible Online!<br><br>'

vHTML += 'Vriendelijke groeten,<br><br>'

vHTML += 'Het StudyBible Online Team'
vHTML += '</BODY></HTML>'

var vAuthorization = new Array("mail.smtp.host=smtp.gmail.com", 
								"mail.smtp.auth=true", 
								"mail.smtp.starttls.enable=true", 
								"mail.smtp.port=587", 
								"mail.smtp.username=studybibleonline@gmail.com", 
								"mail.smtp.password=!noxs4you2");


var vResult = plugins.mail.sendMail(vFullEmail, vFrom, vSubject, vHTML, null, null, null, vAuthorization );
if (!vResult) 
{
	forms.sb_contact_dlg.elements.tabs.tabIndex = 1
	plugins.dialogs.showErrorDialog( 'cvb.message.error',  'i18n:CVB.dialog.error_sending_email',  'i18n:CVB.lbl.ok')
	//plugins.busy.busy(i18n.getI18NMessage('CVB.dialog.error_sending_email'), true)
	//application.sleep(3000);
	return false
}
else {
	forms.sb_contact_dlg.elements.tabs.tabIndex = 1
	plugins.dialogs.showInfoDialog( 'Info',  i18n.getI18NMessage('CVB.dialog.account_data_is_send_by_email', [vFullEmail]), 'i18n:CVB.lbl.ok')
	//plugins.busy.busy(i18n.getI18NMessage('CVB.dialog.account_data_is_send_by_email', [vFullEmail]), true)
	//application.sleep(3000);
	return true
}


}

/**
 * @properties={typeid:24,uuid:"95c3f746-2232-4635-89ce-ffcfc2684b3a"}
 */
function sb_FILE_storeCvBFiles()
{
/**************************************************************************************
Method: 	globals.sb_FILE_storeCvBFiles();

Created:	Karel Broer,  13-10-2008
Modifier:	Adrian Doroiman, (24-11-2008) 
			Added font install on windows
			5-12-2008
			Fixed some bugs in the copy help files script
			2-19-2009
			Tried to cover some possible bugs
Created:	Karel Broer,  10-12-2008 //added font install on Mac

Purpose:	Check if files exist on client cpu, if not, save them to .servoy/CVB folder

Arguments:	- 

**************************************************************************************/	
// Deprecated!
return true;
// JA GEEF MAAR WARNING

var vServoyFolder = '.servoy'
var vOS = application.getOSName()
var vOSNumber = plugins.it2be_tools.client().osNumber
var vSeparator = plugins.it2be_tools.client().fileSeparator
var vLocalClientPath = plugins.it2be_tools.client().userHome
var vServoyFolderPath = vLocalClientPath + vSeparator + vServoyFolder
var vCVBFolder = vServoyFolderPath + vSeparator + 'CVB'
var vFontFolder = "C:\\WINDOWS\\Fonts"
if(vOSNumber == 1){
	vFontFolder = vLocalClientPath + vSeparator + 'Library' + vSeparator + 'Fonts'
}
var vHelpZipFile = 'HTML_2.ZIP'
var vOtherFiles = new Array('Grammatica_totaal.pdf', 'Studiebijbel_handleiding.chm', 'synopsis-bookmarks_totaal.pdf')
var vOtherHelpFiles = new Array('kopiërennaartekstverwerker.htm', 'vensterkopiëren.htm')
var vFontFiles = new Array(
	'GreekSB.ttf',
	'GreekSBBold.ttf',
	'SILEZRA_.TTF',
	'SILHT___.TTF',
	'SILHTB__.TTF',
	'SILHTBI_.TTF',
	'SILHTC__.TTF',
	'SILHTCB_.TTF',
	'SILHTCBI.TTF',
	'SILHTCI_.TTF',
	'SILHTI__.TTF')
var vFontFile
var vOtherFileName
var vZipFilePath = vCVBFolder + vSeparator + vHelpZipFile
var jCvBFolder = plugins.file.convertToJSFile(vCVBFolder)
var vFolderContents = new Array()

var bStopFontInstall = false

//Installing fonts
if(vOSNumber==3)
{
	//Some Windows checkings;
	var jFontFolder = plugins.file.convertToJSFile(vFontFolder)
	if(!jFontFolder.exists())
	{
		vFontFolder = "C:\\WINNT\\Fonts"
		jFontFolder = plugins.file.convertToJSFile(vFontFolder)
		if(!jFontFolder.exists())
			bStopFontInstall = true;
			//application.output('Stop font install!');
		//Don't know how to install fonts unless Windows
	}
}

if(!bStopFontInstall)
{
	//Create folder if not existent; this should happen on MAC only
	var jFontFolder = plugins.file.convertToJSFile(vFontFolder)
	if(!jFontFolder.exists())
		plugins.file.createFolder(vFontFolder)
	
	for(var i in vFontFiles)
	{
		vOtherFileName =  vFontFiles[i]
		vFontFile = vFontFolder + vSeparator + vOtherFileName
		var jZipFilePath = plugins.file.convertToJSFile(vFontFile)
		if(!jZipFilePath.exists())
		{
			vMediaFile = plugins.http.getMediaData('media:///' + vOtherFileName)
			vSucces = plugins.file.writeFile(vFontFile , vMediaFile)
			if(vSucces)
			{
			//	//application.output(vOtherFileName + ' downloaded succesfully')
			}	
		}
	}
}

var vZipFileExists = false
if(!jCvBFolder.exists()){
	plugins.file.createFolder(vCVBFolder)
}
else 
{
	vFolderContents = plugins.file.getFolderContents( jCvBFolder, 'zip')
	vFolderContents = vFolderContents.join(',')
	
	if(utils.stringPatternCount(vFolderContents, vHelpZipFile) > 0){
	//	//application.output('Helpfiles exist')
		vZipFileExists = true
	}
}

var vMediaFile
if(!vZipFileExists)
{
	vMediaFile = plugins.http.getMediaData('media:///' + vHelpZipFile)
	var vSucces = plugins.file.writeFile(vZipFilePath , vMediaFile)
	if(vSucces)
	{
		//application.output('Helpfiles downloaded succesfully')
		
		//Delete html folder if exists
		var vHtmlFolder = vCVBFolder + vSeparator + 'HTML'
		plugins.file.deleteFolder(vHtmlFolder,false)
		
		vSucces = plugins.it2be_tools.unZip(vZipFilePath)
		if(vSucces){
		//	//application.output('Helpfiles unzipped succesfully')
		}
		
		for(var i in vOtherHelpFiles)
		{
			vOtherFileName =  vOtherHelpFiles[i]
			vMediaFile = plugins.http.getMediaData('media:///' + vOtherFileName)
			vZipFilePath = vCVBFolder + vSeparator + 'HTML' + vSeparator + vOtherFileName
			vSucces = plugins.file.writeFile(vZipFilePath , vMediaFile)
			if(vSucces){
			//	//application.output(vOtherFileName + ' downloaded succesfully')
			}
		}
	}
}
	
//put other files to CVB folder
for(var i in vOtherFiles){
	vOtherFileName =  vOtherFiles[i]
	vZipFilePath = vCVBFolder + vSeparator + vOtherFileName
	var jZipFilePath = plugins.file.convertToJSFile(vZipFilePath)
	if(!jZipFilePath.exists())
	{
		vMediaFile = plugins.http.getMediaData('media:///' + vOtherFileName)
		vSucces = plugins.file.writeFile(vZipFilePath , vMediaFile)
		if(vSucces)
		{
		//	//application.output(vOtherFileName + ' downloaded succesfully')
		}
	}
}
	

}

/**
 * @properties={typeid:24,uuid:"95e36c42-b080-47c3-bb28-68ec85709e06"}
 */
function sb_FORM_removeElements()
{
//do not remove elements if user is root or administrator
if(globals.sb_gCurrentGroupCode < 3){
	return false
}

var vAllForms = new Array('sb_form','study_words','book_comment','verse_translation', 'word_study')

var vFormName
var vAllFormElements = new Array()
var vElementName
var x
var k
for(x in vAllForms){
	vFormName = vAllForms[x]
	if(forms[vFormName]){
		vAllFormElements = forms[vFormName].elements.allnames
		if(vAllFormElements.length > 0){
			
			for(k in vAllFormElements){
				vElementName = vAllFormElements[k]
				if(utils.stringLeft(vElementName.toLowerCase(), 6) == 'admin_'){
					forms[vFormName].elements[vElementName].visible = false
				}
			}
		}
	}
}
}

/**
 * @properties={typeid:24,uuid:"d90454e7-b62f-4357-989d-7f3939b943fb"}
 */
function sb_FORM_toggleUIElements()
{
//hide notes button
if(forms.book_comment.elements.btn_openNotes){
	forms.book_comment.elements.btn_openNotes.visible = false
}
}

/**
 * @properties={typeid:24,uuid:"46587a64-151b-499c-becc-d461a834a5ec"}
 */
function sb_HELP_openHelp()
{
/**************************************************************************************
Method: 	globals.sb_HELP_openHelp();

Created:	Karel Broer,  13-10-2008
Modifier:	name or initials,  date(dd-MM-yyyy) //edit notes

Purpose:	Show help

Arguments:	- 

**************************************************************************************/	

var vServoyFolder = '.servoy'
var vSeparator = plugins.it2be_tools.client().fileSeparator
var vLocalClientPath = plugins.it2be_tools.client().userHome
var vServoyFolderPath = vLocalClientPath + vSeparator + vServoyFolder
var vCVBFolder = vServoyFolderPath + vSeparator + 'CVB'
var vWinHelpFile = vCVBFolder + vSeparator + 'Studiebijbel_handleiding.chm'
var vMacHelpFile = vCVBFolder + vSeparator + 'HTML' + vSeparator + 'welcometopic.htm'
var vFile
var vName

if(utils.stringMiddle(application.getOSName(),1,7) == "Windows") 
{ 
	vFile = plugins.file.convertStringToJSFile(vWinHelpFile)
	vName = vFile.getAbsolutePath()
    application.executeProgram('rundll32', 'url.dll,FileProtocolHandler',vName) 
}
else {
	vFile = plugins.file.convertStringToJSFile(vMacHelpFile)
	vName = file.getAbsolutePath()
	application.executeProgram('open','-a','safari',vName)
}
}

/**
 * @properties={typeid:24,uuid:"7dcf6788-1fe2-4b54-b91e-e7ba211623a7"}
 */
function sb_MENU_setAdminMenu()
{
var vOption = arguments[0]
var vOptiesIndex = plugins.it2be_menubar.getMenuIndexByText( i18n.getI18NMessage('CVB.lbl.options') )
var vMenu = plugins.it2be_menubar.getMenu(vOptiesIndex)
var vItem = vMenu.addItem()
	if(vOption == 'root'){
		vItem.set('i18n:CVB.lbl.management', globals.sb_DIALOG_showRootAdminDialog,null,null)
		vItem = vMenu.addItem()
		vItem.set('i18n:CVB.title.userInfo', globals.sb_DIALOG_showUserInfoDialog,null,null)
	}
	if(vOption == 'admin'){
		vItem.set('i18n:CVB.lbl.management', globals.sb_DIALOG_showAdminDialog,null,null)
	}
}

/**
 * @properties={typeid:24,uuid:"1a9d48f7-3826-4384-a98c-9386633f3956"}
 */
function sb_MENU_setMenubar()
{
//Get the application type
var vClientType = application.getApplicationType()
//type 1 = SERVER
//type 2 = CLIENT
//type 3 = DEVELOPER
//type 4 = HEADLESS_CLIENT
//type 5 = WEB_CLIENT
//type 6 = RUNTIME


//Developer FIX
if(globals.customMenuDone != 1 && vClientType != 3)
{
	//Migratie: Aangepast zodat de menu bar weer gaat werken in servoy 5 / 6
	//Remove all servoy menu's
	plugins.window.getMenuBar().removeAllMenus()
	//plugins.it2be_menubar.removeAllMenus()
	//File menu
	//var menu_file = plugins.it2be_menubar.addMenu()
	var menu_file = plugins.window.getMenuBar().addMenu()
	menu_file.text = 'i18n:cvb.lbl.file'
	var menu_exit = menu_file.addMenuItem('i18n:CVB.lbl.quit',globals.quit)
	
	
	//Edit menu
	//get the MenubarMenu object from the MenubarMenuBar
	//var menu = plugins.it2be_menubar.addMenu();
	var menu = plugins.window.getMenuBar().addMenu()
	//set the MenubarMenu object
	//menu.set("i18n:servoy.menuitem.edit");
	menu.text = "i18n:servoy.menuitem.edit"
	//get the MenubarMenuItem object from the (Sub-)menu
	//var item = menu.addItem();
	menu.addMenuItem("i18n:cvb.menu.howtocopy")
	//set the MenubarMenuItem object
	//item.set("i18n:cvb.menu.howtocopy", null);
	//get the MenubarMenuItem object from the (Sub-)menu
	//item = menu.addItem();
	//set the MenubarMenuItem object
	//item.set("i18n:cvb.menu.howtoselect", null);
	menu.addMenuItem("i18n:cvb.menu.howtoselect")
	
	if(globals.sb_gCurrentGroupCode == 1)
	{
		//Options menu
		//get the MenubarMenu object from the MenubarMenuBar
		//var menu = plugins.it2be_menubar.addMenu();
		//set the MenubarMenu object
		//menu.set("i18n:CVB.lbl.options");
		
		var vMenu2 = plugins.window.getMenuBar().addMenu()
		vMenu2.text = "i18n:CVB.lbl.options"
	}
	//Help menu
	//get the MenubarMenu object from the MenubarMenuBar
	//var menu = plugins.it2be_menubar.addMenu();
	var menu3 = plugins.window.getMenuBar().addMenu()
	menu3.text = "i18n:CVB.lbl.help"
	//set the MenubarMenu object
	//menu.set("i18n:CVB.lbl.help");
		
//	if(plugins.it2be_tools.arrayContains(globals.sb_gNLServerURLs, globals.sb_gCurrentServerUrl))
//	{
		//get the MenubarMenuItem object from the (Sub-)menu
		menu3.addMenuItem("i18n:CVB.lbl.help",forms.sb_form.openHelp)
		 
		//var item = menu.addItem();
		//set the MenubarMenuItem object
		//item.set("i18n:CVB.lbl.help",forms.sb_form.openHelp);
//	}
	//get the MenubarMenuItem object from the (Sub-)menu
	//var item = menu.addItem();
	//set the MenubarMenuItem object
	//item.set("i18n:servoy.menuitem.about",globals.openAbout);
		menu3.addMenuItem("i18n:servoy.menuitem.about",globals.openAbout)
	
	
	
	
	//Set some more menu options for client
	plugins.excelxport.exportEnabled = false
	plugins.excelxport.importEnabled = false
	plugins.textxport.exportEnabled = false
	plugins.textxport.importEnabled = false

	//remove toolbars
	application.setToolbarVisible('edit', false)
	application.setToolbarVisible('align', false)
	application.setToolbarVisible('design', false)
	application.setToolbarVisible('draw', false)
	application.setToolbarVisible('text', false)
	application.setToolbarVisible('distribute', false)
	
	
	globals.customMenuDone = 1
}
}

/**
 * @properties={typeid:24,uuid:"f35dfe1f-c494-4149-acfc-83220f26631f"}
 */
function sb_NAV_goToAdmin()
{
}

/**
 * @properties={typeid:24,uuid:"d0a1e54f-14d3-49dd-ae6e-2257efaf364b"}
 */
function sb_NAV_goToMainForm()
{
if(forms.sb_form){
	globals.init();
	globals.sb_FORM_toggleUIElements();
}
}

/**
 * @properties={typeid:24,uuid:"0991813e-606b-46f4-a77b-9b6ed30b5d9c"}
 */
function sb_REC_createLogRecord()
{
globals.sb_gCurrentSession = forms.sb_login_frm.foundset.getRecord(forms.sb_login_frm.foundset.newRecord())
databaseManager.saveData()
globals.sb_gCurrentSession.sb_organisation_id = globals.sb_gCurrentOrgID
globals.sb_gCurrentSession.sb_contact_id = globals.sb_gCurrentUserID
globals.sb_gCurrentSession.creationdate = application.getServerTimeStamp()
globals.sb_gCurrentSession.creator = globals.sb_gLoginName
globals.sb_gCurrentSession.current_user_amount = application.getActiveClientCount(false)
globals.sb_gCurrentSession.ip_address = plugins.it2be_tools.client().IP
globals.sb_gCurrentSession.java_version = plugins.it2be_tools.client().javaVersion
globals.sb_gCurrentSession.os_name = plugins.it2be_tools.client().osName
globals.sb_gCurrentSession.os_version = plugins.it2be_tools.client().osVersion
globals.sb_gCurrentSession.ext_ip_address = plugins.http.getPageData('http:\/\/www.ambitius.com\/tools\/getip.php?key=ambhash')
databaseManager.saveData()

}

/**
 * @properties={typeid:24,uuid:"1fbda561-28cf-4a0b-b0d0-b783bc57e21f"}
 */
function sb_REC_deleteRecord()
{
var vAnsw = plugins.dialogs.showQuestionDialog( 'i18n:cvb.message.warning',  'i18n:cvb.message.deleteRecord',  'i18n:cvb.btn.yes', 'i18n:cvb.btn.no')
if(vAnsw != i18n.getI18NMessage('i18n:cvb.btn.yes')){
	return false
}

databaseManager.recalculate(forms.sb_organisation_detail_frm.foundset)

var vForm = application.getMethodTriggerFormName()
var vIndex = forms[vForm].foundset.getSelectedIndex()
var vResult = forms[vForm].foundset.deleteRecord(vIndex)


}

/**
 * @properties={typeid:24,uuid:"3e7518e0-0dcf-43fa-b4cb-ac555eb587db"}
 */
function sb_REC_newOrganisation()
{
var vRecord = forms.sb_organisation_tbl.foundset.getRecord(forms.sb_organisation_tbl.foundset.newRecord())
databaseManager.saveData()

forms.sb_admin_root_frm.elements.organisation_name.requestFocus()
}

/**
 * @properties={typeid:24,uuid:"0ed1530e-9039-448e-b5ea-95b6125b9d84"}
 */
function sb_SEC_checkMaxUsers()
{
var vOrganisationID = arguments[0]
var vIPAddress = arguments[1]
var vCount

var vSQL = 'SELECT license_amount FROM sb_organisation WHERE sb_organisation_id = ?'
var vDS = databaseManager.getDataSetByQuery(forms.sb_organisation.controller.getServerName(), vSQL, [vOrganisationID], 1)
var vLicenseAmount = vDS.getValue(1,1)

if(vIPAddress){
	vCount = application.getClientCountForInfo(vIPAddress)
}
else {
	vCount = application.getClientCountForInfo(vOrganisationID)	
}

if(vCount > vLicenseAmount){
	plugins.dialogs.showWarningDialog('i18n:cvb.message.warning', 'i18n:cvb.message.license',  'i18n:CVB.lbl.ok')
	return false
}
else {
	return true
}
}

/**
 * @properties={typeid:24,uuid:"9ecfd909-cc60-4e80-a033-b841d10d6e32"}
 */
function sb_SEC_createSysUsers()
{
//globals.sb_SEC_createSysUsers()

var vUsersDS = security.getUsers()
var vCurrentUsers = null

if(vUsersDS.getMaxRowIndex() > 0){
	vCurrentUsers = vUsersDS.getColumnAsArray(2)
	vCurrentUsers = vCurrentUsers.join(',')
}

var vCount = 0

var vSQL = 'SELECT c.sb_organisation_id, c.login_name,  c.login_pw, c.sb_user_uuid, g.group_name FROM sb_contact c, sb_group g \
			WHERE c.sb_group_code = g.group_code'
var vDS = databaseManager.getDataSetByQuery(forms.sb_contact.controller.getServerName(), vSQL, null, -1)
var vUserName
var vPassword
var vUUID
var vGroupName
var vGroupsDS = security.getGroups()
var vCurrentGroups
if(vGroupsDS.getMaxRowIndex() > 0){
	vCurrentGroups = vGroupsDS.getColumnAsArray(2)
	vCurrentGroups = vCurrentGroups.join(',')
}

if(vDS.getMaxRowIndex() > 0){
	for ( var i = 1 ; i <= vDS.getMaxRowIndex() ; i++ ){
		vUserName = vDS.getValue(i,1) + '_' + vDS.getValue(i,2)
		vPassword = vDS.getValue(i,3)
		vUUID = vDS.getValue(i,4)
		vGroupName = vDS.getValue(i,5)
		
		if(utils.stringPatternCount(vCurrentGroups, vGroupName) < 1){
			security.createGroup(vGroupName)
		}
		
		if(utils.stringPatternCount(vCurrentUsers, vUserName) < 1){
			//create user in application server
			security.createUser( vUserName,  vPassword, vUUID)
			security.addUserToGroup(vUUID, vGroupName)
			vCount++
		}
	}

}

plugins.dialogs.showInfoDialog( 'i18n:CVB.dialog.info', vCount + ' i18n:cvb.message.usersCreated' ,  'i18n:CVB.lbl.ok')
}

/**
 * @properties={typeid:24,uuid:"2d133bcf-1be3-492d-8c29-e6598e21ad7b"}
 */
function sb_SEC_dataFilter()
{
if(globals.sb_gCurrentGroupCode == 1){
	return
}

if(!globals.sb_gCurrentOrgID){
	return
}

var vServer = forms.sb_login_frm.controller.getServerName()
var vTables = new Array('sb_contact', 'sb_organisation')
var vResult = false
var vTabelName
for(var i in vTables){
	vTabelName = vTables[i]
	vResult = databaseManager.addTableFilterParam(vServer, vTabelName, 'sb_organisation_id', '=', globals.sb_gCurrentOrgID)
}

return vResult
}

/**
 * @properties={typeid:24,uuid:"11b126fd-c3fa-442a-9dac-4f54efb3b683"}
 */
function sb_SEC_login()
{
/**************************************************************************************
Method: 	globals.sb_SEC_login();

Created:	Karel Broer,  13-10-2008
Modifier:	Karel Broer,  17-02-2009 //added functionality to let user login only once
Modifier:	Karel Broer,  26-03-2009 //added servoy security for users
Modifier:	Karel Broer,  03-04-2009 //added remove admin buttons for regular users
Modifier:	Rick Bonkestoter, 07-07-2009 // just some enhancements

Purpose:	1. Check user login specs
			2. Set specific menu's
		 	3. Got to main form

Arguments:	- 

//TODO: get client active working with userManager plugin
**************************************************************************************/	
//Fix so the ctrl-L funct in dev doesn't give a error
globals.sb_gDEVFix();


var vLanguage = plugins.UserManager.Client().language;
/// OTHER


var vServer = forms.sb_login_frm.controller.getServerName()

var vOrganisation = globals.sb_gOrganisation
//if(!vOrganisation){
//	vOrganisation = 'particulieren'
//}

// Please use a > instead of a < 
// Else users cannot logon BEFORE the end date, this is fixed in this code
var vSQL = "SELECT c.sb_contact_id, c.sb_organisation_id, c.sb_group_code, c.sb_user_uuid, g.group_name, c.demo_user_chk \
			FROM sb_contact c \
			LEFT JOIN sb_group g ON c.sb_group_code = g.group_code \
			WHERE c.login_name = ? \
			AND c.login_pw = ? \
			AND c.organisation_name = ? \
			AND (c.sb_end_date IS NULL OR c.sb_end_date > NOW())	"
var vDS = databaseManager.getDataSetByQuery(vServer, vSQL, [globals.sb_gLoginName, globals.sb_gPassword, vOrganisation ], 1)

if(vDS && vDS.getMaxRowIndex() == 1){

	globals.sb_gCurrentUserID = vDS.getValue(1,1)	
	globals.sb_gCurrentOrgID = vDS.getValue(1,2)
	globals.sb_gCurrentGroupCode = vDS.getValue(1,3)
	globals.sb_gCurrentUserUUID = vDS.getValue(1,4)
	var vGroupName = vDS.getValue(1,5)
	
	// For demo users
	var vDemo = vDS.getValue(1,6);
//	databaseManager.saveData()
	
	if(vDemo)
	{
		globals.sb_demo_chk = 1
		databaseManager.addTableFilterParam('sb', 'books', 'demo_chk', '=', 1);
		databaseManager.addTableFilterParam('sb', 'chapters', 'demo_chk', '=', 1);
		databaseManager.addTableFilterParam('sb', 'verses', 'demo_chk', '=', 1);
		databaseManager.addTableFilterParam('sb', 'verse_translations', 'demo_chk', '=', 1);
	} else {
		globals.sb_demo_chk = 0;
	}
	
	globals.show_books = 1;
	
	if(!globals.sb_SEC_singleUserCheck()) {
		return
	}
	
	if(!globals.sb_SEC_checkMaxUsers(globals.sb_gCurrentOrgID)){
		return
	}
	
	forms.sb_login_progress_frm.controller.show()
	application.updateUI(5)
	globals.sb_REC_createLogRecord();
	
	application.setUserProperty('cvb_username', globals.sb_gLoginName)
	application.setUserProperty('cvb_organisation', globals.sb_gOrganisation)
	
	
	application.addClientInfo(globals.sb_gCurrentOrgID)
	application.addClientInfo(globals.sb_gLoginName)
	application.addClientInfo(globals.sb_gOrganisation)
	
	security.login(globals.sb_gLoginName , globals.sb_gCurrentUserUUID, [vGroupName])
	
	
//	globals.sb_SEC_dataFilter();
	
	//Create the custom menu
	globals.sb_MENU_setMenubar();
	
	switch(globals.sb_gCurrentGroupCode){
		
		//root user, load root admin menu 
		case 1:	globals.sb_MENU_setAdminMenu('root'); globals.show_books = 0;
		break;
		
		//admin user, load admin menu
		case 2 : globals.sb_MENU_setAdminMenu('admin'); globals.show_books = 0;
		break;
	}
	
	globals.sb_FORM_removeElements();
	//Go to the mainForm
	forms.sb_form.controller.show()
	
}
else {
	plugins.dialogs.showWarningDialog( 'i18n:CVB.dialog.attention',  'i18n:CVB.dialog.message.wrong_login',  'i18n:CVB.lbl.ok')
}
}

/**
 * @properties={typeid:24,uuid:"6bc25ec8-c86d-4041-a8cd-cb490f6684a1"}
 */
function sb_SEC_singleUserCheck()
{
var vClientType = application.getApplicationType()
var vResult = true

if(globals.sb_demo_chk == 1)
{
	return true;
}

if(plugins.UserManager && vClientType != 3){
	var vClientsArray = plugins.UserManager.getClients()
	var vClient
	var vClientUUID
	if(vClientsArray.length > 0){
		for(var i in vClientsArray){
			vClient = vClientsArray[i]
			vClientUUID = vClient.userUid
			
			//check if this user is allready logged in
			if(vClientUUID == globals.sb_gCurrentUserUUID){
				plugins.dialogs.showWarningDialog( 'i18n:CVB.dialog.attention',  'i18n:CVB.dialog.message.user_allready_logged_in',  'i18n:CVB.lbl.ok')
				vResult = false
			}
		}
	}
}

return vResult

}

/**
 * @properties={typeid:24,uuid:"d7a4a24d-c5de-4212-9111-b9c32e6fb229"}
 * @AllowToRunInFind
 */
function sb_SYS_recalcTable()
{
var vForm = arguments[0]
forms[vForm].controller.loadAllRecords()
databaseManager.recalculate(forms[vForm].foundset)
plugins.dialogs.showInfoDialog( 'i18n:CVB.dialog.info','i18n:cvb.message.recalcSuccess', 'i18n:CVB.lbl.ok')
}

/**
 * @properties={typeid:24,uuid:"195cd0c7-9f0c-4693-80ae-f4ca34842fcb"}
 */
function sb_SYS_registerPlugins()
{
/**************************************************************************************
Method: 	globals.sb_SYS_registerPlugins();

Created:	Karel Broer 09-03-2009
Modifier:	Karel Broer 01-04-2009 //added UserManager plugin license

Purpose:	Register third party plugins

Arguments:	- 

**************************************************************************************/	
/*
//tablebean
if(plugins.drmaison){
	plugins.drmaison.registerTableBean('Centrum voor Bijbelonderzoek', '2PoO4dMvDAu/252MtmQhu1LbtPBHeTSu978TmXglBVk11yMeTbDAF49C7rlAIx9d')
}

//userManager
if(plugins.UserManager){
		plugins.UserManager.register('Centrum voor Bijbelonderzoek', 'q9SA5eCyb08ffrWuArsAQUsg+jE4mrWCgLOU5keUg5p0JBEAMFKds3lZs0AlQZoUH8JLUwgE3G9GAGD1P2o1oQ==')
}*/

	if (plugins.it2be_tools) {
			plugins.it2be_tools.register("jc7cuph3hfmi2afhk9r03a0b961rb61veod9g2vvvs02bgrc9nkm9e9u4rr209vip8g88mc631c238c7m1pohqo7b0fthd0jmivq96rvqd6k368em6iqgi956vfsctfj6bubogb415mo3s5ihbg5lltf9abhivp09u2um4jqtvk4btkdj39sjbenrnke5grd6dpf47ott2fq9uqeo9d5r2jk0drmj4giftkjccani2pbiv4v9tb2ojn4cm51mmoogstm6f955gpkbdqi9a71232l9l6re9fops6sb0151aep8krp2k6sb8sfrfn0rl55atkkq7m7raq8af0npm59ct5rsv96jtvett1bha4g4gsc9gi2n1eai8jmm7l2bcnle4rj1vik8065flh3fdn42rh9i3ugqeh2c4ht8s5bm3de586hm8u3sgupctbcuuu9jv1t0sp8d0k3g8lrk50shkldk03ctef1viabmv3thbhbalt784d7r773doilhprtfp2mb7b6u5g8pi5v5svo18kl44k0vjddt386v6mq2c6f42j8ajpftk4s8rpkiigam0asimst8emb9cf6q0kdhmn1v173mlcbklg59sr6k1p510geq796lgc5m4ubjlv116hua48nbkj3jk2et0roged9ia75jeab7fts1chnspvip64pq3kqbc4hn2kotv3sku1kqf1ijksl0c94uree7e8sana96nbo0483vq5ci4s7d3qbqfbnt88o8mvif5k169clggru5legbrkbucbiva09dukj6kbcc7l4rtmuqv44bm1qv6d");
		}

	//userManager
	if (plugins.UserManager) {
		//UserManager unlimited users pro update
		plugins.UserManager.register('STB Automatisering & Advies bv', 'q9SA5eCyb085cvATVO8s9vUixCNi/VnowK2A6LL0KRavwlmhkv24YM3R/syVum4q5tBKt0aq7WxKr7s22QDjIA==')
		//plugins.UserManager.register('Rutger Slager', 'q9SA5eCyb08ffrWuArsAQXoy+8L1fb7BREATK5HM332Ko5NwIWOMJFwIPgETWKfD')
	}
}

/**
 * @properties={typeid:24,uuid:"1a24c4ae-428c-4b52-b4b7-5bf40e072d4f"}
 */
function StartProcessor()
{
}

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"b66562b0-9b3c-4ce9-8513-e6a6eb3dda17",variableType:4}
 */
var commentary_id = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"3ffad9b7-e079-4c6d-8ad1-44e940df6665",variableType:4}
 */
var sb_edit_book_1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"801b70f6-bd7c-428a-a438-abdf1f9f81a1",variableType:4}
 */
var sb_edit_book_2;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"720688b2-8691-4f2b-b309-82d604ef9572",variableType:4}
 */
var sb_edit_EditCommentaryBlocksVisible = 0;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"556d5ab7-aa90-4cd2-ad52-655132e16684",variableType:12}
 */
var sb_edit_htmlTextCommentary = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"17c83fa3-57b9-4990-ac9f-5d3dea1874cc",variableType:12}
 */
var sb_edit_htmlTextFootnote = '';

/**
 * @properties={typeid:24,uuid:"d9808e7d-42e6-4fe7-8b8a-320d6a570390"}
 */
function ConvertHtmlToText()
{
var html = arguments[0]

//Test for null values
if(!html)
	return html

//forms.commentary_blocks.controller.setSelectedIndex(516)
//html = forms.commentary_blocks.htmltext

//Need to change the special characters
html = globals.sb_edit_HtmlToTextChangeToSpecialChars(html);

//Remove tlink, flink and wlink
html = globals.sb_edit_HtmlToTextRemoveLinks(html);

//Change <sup> to <su>; must be done after flink removing
html = globals.sb_edit_HtmlToTextChangeSuperToSu(html);

//Remove hebrew font
html = globals.sb_edit_HtmlToTextChangeHebrewWords(html);

//Remove greek font - Perhaps no necessary?
//Remove hebrew words (<or> tags) - no occurences in the database so far

// Some new shit
var regexp = /<a href=[^>]+>([^<]+)<\/a>/gi;

html = html.replace(regexp, '$1')

html = utils.stringReplace(html, '<BR>', '\n')

return html
}

/**§
 * @properties={typeid:24,uuid:"2daa5f2e-ef95-4b62-8357-151ae62d1bfa"}
 */
function ConvertTextToHtml()
{
var text = arguments[0]
var bookAbbr = arguments[1]
var chapter = arguments[2]

//Test for null
if(!text)
	return text

//Need to change the special characters
text = globals.sb_edit_TextToHtmlChangeSpecialCharsToHtml(text);
//Add flink
text = globals.sb_edit_TextToHtmlFillFlink(text);
//Add wlink, with greek words
text = globals.sb_edit_TextToHtmlFillWlink(text);
//Add tlink
text = globals.sb_edit_TextToHtmlFillTlink(text, bookAbbr, chapter);
//Change <su> to <sup>
text = globals.sb_edit_TextToHtmlChangeSuToSuper(text);
//Fill hebrew font
text = globals.sb_edit_TextToHtmlChangeHebrewWords(text);
//Fill hebrew words (<or> tags) - no occurences in the database so far

// Lets change the short title of the article to a linkje
var vSQL  = "SELECT article_small_title, pk FROM articles WHERE article_small_title IS NOT NULL";
var vQuery = databaseManager.getDataSetByQuery('sb', vSQL, null, -1);

for(var i = 1; i <= vQuery.getMaxRowIndex(); i++)
{
	text = utils.stringReplace(text, vQuery.getValue(i,1), '<a href="javascript:forms.viewArticle.openArticle('+vQuery.getValue(i,2)+')">' + vQuery.getValue(i,1) + '</a>')
}

return text
}

/**
 * @properties={typeid:24,uuid:"80313cd3-c965-485b-9aba-6017ad02d87c"}
 */
function sb_edit_HtmlToTextChangeFlink()
{
var text = arguments[0]

var regexp = /<f><sup><b><a href="javascript:globals.flink\('([\d]+)'\)">([\d]+)<\/a><\/b><\/sup><\/f>/gi;

var temp = text.replace(regexp, '<f>$1</f>')

return temp;

}

/**
 * @properties={typeid:24,uuid:"25e575e5-1cb0-426a-a0b5-6dd54e1b9a5b"}
 */
function sb_edit_HtmlToTextChangeHebrewWords()
{
var text = arguments[0]
var regExp = /<tra><font[^>]+>([^<]+)<\/font><\/tra>/i
var arr = text.match(regExp)
var heb

while (arr!=null && arr.length>0)
{
	var original = arr[1]
	var x = new Array();
	for(var i=0;i<original.length;i++)
		x[i]=original.charCodeAt(i)
	original = plugins.SILEzraToUnicode.convertBack(x)	
	
	
	heb = "<tr>"+original+"</tr>"
	text = text.replace(regExp, heb)
	arr = text.match(regExp)
}	

return text
}

/**
 * @properties={typeid:24,uuid:"35467cd5-34dd-40a1-b4c0-a5d399bc81bb"}
 */
function sb_edit_HtmlToTextChangeSuperToSu()
{
var temp = arguments[0]

temp = temp.replace("<sup>", "<su>");
temp = temp.replace("</sup>", "</su>");

return temp
}

/**
 * @properties={typeid:24,uuid:"d0e031ca-a5b5-422c-82f1-54125c766289"}
 */
function sb_edit_HtmlToTextChangeTlink()
{
var text = arguments[0]

var regexp = /<a href="javascript:globals.tlink[^>]+>([^<]+)<\/a>/gi;

var temp = text.replace(regexp, '$1')

return temp;

}

/**
 * @param {String} temp
 * @properties={typeid:24,uuid:"ea40f56e-92de-46c4-b1ec-4b94fb548606"}
 */
function sb_edit_HtmlToTextChangeToSpecialChars(temp)
{
if(!temp){
	return temp; 
}

var specialCharsArray = globals.sb_edit_HtmlToTextGetSpecialCharsArray();
var from = specialCharsArray[0]
var to = specialCharsArray[1]

var aux
do {
	aux = temp
	for(var i in from)
		temp = temp.replace(new RegExp(from[i], "g"), to[i]);
	
} while( temp != aux )

return temp
}

/**
 * @properties={typeid:24,uuid:"3b49016b-e679-4582-94e3-5c0709cfc56d"}
 */
function sb_edit_HtmlToTextChangeWlink()
{
var text = arguments[0]

//text = "De Griekse uitdrukking <a href=\"javascript:wlink('2862')\"><I>meta-noein</I></a>"

//Change also the global method call, because that's the way it should be
var regexp = /<a href="javascript:wlink\('([\d]+)'\)"><I>([^<]+)<\/I><\/a>/gi;
var regexp2 = /<a href="javascript:globals.wlink\('([\d]+)'\)"><I>([^<]+)<\/I><\/a>/gi;

var temp = text.replace(regexp, '<i>$1 $2</i>')
temp = temp.replace(regexp2, '<i>$1 $2</i>')

return temp;

}

/**
 * @properties={typeid:24,uuid:"ef5f90f7-db25-4d79-8c71-6fc345e97acc"}
 */
function sb_edit_HtmlToTextGetSpecialCharsArray()
{
var replaceArrayFrom = new Array();
var replaceArrayResults = new Array();
var replaceArray = new Array();

replaceArrayFrom.push('&#235;'); replaceArrayResults.push('ë');
replaceArrayFrom.push('&#275;'); replaceArrayResults.push('ē')
replaceArrayFrom.push('&#257;'); replaceArrayResults.push('ā')
replaceArrayFrom.push('&#299;'); replaceArrayResults.push('ī')
replaceArrayFrom.push('&#333;'); replaceArrayResults.push('ō')
replaceArrayFrom.push('&#363;'); replaceArrayResults.push('ū')
replaceArrayFrom.push(">&#8216;<"); replaceArrayResults.push(">Q<")
replaceArrayFrom.push(">&#8217;<"); replaceArrayResults.push(">W<")
replaceArrayFrom.push('&#274;'); replaceArrayResults.push('Ē')
replaceArrayFrom.push('&#256;'); replaceArrayResults.push('Ā')
replaceArrayFrom.push('&#298;'); replaceArrayResults.push('Ī')
replaceArrayFrom.push('&#332;'); replaceArrayResults.push('Ō')
replaceArrayFrom.push('&#362;'); replaceArrayResults.push('Ū')

replaceArrayFrom.push("&#8216;"); replaceArrayResults.push("‘")
replaceArrayFrom.push("#8216;"); replaceArrayResults.push("‘") 
replaceArrayFrom.push("&#8216"); replaceArrayResults.push("‘")
replaceArrayFrom.push("#8216"); replaceArrayResults.push("‘")

replaceArrayFrom.push("&#8217;"); replaceArrayResults.push("’")
replaceArrayFrom.push("#8217;"); replaceArrayResults.push("’")
replaceArrayFrom.push("&#8217"); replaceArrayResults.push("’")
replaceArrayFrom.push("#8217"); replaceArrayResults.push("’")

replaceArrayFrom.push("<l level=\"1\" ><br>&nbsp;&nbsp;&nbsp;&nbsp;"); replaceArrayResults.push("<l level=\"1\">")
replaceArrayFrom.push("&nbsp;") ; replaceArrayResults.push(" ")
replaceArrayFrom.push("&lt;"); replaceArrayResults.push("<")
replaceArrayFrom.push("&gt;"); replaceArrayResults.push(">")
replaceArrayFrom.push("<divineName>") ; replaceArrayResults.push( "<font1>")
replaceArrayFrom.push("</divineName>") ; replaceArrayResults.push( "</font1>")

// Additions by Rick

replaceArrayFrom.push("<p>") ; replaceArrayResults.push( "")
replaceArrayFrom.push("</p>") ; replaceArrayResults.push( "")

replaceArrayFrom.push('Ã«'); replaceArrayResults.push("ë");
replaceArrayFrom.push('&#8226');  replaceArrayResults.push("•");
replaceArrayFrom.push('<br>');  replaceArrayResults.push("\n");
replaceArrayFrom.push('Ã¯'); replaceArrayResults.push('ï');
replaceArrayFrom.push('â€“Â'); replaceArrayResults.push('-'); 
replaceArrayFrom.push('Â â€“'); replaceArrayResults.push('-');
replaceArrayFrom.push('Ã¤'); replaceArrayResults.push('ä');
replaceArrayFrom.push('Ã¼'); replaceArrayResults.push('ü');
replaceArrayFrom.push('Ã©'); replaceArrayResults.push('é');




replaceArray[0] = replaceArrayFrom
replaceArray[1] = replaceArrayResults
return replaceArray;
}

/**
 * @properties={typeid:24,uuid:"a022b180-f41b-42f9-b40b-7d1f6bcf17c8"}
 */
function sb_edit_HtmlToTextRemoveLinks()
{
//Method to remove links from a html text and returns the text without links and properly formatted
//Tags where links are found: <wlink>, <tlink>, <flink>


var temp = arguments[0]

//Flink change
temp = globals.sb_edit_HtmlToTextChangeFlink(temp);

//Tlink change
temp = globals.sb_edit_HtmlToTextChangeTlink(temp);

//Wlink change
temp = globals.sb_edit_HtmlToTextChangeWlink(temp);

return temp



/* Testing of wlink
forms.commentary_blocks.controller.setSelectedIndex(616)
var temp = forms.commentary_blocks.htmltext
temp = globals.sb_edit_HtmlToTextChangeWlink(temp);
//application.output(temp)
*/

/* Testing of flink
forms.commentary_blocks.controller.setSelectedIndex(184)
var temp = forms.commentary_blocks.htmltext
temp = globals.sb_edit_HtmlToTextChangeFlink(temp);
//application.output(temp)
*/

/* Testing of tlink
forms.commentary_blocks.controller.setSelectedIndex(615)
var temp = forms.commentary_blocks.htmltext
temp = globals.sb_edit_HtmlToTextChangeTlink(temp);
//application.output(temp)
*/

}

/**
 * @properties={typeid:24,uuid:"4aedf66d-bd65-4633-99ac-fac4dc162721"}
 */
function sb_edit_ReorderFootnotes()
{
//Method to reorder the footnotes in a given text
//arguments[0]: the text
//arguments[1]: where to start counting from (the first new footnote number)
//Returns the text with the footnotes renumbered

var text = arguments[0]
var number = arguments[1]

var bTag = "<f>"
var bTagLength = bTag.length
var eTag = "</f>"
var eTagLength = eTag.Length
var indexNext = text.indexOf(bTag,0)
var i = number
while(indexNext>=0)
{
	var indexEnd = text.indexOf(eTag, indexNext)
	text = text.substring(0, indexNext+bTagLength)+i+text.substr(indexEnd);
	indexNext = text.indexOf(bTag, indexEnd)
	i++;
}

return text
}

/**
 * @properties={typeid:24,uuid:"aecb21cf-05f0-4fc4-b839-840b39f60fed"}
 */
function sb_edit_TextToHtmlChangeHebrewWords()
{
var text = arguments[0]
var regexp = /<tr>([^<]+)<\/tr>/i
var arr = text.match(regexp)
var heb

while (arr!=null && arr.length>0)
{
	//Migratie: Alle plugins.SILEzraToUnicode vervangen
	heb = "<tra><font style=\"font-family: SIL Heb Trans\">"+globals.stringToCharNo(arr[1])+"</font></tra>"
	text = text.replace(regexp, heb)
	arr = text.match(regexp)
}	

return text
}

/**
 * @properties={typeid:24,uuid:"c46a41e3-873b-4f46-ae65-c1d99e5096fc"}
 */
function sb_edit_TextToHtmlChangeSpecialCharsToHtml()
{
var temp = arguments[0]

var specialCharsArray = globals.sb_edit_TextToHtmlGetSpecialCharsArray();

var aux
do {
	aux = temp
	for(var specialChar in specialCharsArray)
		temp = temp.replace(new RegExp(specialChar, "g"), specialCharsArray[specialChar]);

} while( temp != aux )

return temp
}

/**
 * @properties={typeid:24,uuid:"73288e8d-7cb1-4691-b625-2b2c5b3cc0e1"}
 */
function sb_edit_TextToHtmlChangeSuToSuper()
{
var text = arguments[0]

var regexp = /<su>([^<]+)<\/su>/gi
var temp = text.replace(regexp, '<sup>$1</sup>')

return temp
}

/**
 * @properties={typeid:24,uuid:"8d611b7f-fa97-4e06-9435-1e7048ebc752"}
 */
function sb_edit_TextToHtmlFillFlink()
{
var text = arguments[0]

var regexp = /<f>([\d]+)<\/f>/gi
var temp = text.replace(regexp, '<f><sup><b><a href="javascript:globals.flink(\'$1\')">$1</a><\/b><\/sup><\/f>')

return temp;
}

/**
 * @properties={typeid:24,uuid:"23a34a0b-f538-436f-a0a2-708735d75c47"}
 */
function sb_edit_TextToHtmlFillTlink()
{
//Set a space for the text so when there is a link in the begin it will also work
var text = " " + arguments[0]
//var text =+ arguments[0]

//text = "In Gen.1:1–2:3 wordt Matt.1:2-17. vgl. Hos.1:2; Spr.8:22-23, Mat.24:21    en Joh.1:1. Then Jes.11:7 en 65:25. Also schepping (Joh.1:1-3; Kol.1:16). " +
//		"in Ez.27:13; 32:26; 38:2-3; 39:1 genoemd. S p  Matt.1:2-17. and olkeren ( Gen.12:3;  18:18;  22:18)." +
//			"S p  Gen.1, 17 and olkeren ( Gen.12:3,5-7 22:18)." +
//	"(<i>2:12</i>,<i>48</i>), Chaldeeën en vs.1-3, 5 und vs.2 for ok "


var books = globals.sb_edit_TextToHtmlGetBookAbbreviationsArray();
if(plugins.it2be_tools.arrayContains(globals.sb_gESServerURLs, globals.sb_gCurrentServerUrl))
{
	var versLinks = new Array();
	versLinks.push("vs.");
	versLinks.push("versículos ");
	versLinks.push("versículo ");
	versLinks.push("Vs.");
	versLinks.push("Versículos ");
	versLinks.push("Versículo ");
} else {
	var versLinks = new Array();
	versLinks.push("vs.");
	versLinks.push("verzen ");
	versLinks.push("vers ");
	versLinks.push("Vs.");
	versLinks.push("Verzen ");
	versLinks.push("Vers ");
}

//Join the 2 arrays
books = books.concat(versLinks)
books.sort();
books.reverse()

// Get the book abbreviation
var vSQL = "SELECT abbreviation FROM books WHERE pk = ?"
var vResult = databaseManager.getDataSetByQuery('sb', vSQL, [globals.book_id], 1);
var vBookAbbr = vResult.getValue(1,1) + globals.chapter + ":"
var vBookAbbrOnly = vResult.getValue(1,1)

var prefixRegex = "("

//books is the array retrieved from the database + the manually inserted items like: 'vs','verse +'...

for(var i in books) {
	prefixRegex += books[i]
	if(i != (books.length)-1)
	{
		prefixRegex += "|"
	}
}
prefixRegex = prefixRegex+")"
prefixRegex = utils.stringReplace(prefixRegex, ".", "\\.")
//var vRegEX = prefixRegex + "(\\s+|[0-9.:;,-]+)+\\b";
//var vRegEX =  prefixRegex + "\\s?(\\s+|[0-9.:;,-en]+)+([0-9a-z]+\\b|\\b)";


//Veranderd 22-06-2010 DEZE WERKT DON'T TOUCH!!!
//@Modifier René van Veen
var vRegEX =  prefixRegex + "\\s?(\\s+|[0-9.:;,-]+|[en])+([0-9a-z]+^\\b|([a-z])|\\b)";
//Aanpassing gedaan zodat die ook vs.5a matched
//var vRegEX = prefixRegex + "(\\d+([-,:]*\\d)*|(-;\\d*))"

//Oldest regex
//var vRegEX =  prefixRegex + "\\s?(\\s.|[0-9.:;,-]+|^[en])+([0-9]|[a-z]+^\\b|\\b)";
var vRegEX2 = prefixRegex + "\\s?(\\s+|[0-9.:;,-en]+)+";

//application.output(vRegEX)
var regexp = new RegExp(vRegEX, "g" );
var regexp2 = new RegExp(vRegEX2, "g" );
var match = regexp.exec(text);

var vMatchedStuff = [];
/*
while(match != null)
{
	var vObj = {};

	vObj.startIndex = match.index;
	vObj.stopIndex = (match.index + match[0].length);
	vObj.chars = match[0].length
	vObj.text = match[0];
	vMatchedStuff.push(vObj);

	// Do a second match, else it will fail!
	// Now it will continue to the next match in string.
	match = regexp.exec(text);
}
*/

while(match != null)
{
	var vObj = {};
	
	vObj.startIndex = match.index;
	vObj.stopIndex = (match.index + match[0].length);
	vObj.chars = match[0].length

	var extendedMatch = ""+match[0]+"";
	
	regexp2.lastIndex = 0;
	var singleMatch = regexp2.exec(extendedMatch);

	//that's necessary due to javascript issue bug 

	if(singleMatch == null) {
		singleMatch = regexp2.exec(extendedMatch);
	}

  	if(singleMatch != null) {
 		//application.output(extendedMatch + " -- " + singleMatch[0]);
 		extendedMatch = singleMatch[0]; 
		vObj.stopIndex = (match.index + singleMatch[0].length);
		vObj.chars = singleMatch[0].length
 	}
 
 	vObj.text = extendedMatch;
	vObj.extra = singleMatch[1]
	vMatchedStuff.push(vObj);

	// Do a second match, else it will fail!
	// Now it will continue to the next match in string.
	match = regexp.exec(text);
}

vMatchedStuff.reverse();

var vRegEX3 = "[0-9]+([0-9:-]+)?";
var regexp3 = new RegExp(vRegEX3, "g" );

for(i in vMatchedStuff)
{
	var vBefore = text.substring(0, vMatchedStuff[i].startIndex);
	var vAfter = text.substring(vMatchedStuff[i].stopIndex);
	
	// Some scary stuff
	var vString = vMatchedStuff[i].text;
	
	var test = regexp3.exec(vString)
	var q = 0;
	var vUBOOK = "";
	var ReturnText = ""
	var vRetAr = [];
	while(test != null)
	{
		if(test.index == 0) { test = regexp3.exec(vString); continue; }
		//application.output(i + " => " + test[0]);
		// Get the book name!!!!!!
		var vOBJ = {};
		if(q==0)
		{
			vUBOOK = vString.substring(0, test.index);
			vOBJ.title = vUBOOK + test[0];
			vOBJ.startIndex = 0;
			vOBJ.stopIndex = (test.length);
		} else {
			vOBJ.title = test[0];
			vOBJ.startIndex = test.index
			vOBJ.stopIndex = (test.index + test.length);
		}
		
		if(vUBOOK.match("vs.") || vUBOOK.match("verzen ") || vUBOOK.match("vers") || vUBOOK.match("Vs.") || vUBOOK.match("Verzen ") || vUBOOK.match("Vers "))
		{
		//application.output(vBookAbbr);
			//vLinkString = ;
			vLinkString = vUBOOK
			if(test[0].match(':'))
			{
				vLinkString = vLinkString.replace("vs.", vBookAbbrOnly)
				vLinkString = vLinkString.replace("verzen ", vBookAbbrOnly)
				vLinkString = vLinkString.replace("vers ", vBookAbbrOnly)
				vLinkString = vLinkString.replace("Vs.", vBookAbbrOnly)
				vLinkString = vLinkString.replace("Verzen ", vBookAbbrOnly)
				vLinkString = vLinkString.replace("Vers ", vBookAbbrOnly)
			} else {
				vLinkString = vLinkString.replace("vs.", vBookAbbr)
				vLinkString = vLinkString.replace("verzen ", vBookAbbr)
				vLinkString = vLinkString.replace("vers ", vBookAbbr)
				vLinkString = vLinkString.replace("Vs.", vBookAbbr)
				vLinkString = vLinkString.replace("Verzen ", vBookAbbr)
				vLinkString = vLinkString.replace("Vers ", vBookAbbr)
			}
			vOBJ.vlink = true;
			vOBJ.book = vLinkString;
		} else {
			vOBJ.vlink = false;
			vOBJ.book = vUBOOK;
		}
		
		vOBJ.vers = test[0]
			
		vRetAr.push(vOBJ);
		q++;
		test = regexp3.exec(vString)
	}
	vRetAr.reverse()
	for(z in vRetAr)
	{
		var vBefore2 = vString.substring(0, vRetAr[z].startIndex);
		/*if(vRetAr[z].title.match(vRetAr[z].book))
		{
			var vAfter2 = vString.substring((vRetAr[z].title.length));
		} else if(vRetAr[z].title.match(':'))
		{
			var vAfter2 = vString.substring((vRetAr[z].stopIndex));
		} else if(z != (vRetAr.length)-1)
		{
			var vAfter2 = vString.substring((vRetAr[z].stopIndex)+1);
		} else {
			
		}*/
		
		var vAfter2 = vString.substring((vRetAr[z].startIndex)+vRetAr[z].title.length)
		
		var vMultiVerse = vRetAr[z].vers.split('-');
		if(vMultiVerse.length > 1 && vRetAr[z].vlink)
		{
			//application.output(vMultiVerse);
			vLinkString = vMultiVerse[0] + "-" + globals.chapter + ":" + vMultiVerse[1]
		} else if(vMultiVerse.length > 1 && !vMultiVerse[1].match(":")) {
			var vPosBook = vMultiVerse[0].indexOf(":",0)
			var vFirstBook = vMultiVerse[0].substring(0 , vPosBook)
			vLinkString = vMultiVerse[0] + "-" + vFirstBook + ":" + vMultiVerse[1]
		} 
		else {
			vLinkString = vRetAr[z].vers;
		}
		
		vString = vBefore2 + "<a href=\"javascript:globals.tlink('" + vRetAr[z].book + vLinkString + "')\">" + vRetAr[z].title + "</a>" + vAfter2
	}
	
	q++;

	text = vBefore + vString + vAfter;
}

var a =0;

return text;

//Try to search for each one of them
for(var i in books)
{
	var book = books[i]
	var bookAbbr = book
	///
	var basicStringRegex = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))?"
	
//	var book = "Gen."
//	var bookRegex = book.substring(0, book.length-1) + "\\."

	var n = 10
	var stringRegexp = book
	if(book[book.length-1]==".")
	{
	//Regex to check the bookname and if it is a link
		stringRegexp = "[^>'123]" + book.substring(0, book.length-1) + "\\."
	}
	//Regex to group the chapter en vers
	var basicStringRegexFirst = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))"
	///
	/*
	   var basicStringRegex = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s\\);,\\.enva]+))?"

    var n = 10
    var stringRegexp = book
    if(book[book.length-1]==".")
        stringRegexp =  "[^>'123]" + book.substring(0, book.length-1) + "\\." 
    
    var basicStringRegexFirst = basicStringRegex;
	*/
        stringRegexp += basicStringRegexFirst
	//set basicStringRegexFirst 10 times this is when a link is like Gen.1:2 3,4,5,6
	for(var j=0; j<n; j++)
		stringRegexp += basicStringRegex
	var regexp = new RegExp(stringRegexp, "g" );
	
	//Build 3 arrays, one with indexes, one with match length and one with text to insert
	var indexes = new Array()
	var lengths = new Array()
	var newTexts = new Array()
	var hadmatch = [];
	
	var match = regexp.exec(text);
	while (match != null) 
	{
		var newText = ""
		var index = (match.index)
		var length = (match[0].length)
		var groups = (match.length-1)/5
		
		var bookToShow = book
		var verseAndNotChapter = false //True for vs. etc
		var rememberChapter = ""
		
		//Process differently the verses
		if(plugins.it2be_tools.arrayContains(versLinks, bookAbbr))
		{
			verseAndNotChapter = true
			
			//Now set the book and the chapter
			book = forms.commentary_blocks.commentary_blocks_to_books.abbreviation
			
			rememberChapter = forms.commentary_blocks.chapter_from + ":"
			
			bookToShow = bookAbbr
		}
		
		for(var g=0; g<groups; g++)
		{
			var chFrom = match[g*5 + 1]
			var vsFrom = match[g*5 + 2]
			var chTo = match[g*5 + 3]
			var vsTo = match[g*5 + 4]
			var rest = ""
			if(match[g*5 + 5])
				rest = match[g*5 + 5]
			
			//If single reference, it's good to know if these are verse or chapter references
			if(vsFrom)
				verseAndNotChapter = true
					
			//Show only at first match the book name
			if(g>0)
				bookToShow = ""
				
			//Now we have many options
			
			//1. ch only 
			//2. ch:verse
			//3. ch:verse-verse
			//4. ch:verse-ch:verse
			//5. verse-verse
			//6. verse
			
			//option 1, ch only
			if(!chTo && !vsFrom && !vsTo && !verseAndNotChapter)
			{
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + "')\">"+bookToShow+chFrom + "</a>" + rest;
				continue;
			}
			
			//option 2, ch:vs
			if(chFrom && vsFrom && !chTo && !vsTo)
			{
				rememberChapter = chFrom + ":"
				
				//Treat the special case of v and vv; same stuff, 2 times
				for(var v=0;v<2;v++)
					if(rest && rest.length>0 && rest[0]=='v')
					{
						vsFrom += 'v'
						rest=rest.substring(1)
					}	
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "')\">"+bookToShow+chFrom + ":" +vsFrom + "</a>" + rest;
				continue;
			}
			
			//option 3, ch:vs-vs
			if(chFrom && vsFrom && !vsTo && chTo)
			{
				rememberChapter = chFrom + ":"
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chFrom + ":" + chTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + "</a>" + rest;		
				continue;
			}		
			
			//option 4, ch:vs-ch:vs
			if(chFrom && vsFrom && vsTo && chTo)
			{
				rememberChapter = chFrom + ":"
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chTo + ":" + vsTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + ":"  + vsTo + "</a>" + rest;		
				continue;
			}
			
			//option 5, vs-vs
			if(chFrom && !vsFrom && !vsTo && chTo)
			{
				if(arguments[1]) { book = arguments[1] }
				if(arguments[2]) { rememberChapter = arguments[2]+":";   }
				newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "-" + rememberChapter + chTo + "')\">"+bookToShow + chFrom + "-"  + chTo + "</a>" + rest;		
				continue;
			}
			
			//option 6, vs
			if(chFrom && !chTo && !vsFrom && !vsTo && verseAndNotChapter)
			{ 
				if(arguments[1]) { book = arguments[1] }
				if(arguments[2]) { rememberChapter = arguments[2]+":";   }
				//Here we also have the possibility of a reference like vs.3v. or vs.3vv
				//Treat the special case of v and vv; same stuff, 2 times
				for(var v=0;v<2;v++)
					if(rest && rest.length>0 && rest[0]=='v')
					{
						chFrom += 'v'
						rest=rest.substring(1)
					}	
				
				newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "')\">"+bookToShow + chFrom + "</a>" + rest;
				continue;
			}	
		}
		
		indexes.push((match.index)+1)
		lengths.push((match[0].length)-1)
		newTexts.push(newText)
		hadmatch.push(match[0])
		
		match = regexp.exec(text);
	}
	
	//Now make the inserts in the text, in reverse order so that the indexes are not lost
	for(var k=indexes.length-1; k>=0; k--)
	{
	//	plugins.dialogs.showErrorDialog('', text.substring(indexes[k], indexes[k]+lengths[k]))
		var regEx2 = '[A-Za-z0-9]';
		var wasMatched = new RegExp(regEx2, "g" );
		
		var shouldmatch = wasMatched.exec(text.substring((indexes[k])-1, (indexes[k])));	
		var iDoeMin = 0;
		
		if(shouldmatch)
		{
		//	plugins.dialogs.showInfoDialog('', shouldmatch[0])
			// Wij moeten weten wat het eerste karakter - 1 is
			
			if(text.substring((indexes[k])-1, (indexes[k])) == hadmatch[k].substring(0, 1))
			{
				iDoeMin  = 1
			}
		} else {
			iDoeMin = 0;
		}
		
		
	
		text = text.substring(0, (indexes[k]) - iDoeMin) + newTexts[k] + text.substring((indexes[k] - iDoeMin)+(lengths[k] + iDoeMin))
	}
}

return text

//The end, everyone's happy
}

/**
 * @properties={typeid:24,uuid:"ed2c07a7-446b-40b1-be67-2a5be8f643f0"}
 */
function sb_edit_TextToHtmlFillTlink__()
{
var text = " " + arguments[0]
//var text =+ arguments[0]

//text = "In Gen.1:1–2:3 wordt Matt.1:2-17. vgl. Hos.1:2; Spr.8:22-23, Mat.24:21    en Joh.1:1. Then Jes.11:7 en 65:25. Also schepping (Joh.1:1-3; Kol.1:16). " +
//		"in Ez.27:13; 32:26; 38:2-3; 39:1 genoemd. S p  Matt.1:2-17. and olkeren ( Gen.12:3;  18:18;  22:18)." +
//			"S p  Gen.1, 17 and olkeren ( Gen.12:3,5-7 22:18)." +
//	"(<i>2:12</i>,<i>48</i>), Chaldeeën en vs.1-3, 5 und vs.2 for ok "


var books = globals.sb_edit_TextToHtmlGetBookAbbreviationsArray();
var versLinks = new Array();
versLinks.push("vs.");
versLinks.push("verzen ");
versLinks.push("vers ");
versLinks.push("Vs.");
versLinks.push("Verzen ");
versLinks.push("Vers ");


//Join the 2 arrays
books = books.concat(versLinks)
books.sort();
books.reverse()

//Try to search for each one of them
var vStarttime = application.getServerTimeStamp()

for(var i in books)
{
	var book = books[i]
	var bookAbbr = book
	var basicStringRegex = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))?"
	
//	var book = "Gen."
//	var bookRegex = book.substring(0, book.length-1) + "\\."

	var n = 10
	var stringRegexp = book
	if(book[book.length-1]==".")
	{
		//Edit by RENE
		//The regex wasn't working if there was a link in the begin off a line
		//stringRegexp = "[^123]" + book.substring(0, book.length-1) + "\\.(\\d+)\\W(\\d+)"
		stringRegexp = "[^123]" + book.substring(0, book.length-1) + "\\.(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))"
		// LETOP:::: DE \\D{1} is voor een DIGIT met 1 positie
		//stringRegexp = "\\D{1}"+book.substring(0, book.length-1) + "\\."
		//stringRegexp = book.substring(0, book.length-1) + "\\."
	}
	//Afgeblokt door RENE
	//var basicStringRegexFirst = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))"
    //    stringRegexp += basicStringRegexFirst
	//for(var j=0; j<n; j++)
	//	stringRegexp += basicStringRegex
	var regexp = new RegExp(stringRegexp, "g" );
	
	//Build 3 arrays, one with indexes, one with match length and one with text to insert
	var indexes = new Array()
	var lengths = new Array()
	var newTexts = new Array()
	var hadmatch = [];
	
	var match = regexp.exec(text);
	
	/*var stringRegexp2 = "\\d" + book.substring(0, book.length-1) + "\\.(\\d+)\\W(\\d+)"
	var regexp2 = new RegExp(stringRegexp2, "g")
	var matchdubble = regexp2.exec(text)
	
	
	var stringRegexp3 = "[^>']" + book.substring(0, book.length-1) + "\\.(\\d+)\\W(\\d+)"
	var regexp3 = new RegExp(stringRegexp3, "g")
	var matchinLink = regexp3.exec(text)
	
	
	if(matchdubble)
	{
		if(matchdubble[0] == match[0] && matchdubble != null)
		{
			match = null
		}
	}
	*/
	while (match != null) 
	{
		// matched text: match[0]
	    // match start: match.index
	    // capturing group n: match[n]
		var newText = ""
		var index = (match.index)
		var length = (match[0].length)
		//application.output(match)
		

		var groups = (match.length-1)/5
		
		var bookToShow = book
		var verseAndNotChapter = false //True for vs. etc
		var rememberChapter = ""
		
		//Process differently the verses
		if(plugins.it2be_tools.arrayContains(versLinks, bookAbbr))
		{
			verseAndNotChapter = true
			
			//Now set the book and the chapter
			book = forms.commentary_blocks.commentary_blocks_to_books.abbreviation
			
			rememberChapter = forms.commentary_blocks.chapter_from + ":"
			
			bookToShow = bookAbbr
		}
		
		for(var g=0; g<groups; g++)
		{
			var chFrom = match[g*5 + 1]
			var vsFrom = match[g*5 + 2]
			var chTo = match[g*5 + 3]
			var vsTo = match[g*5 + 4]
			var rest = ""
			if(match[g*5 + 5])
				rest = match[g*5 + 5]
			
			//If single reference, it's good to know if these are verse or chapter references
			if(vsFrom)
				verseAndNotChapter = true
					
			//Show only at first match the book name
			if(g>0)
				bookToShow = ""
				
			//Now we have many options
			
			//1. ch only 
			//2. ch:verse
			//3. ch:verse-verse
			//4. ch:verse-ch:verse
			//5. verse-verse
			//6. verse
			
			//option 1, ch only
			if(!chTo && !vsFrom && !vsTo && !verseAndNotChapter)
			{
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + "')\">"+bookToShow+chFrom + "</a>" + rest;
				continue;
			}
			
			//option 2, ch:vs
			if(chFrom && vsFrom && !chTo && !vsTo)
			{
				rememberChapter = chFrom + ":"
				
				//Treat the special case of v and vv; same stuff, 2 times
				for(var v=0;v<2;v++)
					if(rest && rest.length>0 && rest[0]=='v')
					{
						vsFrom += 'v'
						rest=rest.substring(1)
					}	
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "')\">"+bookToShow+chFrom + ":" +vsFrom + "</a>" + rest;
				continue;
			}
			
			//option 3, ch:vs-vs
			if(chFrom && vsFrom && !vsTo && chTo)
			{
				rememberChapter = chFrom + ":"
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chFrom + ":" + chTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + "</a>" + rest;		
				continue;
			}		
			
			//option 4, ch:vs-ch:vs
			if(chFrom && vsFrom && vsTo && chTo)
			{
				rememberChapter = chFrom + ":"
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chTo + ":" + vsTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + ":"  + vsTo + "</a>" + rest;		
				continue;
			}
			
			//option 5, vs-vs
			if(chFrom && !vsFrom && !vsTo && chTo)
			{
				if(arguments[1]) { book = arguments[1] }
				if(arguments[2]) { rememberChapter = arguments[2]+":";   }
				newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "-" + rememberChapter + chTo + "')\">"+bookToShow + chFrom + "-"  + chTo + "</a>" + rest;		
				continue;
			}
			
			//option 6, vs
			if(chFrom && !chTo && !vsFrom && !vsTo && verseAndNotChapter)
			{ 
				if(arguments[1]) { book = arguments[1] }
				if(arguments[2]) { rememberChapter = arguments[2]+":";   }
				//Here we also have the possibility of a reference like vs.3v. or vs.3vv
				//Treat the special case of v and vv; same stuff, 2 times
				for(var v=0;v<2;v++)
					if(rest && rest.length>0 && rest[0]=='v')
					{
						chFrom += 'v'
						rest=rest.substring(1)
					}	
				
				newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "')\">"+bookToShow + chFrom + "</a>" + rest;
				continue;
			}	
		}
		
		indexes.push((match.index)+1)
		lengths.push((match[0].length)-1)
		newTexts.push(newText)
		hadmatch.push(match[0])
		
		match = regexp.exec(text);
	}
	
	//Now make the inserts in the text, in reverse order so that the indexes are not lost
	for(var k=indexes.length-1; k>=0; k--)
	{
	//	plugins.dialogs.showErrorDialog('', text.substring(indexes[k], indexes[k]+lengths[k]))
		var regEx2 = '[A-Za-z0-9]';
		var wasMatched = new RegExp(regEx2, "g" );
		
		var shouldmatch = wasMatched.exec(text.substring((indexes[k])-1, (indexes[k])));	
		var iDoeMin = 0;
		
		if(shouldmatch)
		{
		//	plugins.dialogs.showInfoDialog('', shouldmatch[0])
			// Wij moeten weten wat het eerste karakter - 1 is
			
			if(text.substring((indexes[k])-1, (indexes[k])) == hadmatch[k].substring(0, 1))
			{
				iDoeMin  = 1
			}
		} else {
			iDoeMin = 0;
		}
		
		
	
		text = text.substring(0, (indexes[k]) - iDoeMin) + newTexts[k] + text.substring((indexes[k] - iDoeMin)+(lengths[k] + iDoeMin))
	}
}

//application.output(text)
var vEndtime = application.getServerTimeStamp()
//application.output("total time " + (vEndtime - vStarttime) + " milisec")
return text

//The end, everyone's happy

}

/**
 * @properties={typeid:24,uuid:"bab9a152-66bf-4181-82bf-635705e88215"}
 */
function sb_edit_TextToHtmlFillTlink_good()
{
//Set a space for the text so when there is a link in the begin it will also work
var text = " " + arguments[0]
//var text =+ arguments[0]

//text = "In Gen.1:1–2:3 wordt Matt.1:2-17. vgl. Hos.1:2; Spr.8:22-23, Mat.24:21    en Joh.1:1. Then Jes.11:7 en 65:25. Also schepping (Joh.1:1-3; Kol.1:16). " +
//		"in Ez.27:13; 32:26; 38:2-3; 39:1 genoemd. S p  Matt.1:2-17. and olkeren ( Gen.12:3;  18:18;  22:18)." +
//			"S p  Gen.1, 17 and olkeren ( Gen.12:3,5-7 22:18)." +
//	"(<i>2:12</i>,<i>48</i>), Chaldeeën en vs.1-3, 5 und vs.2 for ok "


var books = globals.sb_edit_TextToHtmlGetBookAbbreviationsArray();
var versLinks = new Array();
versLinks.push("vs.");
versLinks.push("verzen ");
versLinks.push("vers ");
versLinks.push("Vs.");
versLinks.push("Verzen ");
versLinks.push("Vers ");


//Join the 2 arrays
books = books.concat(versLinks)
books.sort();
books.reverse()

//Try to search for each one of them
for(var i in books)
{
	var book = books[i]
	var bookAbbr = book
	///
	var basicStringRegex = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))?"
	
//	var book = "Gen."
//	var bookRegex = book.substring(0, book.length-1) + "\\."

	var n = 10
	var stringRegexp = book
	if(book[book.length-1]==".")
	{
	//Regex to check the bookname and if it is a link
		stringRegexp = "[^>'123]" + book.substring(0, book.length-1) + "\\."
	}
	//Regex to group the chapter en vers
	var basicStringRegexFirst = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))"
	///
	/*
	   var basicStringRegex = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s\\);,\\.enva]+))?"

    var n = 10
    var stringRegexp = book
    if(book[book.length-1]==".")
        stringRegexp =  "[^>'123]" + book.substring(0, book.length-1) + "\\." 
    
    var basicStringRegexFirst = basicStringRegex;
	*/
        stringRegexp += basicStringRegexFirst
	//set basicStringRegexFirst 10 times this is when a link is like Gen.1:2 3,4,5,6
	for(var j=0; j<n; j++)
		stringRegexp += basicStringRegex
	var regexp = new RegExp(stringRegexp, "g" );
	
	//Build 3 arrays, one with indexes, one with match length and one with text to insert
	var indexes = new Array()
	var lengths = new Array()
	var newTexts = new Array()
	var hadmatch = [];
	
	var match = regexp.exec(text);
	while (match != null) 
	{
		var newText = ""
		var index = (match.index)
		var length = (match[0].length)
		var groups = (match.length-1)/5
		
		var bookToShow = book
		var verseAndNotChapter = false //True for vs. etc
		var rememberChapter = ""
		
		//Process differently the verses
		if(plugins.it2be_tools.arrayContains(versLinks, bookAbbr))
		{
			verseAndNotChapter = true
			
			//Now set the book and the chapter
			book = forms.commentary_blocks.commentary_blocks_to_books.abbreviation
			
			rememberChapter = forms.commentary_blocks.chapter_from + ":"
			
			bookToShow = bookAbbr
		}
		
		for(var g=0; g<groups; g++)
		{
			var chFrom = match[g*5 + 1]
			var vsFrom = match[g*5 + 2]
			var chTo = match[g*5 + 3]
			var vsTo = match[g*5 + 4]
			var rest = ""
			if(match[g*5 + 5])
				rest = match[g*5 + 5]
			
			//If single reference, it's good to know if these are verse or chapter references
			if(vsFrom)
				verseAndNotChapter = true
					
			//Show only at first match the book name
			if(g>0)
				bookToShow = ""
				
			//Now we have many options
			
			//1. ch only 
			//2. ch:verse
			//3. ch:verse-verse
			//4. ch:verse-ch:verse
			//5. verse-verse
			//6. verse
			
			//option 1, ch only
			if(!chTo && !vsFrom && !vsTo && !verseAndNotChapter)
			{
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + "')\">"+bookToShow+chFrom + "</a>" + rest;
				continue;
			}
			
			//option 2, ch:vs
			if(chFrom && vsFrom && !chTo && !vsTo)
			{
				rememberChapter = chFrom + ":"
				
				//Treat the special case of v and vv; same stuff, 2 times
				for(var v=0;v<2;v++)
					if(rest && rest.length>0 && rest[0]=='v')
					{
						vsFrom += 'v'
						rest=rest.substring(1)
					}	
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "')\">"+bookToShow+chFrom + ":" +vsFrom + "</a>" + rest;
				continue;
			}
			
			//option 3, ch:vs-vs
			if(chFrom && vsFrom && !vsTo && chTo)
			{
				rememberChapter = chFrom + ":"
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chFrom + ":" + chTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + "</a>" + rest;		
				continue;
			}		
			
			//option 4, ch:vs-ch:vs
			if(chFrom && vsFrom && vsTo && chTo)
			{
				rememberChapter = chFrom + ":"
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chTo + ":" + vsTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + ":"  + vsTo + "</a>" + rest;		
				continue;
			}
			
			//option 5, vs-vs
			if(chFrom && !vsFrom && !vsTo && chTo)
			{
				if(arguments[1]) { book = arguments[1] }
				if(arguments[2]) { rememberChapter = arguments[2]+":";   }
				newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "-" + rememberChapter + chTo + "')\">"+bookToShow + chFrom + "-"  + chTo + "</a>" + rest;		
				continue;
			}
			
			//option 6, vs
			if(chFrom && !chTo && !vsFrom && !vsTo && verseAndNotChapter)
			{ 
				if(arguments[1]) { book = arguments[1] }
				if(arguments[2]) { rememberChapter = arguments[2]+":";   }
				//Here we also have the possibility of a reference like vs.3v. or vs.3vv
				//Treat the special case of v and vv; same stuff, 2 times
				for(var v=0;v<2;v++)
					if(rest && rest.length>0 && rest[0]=='v')
					{
						chFrom += 'v'
						rest=rest.substring(1)
					}	
				
				newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "')\">"+bookToShow + chFrom + "</a>" + rest;
				continue;
			}	
		}
		
		indexes.push((match.index)+1)
		lengths.push((match[0].length)-1)
		newTexts.push(newText)
		hadmatch.push(match[0])
		
		match = regexp.exec(text);
	}
	
	//Now make the inserts in the text, in reverse order so that the indexes are not lost
	for(var k=indexes.length-1; k>=0; k--)
	{
	//	plugins.dialogs.showErrorDialog('', text.substring(indexes[k], indexes[k]+lengths[k]))
		var regEx2 = '[A-Za-z0-9]';
		var wasMatched = new RegExp(regEx2, "g" );
		
		var shouldmatch = wasMatched.exec(text.substring((indexes[k])-1, (indexes[k])));	
		var iDoeMin = 0;
		
		if(shouldmatch)
		{
		//	plugins.dialogs.showInfoDialog('', shouldmatch[0])
			// Wij moeten weten wat het eerste karakter - 1 is
			
			if(text.substring((indexes[k])-1, (indexes[k])) == hadmatch[k].substring(0, 1))
			{
				iDoeMin  = 1
			}
		} else {
			iDoeMin = 0;
		}
		
		
	
		text = text.substring(0, (indexes[k]) - iDoeMin) + newTexts[k] + text.substring((indexes[k] - iDoeMin)+(lengths[k] + iDoeMin))
	}
}

return text

//The end, everyone's happy
}

/**
 * @properties={typeid:24,uuid:"f5193e71-278b-4fe4-8b55-1cdbc0f2271e"}
 */
function sb_edit_TextToHtmlFillTlink_ne()
{
var text = arguments[0]

//text = "In Gen.1:1–2:3,5 en 7. 1Cor.4:1, 7, 2Cor.4:1, wordt Matt.1:2-17. vgl. Hos.1:2; Spr.8:22-23, Mat.24:21, 1Petr.1:1 en . Then Jes.11:7 en 65:25. Also schepping (Joh.1:1-3; Kol.1:16). " +
//        "in Ez.27:13; 32:26; 38:2-3; 39:1 genoemd. S p  Matt.1:2-17. and olkeren ( Gen.12:3;  18:18;  22:18)." +
//            "S p  Gen.1, 17 and olkeren ( Gen.12:3,5-7 22:18)." +
//    "(<i>2:12</i>,<i>48</i>), Chaldeeën en vs.1-3, 5 und vs.2 for ok "


var books = globals.sb_edit_TextToHtmlGetBookAbbreviationsArray();
var versLinks = new Array();
versLinks.push("vs.");
versLinks.push("verzen ");
versLinks.push("vers ");
versLinks.push("Vs.");
versLinks.push("Verzen ");
versLinks.push("Vers ");

//Join the 2 arrays
books = books.concat(versLinks)

//Try to search for each one of them
for(var i in books)
{
    var book = books[i]
    var bookAbbr = book
    var basicStringRegex = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))?"
    
//    var book = "Gen."
//    var bookRegex = book.substring(0, book.length-1) + "\\."

    var n = 10
    var stringRegexp = book
    if(book[book.length-1]==".")
        stringRegexp = book.substring(0, book.length-1) + "\\." 
    
    var basicStringRegexFirst = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))"
        stringRegexp += basicStringRegexFirst
    for(var j=0; j<n; j++)
        stringRegexp += basicStringRegex
    var regexp = new RegExp(stringRegexp, "g" );
    
    //Build 3 arrays, one with indexes, one with match length and one with text to insert
    var indexes = new Array()
    var lengths = new Array()
    var newTexts = new Array()
    
    var match = regexp.exec(text);
    while (match != null) 
    {
        // matched text: match[0]
        // match start: match.index
        // capturing group n: match[n]
        var newText = ""
        var index = match.index
        var length = match[0].length
        
        var groups = (match.length-1)/5
        
        var bookToShow = book
        var verseAndNotChapter = false //True for vs. etc
        var rememberChapter = ""
    
        //Process differently the verses
        if(plugins.it2be_tools.arrayContains(versLinks, bookAbbr))
        {
            verseAndNotChapter = true
            
            //Now set the book and the chapter
            book = forms.commentary_blocks.commentary_blocks_to_books.abbreviation
            
            rememberChapter = forms.commentary_blocks.chapter_from + ":"
            
            bookToShow = bookAbbr
        }
        
        for(var g=0; g<groups; g++)
        {
            var chFrom = match[g*5 + 1]
            var vsFrom = match[g*5 + 2]
            var chTo = match[g*5 + 3]
            var vsTo = match[g*5 + 4]
            var rest = ""
            if(match[g*5 + 5])
                rest = match[g*5 + 5]
            
            //If single reference, it's good to know if these are verse or chapter references
            if(vsFrom)
                verseAndNotChapter = true
                    
            //Show only at first match the book name
            if(g>0)
                bookToShow = ""
                
            //Now we have many options
            
            //1. ch only 
            //2. ch:verse
            //3. ch:verse-verse
            //4. ch:verse-ch:verse
            //5. verse-verse
            //6. verse
            
            //option 1, ch only
            if(!chTo && !vsFrom && !vsTo && !verseAndNotChapter)
            {
                //Test for false Match of a digit from the start of a different book
                var nextPoz = match[0].length+match.index+1        
                var nextChar = ""
                if(nextPoz<=text.length)
                    nextChar = text[nextPoz]
                if(nextChar==" ")
                {
                    if(nextPoz+1<=text.length)
                        nextChar = text[nextPoz+1]
                    else
                        nextChar=""
                }
                if( chFrom.length==1 && plugins.it2be_tools.isNumber(chFrom) && nextChar.length==1 && plugins.it2be_tools.isInRange(nextChar, 'a', 'z', true) && nextChar==nextChar.toUpperCase())
                    newText+=chFrom
                else
                    newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + "')\">"+bookToShow+chFrom + "</a>" + rest;
                continue;
            }
            
            //option 2, ch:vs
            if(chFrom && vsFrom && !chTo && !vsTo)
            {
                rememberChapter = chFrom + ":"
                
                //Treat the special case of v and vv; same stuff, 2 times
                for(var v=0;v<2;v++)
                    if(rest && rest.length>0 && rest[0]=='v')
                    {
                        vsFrom += 'v'
                        rest=rest.substring(1)
                    }    
                newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "')\">"+bookToShow+chFrom + ":" +vsFrom + "</a>" + rest;
                continue;
            }
            
            //option 3, ch:vs-vs
            if(chFrom && vsFrom && !vsTo && chTo)
            {
                rememberChapter = chFrom + ":"
                newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chFrom + ":" + chTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + "</a>" + rest;        
                continue;
            }        
            
            //option 4, ch:vs-ch:vs
            if(chFrom && vsFrom && vsTo && chTo)
            {
                rememberChapter = chFrom + ":"
                newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chTo + ":" + vsTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + ":"  + vsTo + "</a>" + rest;        
                continue;
            }
            
            //option 5, vs-vs
            if(chFrom && !vsFrom && !vsTo && chTo)
            {
                if(arguments[1]) { book = arguments[1] }
                if(arguments[2]) { rememberChapter = arguments[2]+":";   }
                newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "-" + rememberChapter + chTo + "')\">"+bookToShow + chFrom + "-"  + chTo + "</a>" + rest;        
                continue;
            }
            
            //option 6, vs
            if(chFrom && !chTo && !vsFrom && !vsTo && verseAndNotChapter)
            {
                //Test for false Match of a digit from the start of a different book
                var nextPoz = match[0].length+match.index
                var nextChar = ""
                if(nextPoz<=text.length)
                    nextChar = text[nextPoz]
                if(nextChar==" ")
                {
                    if(nextPoz+1<=text.length)
                        nextChar = text[nextPoz+1]
                    else
                        nextChar=""
                }
                if( chFrom.length==1 && plugins.it2be_tools.isNumber(chFrom) && nextChar.length==1 && plugins.it2be_tools.isInRange(nextChar, 'a', 'z', true) && nextChar==nextChar.toUpperCase() && g==groups-1)
                    newText+=chFrom
                else
                {            
                    if(arguments[1]) { book = arguments[1] }
                    if(arguments[2]) { rememberChapter = arguments[2]+":";   }
                    //Here we also have the possibility of a reference like vs.3v. or vs.3vv
                    //Treat the special case of v and vv; same stuff, 2 times
                    for(var v=0;v<2;v++)
                        if(rest && rest.length>0 && rest[0]=='v')
                        {
                            chFrom += 'v'
                            rest=rest.substring(1)
                        }    
                    
                    newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "')\">"+bookToShow + chFrom + "</a>" + rest;
                }
                continue;
            }    
        }
        
        indexes.push(match.index)
        lengths.push(match[0].length)
        newTexts.push(newText)
        
        match = regexp.exec(text);
    }
    
    //Now make the inserts in the text, in reverse order so that the indexes are not lost
    for(var k=indexes.length-1; k>=0; k--)
    {
        text = text.substring(0, indexes[k]) + newTexts[k] + text.substring(indexes[k]+lengths[k])
    }
}

//application.output(text)

return text

//The end, everyone's happy

}

/**
 * @properties={typeid:24,uuid:"a1deefc7-5066-4b42-82c3-d0ea2ddbc077"}
 */
function sb_edit_TextToHtmlFillTlink_toenWassieGoed()
{
//Set a space for the text so when there is a link in the begin it will also work
var text = " " + arguments[0]
//var text =+ arguments[0]

//text = "In Gen.1:1–2:3 wordt Matt.1:2-17. vgl. Hos.1:2; Spr.8:22-23, Mat.24:21    en Joh.1:1. Then Jes.11:7 en 65:25. Also schepping (Joh.1:1-3; Kol.1:16). " +
//		"in Ez.27:13; 32:26; 38:2-3; 39:1 genoemd. S p  Matt.1:2-17. and olkeren ( Gen.12:3;  18:18;  22:18)." +
//			"S p  Gen.1, 17 and olkeren ( Gen.12:3,5-7 22:18)." +
//	"(<i>2:12</i>,<i>48</i>), Chaldeeën en vs.1-3, 5 und vs.2 for ok "


var books = globals.sb_edit_TextToHtmlGetBookAbbreviationsArray();
var versLinks = new Array();
versLinks.push("vs.");
versLinks.push("verzen ");
versLinks.push("vers ");
versLinks.push("Vs.");
versLinks.push("Verzen ");
versLinks.push("Vers ");


//Join the 2 arrays
books = books.concat(versLinks)
books.sort();
books.reverse()

// Get the book abbreviation
var vSQL = "SELECT abbreviation FROM books WHERE pk = ?"
var vResult = databaseManager.getDataSetByQuery('sb', vSQL, [globals.book_id], 1);
var vBookAbbr = vResult.getValue(1,1) + globals.chapter + ":"

var prefixRegex = "("

//books is the array retrieved from the database + the manually inserted items like: 'vs','verse +'...

for(var i in books) {
	prefixRegex += books[i]
	if(i != (books.length)-1)
	{
		prefixRegex += "|"
	}
}
prefixRegex=prefixRegex+")"

//var vRegEX = prefixRegex + "(\\s+|[0-9.:;,-]+)+\\b";
var vRegEX =  prefixRegex + "\\s?(\\s+|[0-9.:;,-]+)+([0-9a-z]+\\b|\\b)";
var vRegEX2 = prefixRegex + "\\s?(\\s+|[0-9.:;,-]+)+";

var regexp = new RegExp(vRegEX, "g" );
var regexp2 = new RegExp(vRegEX2, "g" );
var match = regexp.exec(text);

var vMatchedStuff = [];
/*
while(match != null)
{
	var vObj = {};

	vObj.startIndex = match.index;
	vObj.stopIndex = (match.index + match[0].length);
	vObj.chars = match[0].length
	vObj.text = match[0];
	vMatchedStuff.push(vObj);

	// Do a second match, else it will fail!
	// Now it will continue to the next match in string.
	match = regexp.exec(text);
}
*/

while(match != null)
{
	var vObj = {};
	
	vObj.startIndex = match.index;
	vObj.stopIndex = (match.index + match[0].length);
	vObj.chars = match[0].length

	var extendedMatch = ""+match[0]+"";
	
	regexp2.lastIndex = 0;
	var singleMatch = regexp2.exec(extendedMatch);

	//that's necessary due to javascript issue bug 

	if(singleMatch == null) {
		singleMatch = regexp2.exec(extendedMatch);
	}

  	if(singleMatch != null) {
 		//application.output(extendedMatch + " -- " + singleMatch[0]);
 		extendedMatch = singleMatch[0]; 
		vObj.stopIndex = (match.index + singleMatch[0].length);
		vObj.chars = singleMatch[0].length
 	}
 
 	vObj.text = extendedMatch;
	vObj.extra = singleMatch[1]
	vMatchedStuff.push(vObj);

	// Do a second match, else it will fail!
	// Now it will continue to the next match in string.
	match = regexp.exec(text);
}

vMatchedStuff.reverse();

var vRegEX3 = "[0-9]+([0-9:-]+)?";
var regexp3 = new RegExp(vRegEX3, "g" );

for(i in vMatchedStuff)
{
	var vBefore = text.substring(0, vMatchedStuff[i].startIndex);
	var vAfter = text.substring(vMatchedStuff[i].stopIndex);
	
	// Some scary stuff
	var vString = vMatchedStuff[i].text;
	
	var test = regexp3.exec(vString)
	while(test != null)
	{
		//application.output(i + " => " + test[0]);
		test = regexp3.exec(vString)
	}
	
	
	if(vString.match("vs.") || vString.match("verzen ") || vString.match("vers") || vString.match("Vs.") || vString.match("Verzen ") || vString.match("Vers "))
	{
		//application.output(vBookAbbr);
		//vLinkString = ;
		vLinkString = vMatchedStuff[i].text
		vLinkString = vLinkString.replace("vs.", vBookAbbr)
		vLinkString = vLinkString.replace("verzen ", vBookAbbr)
		vLinkString = vLinkString.replace("vers ", vBookAbbr)
		vLinkString = vLinkString.replace("Vs.", vBookAbbr)
		vLinkString = vLinkString.replace("Verzen ", vBookAbbr)
		vLinkString = vLinkString.replace("Vers ", vBookAbbr)
		
		var vMultiVerse = vLinkString.split('-');
		if(vMultiVerse.length > 1)
		{
			//application.output(vMultiVerse);
			vLinkString = vMultiVerse[0] + "-" + globals.chapter + ":" + vMultiVerse[1]
		}
		
		text = vBefore + "<a href=\"javascript:globals.tlink('" + vLinkString + "')\">" + vMatchedStuff[i].text + "</a>" + vAfter
	}
	else
	{
		text = vBefore + "<a href=\"javascript:globals.tlink('" + vMatchedStuff[i].text + "')\">" + vMatchedStuff[i].text + "</a>" + vAfter
	}
}

var a =0;

return text;

//Try to search for each one of them
for(var i in books)
{
	var book = books[i]
	var bookAbbr = book
	///
	var basicStringRegex = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))?"
	
//	var book = "Gen."
//	var bookRegex = book.substring(0, book.length-1) + "\\."

	var n = 10
	var stringRegexp = book
	if(book[book.length-1]==".")
	{
	//Regex to check the bookname and if it is a link
		stringRegexp = "[^>'123]" + book.substring(0, book.length-1) + "\\."
	}
	//Regex to group the chapter en vers
	var basicStringRegexFirst = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s;,enva]*))"
	///
	/*
	   var basicStringRegex = "(?:(\\d+)(?::(\\d+))?(?:[\\-–](\\d+)(?::(\\d+))?)?([\\s\\);,\\.enva]+))?"

    var n = 10
    var stringRegexp = book
    if(book[book.length-1]==".")
        stringRegexp =  "[^>'123]" + book.substring(0, book.length-1) + "\\." 
    
    var basicStringRegexFirst = basicStringRegex;
	*/
        stringRegexp += basicStringRegexFirst
	//set basicStringRegexFirst 10 times this is when a link is like Gen.1:2 3,4,5,6
	for(var j=0; j<n; j++)
		stringRegexp += basicStringRegex
	var regexp = new RegExp(stringRegexp, "g" );
	
	//Build 3 arrays, one with indexes, one with match length and one with text to insert
	var indexes = new Array()
	var lengths = new Array()
	var newTexts = new Array()
	var hadmatch = [];
	
	var match = regexp.exec(text);
	while (match != null) 
	{
		var newText = ""
		var index = (match.index)
		var length = (match[0].length)
		var groups = (match.length-1)/5
		
		var bookToShow = book
		var verseAndNotChapter = false //True for vs. etc
		var rememberChapter = ""
		
		//Process differently the verses
		if(plugins.it2be_tools.arrayContains(versLinks, bookAbbr))
		{
			verseAndNotChapter = true
			
			//Now set the book and the chapter
			book = forms.commentary_blocks.commentary_blocks_to_books.abbreviation
			
			rememberChapter = forms.commentary_blocks.chapter_from + ":"
			
			bookToShow = bookAbbr
		}
		
		for(var g=0; g<groups; g++)
		{
			var chFrom = match[g*5 + 1]
			var vsFrom = match[g*5 + 2]
			var chTo = match[g*5 + 3]
			var vsTo = match[g*5 + 4]
			var rest = ""
			if(match[g*5 + 5])
				rest = match[g*5 + 5]
			
			//If single reference, it's good to know if these are verse or chapter references
			if(vsFrom)
				verseAndNotChapter = true
					
			//Show only at first match the book name
			if(g>0)
				bookToShow = ""
				
			//Now we have many options
			
			//1. ch only 
			//2. ch:verse
			//3. ch:verse-verse
			//4. ch:verse-ch:verse
			//5. verse-verse
			//6. verse
			
			//option 1, ch only
			if(!chTo && !vsFrom && !vsTo && !verseAndNotChapter)
			{
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + "')\">"+bookToShow+chFrom + "</a>" + rest;
				continue;
			}
			
			//option 2, ch:vs
			if(chFrom && vsFrom && !chTo && !vsTo)
			{
				rememberChapter = chFrom + ":"
				
				//Treat the special case of v and vv; same stuff, 2 times
				for(var v=0;v<2;v++)
					if(rest && rest.length>0 && rest[0]=='v')
					{
						vsFrom += 'v'
						rest=rest.substring(1)
					}	
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "')\">"+bookToShow+chFrom + ":" +vsFrom + "</a>" + rest;
				continue;
			}
			
			//option 3, ch:vs-vs
			if(chFrom && vsFrom && !vsTo && chTo)
			{
				rememberChapter = chFrom + ":"
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chFrom + ":" + chTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + "</a>" + rest;		
				continue;
			}		
			
			//option 4, ch:vs-ch:vs
			if(chFrom && vsFrom && vsTo && chTo)
			{
				rememberChapter = chFrom + ":"
				newText += "<a href=\"javascript:globals.tlink('" + book + chFrom + ":" + vsFrom + "-" + chTo + ":" + vsTo + "')\">"+bookToShow+chFrom + ":" +vsFrom + "-" + chTo + ":"  + vsTo + "</a>" + rest;		
				continue;
			}
			
			//option 5, vs-vs
			if(chFrom && !vsFrom && !vsTo && chTo)
			{
				if(arguments[1]) { book = arguments[1] }
				if(arguments[2]) { rememberChapter = arguments[2]+":";   }
				newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "-" + rememberChapter + chTo + "')\">"+bookToShow + chFrom + "-"  + chTo + "</a>" + rest;		
				continue;
			}
			
			//option 6, vs
			if(chFrom && !chTo && !vsFrom && !vsTo && verseAndNotChapter)
			{ 
				if(arguments[1]) { book = arguments[1] }
				if(arguments[2]) { rememberChapter = arguments[2]+":";   }
				//Here we also have the possibility of a reference like vs.3v. or vs.3vv
				//Treat the special case of v and vv; same stuff, 2 times
				for(var v=0;v<2;v++)
					if(rest && rest.length>0 && rest[0]=='v')
					{
						chFrom += 'v'
						rest=rest.substring(1)
					}	
				
				newText += "<a href=\"javascript:globals.tlink('" + book + rememberChapter + chFrom + "')\">"+bookToShow + chFrom + "</a>" + rest;
				continue;
			}	
		}
		
		indexes.push((match.index)+1)
		lengths.push((match[0].length)-1)
		newTexts.push(newText)
		hadmatch.push(match[0])
		
		match = regexp.exec(text);
	}
	
	//Now make the inserts in the text, in reverse order so that the indexes are not lost
	for(var k=indexes.length-1; k>=0; k--)
	{
	//	plugins.dialogs.showErrorDialog('', text.substring(indexes[k], indexes[k]+lengths[k]))
		var regEx2 = '[A-Za-z0-9]';
		var wasMatched = new RegExp(regEx2, "g" );
		
		var shouldmatch = wasMatched.exec(text.substring((indexes[k])-1, (indexes[k])));	
		var iDoeMin = 0;
		
		if(shouldmatch)
		{
		//	plugins.dialogs.showInfoDialog('', shouldmatch[0])
			// Wij moeten weten wat het eerste karakter - 1 is
			
			if(text.substring((indexes[k])-1, (indexes[k])) == hadmatch[k].substring(0, 1))
			{
				iDoeMin  = 1
			}
		} else {
			iDoeMin = 0;
		}
		
		
	
		text = text.substring(0, (indexes[k]) - iDoeMin) + newTexts[k] + text.substring((indexes[k] - iDoeMin)+(lengths[k] + iDoeMin))
	}
}

return text

//The end, everyone's happy
}

/**
 * @properties={typeid:24,uuid:"10323ede-1b1f-45b0-84ee-ba96a791f687"}
 */
function sb_edit_TextToHtmlFillWlink()
{
var text = arguments[0]

//text = "magiërs (<i>2745 magoi</i> is letterlijk ‘magiërs’) "

var regexp = /<i>([\d]+)\s([^<]+)<\/i>/i
var arr = text.match(regexp)
var wlink

//Tried something here, thought plugin was necessary, but it seems not the case
while (arr!=null && arr.length>0)
{
	var original = arr[2]
	var greek = original
	wlink = "<a href=javascript:globals.wlink(" + arr[1] + ")><I>"+greek+"</I></a>"
	text = text.replace(regexp, wlink)
	arr = text.match(regexp)
}	

return text
}

/**
 * @properties={typeid:24,uuid:"777b7d32-987c-4db9-b5c3-fd762e453767"}
 */
function sb_edit_TextToHtmlGetBookAbbreviationsArray()
{
//Method that returns as array that contains possible abbreviations of all the books 

var abrev = new Array()
// ORDER BY book_name ASC
var query = "SELECT abbreviation FROM books ORDER BY book_name ASC"
res = databaseManager.getDataSetByQuery(forms.books.controller.getServerName(), query, null, -1)
if(res.getMaxRowIndex()>0)
	abrev = abrev.concat(res.getColumnAsArray(1))
if(!plugins.it2be_tools.arrayContains(globals.sb_gESServerURLs, globals.sb_gCurrentServerUrl))
{
abrev.push(
	'1 Cor.',
	'1Cor.',
	'2 Cor.',
	'2Cor.',
	'Col.',
	'1 Thess.',
	'1Thess.',
	'2 Thess.',
	'2Thess.',
	'Jac.',
	'1 Petr.',
	'1Petr.',
	'2 Petr.',
	'2Petr.',
	'1 Sam.',
	'2 Sam.',
	'1 Kon.',
	'2 Kon.',
	'1 Kron.',
	'1Kron.',
	'2 Kron.',
	'2Kron.',
	'Esther',
	'Pred.',
	'Ezech.',
	'Ez.',
	'Obadja',
	'Micha',
	'Zef.',
	'Matt.',
	//toegevoegd als test
	'Hebr.',
	'1 Tim.',
	'2 Tim.',
	'Openb.',
	'Marc.'
	)
}
return abrev
}

/**
 * @properties={typeid:24,uuid:"81488abf-c182-498c-85c8-b404ab8b2396"}
 */
function sb_edit_TextToHtmlGetSpecialCharsArray()
{
var replaceArray = new Array();
replaceArray['e^']='&#275;'
replaceArray['a^']='&#257;'
replaceArray['i^']='&#299;'
replaceArray['o^']='&#333;'
replaceArray['u^']='&#363;'
replaceArray[">Q<"]=">&#8216;<"
replaceArray[">W<"]=">&#8217;<"
replaceArray['E^']='&#274;'
replaceArray['A^']='&#256;'
replaceArray['I^']='&#298;'
replaceArray['O^']='&#332;'

replaceArray['ē']='&#275;'
replaceArray['ā']='&#257;'
replaceArray['ī']='&#299;'
replaceArray['ō']='&#333;'
replaceArray['ū']='&#363;'
replaceArray['Ē']='&#274;'
replaceArray['Ā']='&#256;'
replaceArray['Ī']='&#298;'
replaceArray['Ō']='&#332;'
replaceArray['Ū']='&#362;'

replaceArray["</I>W"]="</I>&#8217;"
replaceArray["â€™"]= "&#8217;"
replaceArray["â€˜"]= "&#8216;"
replaceArray["<l level=\"1\">"]= "<l level=\"1\" ><br>&nbsp;&nbsp;&nbsp;&nbsp;"
replaceArray["‘"]="&#8216;"
replaceArray["’"]="&#8217;"
replaceArray["\\n"]="<BR>";

// Aditions by Rick//
//replaceArray["<font1>"] = "<small style=\"text-transform: uppercase\">";
//replaceArray["</font1>"] = "</small>";

return replaceArray;
}

/**
 * @properties={typeid:24,uuid:"54a2a491-3a3c-4a31-853d-c8e81ae2af19"}
 * @AllowToRunInFind
 */
function sb_edit_WordsTranslationToHTML_nt()
{
var aTypes = new Array();
	aTypes.push('TR');
	aTypes.push('H-F');
	aTypes.push('N25');
	aTypes.push('N27');
	
var vVerseID = arguments[0];
var vGreek = "";
var iIndex, vWordsStrong;

if(vVerseID > 0)
{
	for(m in aTypes) 
	{
		//if(forms.words_fill_in.controller.find())
		//{
			if(aTypes[m] == 'TR')
			{
				var vSQL2 = "SELECT pk FROM words WHERE (word_original != '' AND word_original IS NOT NULL) AND verse_id = " + globals.selected_verse_id + " AND words.tr = 1 ORDER BY word_order"
				//forms.words_fill_in.tr = 1;
			} else if(aTypes[m] == 'H-F')
			{
			var vSQL2 = "SELECT pk FROM words WHERE (word_original != '' AND word_original IS NOT NULL) AND verse_id = " + globals.selected_verse_id + " AND words.hf = 1 ORDER BY word_order"
				
				//forms.words_fill_in.hf = 1;
			}else if(aTypes[m] == 'N25')
			{
			var vSQL2 = "SELECT pk FROM words WHERE (word_original != '' AND word_original IS NOT NULL) AND verse_id = " + globals.selected_verse_id + " AND words.n25 = 1 ORDER BY word_order"
				
				//forms.words_fill_in.n25 = 1;
			}else if(aTypes[m] == 'N27')
			{
			var vSQL2 = "SELECT pk FROM words WHERE (word_original != '' AND word_original IS NOT NULL) AND verse_id = " + globals.selected_verse_id + " AND words.n27 = 1 ORDER BY word_order"
				
				//forms.words_fill_in.n27 = 1;
			}
			
			//forms.words_fill_in.verse_id = vVerseID;
			//forms.words_fill_in.controller.search();
		//}
		
		var vFoundset2 = databaseManager.getFoundSet("sb", "words")
		vFoundset2.loadRecords(vSQL2)
		
		var j = 0;
		var vPreviousCode = 0;
		
		var vWords = '<html><body><table><tr><td><table cellpadding=\"4\" cellspacing=\"4\">';
		var vGreek2 = "<html><body><table><tr><td><table cellpadding=\"4\" cellspacing=\"4\">"
		
		for(var i = 1; i <= vFoundset2.getSize(); i++)
		{
			var vRecord = vFoundset2.getRecord(i);
			vFoundset2.setSelectedIndex(i);
			vRecord.words_to_word_variants.setSelectedIndex(i);
			
			var iDisplay = 1;
			var iColored = 0;
			var iCertainMode = 0;
			var vCode = ""; 
			
			if(iDisplay == 1)
			{
				if(vRecord.tr == 0 || vRecord.hr == 0 || vRecord.n25 == 0 || vRecord.n27 == 0)
				{
					iColored = 1;
				}
				
				
				
				if(vRecord.words_to_word_variants.code_no != null && vRecord.words_to_word_variants.code_no != "" && vRecord.words_to_word_variants.code_no != "  ")
				{
					vCode = vRecord.words_to_word_variants.code_no;
				}
				
				
				/////////////////////////////////////////////////////////////////////////
				
				j++;
				
				if(j%4 == 1)
				{
					vWords += '<tr>';
					vGreek2 += '<tr>';
					
				}
				
				vWords += '<td valign=\"top\">';
				vGreek2 += '<td valign=\"top\">';
				
				//if(utils.stringTrim(vCode))
				if(vCode)
				{
					if(vPreviousCode != vCode)
					{
						vPreviousCode = vCode;
						if(iColored == 1)
						{
							vWords += '<font color=\"#7A004D\">';
							vWords += '<sup><font size=\"3\">';
							vWords += vCode;
							vWords += '</font></sup>';
							vWords += '</font>';
						}
					}
				}
					// Certain modes
					vGreek = "";
					if(iCertainMode == 1)
					{
						vGreek += '[';
					}
					
					//vGreek = vGreek.concat('<a href="javascript:forms.study_words.searchWord(\'');
					vGreek += '<a href=\"javascript:forms.study_words.searchWord(\''
					iIndex = vRecord.word_strong.indexOf('.');
					vWordsStrong = "";
					
					if(iIndex > 0)
					{
						vWordsStrong = vRecord.word_strong.substring(0, iIndex);
					} else {
						vWordsStrong = vRecord.word_strong;
					}
					
					vGreek += vWordsStrong;
					
					if(iColored == 1)
					{
						//vGreek = vGreek.concat('\')" style="color:#7A004D;text-decoration:none"><font face="GreekSBBold" color="#7A004D">');
						vGreek += '\')\" style=\"color:#7A004D;text-decoration:none\"><font face=\"GreekSBBold\" color=\"#7A004D\">'
					} else {
						//vGreek = vGreek.concat('\')" style="color:#000000;text-decoration:none"><font face="GreekSBBold"	color="#000000">');
						vGreek += '\')\" style=\"color:#000000;text-decoration:none\"><font face=\"GreekSBBold\"	color=\"#000000\">'
					}
					
					vGreek += vRecord.word_original;
					
					vGreek += '</font></a>';
						
					if(iCertainMode == 1)
					{
						vGreek += ']';
					}
					
					vWords += vGreek;
					
					if(iColored == 1)
					{
						vWords += '<font color=\"#7A004D\">';
					}
					
					vWords += '<br />';
					vWords += vRecord.word_transliteration;
					vWords += '<br />';
					vWords += vRecord.word_translation;
					if(iColored == 1)
					{
						vWords += '</font>';
					}
					
					vWords += '</td>';
					
					
					vGreek2 += vGreek
					vGreek2 += '</td>'
					
					if(j%4 == 0)
					{
						vWords += '</tr>';
						vGreek2 += '</tr>';
					}
				//}
				
				
				/// Manuscripts
				
				if(forms.fill_manuscript_info.controller.find())
				{
					forms.fill_manuscript_info.verse_id = vVerseID;
					// ADDIDTIONS
					switch(aTypes[m])
					{
						case "TR":
							forms.fill_manuscript_info.tr = 1
						break;
						
						case "H-F":
							forms.fill_manuscript_info.hf = 1;
						break;
						
						case "N25":
							forms.fill_manuscript_info.n25 = 1;
						break;
						
						case "N27":
							forms.fill_manuscript_info.n27 = 1;
						break;
					}
					forms.fill_manuscript_info.controller.search();
				}
			}
		}
		
		var vFistTime = 1
		for(var z = 1; z <= forms.fill_manuscript_info.foundset.getSize(); z++)
		{
			var vRecord2 = forms.fill_manuscript_info.foundset.getRecord(z);
			
			var iDisplay2 = 1;
			if(aTypes[m] == 'TR' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'H-F' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N25' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N27' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			iDisplay2 = 1;
			
			if(iDisplay2 == 1)
			{
				if(vFistTime == 1)
				{
					vWords += '</table></td></tr></table>';
					vGreek2 += '</table></body></html>'
					vFistTime = 0
				}
				vWords += '<table><tr><td><font size="3">';
				
				if(vRecord2.code_no != 0)
				{
					vWords += vRecord2.code_no;
				}
				vWords += ' ';
				var vText = vRecord2.manuscript_text;
				
				if(vText != null)
				{
					var vIndex1 = vText.indexOf('<grk>');
					var vIndex2 = vText.indexOf('</grk>');
					
					if(vIndex1 > 0)
					{
						var vGreek3 = vText.substring(vIndex1+5, vIndex2);
							vGreek3 = plugins.SB_NT.getGreek(vGreek3);
						
						var vNewText = vText.substring(0, vIndex1);
						vNewText += '<font size=\"3\" face=\"GreekSB\">';
						vNewText += vGreek3;
						vNewText += '</font>';
						vNewText += vText.substring(vIndex2+6);
					} else {
						var vNewText = vText
					}
					
					vWords += vNewText;
					vWords += '</font></td></tr></table>';
				}
			}
		}
		if(vFistTime == 1)
		{
			vWords += '</table></td></tr></table>'
			vGreek2 += '</table></td></tr></table>'
		}
		vWords += '</body></html>';
		vGreek += '</body></html>';
		// Foundset genereren
		var vFoundset = databaseManager.getFoundSet('sb', 'verses');
		
		if(vFoundset.find())
		{		
			vFoundset.pk = vVerseID;
			vFoundset.search();
		}
		
		if(aTypes[m] == 'TR')
		{
			vFoundset.words_html_tr = vWords;
			vFoundset.words_html_tr_gr = vGreek2;
		}
		if(aTypes[m] == 'H-F')
		{
			vFoundset.words_html_hf = vWords;
			vFoundset.words_html_hf_gr = vGreek2;
		}
		if(aTypes[m] == 'N25')
		{
			vFoundset.words_html_n25 = vWords;
			vFoundset.words_html_n25_gr = vGreek2;
		}
		if(aTypes[m] == 'N27')
		{
			vFoundset.words_html_n27 = vWords;
			vFoundset.words_html_n27_gr = vGreek2;
		}
	}
}
databaseManager.saveData()

}

/**
 * @properties={typeid:24,uuid:"f82e4adf-2635-4df8-8fc5-489fec15962c"}
 * @AllowToRunInFind
 */
function sb_edit_WordsTranslationToHTML_nt_bug()
{
var aTypes = new Array();
	aTypes.push('TR');
	aTypes.push('H-F');
	aTypes.push('N25');
	aTypes.push('N27');
	
var vVerseID = arguments[0];
var vGreek = "";
var iIndex, vWordsStrong;

//application.output(vVerseID);

if(vVerseID > 0)
{
	for(m in aTypes) 
	{
		if(forms.words_fill_in.controller.find())
		{
			if(aTypes[m] == 'TR')
			{
				forms.words_fill_in.tr = 1;
			}
			if(aTypes[m] == 'H-F')
			{
				forms.words_fill_in.hf = 1;
			}
			if(aTypes[m] == 'N25')
			{
				forms.words_fill_in.n25 = 1;
			}
			if(aTypes[m] == 'N27')
			{
				forms.words_fill_in.n27 = 1;
			}
			
			forms.words_fill_in.verse_id = vVerseID;
			forms.words_fill_in.controller.search();
		}
		
		var j = 0;
		var vPreviousCode = 0;
		
		var vWords = '<html><body><table><tr><td><table cellpassind="4" cellspacing="4">';
		
		for(var i = 1; i <= forms.words_fill_in.foundset.getSize(); i++)
		{
			var vRecord = forms.words_fill_in.foundset.getRecord(i);
			forms.words_fill_in.foundset.setSelectedIndex(i);
			forms.words_fill_in.words_to_word_variants.setSelectedIndex(i);
			
			var iDisplay = 1;
			var iColored = 0;
			var iCertainMode = 0;
			var vCode = ""; 
			
		/*	if(aTypes[m] == 'TR' && forms.words_fill_in.words_to_word_variants.tr == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'H-F' && forms.words_fill_in.words_to_word_variants.hf == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N25' && forms.words_fill_in.words_to_word_variants.n25 == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N27' && forms.words_fill_in.words_to_word_variants.n27 == 0)
			{
				iDisplay = 0;
			} */
			
			if(iDisplay == 1)
			{
				if(forms.words_fill_in.tr == 0 || forms.words_fill_in.hr == 0 || forms.words_fill_in.n25 == 0 || forms.words_fill_in.n27 == 0)
				{
					iColored = 1;
				}
				
				if(forms.words_fill_in.words_to_word_variants.code_no != null && forms.words_fill_in.words_to_word_variants.code_no != "")
				{
					vCode = forms.words_fill_in.words_to_word_variants.code_no;
				}
				
				
				/////////////////////////////////////////////////////////////////////////
				
				j++;
				
				if(j%4 == 1)
				{
					vWords = vWords.concat('<tr>');
				}
				
				vWords = vWords.concat('<td valign="top">');
				
				//if(utils.stringTrim(vCode))
				if(vCode)
				{
					if(vPreviousCode != vCode)
					{
						vPreviousCode = vCode;
						if(iColored == 1)
						{
							vWords = vWords.concat('<font color="#7A004D">');
							vWords = vWords.concat('<sup><font size="3">');
							vWords = vWords.concat(vCode);
							vWords = vWords.concat('</font></sup>');
							vWords = vWords.concat('</font>');
						}
					}
					
					// Certain modes
					vGreek = "";
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat('[');
					}
					
					vGreek = vGreek.concat('<a href="javascript:forms.study_words.searchWord(\'');
					iIndex = vRecord.word_strong.indexOf('.');
					vWordsStrong = "";
					
					if(iIndex > 0)
					{
						vWordsStrong = vRecord.word_strong.substring(0, iIndex);
					} else {
						vWordsStrong = vRecord.word_strong;
					}
					
					vGreek = vGreek.concat(vWordsStrong);
					
					if(iColored == 1)
					{
						vGreek = vGreek.concat('\')" style="color:#7A004D;text-decoration:none"><font face="GreekSBBold" color="#7A004D">');
					} else {
						vGreek = vGreek.concat('\')" style="color:#000000;text-decoration:none"><font face="GreekSBBold"	color="#000000">');
					}
					
					vGreek = vGreek.concat(vRecord.word_original);
					
					vGreek = vGreek.concat('</font></a>');
						
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat(']');
					}
					
					vWords = vWords.concat(vGreek);
					
					if(iColored == 1)
					{
						vWords = vWords.concat('<font color="#7A004D"');
					}
					
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_transliteration);
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_translation);
					if(iColored == 1)
					{
						vWords = vWords.concat('</font>');
					}
					
					vWords = vWords.concat('</td>');
					
					if(j%4 == 0)
					{
						vWords = vWords.concat('</tr>');
					}
				}
				
				
				/// Manu scripts
				/*
				if(forms.fill_manuscript_info.controller.find())
				{
					forms.fill_manuscript_info.verse_id = vVerseID;
					forms.fill_manuscript_info.controller.search();
				}
				
				for(var z = 1; z <= forms.fill_manuscript_info.foundset.getSize(); z++)
				{
					var vRecord2 = forms.fill_manuscript_info.foundset.getRecord(z);
					
					vWords = vWords.concat('<tr><td><font size="3">');
					
					if(vRecord2.code_no != 0)
					{
						vWords = vWords.concat(vRecord2.code_no);
					}
					vWords = vWords.concat(' ');
					var vText = vRecord2.manuscript_text;
					
					if(vText != null)
					{
						var vIndex1 = vText.indexOf('<grk>');
						var vIndex2 = vText.indexOf('</grk>');
						
						if(vIndex1 > 0)
						{
							var vGreek2 = vText.substring(vIndex1+5, vIndex2);
								vGreek2 = plugins.SB_NT.getGreek(vGreek2);
							
							var vNewText = vText.substring(0, vIndex1);
							vNewText = vNewText.concat('<font size="3" face="GreekSB">');
							vNewText = vNewText.concat(vGreek2);
							vNewText = vNewText.concat('</font>');
							vNewText = vNewText.concat(vText.substring(vIndex2+6));
						} else {
							var vNewText = vText
						}
						
						vWords = vWords.concat(vNewText);
						vWords = vWords.concat('</font></td></tr>');
					}
				}*/
				vWords = vWords.concat('</table></td></tr></table></body></html>');
				// Opslaan
				
				// Foundset genereren
				var vFoundset = databaseManager.getFoundSet('sb', 'verses');
				
				if(vFoundset.find())
				{		
					vFoundset.pk = vVerseID;
					vFoundset.search();
				}
				
				if(aTypes[m] == 'TR')
				{
					vFoundset.words_html_tr = vWords;
					vFoundset.words_html_tr_gr = vGreek;
				}
				if(aTypes[m] == 'H-F')
				{
					vFoundset.words_html_hf = vWords;
					vFoundset.words_html_hf_gr = vGreek;
				}
				if(aTypes[m] == 'N25')
				{
					vFoundset.words_html_n25 = vWords;
					vFoundset.words_html_n25_gr = vGreek;
				}
				if(aTypes[m] == 'N27')
				{
					vFoundset.words_html_n27 = vWords;
					vFoundset.words_html_n27_gr = vGreek;
				}
				
				//// hier verder
				globals.words = vWords;
			}
			
		}
	}
}









}

/**
 * @properties={typeid:24,uuid:"02e5a8a7-e8a4-4ea6-8fa8-df4d4ee11924"}
 * @AllowToRunInFind
 */
function sb_edit_WordsTranslationToHTML_nt_old()
{
var vVerseID = arguments[0]

globals.words = ''
//application.output(''+globals.selected_verse_id)
if( globals.selected_verse_id > 0) {
    forms.words_fill_in.controller.find()
    forms.words_fill_in.verse_id = globals.selected_verse_id
    forms.words_fill_in.controller.search()
    //var aux = ''
    var j = 0 
    var previousCode = 0
    globals.words = globals.words.concat('<html><body><table><tr><td><table cellpadding=\"4\" cellspacing=\"4\">')
    for(var i=1;i<= forms.words_fill_in.foundset.getSize();i++) {
        var record = forms.words_fill_in.foundset.getRecord(i);
        
        var display = 1
        var colored = 0
        var certain_mode = 0 // word is certain
        var code = ''
        forms.words_fill_in. foundset.setSelectedIndex(i)
        forms.words_fill_in.words_to_word_variants.setSelectedIndex(i)
        if(globals.text_version == 'TR' && forms.words_fill_in.words_to_word_variants.tr == 0 ){
                display = 0    
        }
        else if(globals.text_version == 'H-F' && forms.words_fill_in.words_to_word_variants.hf == 0){
                display = 0
        }
        else if(globals.text_version == 'N25' && forms.words_fill_in.words_to_word_variants.n25 == 0){
                display = 0
        }
        else if(globals.text_version == 'N27' && forms.words_fill_in.words_to_word_variants.n27 == 0){
                display = 0
        }
        if( display == 1) {
            if( forms.words_fill_in.words_to_word_variants.tr == 0 ||
                forms.words_fill_in.words_to_word_variants.hf == 0 ||
                forms.words_fill_in.words_to_word_variants.n25 == 0 ||
                forms.words_fill_in.words_to_word_variants.n27 == 0){
                    colored = 1
            }
            if(forms.words_fill_in.words_to_word_variants.code_no != null && 
                forms.words_fill_in.words_to_word_variants.code_no != ""){
                code = forms.words_fill_in.words_to_word_variants.code_no
            }
        }
        
        /*forms.fill_word_variants.controller.find()
        forms.fill_word_variants.word_id = record.pk
        forms.fill_word_variants.controller.search()
        if(forms.fill_word_variants.foundset.getSize()>0) {
            var recWordVariant = forms.fill_word_variants.foundset.getRecord(1)
            if(globals.text_version == 'TR' && recWordVariant.tr == 0 ) {
                display = 0
            }
            if(globals.text_version == 'H-F' && recWordVariant.hf == 0){
                display = 0
            }
            if(globals.text_version == 'N25' && recWordVariant.n25 == 0)
                display = 0
            if(globals.text_version == 'N27' && recWordVariant.n27 == 0)
                display = 0
            if(globals.text_version == 'TR' && recWordVariant.mode_tr == 1 ) 
                certain_mode = 1 //word is not certain
            if(globals.text_version == 'H-F' && recWordVariant.mode_hf == 1)
                certain_mode = 1
            if(globals.text_version == 'N25' && recWordVariant.mode_n25 == 1)
                certain_mode = 1
            if(globals.text_version == 'N27' && recWordVariant.mode_n27 == 1)
                certain_mode = 1
            if( recWordVariant.tr == 0 ||
                 recWordVariant.hf == 0 ||
                 recWordVariant.n25 == 0 ||
                 recWordVariant.n26 == 0){
                    colored = 1
            }
            if(recWordVariant.code_no != null && recWordVariant.code_no != ""){
                code = recWordVariant.code_no
            }
        }*/
        
        if( display == 1 ){
            j += 1
            if( j % 4 == 1){
                globals.words = globals.words.concat('<tr>')
            }
            globals.words = globals.words.concat('<td valign=\"top\">')
            if( utils.stringTrim(code) != '' ){
                if(previousCode != code  ) {
                    if(colored == 1)
                        globals.words = globals.words.concat('<font color="#7A004D">')
                    globals.words = globals.words.concat('<sup><font size="3">')
                    globals.words = globals.words.concat(code)
                    previousCode = code
                    globals.words = globals.words.concat('</font></sup>')
                    if(colored == 1)
                        globals.words = globals.words.concat('</font')
                }
            }
            if(certain_mode == 1)
                globals.words = globals.words.concat('[')
            //globals.words = globals.words.concat('<B>')
            globals.words = globals.words.concat('<a href=\"javascript:forms.study_words.searchWord(\'')
            var index = record.word_strong.indexOf('.')
            var wordStrong = ''
            if( index > 0)
                wordStrong = record.word_strong.substring(0,index)
            else
                wordStrong = record.word_strong
            
            globals.words = globals.words.concat(wordStrong)
            if(colored == 1)
                globals.words = globals.words.concat('\')\" style=\"color:#7A004D;text-decoration:none\"><font face=\"GreekSBBold\" color="#7A004D">')
            else
                globals.words = globals.words.concat('\')\" style=\"color:black;text-decoration:none\"><font face=\"GreekSBBold\" color="#000000">')
            globals.words = globals.words.concat(record.word_original)
            globals.words = globals.words.concat('</font></a>')
            if(certain_mode == 1)
                globals.words = globals.words.concat(']')
            
            if( globals.griek_version != i18n.getI18NMessage('onlyGreek')){
                if(colored == 1)
                    globals.words = globals.words.concat('<font color="#7A004D">')
                globals.words = globals.words.concat('<br>')
                globals.words = globals.words.concat(record.word_transliteration)
                globals.words = globals.words.concat('<br>')
                globals.words = globals.words.concat(record.word_translation)
            
            }
            
            if(colored == 1)
                globals.words = globals.words.concat('</font>') 
            globals.words = globals.words.concat('</td>');
            if( j % 4 == 0) {
                globals.words = globals.words.concat('</tr>')
            }
        }
    }
    globals.words = globals.words.concat('</table></td></tr><tr><td><table>')
    forms.fill_manuscript_info.controller.find()
    forms.fill_manuscript_info.verse_id = globals.selected_verse_id
    forms.fill_manuscript_info.controller.search()
    
    for(var i=1;i <= forms.fill_manuscript_info.foundset.getSize();i++){
        var record = forms.fill_manuscript_info.foundset.getRecord(i);
        display = 1
        if(globals.text_version == 'TR' && record.tr == 0 ) 
                display = 0
            if(globals.text_version == 'H-F' && record.hf == 0)
                display = 0
            if(globals.text_version == 'N25' && record.n25 == 0)
                display = 0
            if(globals.text_version == 'N27' && record.n27 == 0)
                display = 0
        if( display == 1 ){
            globals.words = globals.words.concat('<tr><td><font size="3">')
            if( record.code_no != 0)
                globals.words = globals.words.concat(record.code_no)
            globals.words = globals.words.concat("   ")
            var text = record.manuscript_text
            if(text != null ){
                var index1 = text.indexOf('<grk>')
                var index2 = text.indexOf('</grk>')
                if(index1>0){
                    greek = text.substring(index1+5,index2)
                    greek = plugins.SB_NT.getGreek(greek)
                    var newText = text.substring(0,index1)
                    newText = newText.concat('<font size="3" face=\"GreekSB\">')
                    newText = newText.concat(greek)
                    newText = newText.concat('</font>')
                    newText = newText.concat(text.substring(index2+6)) 
                } 
                else {
                    newText = text
                }
                globals.words = globals.words.concat(newText)
            }
            globals.words = globals.words.concat('</font></td></tr>')
        }
    }
    globals.words = globals.words.concat('</table></td></tr></table></body></html>')
}
//forms.study_words.controller.show()

}

/**
 * @properties={typeid:24,uuid:"7c5fef2c-7026-4988-995c-0bc3c2769e3c"}
 */
function sb_edit_WordsTranslationToHTML_ot()
{
var vVerseID = arguments[0]

var rowSize = 4
var cont = Array(rowSize)
var cont_gr = Array(rowSize)

var query="select word_original, word_transliteration, word_translation, word_strong from words where verse_id=" + vVerseID + " and word_strong is not null and word_strong!='' order by word_order"
var res = databaseManager.getDataSetByQuery(forms.books.controller.getServerName(),query, null, 1000)
var size = res.getMaxRowIndex()
if(size!=0)
{
	var header = '<html><body><table><tr><td><table cellpadding="4" cellspacing="4">'
	var content = ''
	var content_gr = ''
	var footer = '</table></td></tr></table></body></html>'
	for ( var j=1; j<=size; j++ )
	{
		res.rowIndex = j
	
		if((j-1)%rowSize==0)
		{
			content+='<tr>'
			content_gr+='<tr>'
		}
		
	//	WTF???
	//	plugins.it2be_tools.defaultPrinter
		
		if(res[4])
		{
			var strong = res[4]
			var index=strong.indexOf('.', 0)
			if(index>0)
				strong = strong.substring(0, index)
			
		//	cont[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B><br><font face="SIL Heb Trans">'+plugins.SILEzraToUnicode.convertToEzra(res[2])+'</font><br>' + res[3] + '</td>'				
		//	cont_gr[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B></td>'
		//	cont[rowSize-(j-1)%rowSize-1] = "<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + plugins.SILEzraToUnicode.convertToEzra(res[1]) + "</font></B><br><font face=\"SIL Heb Trans\">"+plugins.SILEzraToUnicode.convertToEzra(res[2])+"</font><br>" +  utils.stringReplace(res[3],"'", "&#39;") + "</td>"				
		//	cont_gr[rowSize-(j-1)%rowSize-1] ="<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + plugins.SILEzraToUnicode.convertToEzra(res[1]) + "</font></B></td>"
			cont[rowSize-(j-1)%rowSize-1] = "<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + globals.stringToCharNo(res[1]) + "</font></B><br><font face=\"SIL Heb Trans\">"+ globals.stringToCharNo(res[2])+"</font><br>" +  utils.stringReplace(res[3],"'", "&#39;") + "</td>"				
			cont_gr[rowSize-(j-1)%rowSize-1] ="<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + globals.stringToCharNo(res[1]) + "</font></B></td>"

	}
		else
		{
			cont[rowSize-(j-1)%rowSize-1]=''
			cont_gr[rowSize-(j-1)%rowSize-1]=''
		}
		
		if(j%rowSize==0)
		{
			for(var k=0; k<rowSize;k++)
			{
				content+=cont[k]
				content_gr+=cont_gr[k]
			}
			content+='</tr>'
			content_gr+='</tr>'
		}
		
	}//j		
	if(size%rowSize!=0)
	{
		for(var k=0; k<rowSize-size%rowSize; k++)
		{
			content += '<td valign="top">&nbsp;</td>'
			content_gr += '<td valign="top">&nbsp;</td>'
		}
		for(var k=rowSize-size%rowSize; k<rowSize;k++)
		{
			content+=cont[k]
			content_gr+=cont_gr[k]
		}

		content+='</tr>'
		content_gr+='</tr>'
	}
	
	//var updateQuery = "UPDATE verses SET words_html_tr = '" + header + content + footer + "',words_html_tr_gr='"+ header + content_gr + footer + "' WHERE pk=" + vVerseID +";";
//

// Foundset method?
var vFoundset = databaseManager.getFoundSet('sb', 'verses');
vFoundset.loadRecords("SELECT pk FROM verses WHERE pk = " + vVerseID);

if(vFoundset.pk == vVerseID)
{
	vFoundset.words_html_tr = header + content + footer;
	vFoundset.words_html_tr_gr = header + content_gr + footer;
	databaseManager.saveData();
}

	return true;
//	//application.output(    updateQuery )
/*	var success =	plugins.rawSQL.executeSQL( forms.books.controller.getServerName(),  "verses",  updateQuery)
	if(!success)
		//application.output("Verses words cannot be updated")
	else
		databaseManager.refreshRecordFromDatabase(forms.verses_fill_in.foundset, -1)*/
	//	plugins.rawSQL.flushAllClientsCache(forms.books.controller.getServerName(), '')
}//size not zero


}

/**
 * @properties={typeid:24,uuid:"3e8b4373-7c34-4d16-88af-f267c3c49f3a"}
 */
function sb_edit_WordsTranslationToHTML_ot_werkend()
{
var vVerseID = arguments[0]

var rowSize = 4
var cont = Array(rowSize)
var cont_gr = Array(rowSize)

var query="select word_original, word_transliteration, word_translation, word_strong from words where verse_id=" + vVerseID + " and word_strong is not null and word_strong!='' order by word_order"
var res = databaseManager.getDataSetByQuery(forms.books.controller.getServerName(),query, null, 1000)
var size = res.getMaxRowIndex()
if(size!=0)
{
	var header = '<html><body><table><tr><td><table cellpadding="4" cellspacing="4">'
	var content = ''
	var content_gr = ''
	var footer = '</table></td></tr></table></body></html>'
	for ( var j=1; j<=size; j++ )
	{
		res.rowIndex = j
	
		if((j-1)%rowSize==0)
		{
			content+='<tr>'
			content_gr+='<tr>'
		}
		
		if(res[4])
		{
			var strong = res[4]
			var index=strong.indexOf('.', 0)
			if(index>0)
				strong = strong.substring(0, index)
			
		//	cont[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B><br><font face="SIL Heb Trans">'+plugins.SILEzraToUnicode.convertToEzra(res[2])+'</font><br>' + res[3] + '</td>'				
		//	cont_gr[rowSize-(j-1)%rowSize-1] ='<td valign="top"><B><a href="javascript:globals.wlink(\'' + strong + '\')" style="color:black;text-decoration:none"><font face="SIL Ezra" color="#000000">' + plugins.SILEzraToUnicode.convertToEzra(res[1]) + '</font></a></B></td>'
			cont[rowSize-(j-1)%rowSize-1] = "<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + plugins.SILEzraToUnicode.convertToEzra(res[1]) + "</font></B><br><font face=\"SIL Heb Trans\">"+plugins.SILEzraToUnicode.convertToEzra(res[2])+"</font><br>" + utils.stringReplace(res[3],"'", "&#39;") + "</td>"				
			cont_gr[rowSize-(j-1)%rowSize-1] ="<td valign=\"top\"><B><font face=\"SIL Ezra\" color=\"#000000\">" + plugins.SILEzraToUnicode.convertToEzra(res[1]) + "</font></B></td>"
	}
		else
		{
			cont[rowSize-(j-1)%rowSize-1]=''
			cont_gr[rowSize-(j-1)%rowSize-1]=''
		}
		
		if(j%rowSize==0)
		{
			for(var k=0; k<rowSize;k++)
			{
				content+=cont[k]
				content_gr+=cont_gr[k]
			}
			content+='</tr>'
			content_gr+='</tr>'
		}
		
	}//j		
	if(size%rowSize!=0)
	{
		for(var k=0; k<rowSize-size%rowSize; k++)
		{
			content += '<td valign="top">&nbsp;</td>'
			content_gr += '<td valign="top">&nbsp;</td>'
		}
		for(var k=rowSize-size%rowSize; k<rowSize;k++)
		{
			content+=cont[k]
			content_gr+=cont_gr[k]
		}

		content+='</tr>'
		content_gr+='</tr>'
	}
	
	var updateQuery = "UPDATE verses SET words_html_tr = '" + header + content + footer + "',words_html_tr_gr='"+ header + content_gr + footer + "' WHERE pk=" + vVerseID
//	//application.output(    updateQuery )
	var success =	plugins.rawSQL.executeSQL( forms.books.controller.getServerName(),  "verses",  updateQuery)
	if(success)
		databaseManager.refreshRecordFromDatabase(forms.verses_fill_in.foundset, -1)
		
	//	plugins.rawSQL.flushAllClientsCache(forms.books.controller.getServerName(), '')
}//size not zero


}

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"c083571c-8735-4044-9545-8b32f5c63cf7",variableType:12}
 */
var sb_export_charset = 'UTF-16';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"ca10a985-664a-46ae-9e9b-da59954515d5",variableType:4}
 */
var sb_import_backupCommentaryId = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"da10bf9b-5e04-4ad6-8941-726e4e7fb801",variableType:4}
 */
var sb_import_book_id;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"4186cb30-d350-4aa8-8a0e-f558d4badb40",variableType:4}
 */
var sb_import_bookId = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"1c3ba06c-cbe8-4ff9-8c0c-0ef69e1ab654",variableType:4}
 */
var sb_import_chapter;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"ebab6069-662b-42b3-be62-952ace8e7a2e",variableType:4}
 */
var sb_import_chapterFromId = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"02917270-0fc2-4e07-8944-ebd290aeb8a6",variableType:4}
 */
var sb_import_chapterToId = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"f8643505-f24a-4f1c-b03c-f533c3ff5922",variableType:12}
 */
var sb_import_commentary = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"cd5557a3-01e5-4c17-b677-4d9b39edbfd3",variableType:4}
 */
var sb_import_commentaryAndFootnotesValidated = 0;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"f462aa95-f2d4-4021-9210-a5130589709f",variableType:4}
 */
var sb_import_commentaryBlockCreated = 0;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"538380fd-7fe9-4519-a31b-5f4e02e277e5",variableType:12}
 */
var sb_import_commentaryError = '';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"6b9e7ef8-5428-42bb-8b50-755eaa070a40",variableType:4}
 */
var sb_import_commentaryId = 1;

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"cb2d35e8-e34f-416a-bd5c-58641f5596cf",variableType:12}
 */
var sb_import_file = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"a2584397-708f-46c2-abd4-629e2ed0b6ac",variableType:12}
 */
var sb_import_footnotes = '';

/**
 * @type String
 *
 * @properties={typeid:35,uuid:"f769f1af-6713-4cde-93e8-6656ff16c1d8",variableType:12}
 */
var sb_import_testament = 'Old';

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"3670167c-c4e9-4ec7-bbd1-27a591cb74a4",variableType:4}
 */
var sb_import_verseFromId = 1;

/**
 * @type Number
 *
 * @properties={typeid:35,uuid:"b777df31-3324-4ffe-a309-df0edaa9fb8a",variableType:4}
 */
var sb_import_verseToId = 1;

/**
 * @properties={typeid:24,uuid:"e1a1f142-e535-47f4-83ee-2b8e1012ae1f"}
 */
function sb_import_versTrans()
{
application.showFormInDialog( forms.sb_import_verse_translations,  -1,  -1,  -1,  -1, "i18n:servoy.menuitem.import",  false,  false,  forms.sb_import_verse_translations,  true)
}

/**
 * @properties={typeid:24,uuid:"2e9544df-7bc7-4aa5-901a-f3f5f498b147"}
 */
function sb_import_versWords()
{
application.showFormInDialog( forms.sb_import_verse_words,  -1,  -1,  -1,  -1, "i18n:servoy.menuitem.import",  false,  false,  forms.sb_import_verse_words,  true)
}

/**
 * @properties={typeid:24,uuid:"db9c4bf3-2e71-43be-8134-9c437b9145dd"}
 * @AllowToRunInFind
 */
function sb_import_wordTransLNTold()
{
var aTypes = new Array();
	aTypes.push('TR');
	aTypes.push('H-F');
	aTypes.push('N25');
	aTypes.push('N27');
	
var vVerseID = arguments[0];
var vGreek = "";
var iIndex, vWordsStrong;

//application.output(vVerseID);

if(vVerseID > 0)
{
	for(m in aTypes) 
	{
		if(forms.words_fill_in.controller.find())
		{
			if(aTypes[m] == 'TR')
			{
				forms.words_fill_in.tr = 1;
			}
			if(aTypes[m] == 'H-F')
			{
				forms.words_fill_in.hf = 1;
			}
			if(aTypes[m] == 'N25')
			{
				forms.words_fill_in.n25 = 1;
			}
			if(aTypes[m] == 'N27')
			{
				forms.words_fill_in.n27 = 1;
			}
			
			forms.words_fill_in.verse_id = vVerseID;
			forms.words_fill_in.controller.search();
		}
		
		var j = 0;
		var vPreviousCode = 0;
		
		var vWords = '<html><body><table><tr><td><table cellpassind="4" cellspacing="4">';
		
		for(var i = 1; i <= forms.words_fill_in.foundset.getSize(); i++)
		{
			var vRecord = forms.words_fill_in.foundset.getRecord(i);
			forms.words_fill_in.foundset.setSelectedIndex(i);
			forms.words_fill_in.words_to_word_variants.setSelectedIndex(i);
			
			var iDisplay = 1;
			var iColored = 0;
			var iCertainMode = 0;
			var vCode = ""; 
			
		/*	if(aTypes[m] == 'TR' && forms.words_fill_in.words_to_word_variants.tr == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'H-F' && forms.words_fill_in.words_to_word_variants.hf == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N25' && forms.words_fill_in.words_to_word_variants.n25 == 0)
			{
				iDisplay = 0;
			} else if(aTypes[m] == 'N27' && forms.words_fill_in.words_to_word_variants.n27 == 0)
			{
				iDisplay = 0;
			} */
			
			if(iDisplay == 1)
			{
				if(forms.words_fill_in.tr == 0 || forms.words_fill_in.hr == 0 || forms.words_fill_in.n25 == 0 || forms.words_fill_in.n27 == 0)
				{
					iColored = 1;
				}
				
				if(forms.words_fill_in.words_to_word_variants.code_no != null && forms.words_fill_in.words_to_word_variants.code_no != "")
				{
					vCode = forms.words_fill_in.words_to_word_variants.code_no;
				}
				
				
				/////////////////////////////////////////////////////////////////////////
				
				j++;
				
				if(j%4 == 1)
				{
					vWords = vWords.concat('<tr>');
				}
				
				vWords = vWords.concat('<td valign="top">');
				
				//if(utils.stringTrim(vCode))
				if(vCode)
				{
					if(vPreviousCode != vCode)
					{
						vPreviousCode = vCode;
						if(iColored == 1)
						{
							vWords = vWords.concat('<font color="#7A004D">');
							vWords = vWords.concat('<sup><font size="3">');
							vWords = vWords.concat(vCode);
							vWords = vWords.concat('</font></sup>');
							vWords = vWords.concat('</font>');
						}
					}
					
					// Certain modes
					vGreek = "";
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat('[');
					}
					
					vGreek = vGreek.concat('<a href="javascript:forms.study_words.searchWord(\'');
					iIndex = vRecord.word_strong.indexOf('.');
					vWordsStrong = "";
					
					if(iIndex > 0)
					{
						vWordsStrong = vRecord.word_strong.substring(0, iIndex);
					} else {
						vWordsStrong = vRecord.word_strong;
					}
					
					vGreek = vGreek.concat(vWordsStrong);
					
					if(iColored == 1)
					{
						vGreek = vGreek.concat('\')" style="color:#7A004D;text-decoration:none"><font face="GreekSBBold" color="#7A004D">');
					} else {
						vGreek = vGreek.concat('\')" style="color:#000000;text-decoration:none"><font face="GreekSBBold"	color="#000000">');
					}
					
					vGreek = vGreek.concat(vRecord.word_original);
					
					vGreek = vGreek.concat('</font></a>');
						
					if(iCertainMode == 1)
					{
						vGreek = vGreek.concat(']');
					}
					
					vWords = vWords.concat(vGreek);
					
					if(iColored == 1)
					{
						vWords = vWords.concat('<font color="#7A004D"');
					}
					
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_transliteration);
					vWords = vWords.concat('<br />');
					vWords = vWords.concat(vRecord.word_translation);
					if(iColored == 1)
					{
						vWords = vWords.concat('</font>');
					}
					
					vWords = vWords.concat('</td>');
					
					if(j%4 == 0)
					{
						vWords = vWords.concat('</tr>');
					}
				}
				
				
				/// Manu scripts
				
				if(forms.fill_manuscript_info.controller.find())
				{
					forms.fill_manuscript_info.verse_id = vVerseID;
					forms.fill_manuscript_info.controller.search();
				}
			}
		}
		
		for(var z = 1; z <= forms.fill_manuscript_info.foundset.getSize(); z++)
		{
			var vRecord2 = forms.fill_manuscript_info.foundset.getRecord(z);
			
			var iDisplay2 = 1;
			if(aTypes[m] == 'TR' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'H-F' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N25' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(aTypes[m] == 'N27' && vRecord2.tr == 0)
			{
				iDisplay2 = 0
			}
			if(iDisplay2 == 1)
			{
				vWords = vWords.concat('</table></td></tr></table>');
				vWords = vWords.concat('<table><tr><td><font size="3">');
				
				if(vRecord2.code_no != 0)
				{
					vWords = vWords.concat(vRecord2.code_no);
				}
				vWords = vWords.concat(' ');
				var vText = vRecord2.manuscript_text;
				
				if(vText != null)
				{
					var vIndex1 = vText.indexOf('<grk>');
					var vIndex2 = vText.indexOf('</grk>');
					
					if(vIndex1 > 0)
					{
						var vGreek2 = vText.substring(vIndex1+5, vIndex2);
							vGreek2 = plugins.SB_NT.getGreek(vGreek2);
						
						var vNewText = vText.substring(0, vIndex1);
						vNewText = vNewText.concat('<font size="3" face="GreekSB">');
						vNewText = vNewText.concat(vGreek2);
						vNewText = vNewText.concat('</font>');
						vNewText = vNewText.concat(vText.substring(vIndex2+6));
					} else {
						var vNewText = vText
					}
					
					vWords = vWords.concat(vNewText);
					vWords = vWords.concat('</font></td></tr>');
				}
			}
		}
		vWords = vWords.concat('</body></html>');
		// Foundset genereren
		var vFoundset = databaseManager.getFoundSet('sb', 'verses');
		
		if(vFoundset.find())
		{		
			vFoundset.pk = vVerseID;
			vFoundset.search();
		}
		
		if(aTypes[m] == 'TR')
		{
			vFoundset.words_html_tr = vWords;
			vFoundset.words_html_tr_gr = vGreek;
		}
		if(aTypes[m] == 'H-F')
		{
			vFoundset.words_html_hf = vWords;
			vFoundset.words_html_hf_gr = vGreek;
		}
		if(aTypes[m] == 'N25')
		{
			vFoundset.words_html_n25 = vWords;
			vFoundset.words_html_n25_gr = vGreek;
		}
		if(aTypes[m] == 'N27')
		{
			vFoundset.words_html_n27 = vWords;
			vFoundset.words_html_n27_gr = vGreek;
		}
		
	}
}


}

